[id="using-image-streams"]
= Using ImageStreams with Workload Resources
include::modules/common-attributes.adoc[]
:context: using-image-streams

toc::[]

== ImageStream Triggers
_ImageStreams_ can be integrated with OpenShift resources and Kubernetes resources, including CRDs.
In the end they are all handled in the same controller, just the configuration place differs.

ImageStream trigger works by resolving the image form the referenced ImageStream and inserting that image
into the referenced container image field.

Specifying an _ImageStream trigger_ and an _image for a container_ directly are _exclusive_ choices.
Either you wan't to specify the exact image, or let it be provided by the ImageStream trigger.
Specifying both at the same time will lead to weird states when the first rollout maybe be done using
the directly specified image with follow up rollout from the one injected from the ImageStream.
Similar behaviour will occur e.g. when doing `oc apply` since it will replace the injected image with
the one hard specified in the image field in yaml file and ImageStream trigger will reconcile and overwrite
it back but there will be unnecessary rollouts.

For the aforementioned reasons, using an ImageStream trigger to provide a container with an image, the container image field should be set to " "!

Note: DeploymentConfig won't try to rollout revision until the ImageStream trigger has been resolved (happens asynchronously). This isn't the case with upstream resources so you may see some error events w.r.t. creating a revision while the image is empty until the image is substituted. Those intermittent event are expected and are meant to be disregarded. (Hopefully we can make upstream more aware of the situations in the future.)


=== Generic ImageStreamTrigger
[source,yaml]
----
metadata:
  name: my-deployment
  annotations:
    image.openshift.io/triggers: '[{"from":{"kind":"ImageStreamTag","name":"openshift-acme:latest"},"fieldPath":"spec.template.spec.containers[?(@.name==\"openshift-acme\")].image"}]'  <2>
spec:
  ...
----
<1> The top level `metadata` field of your object
<2> ImageStream triggers

== CLI integration
`oc set trigger`
