[[install-config-persistent-storage-dynamically-provisioning-pvs]]
= Dynamically Provisioning Persistent Volumes
{product-author}
{product-version}
:data-uri:
:icons:
:experimental:
:toc: macro
:toc-title:
:prewrap!:

toc::[]

== Overview
You can provision your OpenShift cluster with storage dynamically when running
in a cloud environment. The Kubernetes
link:../../architecture/additional_concepts/storage.html[persistent volume]
framework allows administrators to provision a cluster with persistent storage
and gives users a way to request those resources without having any knowledge of
the underlying infrastructure.

Many storage types are available for use as persistent volumes in OpenShift.
While all of them can be statically provisioned by an administrator, some types
of storage can be created dynamically using an API. These types of storage can
be provisioned in an OpenShift cluster using the new and experimental dynamic
storage feature.

[IMPORTANT]
====
ifdef::openshift-enterprise[]
Dynamic provisioning of persistent volumes is currently a Technology Preview
feature, introduced in OpenShift Enterprise 3.1.1.
endif::[]
This feature is experimental and expected to change in the future as it matures
and feedback is received from users. New ways to provision the cluster are
planned and the means by which one accesses this feature is going to change.
Backwards compatibility is not guaranteed.
====

[[enabling-provisioner-plugins]]
== Enabling Provisioner Plug-ins

OpenShift provides the following _provisioner plug-ins_, which have generic
implementations for dynamic provisioning that use the cluster's configured cloud
provider's API to create new storage resources:

[options="header"]
|===

|Storage Type |Provisioner Plug-in Name |Required Cloud Configuration

|OpenStack Cinder
|`kubernetes.io/cinder`
|link:../../install_config/configuring_openstack.html[Configuring for OpenStack]

|AWS Elastic Block Store (EBS)
|`kubernetes.io/aws-ebs`
|link:../../install_config/configuring_aws.html[Configuring for AWS]

|GCE Persistent Disk (gcePD)
|`kubernetes.io/gce-pd`
|link:../../install_config/configuring_gce.html[Configuring for GCE]
|===

[IMPORTANT]
====
For any chosen provisioner plug-ins, the relevant cloud configuration must also
be set up, per *Required Cloud Configuration* in the above table.
====

When your OpenShift cluster is configured for EBS, GCE, or Cinder, the
associated provisioner plug-in is implied and automatically enabled. No
additional OpenShift configuration by the cluster administration is required for
dynamic provisioning.

For example, if your OpenShift cluster is configured to run in AWS, the EBS
provisioner plug-in is automatically available for creating
link:#dynamic-pvs-requesting-storage[dynamically provisioned storage requested
by a user].

Future provisioner plug-ins will include the many types of storage a single
provider offers. AWS, for example, has several types of EBS volumes to offer,
each with its own performance characteristics; there is also an NFS-like storage
option. More provisioner plug-ins will be implemented for the supported storage
types available in OpenShift.

[[dynamic-pvs-requesting-storage]]
== Requesting Dynamically Provisioned Storage

Users can request dynamically provisioned storage by including a storage class
annotation in their link:../../dev_guide/persistent_volumes.html[persistent
volume claim]:

.Persistent Volume Claim Requesting Dynamic Storage
====
[source,yaml]
----
kind: "PersistentVolumeClaim"
apiVersion: "v1"
metadata:
  name: "claim1"
  annotations:
    volume.alpha.kubernetes.io/storage-class: "foo" <1>
spec:
  accessModes:
    - "ReadWriteOnce"
  resources:
    requests:
      storage: "3Gi"
----
<1> The value of the `*volume.alpha.kubernetes.io/storage-class*` annotation is
not meaningful at this time. The presence of the annotation, with any arbitrary
value, triggers provisioning using the single implied
link:#enabling-provisioner-plugins[provisioner plug-in per cloud].
====

[[dynamic-pvs-volume-recycling]]
== Volume Recycling

Volumes created dynamically by a provisioner have their
`*persistentVolumeReclaimPolicy*` set to *Delete*. When a persistent volume
claim is deleted, its backing persistent volume is considered released of its
claim, and that resource can be reclaimed by the cluster. Dynamic provisioning
utilizes the provider's API to delete the volume from the provider and then
removes the persistent volume from the cluster.
