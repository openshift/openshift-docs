[[install-config-aggregate-logging-driver]]
= Changing the Aggregated Logging Driver 
{product-author}
{product-version}
:data-uri:
:icons:
:experimental:
:toc: macro
:toc-title:
:prewrap!:

toc::[]


For aggregated logging, it is recommended to use the `json-file` log driver.

[IMPORTANT]
====
When using the `json-file` driver, ensure that you are using Docker
version *docker-1.12.6-55.gitc4618fb.el7_4 now* or later.
====

Fluentd determines the driver Docker is using by checking the
*_/etc/docker/daemon.json_* and *_/etc/sysconfig/docker_* files.

You can determine which driver Docker is using with the `docker info` command:

----
# docker info | grep Logging

Logging Driver: journald
----

To change to `json-file`:

. Modify either the *_/etc/sysconfig/docker_* or *_/etc/docker/daemon.json_* files.
+
For example:
+
[source,json]
----
# cat /etc/sysconfig/docker
OPTIONS=' --selinux-enabled --log-driver=json-file --log-opt max-size=1M --log-opt max-file=3 --signature-verification=False'

cat /etc/docker/daemon.json
{
"log-driver": "json-file",
"log-opts": {
"max-size": "1M",
"max-file": "1"
}
}
----

. Restart the Docker service:
+
----
systemctl restart docker
----

. Restart Fluentd.
+
[WARNING]
====
Restarting Fluentd on more than a dozen nodes at once will create a large load
on the Kubernetes scheduler. Exercise caution when using the following the
directions to restart Fluentd.
====
+
There are two methods for restarting Fluentd. You can restart the Fluentd on one
node or a set of nodes, or on all nodes.
+
.. The following steps demonstrate how to restart Fluentd on one node or a set of
nodes.

... List the nodes where Fluentd is running:
+
----
$ oc get nodes -l logging-infra-fluentd=true
----
+
... For each node, remove the label and turn off Fluentd:
+
----
$ oc label node $node logging-infra-fluentd-
----
+
... Verify Fluentd is off:
+
----
$ oc get pods -l component=fluentd
----
+
... For each node, restart Fluentd:
+
----
$ oc label node $node logging-infra-fluentd=true
----
+
.. The following steps demonstrate how to restart the Fluentd all nodes.

... Turn off Fluentd on all nodes:
+
----
$ oc label node -l logging-infra-fluentd=true --overwrite logging-infra-fluentd=false
----
+
... Verify Fluentd is off:
+
----
$ oc get pods -l component=fluentd
----
+
... Restart Fluentd on all nodes:
+
----
$ oc label node -l logging-infra-fluentd=false --overwrite logging-infra-fluentd=true
----
+
... Verify Fluentd is on:
+
----
$ oc get pods -l component=fluentd
----

