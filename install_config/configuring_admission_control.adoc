= Configuring Admission Control Plugins
{product-author}
{product-version}
:data-uri:
:icons:
:experimental:
:toc: macro
:toc-title:

toc::[]

== Overview

An admission control plug-in is a piece of code that intercepts requests to the Master API server prior to
persistence of a resource, but after the request is authenticated and authorized.

Each admission control plug-in is run in sequence before a request is accepted into the cluster. If any plug-in
in the sequence rejects the request, the entire request is rejected immediately and an error is returned to the end-user.

Admission control plug-ins may modify the incoming object in some cases to apply system configured defaults.
In addition, admission control plug-ins may modify related resources as part of request processing to do things like increment quota usage.

== Configuring the list of admission control plugins

The OpenShift master uses two sets of admission control plugins. One set controls admission of Kubernetes-specific
resources such as Pods, ReplicationControllers, Services, etc. and another one controls admission of OpenShift-specific resources such
as Builds, Projects, Deployments, etc.

[WARNING]
====
The OpenShift master has a default list of plugins that are enabled by default for each type of resource (Kubernetes and OpenShift).
These are required for the proper functioning of the master. It is not recommended to modify these lists unless you strictly know what
you are doing. Future versions of the product may use a different set of plugins and may change their ordering. If you do override the
default list of plugins in the master config, you are responsible for updating it to reflect requirements of newer versions of the
OpenShift master.
====

=== Overriding the list of admission control plugins for OpenShift resources

The list of admission control plugins for OpenShift resources can be configured in the
link:master_node_configuration.html#master-configuration-files[master-config.yaml]
as follows:

[source,yaml]
----
admissionControl:
  pluginOrderOverride:
  - OriginNamespaceLifecycle
  - BuildByStrategy
  - YourPlugin
----

If the `pluginOrderOverride` setting is empty or not present, then the default set of plugins will be used.

The default list of admission control plugins for OpenShift resources is:

[source, yaml]
----
- OriginNamespaceLifecycle
- BuildByStrategy
----

* *OriginNamespaceLifecycle* Enforces that a
link:../architecture/core_concepts/projects_and_users.html#namespaces[Namespace]
must exist before creating resources in it. It also prevents creation of resources in a project
that is in the process of getting deleted.

* *BuildByStrategy* Restricts creation of
link:../architecture/core_concepts/builds_and_image_streams.html#builds[Builds]
and
link:../dev_guide/builds.html#defining-a-buildconfig[BuildConfigs]
to a strategy that the current user is
link:../admin_guide/securing_builds.html[allowed to use].

=== Overriding the list of admission control plugins for Kubernetes resources

The list of admission control plugins for Kubernetes resources can be configured in the
link:master_node_configuration.html#master-configuration-files[master-config.yaml]
as follows:

[source,yaml]
----
kubernetesMasterConfig:
  admissionConfig:
    pluginOrderOverride:
    - NamespaceLifecycle
    - OriginPodNodeEnvironment
    - YourPlugin
    - ...
----

The default list of admission control plugins for Kubernetes resources is:

[source, yaml]
----
- NamespaceLifecycle
- OriginPodNodeEnvironment
- LimitRanger
- ServiceAccount
- SecurityContextConstraint
- ResourceQuota
- SCCExecRestrictions
----

* *NamespaceLifecycle* Enforces that a
link:../architecture/core_concepts/projects_and_users.html#namespaces[Namespace]
must exist before creating resources in it. It also prevents creation of resources in a project
that is in the process of getting deleted.

* *OriginPodNodeEnvironment* Ensures that a
link:../architecture/core_concepts/pods_and_services.html#pods[Pod]'s node selector matches at least one node
in the cluster.

* *LimitRanger* Enforces resource usage
link:../dev_guide/limits.html[limits] for pods created in a given Namespace.

* *ServiceAccount* Ensures that all pods are associated with a valid
link:../dev_guide/service_accounts.html[service account] and that the
service account associated with the pod can properly execute it.

* *SecurityContextConstraint* Ensures that
link:../architecture/additional_concepts/authorization.html#security-context-constraints[security context constraints]
that apply to the current user and pod service account are applied to a pod.

* *ResourceQuota* Enforces
link:../dev_guide/quota.html[resource quota] that has been configured for a particular project.

* *SCCExecRestrictions* Prevents users from remotely executing processes on pods that they cannot create according to current
link:../architecture/additional_concepts/authorization.html#security-context-constraints[security context constraints].

== Providing configuration for Admission Control Plugins

Certain admission control plugins may take an additional configuration file. The configuration for a plugin may be provided either
as a file location or an embedded configuration object in
link:master_node_configuration.html#master-configuration-files[master-config.yaml].

If specifying a path to a configuration file, use a location field:

[source, yaml]
----
admissionControl:
  pluginConfig:
    MyPlugin:
      location: /path/to/pluginconfig
----

If specifying an embedded configuration, use a configuration field:

[source, yaml]
----
admissionControl:
  pluginConfig:
    MyPlugin:
      configuration:
        apiVersion: v1
        kind: MyPluginConfig
        configItem1: value1
        configItem2: value2
----

Each plugin is responsible for initializing and using the configuration provided in the master config file.
