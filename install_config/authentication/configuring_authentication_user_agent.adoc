[[configuring-authentication-user-agent-api]]
= Configuring User Agents to Prevent Access to the APIs
{product-author}
{product-version}
:data-uri:
:icons:
:experimental:
:toc: macro
:toc-title:
:prewrap!:

toc::[]

== Overview

{product-title} implements a user agent that can be used to prevent an application developer's CLI accessing the {product-title} API.



== Configuring User Agents

User agents for the {product-title} CLI are constructed from a set of values
within {product-title}:

----
<command>/<version> (<platform>/<architecture>) <client>/<git_commit>
----

For example: 

* If you have the following values:
+
** `<command>` = `oc`
** `<version>` = The client version. For example, `v3.5.0`. Requests made against the Kubernetes
API at `/api` receive the Kubernetes version, while requests made against the
{product-title} API at `/oapi` receive the {product-title} version (as specified
by `oc version`)
** `<platform>` = `linux`
** `<architecture>` = `amd64`
** `<client>` = `openshift`, or `kubernetes` depending on if the request is made against the Kubernetes API at `/api`, or the {product-title} API at `/oapi`
** `<git_commit>` = The Git commit of the client version (for example, `f034127`)

* The user agent will be:
+
----
oc/v3.5.0 (linux/amd64) openshift/f034127
----

As an {product-title} administrator, you can prevent clients from accessing the
API with the `userAgentMatching` configuration setting of a master
configuration. So, if a client is using a particular library or
binary, they will be prevented from accessing the API.

The following user agent example denies the Kubernetes 1.2 client binary,
OpenShift Origin 1.1.3 binary, and the POST and PUT `httpVerbs`:

====
----
policyConfig:
  userAgentMatchingConfig:
    defaultRejectionMessage: "Your client is too old.  Go to https://example.org to update it."
    deniedClients:
    - regex: '\w+/v(?:(?:1\.1\.1)|(?:1\.0\.1)) \(.+/.+\) openshift/\w{7}'
    - regex: '\w+/v(?:1\.1\.3) \(.+/.+\) openshift/\w{7}'
      httpVerbs:
      - POS5
      - PUT
    - regex: '\w+/v1\.2\.0 \(.+/.+\) kubernetes/\w{7}'
      httpVerbs:
      - POST
      - PUT
    requiredClients: null
----
====

Administrators can also deny clients that do not exactly match the expected
clients:

====
----
policyConfig:
  userAgentMatchingConfig:
    defaultRejectionMessage: "Your client is too old.  Go to https://example.org to update it."
    deniedClients: []
    requiredClients:
    - regex: '\w+/v1\.1\.3 \(.+/.+\) openshift/\w{7}'
    - regex: '\w+/v1\.2\.0 \(.+/.+\) kubernetes/\w{7}'
      httpVerbs:
      - POST
      - PUT
----
====

[NOTE]
====
When the client's user agent mismatches the configuration, errors occur. To
ensure that mutating requests match, enforce a whitelist. Rules are mapped to
specific verbs, so you can ban mutating requests while allowing non-mutating
requests.
====
