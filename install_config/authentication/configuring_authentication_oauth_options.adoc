[[install-config-configuring-authentication-oauth]]
= Configuring OAuth Token, Grant, and Session Options
{product-author}
{product-version}
:data-uri:
:icons:
:experimental:
:toc: macro
:toc-title:
:prewrap!:

toc::[]

== Overview

You can configure token, grant and session options for the OAuth deployment in your cluster.

== Configuring OAuth Options


When configuring OAuth, you can specify the following:

* Token options. The OAuth server generates two kinds of tokens:
+
** Access tokens.  Longer-lived tokens that grant access to the API.

** Authorize codes. Short-lived tokens whose only use is to be exchanged for
an access token.

* Grant options. When the OAuth server receives token requests for a client to which the user
has not previously granted permission, the action that the OAuth server takes
is dependent on the OAuth client's grant strategy.
+
When the OAuth client requesting token does not provide its own grant strategy,
the server-wide default strategy is used. To configure the default strategy,
set the `method` value in the `grantConfig` stanza. 

* Session Options. The OAuth server uses a signed and encrypted cookie-based session during login
and redirect flows. 
+
Use the `sessionConfig` stanza to set session options: 
+
** maximum age of a session
** name of the cookie used
** file name of the serialized SessionSecrets object



To configure OAuth:

. Edit the master configuration file:
+
----
/etc/origin/master/master-config.yaml
----

. Use the `tokenConfig` stanza to set token options, as needed:
+
.Master Configuration Token Options
====

----
oauthConfig:
  ...
  tokenConfig:
    accessTokenMaxAgeSeconds: 86400 <1>
    authorizeTokenMaxAgeSeconds: 300 <2>
----
<1> Set `accessTokenMaxAgeSeconds` to control the lifetime of access tokens.
The default lifetime is 24 hours.
<2> Set `authorizeTokenMaxAgeSeconds` to control the lifetime of authorize
codes. The default lifetime is five minutes.
====
[[install-config-configuring-authentication-oauth-grant]]
. Use the `grantConfig` stanza to set grant options, as needed:
+
.Master Configuration Grant Options
====

----
oauthConfig:
  ...
  grantConfig:
    method: auto
----
====
+
Valid values for `method` are:
+
* `auto`. Auto-approve the grant and retry the request.
* `prompt`. Prompt the user to approve or deny the grant.
* `deny`. Auto-deny the grant and return a failure error to the client.

. Use the `sessionConfig` stanza to configure session options:
+
.Master Configuration Session Options
====
----
oauthConfig:
  ...
  sessionConfig:
    sessionMaxAgeSeconds: 300 <1>
    sessionName: ssn <2>
    sessionSecretsFile: "..." <3> 
----

<1> Controls the maximum age of a session; sessions auto-expire once a token request is complete. If auto-grant is not enabled, sessions must last as long as the user is expected to take to approve or reject a client authorization request.
<2> Name of the cookie used to store the session.
<3> File name containing serialized SessionSecrets object. If empty, a random signing and encryption secret is generated at each server start. 
====

. Use the `secrets` stanza to set session secret options, as needed:
+
.Master Configuration Session Secret Options:
====

----
apiVersion: v1
kind: SessionSecrets
secrets: <1>
- authentication: "..." <2>
  encryption: "..." <3>
- authentication: "..."
  encryption: "..."
...
----
<1> List of secrets used to authenticate and encrypt cookie sessions. At least
one secret must be specified. Each secret must set an authentication and
encryption secret.
<2> Signing secret, used to authenticate sessions using HMAC. Recommended to use
a secret with 32 or 64 bytes.
<3> Encrypting secret, used to encrypt sessions. Must be 16, 24, or 32
characters long, to select AES-128, AES-192, or AES-256.
====
+
To specify the signing and encryption secret to use, specify a
`sessionSecretsFile`. This allows you separate secret values from the
configuration file and keep the configuration file distributable, for example
for debugging purposes.
+
Multiple secrets can be specified in the `sessionSecretsFile` to enable
rotation. New sessions are signed and encrypted using the first secret in the
list. Existing sessions are decrypted and authenticated by each secret until one
succeeds.
+
If no `sessionSecretsFile` is specified, a random signing and encryption
secret is generated at each start of the master server. This means that any
logins in progress will have their sessions invalidated if the master is
restarted. It also means that if multiple masters are configured, they will not
be able to decode sessions generated by one of the other masters.


include::install_config/authentication/configuring_authentication_allow_all.adoc[tag=restart-after-config-master]

