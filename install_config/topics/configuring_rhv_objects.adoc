////
Module included in the following assemblies:

install_config/configuring_rhv.adoc
////

[id='configuring-rhv-objects_{context}']
= Configuring Red Hat Virtualization for OpenShift

To integrate {product-title} with Red Hat Virtualization, perform the following
actions as part of your
xref:../install/host_preparation.adoc#install-config-install-host-preparation[host preparation].

Configuring Red Hat Virtualization for OpenShift involves the following key steps:

. Creating the bastion virtual machine
. Installing OpenShift
. Optionally, installing Metrics Store

== Creating the bastion virtual machine

. Log in to the Manager machine using SSH.
. Update the following parameters in `create-bastion-machine-playbook.yaml`:

* engine_url: https://_Manager_FQDN_/ovirt-engine/api
* engine_user: _Manager_username_
* engine_password: _Manager_password_
* qcow_url: `RHEL-guest-image` download URL. You can copy the URL from link:https://access.redhat.com/downloads/content/69/ver=/rhel---7/latest/x86_64/product-software[]:
.. In the *Product Software* tab, locate the `Red Hat Enterprise Linux KVM Guest Image`.
.. Right-click the *Download Now* button and copy the URL.
+
[NOTE]
====
This link expires after some time. Save the link when you are ready to run the playbook.
====

* vms / profile / root_password: _bastion_root_password_
* vms / cloud-init / rh_subscription / username: _Red_Hat_Subscription_Manager_username_
* vms / cloud-init / rh_subscription / password: _Red_Hat_Subscription_Manager_password_

. Create the bastion virtual machine:
+
[options="nowrap" subs="+quotes,verbatim"]
----
# ansible-playbook -i localhost create-bastion-machine-playbook.yaml
----

== Installing OpenShift

. Log in to the bastion virtual machine.
. Update the following parameters in `vars.yaml`:

* engine_url: 'https://_Manager_FQDN_/ovirt-engine/api'
* engine_user: _Manager_username_
* engine_password:  _Manager_password_
* engine_cafile: Path to the Manager CA certificate (default is `/etc/pki/ovirt-engine/ca.pem`). Required if `engine_insecure` is `false`.
* openshift_ovirt_cluster: _Default_
* openshift_ovirt_data_store: _Data_store_
* qcow_url: _RHEL-guest-image_URL_
* template_name: _RHEL7_

. Optionally, uncomment the `ovirt Metrics` section in `vars.yaml` if you are installing Metrics Store.

. Export the environment variables and run the OpenShift installation playbook:
+
[options="nowrap" subs="+quotes,verbatim"]
----
# export ANSIBLE_ROLES_PATH="/usr/share/ansible/roles/:/usr/share/ansible/openshift-ansible/roles"
# export ANSIBLE_JINJA2_EXTENSIONS="jinja2.ext.do"
# ansible-playbook -i openshift_3_11.hosts install_okd.yaml -e @vars.yaml
----

. Create DNS entries for the routers. Provide entries for all infrastructure instances and configure a round-robin strategy so that the router can pass traffic to applications.

. Create a DNS entry for the {product-title} web console. Specify the IP address of the load balancer node.
