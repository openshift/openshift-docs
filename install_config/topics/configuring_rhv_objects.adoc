////
Module included in the following assemblies:

install_config/configuring_rhv.adoc
////

[id='configuring-rhv-objects_{context}']
= Configuring Red Hat Virtualization for OpenShift

To integrate {product-title} with Red Hat Virtualization, perform the following
actions as part of your
xref:../install/host_preparation.adoc#install-config-install-host-preparation[host preparation].

Configuring Red Hat Virtualization for OpenShift involves the following key steps:

. Creating a bastion virtual machine
. Installing OpenShift
. Optionally, installing Metrics Store

.Prerequisite

To ensure high availability, assign each class of instances to a negative affinity group. See link:https://access.redhat.com/documentation/en-us/red_hat_virtualization/4.3-beta/html-single/virtual_machine_management_guide/#sect-Affinity_Groups[Affinity Groups] in the _Red Hat Virtualization Virtual Machine Management Guide_.

== Creating a bastion virtual machine

. Log in to the Manager machine using SSH.
. Update the following parameters in `create-bastion-machine-playbook.yaml`:

* engine_url: https://_Manager_FQDN_/ovirt-engine/api
* engine_user: _Manager_username_
* engine_password: _Manager_password_
* qcow_url: `RHEL-guest-image` URL. To copy the URL:
.. Go to `https://access.redhat.com/downloads/content/69/ver=/rhel---7/latest/x86_64/product-software`.
.. In the *Product Software* tab, right-click the *Download Now* button of the `Red Hat Enterprise Linux _version_ KVM Guest Image` and copy the link.
+
[NOTE]
====
This link expires after some time. Therefore, you should save the link when you are ready to run the playbook.
====

* vms / profile / root_password: '_bastion_root_password_'
* vms / cloud-init / rh_subscription / username: '_Red_Hat_Subscription_Manager_username_'
* vms / cloud-init / rh_subscription / password: '_Red_Hat_Subscription_Manager_password_'

. Create the bastion virtual machine:
+
[options="nowrap" subs="+quotes,verbatim"]
----
# ansible-playbook -i localhost create-bastion-machine-playbook.yaml
----

== Installing OpenShift

. Log in to the bastion virtual machine.

. Update the following parameters in `vars.yaml`:

* engine_url: 'https://_Manager_FQDN_/ovirt-engine/api'
* engine_user: '_Manager_username_'
* engine_password:  '_Manager_password_'
* engine_cafile: Required if `engine_insecure` is set to `false`. To download the CA certificate, enter the following command:
+
[options="nowrap" subs="+quotes,verbatim"]
----
# curl -k -o admin@internal:_Manager_password_ http://_Manager_FQDN_/ovirt-engine/services/pki-resource?resource=ca-certificate
----
* openshift_ovirt_cluster: '_Default_'
* openshift_ovirt_data_store: '_data_storage_domain_'
* qcow_url: 'RHEL-guest-image URL'
* template_name: 'RHEL 7'

. Optionally, uncomment the `ovirt Metrics` section in `vars.yaml` if you are installing Metrics Store.

. Export the environment variables and run the OpenShift installation playbook:
+
[options="nowrap" subs="+quotes,verbatim"]
----
# export ANSIBLE_ROLES_PATH="/usr/share/ansible/roles/:/usr/share/ansible/openshift-ansible/roles"
# export ANSIBLE_JINJA2_EXTENSIONS="jinja2.ext.do"
# ansible-playbook -i integ.ini install_okd.yaml -e @vars.yaml
----

. Create DNS entries for the routers. Provide entries for all infrastructure instances and configure a round-robin strategy so that the router can pass traffic to applications.

. Create a DNS entry for the {product-title} web console. Specify the IP address of the load balancer node.
