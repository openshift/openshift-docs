:_mod-docs-content-type: ASSEMBLY
[id="rosa-hcp-sts-creating-a-cluster-ext-auth"]
= Creating ROSA with HCP clusters with external authentication
include::includes/attributes-openshift-dedicated.adoc[]
:context: rosa-hcp-sts-creating-a-cluster-ext-auth


You can create {hcp-title-first} clusters that use external authentication to issue your access tokens.

[IMPORTANT]
====
Since it is not possible to upgrade or convert existing ROSA clusters to a {hcp} architecture, you must create a new cluster to use {hcp-title} functionality. You also cannot convert a cluster that was created to use external authentication providers to use the internal OAuth2 server. You must also create a new cluster.
====

include::includes/imp-rosa-hcp-no-shared-vpc-support.adoc[leveloffset=+0]

[NOTE]
====
{hcp-title} clusters only support {sts-first} authentication.
====

.Further reading
* For a comparison between {hcp-title} and ROSA Classic, see the link:https://access.redhat.com/documentation/en-us/openshift_container_platform/4.16/html-single/architecture/#rosa-hcp-classic-comparison_rosa-architecture-models[Comparing architecture models] documentation.
* See the AWS documentation for information about link:https://docs.aws.amazon.com/rosa/latest/userguide/getting-started-hcp.html[Getting started with ROSA with HCP using the ROSA CLI in auto mode].

.Additional resources

For a full list of the supported certificates, see the link:https://access.redhat.com/documentation/en-us/openshift_container_platform/4.16/html-single/introduction_to_rosa/#rosa-policy-compliance_rosa-policy-process-security[Compliance] section of "Understanding process and security for Red Hat OpenShift Service on AWS".

[id="rosa-hcp-external-auth-prereqs"]
== {hcp-title} Prerequisites

To create a {hcp-title} cluster, you must have completed the following steps:

* Completed the link:https://access.redhat.com/documentation/en-us/openshift_container_platform/4.16/html-single/prepare_your_environment/#rosa-sts-aws-prereqs[AWS prerequisites]
* xref:rosa-hcp-creating-vpc[Configured virtual private cloud (VPC)]
* Created xref:rosa-sts-creating-account-wide-sts-roles-and-policies_rosa-hcp-sts-creating-a-cluster-quickly[Account-wide roles]
* Created an xref:rosa-sts-byo-oidc_rosa-hcp-sts-creating-a-cluster-quickly[OIDC configuration]
* Created xref:rosa-operator-config_rosa-hcp-sts-creating-a-cluster-quickly[Operator roles]

// Step 1 Prepare HCP cluster with  --external-auth-providers-enabled
include::includes/rosa-hcp-sts-creating-a-cluster-external-auth-cluster-cli.adoc[leveloffset=+1]
//Step 2 Create/list/delete external_provider  to HCP cluster that external_auth_config is not enable
include::includes/rosa-hcp-sts-creating-a-cluster-external-auth-provider-cli.adoc[leveloffset=+1]

[role="_additional-resources"]
.Additional resources
* For more information about configuring Entra ID for your IDP, see link:https://learn.microsoft.com/en-us/entra/fundamentals/whatis[What is Microsoft Entra ID?] in the Azure documentation or the link:https://access.redhat.com/documentation/en-us/openshift_container_platform/4.16/html-single/tutorials/#cloud-experts-entra-id-idp[Configuring Microsoft Entra ID (formerly Azure Active Directory) as an identity provider] tutorial section of the documentation.
* For information about the similar `idps` tool in the ROSA CLI, see link:https://access.redhat.com/documentation/en-us/openshift_container_platform/4.16/html-single/cli_tools/#rosa-create-idp_rosa-managing-objects-cli[`create idp`].
* For more information about options in the ROSA CLI, see link:https://access.redhat.com/documentation/en-us/openshift_container_platform/4.16/html-single/cli_tools/#rosa-create-external-auth-provider_rosa-managing-objects-cli[`create external-auth-provider`], link:https://access.redhat.com/documentation/en-us/openshift_container_platform/4.16/html-single/cli_tools/#rosa-list-external-auth-provider_rosa-managing-objects-cli[`list external-auth-provider`], and link:https://access.redhat.com/documentation/en-us/openshift_container_platform/4.16/html-single/cli_tools/#rosa-delete-external-auth-provider_rosa-managing-objects-cli[`delete external-auth-provider`].

// Step 3: Create, list, and revoke a break glass credential
include::includes/rosa-hcp-sts-creating-a-break-glass-cred-cli.adoc[leveloffset=+1]

[role="_additional-resources"]
.Additional resources
* For more information about creating a {hcp-title} cluster with external authentication enabled, see xref:rosa-hcp-sts-creating-a-cluster-external-auth-cluster-cli_rosa-hcp-sts-creating-a-cluster-ext-auth[Creating a ROSA with HCP cluster that uses external authentication providers].
* For more information about CLI configurations, see link:https://access.redhat.com/documentation/en-us/openshift_container_platform/4.16/html-single/cli_tools/#managing-cli-profiles[Managing CLI profiles].

include::includes/rosa-hcp-sts-accessing-a-break-glass-cred-cli.adoc[leveloffset=+1]

[role="_additional-resources"]
.Additional resources
* For more information about cluster role binding, see link:https://access.redhat.com/documentation/en-us/openshift_container_platform/4.16/html-single/authentication_and_authorization/#rbac-overview[Using RBAC to define and apply permissions].

include::includes/rosa-hcp-sts-revoking-a-break-glass-cred-cli.adoc[leveloffset=+1]

//Step 4 delete external_provider  to HCP cluster that external_auth_config is not enable
include::includes/rosa-hcp-sts-creating-a-cluster-external-auth-provider-delete-cli.adoc[leveloffset=+1]

[role="_additional-resources"]
[id="additional-resources_rosa-sts-creating-a-cluster-ext-auth"]
== Additional resources

* For steps to deploy a ROSA cluster using manual mode, see link:https://access.redhat.com/documentation/en-us/openshift_container_platform/4.16/html-single/install_rosa_classic_clusters/#rosa-sts-creating-cluster-using-customizations_rosa-sts-creating-a-cluster-with-customizations[Creating a cluster using customizations].
* For more information about the AWS Identity Access Management (IAM) resources required to deploy {product-title} with STS, see link:https://access.redhat.com/documentation/en-us/openshift_container_platform/4.16/html-single/introduction_to_rosa/#rosa-sts-about-iam-resources[About IAM resources for clusters that use STS].
* To learn more about the default CIDR ranges for {product-title}, see link:https://access.redhat.com/documentation/en-us/openshift_container_platform/4.16/html-single/networking/#cidr-range-definitions[CIDR range definitions].
* For details about optionally setting an Operator role name prefix, see link:https://access.redhat.com/documentation/en-us/openshift_container_platform/4.16/html-single/introduction_to_rosa/#rosa-sts-about-operator-role-prefixes_rosa-sts-about-iam-resources[About custom Operator IAM role prefixes].
* For information about the prerequisites to installing ROSA with STS, see link:https://access.redhat.com/documentation/en-us/openshift_container_platform/4.16/html-single/prepare_your_environment/#rosa-sts-aws-prereqs[AWS prerequisites for ROSA with STS].
* For details about using the `auto` and `manual` modes to create the required STS resources, see link:https://access.redhat.com/documentation/en-us/openshift_container_platform/4.16/html-single/install_rosa_classic_clusters/#rosa-understanding-deployment-modes_rosa-sts-creating-a-cluster-with-customizations[Understanding the auto and manual deployment modes].
* For more information about using OpenID Connect (OIDC) identity providers in AWS IAM, see link:https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_providers_create_oidc.html[Creating OpenID Connect (OIDC) identity providers] in the AWS documentation.
* For more information about troubleshooting ROSA cluster installations, see link:https://access.redhat.com/documentation/en-us/openshift_container_platform/4.16/html-single/support/#rosa-troubleshooting-installations[Troubleshooting installations].
* For steps to contact Red Hat Support for assistance, see link:https://access.redhat.com/documentation/en-us/openshift_container_platform/4.16/html-single/support/#getting-support[Getting support for Red Hat OpenShift Service on AWS].
