:_mod-docs-content-type: ASSEMBLY
include::includes/attributes-openshift-dedicated.adoc[]
:context: rosa-sts-aws-prereqs
[id="rosa-sts-aws-prereqs"]
= Detailed requirements for deploying ROSA using STS


{product-title} (ROSA) provides a model that allows Red Hat to deploy clusters into a customerâ€™s existing Amazon Web Service (AWS) account.

include::includes/rosa-sts.adoc[]

Ensure that the following AWS prerequisites are met before installing ROSA with STS.

[IMPORTANT]
====
When you create a ROSA cluster using AWS STS, an associated AWS OpenID Connect (OIDC) identity provider is created as well. This OIDC provider configuration relies on a public key that is located in the `us-east-1` AWS region. Customers with AWS SCPs must allow the use of the `us-east-1` AWS region, even if these clusters are deployed in a different region.
====

[id="rosa-sts-customer-requirements_{context}"]
== Customer requirements when using STS for deployment

The following prerequisites must be complete before you deploy a {product-title} (ROSA) cluster that uses the AWS Security Token Service (STS).

include::includes/rosa-sts-aws-requirements-account.adoc[leveloffset=+2]
[role="_additional-resources"]
[id="additional-resources_aws-account-requirements_{context}"]
.Additional resources
* xref:rosa-limits-scalability[Limits and scalability]
* link:https://access.redhat.com/documentation/en-us/openshift_container_platform/4.16/html-single/support/#rosa-troubleshooting-elb-service-role_rosa-troubleshooting-cluster-deployments[Creating the Elastic Load Balancing (ELB) service-linked role]

include::includes/rosa-sts-aws-requirements-access-req.adoc[leveloffset=+2]

[role="_additional-resources"]
[id="additional-resources_aws-access-requirements_{context}"]
.Additional resources
* See link:https://access.redhat.com/documentation/en-us/openshift_container_platform/4.16/html-single/building_applications/#rosa-applications-config-custom-domains[Configuring custom domains for applications]

include::includes/rosa-sts-aws-requirements-support-req.adoc[leveloffset=+2]
include::includes/rosa-sts-aws-requirements-security-req.adoc[leveloffset=+2]

[role="_additional-resources"]
[id="additional-resources_aws-security-requirements_{context}"]
.Additional resources
* xref:osd-aws-privatelink-firewall-prerequisites_rosa-sts-aws-prereqs[AWS firewall prerequisites]

include::includes/rosa-sts-aws-requirements-ocm.adoc[leveloffset=+2]
include::includes/rosa-sts-aws-requirements-association-concept.adoc[leveloffset=+3]
include::includes/rosa-sts-aws-requirements-creating-association.adoc[leveloffset=+3]

[discrete]
[role="_additional-resources"]
[id="additional-resources_creating-association_{context}"]
== Additional resources
* See link:https://access.redhat.com/documentation/en-us/openshift_container_platform/4.16/html-single/introduction_to_rosa/#rosa-sts-account-wide-roles-and-policies_rosa-sts-about-iam-resources[Account-wide IAM role and policy reference] for a list of IAM roles needed for cluster creation.

include::includes/rosa-sts-aws-requirements-creating-multi-association.adoc[leveloffset=+3]


include::includes/rosa-requirements-deploying-in-opt-in-regions.adoc[leveloffset=+1]
include::includes/rosa-setting-the-aws-security-token-version.adoc[leveloffset=+2]

[id="rosa-sts-policy-iam_{context}"]
== Red Hat managed IAM references for AWS

With the STS deployment model, Red Hat is no longer responsible for creating and managing Amazon Web Services (AWS) IAM policies, IAM users, or IAM roles. For information on creating these roles and policies, see the following sections on IAM roles.

* To use the `ocm` CLI, you must have an `ocm-role` and `user-role` resource. See xref:rosa-sts-ocm-role[OpenShift Cluster Manager IAM role resources].
* If you have a single cluster, see link:https://access.redhat.com/documentation/en-us/openshift_container_platform/4.16/html-single/introduction_to_rosa/#rosa-sts-account-wide-roles-and-policies_rosa-sts-about-iam-resources[Account-wide IAM role and policy reference].
* For every cluster, you must have the necessary operator roles. See link:https://access.redhat.com/documentation/en-us/openshift_container_platform/4.16/html-single/introduction_to_rosa/#rosa-sts-operator-roles_rosa-sts-about-iam-resources[Cluster-specific Operator IAM role reference].

include::includes/rosa-aws-provisioned.adoc[leveloffset=+1]
// Keeping existing ID to prevent link breakage
[id="osd-aws-privatelink-firewall-prerequisites_rosa-sts-aws-prereqs"]
== AWS firewall prerequisites

If you are using a firewall to control egress traffic from your {product-title}, you must configure your firewall to grant access to the certain domain and port combinations below. {product-title} requires this access to provide a fully managed OpenShift service.

include::includes/osd-aws-privatelink-firewall-prerequisites.adoc[leveloffset=+2]
include::includes/rosa-hcp-firewall-prerequisites.adoc[leveloffset=+2]

[role="_additional-resources"]
.Additional resources

*  link:https://access.redhat.com/documentation/en-us/openshift_container_platform/4.16/html-single/support/#about-remote-health-monitoring[About remote health monitoring]

== Next steps
* xref:rosa-sts-required-aws-service-quotas[Review the required AWS service quotas]

[role="_additional-resources"]
[id="additional-resources_aws-prerequisites_{context}"]
== Additional resources
* link:https://access.redhat.com/documentation/en-us/openshift_container_platform/4.16/html-single/introduction_to_rosa/#rosa-policy-sre-access_rosa-policy-process-security[SRE access to all Red Hat OpenShift Service on AWS clusters]
* link:https://access.redhat.com/documentation/en-us/openshift_container_platform/4.16/html-single/building_applications/#rosa-applications-config-custom-domains[Configuring custom domains for applications]
* link:https://access.redhat.com/documentation/en-us/openshift_container_platform/4.16/html-single/introduction_to_rosa/#rosa-sdpolicy-instance-types_rosa-service-definition[Instance types]
