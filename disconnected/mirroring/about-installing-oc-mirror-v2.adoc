:_mod-docs-content-type: ASSEMBLY
[id="about-installing-oc-mirror-v2"]
= Mirroring images for a disconnected installation by using the oc-mirror plugin v2
include::_attributes/common-attributes.adoc[]
:context: about-installing-oc-mirror-v2

toc::[]

You can run your cluster in a restricted network without direct internet connectivity if you install the cluster from a mirrored set of {product-title} container images in a private registry. This registry must be running whenever your cluster is running.

Just as you can use the `oc-mirror` OpenShift CLI (`oc`) plugin, you can also use oc-mirror plugin v2 to mirror images to a mirror registry in your fully or partially disconnected environments. To download the required images from the official Red Hat registries, you must run oc-mirror plugin v2 from a system with internet connectivity.

:FeatureName: oc-mirror plugin v2
include::snippets/technology-preview.adoc[]

[id="prerequisites_oc-mirror-v2_{context}"]
== Prerequisites

* You must have a container image registry that supports link:https://docs.docker.com/registry/spec/manifest-v2-2[Docker V2-2] in the location that hosts the {product-title} cluster, such as {quay}.
+
[NOTE]
====
If you use {quay}, use version 3.6 or later with the oc-mirror plugin. See the documentation on link:https://access.redhat.com/documentation/en-us/red_hat_quay/3/html/deploying_the_red_hat_quay_operator_on_openshift_container_platform/index[Deploying the Red Hat Quay Operator on OpenShift Container Platform (Red Hat Quay documentation)]. If you need additional assistance selecting and installing a registry, contact your sales representative or Red Hat Support.
====

[Optional]
* If you do not have an existing solution for a container image registry, {product-title} subscribers receive a mirror registry for Red Hat OpenShift. This mirror registry is included with your subscription and serves as a small-scale container registry. You can use this registry to mirror the necessary container images of {product-title} for disconnected installations.

* Every machine in the provisioned clusters must have access to the mirror registry. If the registry is unreachable, tasks like installation, updating, or routine operations such as workload relocation, might fail. Mirror registries must be operated in a highly available manner, ensuring their availability aligns with the production availability of your {product-title} clusters.

.High level workflow

The following steps outline the high-level workflow on how to mirror images to a mirror registry by using the oc-mirror plugin v2:

. Create an image set configuration file.

. Mirror the image set to the target mirror registry by using one of the following workflows:

* Mirror an image set directly to the target mirror registry (mirror to mirror).

** Mirror an image set to disk (Mirror-to-Disk), transfer the `tar` file to the target environment, then mirror the image set to the target mirror registry (Disk-to-Mirror).

. Configure your cluster to use the resources generated by the oc-mirror plugin v2.

. Repeat these steps to update your target mirror registry as necessary.


// About oc-mirror plugin v2
include::modules/oc-mirror-v2-about.adoc[leveloffset=+1]

// oc-mirror compatibility and support
include::modules/oc-mirror-v2-support.adoc[leveloffset=+2]

//Preparing your mirror hosts
include::modules/oc-mirror-preparing-mirror-hosts.adoc[leveloffset=+1]

//Installing oc-mirror plugin v2
include::modules/oc-mirror-installing-plugin.adoc[leveloffset=+2]

//Configuring credentials that enable image mirroring
include::modules/installation-adding-registry-pull-secret.adoc[leveloffset=+2]

[id="using-oc-mirror_{context}"]
== Mirroring an image set to a mirror registry

Mirroring an image set to a mirror registry ensures that the required images are available in a secure and controlled environment, facilitating smoother deployments, updates, and maintenance tasks.

//Building the image set configuration
include::modules/oc-mirror-building-image-set-config-v2.adoc[leveloffset=+2]

//oc-mirror-workflows: mirroring in partially disconnected environment
include::modules/oc-mirror-workflows-partially-disconnected-v2.adoc[leveloffset=+2]

//Mirroring an image set in a fully disconnected environment:
include::modules/oc-mirror-workflows-fully-disconnected-v2.adoc[leveloffset=+2]
include::modules/oc-mirror-mirror-to-disk-v2.adoc[leveloffset=+2]
include::modules/oc-mirror-disk-to-mirror-v2.adoc[leveloffset=+2]

[id="additional-resources_{context}"]
== Additional resources

* xref:../../disconnected/updating/disconnected-update-osus.adoc#updating-disconnected-cluster-osus[Updating a cluster in a disconnected environment using the OpenShift Update Service]

// About custom resources generated by v2
include::modules/oc-mirror-IDMS-ITMS-about.adoc[leveloffset=+1]

// Configuring your cluster to use the resources generated by oc-mirror
include::modules/oc-mirror-updating-cluster-manifests-v2.adoc[leveloffset=+2]

//Delete Feature
// workflows of delete feature
include::modules/oc-mirror-workflows-delete-v2.adoc[leveloffset=+1]

// procedure for delete feature
include::modules/oc-mirror-procedure-delete-v2.adoc[leveloffset=+2]

// About dry-run
include::modules/oc-mirror-v2-about-dry-run.adoc[leveloffset=+1]

// Performing Dry-run for V2
include::modules/oc-mirror-dry-run-v2.adoc[leveloffset=+2]

//oc-mirror-enclave-support-about
include::modules//oc-mirror-enclave-support-about.adoc[leveloffset=+1]

// How to mirror to an Enclave
include::modules/oc-mirror-enclave-support.adoc[leveloffset=+2]

//operator catalog filtering
include::modules/oc-mirror-operator-catalog-filtering.adoc[leveloffset=+1]

//Image set configuration parameters
include::modules/oc-mirror-imageset-config-parameters-v2.adoc[leveloffset=+1]

// Command reference for oc-mirror v2
include::modules/oc-mirror-command-reference-v2.adoc[leveloffset=+1]
* xref:../../disconnected/mirroring/about-installing-oc-mirror-v2.adoc#oc-mirror-updating-cluster-manifests-v2_about-installing-oc-mirror-v2[Configuring your cluster to use the resources generated by oc-mirror]
