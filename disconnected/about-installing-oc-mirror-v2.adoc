:_mod-docs-content-type: ASSEMBLY
[id="about-installing-oc-mirror-v2"]
= Mirroring images for a disconnected installation by using the oc-mirror plugin v2
include::_attributes/common-attributes.adoc[]
:context: about-installing-oc-mirror-v2

toc::[]

You can run your cluster in a disconnected environment if you install the cluster from a mirrored set of {product-title} container images in a private registry. This registry must be running whenever your cluster is running.

You can use oc-mirror plugin v2 to mirror images to a mirror registry in your fully or partially disconnected environments. To download the required images from the official Red{nbsp}Hat registries, you must run oc-mirror plugin v2 from a system with internet connectivity.

// About oc-mirror plugin v2
include::modules/oc-mirror-v2-about.adoc[leveloffset=+1]

// oc-mirror compatibility and support
include::modules/oc-mirror-v2-support.adoc[leveloffset=+2]

[id="prerequisites_oc-mirror-v2_{context}"]
== Prerequisites

* You must have a container image registry that supports link:https://github.com/opencontainers/distribution-spec/blob/main/spec.md[OCI v1] in the location that hosts the {product-title} cluster, such as {quay}.
+
[NOTE]
====
* If you use {quay}, use version 3.6 or later with the oc-mirror plugin. See link:https://access.redhat.com/documentation/en-us/red_hat_quay/3/html/deploying_the_red_hat_quay_operator_on_openshift_container_platform/index[Deploying the Red{nbsp}Hat Quay Operator on {product-title} (Red{nbsp}Hat Quay documentation)]. If you need additional assistance selecting and installing a registry, contact your sales representative or Red{nbsp}Hat Support.

* If you do not have an existing solution for a container image registry, {product-title} subscribers receive a mirror registry for Red{nbsp}Hat OpenShift. This mirror registry is included with your subscription and serves as a small-scale container registry. You can use this registry to mirror the necessary container images of {product-title} for disconnected installations.
====

* Every machine in the provisioned clusters must have access to the mirror registry. If the registry is unreachable, tasks like installation, updating, or routine operations such as workload relocation, might fail. Mirror registries must be operated in a highly available manner, ensuring their availability aligns with the production availability of your {product-title} clusters.

//Preparing your mirror hosts
include::modules/oc-mirror-preparing-mirror-hosts.adoc[leveloffset=+1]

//Installing oc-mirror plugin v2
include::modules/oc-mirror-installing-plugin.adoc[leveloffset=+2]

//Configuring credentials that enable image mirroring
include::modules/installation-adding-registry-pull-secret.adoc[leveloffset=+2]

[id="using-oc-mirror_{context}"]
== Mirroring an image set to a mirror registry

Mirroring an image set to a mirror registry ensures that the required images are available in a secure and controlled environment, facilitating smoother deployments, updates, and maintenance tasks.

//Creating the image set configuration
include::modules/oc-mirror-building-image-set-config-v2.adoc[leveloffset=+2]

[role="_additional-resources"]
.Additional resources

* xref:../updating/understanding_updates/intro-to-updates.adoc#update-service-about_understanding-openshift-updates[About the OpenShift Update Service]

include::modules/oc-mirror-workflows-table.adoc[leveloffset=+2]

//Mirroring an image set in a partially disconnected environment
include::modules/oc-mirror-workflows-partially-disconnected-v2.adoc[leveloffset=+2]

//Mirroring an image set in a fully disconnected environment:
include::modules/oc-mirror-workflows-fully-disconnected-v2.adoc[leveloffset=+2]

include::modules/oc-mirror-mirror-to-disk-v2.adoc[leveloffset=+2]

include::modules/oc-mirror-disk-to-mirror-v2.adoc[leveloffset=+2]

// About custom resources generated by oc-mirror plugin v2
include::modules/oc-mirror-IDMS-ITMS-about.adoc[leveloffset=+1]

[role="_additional-resources"]
.Additional resources

* xref:../rest_api/operatorhub_apis/catalogsource-operators-coreos-com-v1alpha1.html[CatalogSource]

* xref:../rest_api/config_apis/imagedigestmirrorset-config-openshift-io-v1.adoc#imagedigestmirrorset-config-openshift-io-v1[ImageDigestMirrorSet]

* xref:../rest_api/config_apis/imagetagmirrorset-config-openshift-io-v1.adoc#imagetagmirrorset-config-openshift-io-v1[ImageTagMirrorSet]

* xref:../extensions/catalogs/managing-catalogs.adoc#olmv1-about-catalogs_managing-catalogs[About catalogs in {olmv1}]

// Restrictions on modifying oc-mirror-generated resources
include::modules/oc-mirror-restricted-fields.adoc[leveloffset=+2]

// Configuring your cluster to use the resources generated by oc-mirror
include::modules/oc-mirror-updating-cluster-manifests-v2.adoc[leveloffset=+2]

After your cluster is configured to use the resources generated by oc-mirror plugin v2, see xref:../disconnected/about-installing-oc-mirror-v2.adoc#next-steps_about-installing-oc-mirror-v2[Next steps] for information about tasks that you can perform using your mirrored images.

[role="_additional-resources"]
.Additional resources

* xref:../extensions/catalogs/disconnected-catalogs.adoc#disconnected-catalogs[Disconnected environment support in {olmv1}]

// Deletion of images from your disconnected environment
include::modules/oc-mirror-workflows-delete-v2.adoc[leveloffset=+1]

[role="_additional-resources"]
.Additional resources
* xref:../disconnected/about-installing-oc-mirror-v2.adoc#oc-mirror-v2-procedure-garbage-collector_about-installing-oc-mirror-v2[Resolving storage cleanup issues in the distribution registry]

include::modules/oc-mirror-v2-procedure-garbage-collector.adoc[leveloffset=+2]

// Deleting images from a disconnected environment
include::modules/oc-mirror-procedure-delete-v2.adoc[leveloffset=+2]

// About dry-run
include::modules/oc-mirror-v2-about-dry-run.adoc[leveloffset=+1]

// Performing Dry-run for V2
include::modules/oc-mirror-dry-run-v2.adoc[leveloffset=+2]

// Troubleshooting oc-mirror plugin v2 errors
include::modules/oc-mirror-troubleshooting-v2.adoc[leveloffset=+1]

// Benefits of enclave support
include::modules//oc-mirror-enclave-support-about.adoc[leveloffset=+1]

// Mirroring to an enclave
include::modules/oc-mirror-enclave-support.adoc[leveloffset=+2]

// Proxy support
include::modules/oc-mirror-proxy-support.adoc[leveloffset=+1]

[role="_additional-resources"]
.Additional resources
* xref:../disconnected/updating/disconnected-update-osus.adoc#updating-disconnected-cluster-osus[Updating a cluster in a disconnected environment using the OpenShift Update Service]
* xref:../disconnected/about-installing-oc-mirror-v2.adoc#oc-mirror-v2-procedure-garbage-collector_about-installing-oc-mirror-v2[Resolving storage cleanup issues in the distribution registry]

//signature mirroring
include::modules/oc-mirror-signature-mirroring.adoc[leveloffset=+1]

include::modules/oc-mirror-signature-mirroring-procedure.adoc[leveloffset=+2]

include::modules/oc-mirror-signature-verification.adoc[leveloffset=+2]

// Operator catalog filtering
include::modules/oc-mirror-operator-catalog-filtering.adoc[leveloffset=+1]

// Image set configuration parameters
include::modules/oc-mirror-imageset-config-parameters-v2.adoc[leveloffset=+1]

[role="_additional-resources"]
.Additional resources

* xref:../cli_reference/opm/cli-opm-ref.adoc#cli-opm-ref[opm CLI reference]

// Command reference for oc-mirror v2
include::modules/oc-mirror-command-reference-v2.adoc[leveloffset=+1]

include::modules/oc-mirror-command-reference-v2-delete.adoc[leveloffset=+2]

include::modules/oc-mirror-about-cache-and-workspace-dirs.adoc[leveloffset=+2]

[role="_additional-resources"]
.Additional resources
* xref:../disconnected/about-installing-oc-mirror-v2.adoc#oc-mirror-updating-cluster-manifests-v2_about-installing-oc-mirror-v2[Configuring your cluster to use the resources generated by oc-mirror]

[id="next-steps_{context}"]
== Next steps

After you mirror images to your disconnected environment using oc-mirror plugin v2, you can perform any of the following actions:

* xref:../disconnected/installing.adoc#installing-disconnected-environments[Installing a cluster in a disconnected environment]
* xref:../disconnected/using-olm.adoc#olm-restricted-networks[Using Operator Lifecycle Manager in disconnected environments]
* xref:../disconnected/updating/disconnected-update-osus.adoc#updating-disconnected-cluster-osus[Updating a cluster in a disconnected environment using the OpenShift Update Service]

// Intentionally linking to the OSUS update procedure since we probably want to steer users to do that workflow as much as possible. But I can change to the index of the update section if I shouldn't be as prescriptive.
