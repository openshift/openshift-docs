[id="applying-autoscaling"]
= Applying autoscaling to an {product-title} cluster
include::modules/common-attributes.adoc[]
:context: applying-autoscaling

toc::[]

Applying autoscaling to an {product-title} cluster involves deploying a cluster autoscaler and then deploying machine autoscalers for each machine type in your cluster.

[IMPORTANT]
====
You can configure the cluster autoscaler only in clusters where the machine API is operational.
====

include::modules/cluster-autoscaler-about.adoc[leveloffset=+1]

include::modules/machine-autoscaler-about.adoc[leveloffset=+1]

[id="configuring-clusterautoscaler"]
== Configuring the cluster autoscaler

First, deploy the cluster autoscaler to manage automatic resource scaling in your {product-title} cluster.

[NOTE]
====
Because the cluster autoscaler is scoped to the entire cluster, you can make only one cluster autoscaler for the cluster.
====

include::modules/cluster-autoscaler-cr.adoc[leveloffset=+2]

:FeatureName: cluster autoscaler
:FeatureResourceName: ClusterAutoscaler
include::modules/deploying-resource.adoc[leveloffset=+2]

//
// Addresses WINC-551 - https://github.com/openshift/openshift-docs/pull/32773 - Delete before merge
//

[id="cluster-autoscaler-machineset"]
== Configuring the machine set

The machine set which creates the Windows Machines requires configuring a file template. On creation, a `windows-user-data` secret is created. On subsequent use, the `windows-user-data` may be used by the machine sets. The associated machine sets may have the following labels:

* `machine.openshift.io/os-id: Windows`
* `machine.openshift.io/cluster-api-machine-role: worker`
* `machine.openshift.io/cluster-api-machine-type: worker`

The following label has to be added to the machine spec within the machine set spec:

* `node-role.kubernetes.io/worker:``

[IMPORTANT]
====
If these labels are not added, the the Windows node will not be marked as a `worker` node.
====

.Procedure

* Configure the machine set template with values from your environment, using the required guides:

** xref:../machine_management/creating_machinesets/creating-machineset-aws.adoc#creating-machineset-aws[AWS machine set]
** xref:../machine_management/creating_machinesets/creating-machineset-azure.adoc#creating-machineset-azure[Azure machine set]
** xref:../machine_management/creating_machinesets/creating-machineset-gcp.adoc#creating-machineset-gcp[GCP machine set]
** xref:../machine_management/creating_machinesets/creating-machineset-osp.adoc#creating-machineset-osp[OSP machine set]
** xref:../machine_management/creating_machinesets/creating-machineset-rhv.adoc#creating-machineset-rhv[RHV machine set]
** xref:../machine_management/creating_machinesets/creating-machineset-vsphere.adoc#creating-machineset-vsphere[vSphere machine set]

After you configure the cluster autoscaler and defined the machine set, you must configure at least one machine autoscaler.
//
// Delete before Merge
//

[id="configuring-machineautoscaler"]
== Configuring the machine autoscalers

After you deploy the cluster autoscaler, deploy `MachineAutoscaler` resources that reference the machine sets that are used to scale the cluster.

[IMPORTANT]
====
You must deploy at least one `MachineAutoscaler` resource after you deploy the `ClusterAutoscaler` resource.
====

[NOTE]
====
You must configure separate resources for each machine set. Remember that machine sets are different in each region, so consider whether you want to enable machine scaling in multiple regions. The machine set that you scale must have at least one machine in it.
====

include::modules/machine-autoscaler-cr.adoc[leveloffset=+2]

:FeatureName: machine autoscaler
:FeatureResourceName: MachineAutoscaler
include::modules/deploying-resource.adoc[leveloffset=+2]

== Additional resources

* For more information about pod priority, see xref:../nodes/pods/nodes-pods-priority.adoc#nodes-pods-priority[Including pod priority in pod scheduling decisions in {product-title}].
