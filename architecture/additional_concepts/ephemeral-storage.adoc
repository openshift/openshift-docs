[[architecture-additional-concepts-ephemeral-storage]]
= Ephemeral Local Storage
{product-author}
{product-version}
:data-uri:
:icons:
:experimental:
:toc: macro
:toc-title:
:prewrap!:

toc::[]

ifdef::openshift-origin,openshift-enterprise[]
[NOTE]
====
This section only applies if you have enabled the ephemeral storage technology 
feature preview in {product-title} 3.10. This feature is disabled by default. To
enable this feature, see
xref:../install_config/configuring_ephemeral.adoc[configuring for
ephemeral storage].

Technology Preview releases are not supported with Red Hat production service-level agreements
(SLAs) and might not be functionally complete, and Red Hat does not recommend using them for
production. These features provide early access to upcoming product features, enabling 
customers to test functionality and provide feedback during the development process. 
For more information see link:https://access.redhat.com/support/offerings/techpreview/
[Red Hat Technology Preview Features Support Scope]. 
====
endif::openshift-origin,openshift-enterprise[]

== Overview

In addition to persistent storage, pods and containers may require
ephemeral (transient) local storage for their operation. The lifetime
of this ephemeral storage does not extend beyond the life of the
individual pod, and this ephemeral storage cannot be shared across
pods.

Prior to {product-title} 3.10, ephemeral local storage was exposed to pods via
the container’s writable layer, logs directory, and EmptyDir volumes. Pods use
ephemeral local storage for scratch space, caching, and logs.  There are many
issues related to the lack of local storage accounting and isolation, including:

* Pods do not know how much local storage is available to them.
* Pods cannot request guaranteed local storage.
* Local storage is a best effort resource.
* Pods can get evicted due to other pods filling the local storage,
after which, new pods are not admitted until sufficient storage
has been reclaimed.

Unlike persistent volumes, ephemeral storage is unstructured and
shared (the space, not the actual data) between all pods running on a
node, in addition to other uses by the system, the container runtime,
and {product-title}. The ephemeral storage framework allows pods to
specify their transient local storage needs and {product-title} to
schedule pods where appropriate and protect the node against excessive
use of local storage.

While the ephemeral storage framework allows administrators and
developers to better manage this local storage, it does not provide
any promises related to I/O throughput and latency.

[[types-of-ephemeral-storage]]
== Types of ephemeral storage

Ephemeral local storage is always made available in the primary
partition. There are two basic ways of creating the primary
partition, root and runtime.

[[types-root]]
=== Root

This partition holds the kubelet’s root directory, `/var/lib/origin/`
by default, and `/var/log/` directory. This partition may be shared
between user pods, the operationg system, and Kubernetes system daemons. This partition
can be consumed by pods by using EmptyDir volumes, container logs, image
layers, and container writable layers. Kubelet manages shared
access and isolation of this partition. This partition is ephemeral
and applications cannot expect any performance SLAs, disk IOPS for
example, from this partition.

[[types-runtime]]
=== Runtime

This is an optional partition that runtimes can use for overlay
file systems. {product-title} attempts to identify and provide
shared access along with isolation to this partition. Container image
layers and writable layers are stored in this partition. If the runtime partition
exists, the `root` partition does not hold any image layer or other writable storage.

[NOTE]
====
When using DeviceMapper to provide runtime storage,
a containers' copy-on-write layer is not accounted for in ephemeral
storage management. Using overlay storage allows this use of
ephemeral storage to be monitored.
====