// Module included in the following assemblies:
//
// * admin_guide/aws-getting-started.adoc

[id='aws-getting-started-install-{context}']
= Installing the AWS Service Broker into an existing {product-title} cluster

AWS provides scripts that facilitate installing the AWS Service Broker into your {product-title} cluster.

.Procedure

To install the AWS Service Broker:

. Create a directory for the AWS Service Broker installation files:
+
----
# mkdir awssb
# cd awssb
----

. Download the installation files:
+
----
# wget https://raw.githubusercontent.com/awslabs/aws-servicebroker/release-v1.0.0-beta.2/packaging/openshift/deploy.sh
# wget https://raw.githubusercontent.com/awslabs/aws-servicebroker/release-v1.0.0-beta.2/packaging/openshift/aws-servicebroker.yaml
# wget https://raw.githubusercontent.com/awslabs/aws-servicebroker/release-v1.0.0-beta.2/packaging/openshift/parameters.env
# chmod +x deploy.sh
----
+
[NOTE]
====
These files are fully developed, supported, maintained, and tested by AWS.
====

. Edit the `parameters.env` as needed:
+
You can leave the default values for most installations. 
+
----
TARGETACCOUNTID= <1>
TARGETROLENAME=  <1>
VPCID=  
REGION=us-east-1
IMAGE=awsservicebroker/aws-servicebroker:beta
IMAGEPULLPOLICY=Always
S3BUCKET=awsservicebroker
S3KEY=templates/latest
S3REGION=us-east-1
TABLENAME=awssb
VERBOSITY=10
BROKERID=awsservicebroker
PRESCRIBE_OVERRIDES=true
----
+
<1> Leave these parameters blank if you are installing the AWS Service Broker using the account where the user or role is located. 
If you are using a different AWS account, specify the account ID and role for that account.

. Run the following command to start the installation script:
+
----
# ./deploy.sh <ACCESS_KEY_ID> <SECRET_KEY> <1>
----
+
<1> If your cluster is configured to access an AWS EC2 infrastructure, omit the `<ACCESS_KEY_ID>` and `<SECRET_KEY>`.
+
[NOTE]
====
You must have required permission to run this command. Contact your system administrator for permissions. 
====
+
The script creates all of the required {product-title} components, including:
+
* The `aws-servicebroker-client` service account;
* The `aws-servicebroker` secret;
* The `aws-servicebroker` cluster service broker; 
* The `aws-servicebroker` and `access-aws-servicebroker` cluster roles;
* The `aws-servicebroker` and `aws-servicebroker-client` cluster role bindings;
* The `aws-servicebroker` service;
* The `aws-servicebroker-credentials` secret;
* The `aws-servicebroker` deployment;
* An `aws-servicebroker-*` pod.

. Run the following command to verify that that the broker is running:
+
----
# oc get pods | grep aws-servicebroker

NAME                                READY     STATUS    RESTARTS   AGE
aws-servicebroker-946479445-shwq5   0/1       Running   1          36s
----

. Run the following command to check service broker logs:
+
----
# oc logs $(oc get pods --no-headers -o name | grep aws-servicebroker)
----
