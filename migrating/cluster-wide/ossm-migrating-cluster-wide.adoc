// Module included in the following assemblies:
//
// * service-mesh-docs-main/migrating/cluster-wide/ossm-migrating-cluster-wide-assembly.adoc

:_mod-docs-content-type: ASSEMBLY
[id="ossm-migrating-cluster-wide"]
= Cluster-wide migration guide
include::_attributes/common-attributes.adoc[]
:context: ossm-migrating-cluster-wide

toc::[]

This guide is for users who are running a cluster-wide deployment of {SMProductName} {SMv2Version} and are migrating to {SMProduct} 3.0.

[IMPORTANT]
====
You must complete the premigration checklists before you start migrating your deployment.
====

include::modules/ossm-control-plane-configuration-migration-requirements.adoc[leveloffset=+1]

[role="_additional-resources"]
[id="additional-resources-cluster-wide_{context}"]
.Additional resources

* xref:../../install/ossm-sidecar-injection.adoc#ossm-about-sidecar-injection_ossm-sidecar-injection[About sidecar injection]

* xref:../../migrating/checklists/ossm-migrating-network-policies.adoc#ossm-migrating-network-policies-setup-during-migration_ossm-migrating-network-policies[Set up network policies to use during migration]

* xref:../../install/ossm-installing-openshift-service-mesh.adoc#ossm-scoping-service-mesh-with-discoveryselectors_ossm-installing-openshift-service-mesh[Scoping the mesh with discoverySelectors]

include::modules/ossm-cluster-wide-migration-methods.adoc[leveloffset=+1]

// This sets the context to build the tasks for cluster-wide migration using the Istio revision label 
:context: cw-revision

include::modules/ossm-migrating-a-cluster-wide-deployment-using-the-istio-revision-label.adoc[leveloffset=+1]

include::modules/ossm-migrating-workloads-using-the-istio-revision-label.adoc[leveloffset=+2]

.Next steps

If you are using gateways, you must migrate them before you complete the migration process.

* xref:../../migrating/migrating-gateways/ossm-migrating-gateways.adoc#ossm-migrating-gateways[Migrating gateways]

If you are not using gateways, and have verified your cluster-wide migration, you can proceed to complete the migration and remove {SMProduct} 2 resources.

* xref:../../migrating/done/ossm-migrating-complete.adoc#ossm-migrating-complete[Completing the Migration]

// This sets the context to build the tasks for cluster-wide migration using the Istio revision label with cert-manager tasks
:context: cw-revision-cm

include::modules/ossm-migrating-a-cluster-wide-deployment-using-the-istio-revision-label.adoc[leveloffset=+1]

include::modules/ossm-migrating-workloads-using-the-istio-revision-label.adoc[leveloffset=+2]

.Next steps

If you are using gateways, you must migrate them before you complete the migration process.

* xref:../../migrating/migrating-gateways/ossm-migrating-gateways.adoc#ossm-migrating-gateways[Migrating gateways]

If you are not using gateways, and have verified your cluster-wide migration, you can proceed to complete the migration and remove {SMProduct} 2 resources.

* xref:../../migrating/done/ossm-migrating-complete.adoc#ossm-migrating-complete[Completing the Migration]

// This sets the context to build the tasks for cluster-wide migration using the Istio injection label
:context: cw-injection

include::modules/ossm-migrating-a-cluster-wide-deployment-using-the-istio-injection-label.adoc[leveloffset=+1]

include::modules/ossm-migrating-workloads-using-the-istio-injection-label.adoc[leveloffset=+2]

.Next steps

If you are using gateways, you must migrate them before you complete the migration process.

* xref:../../migrating/migrating-gateways/ossm-migrating-gateways.adoc#ossm-migrating-gateways[Migrating gateways]

If you are not using gateways, and have verified your cluster-wide migration, create a default revision tag and relabel namespaces.

include::modules/ossm-creating-a-default-revision-tag-and-relabeling-the-namespaces.adoc[leveloffset=+2]

.Next steps

You can proceed to complete the migration and remove {SMProduct} 2 resources.

* xref:../../migrating/done/ossm-migrating-complete.adoc#ossm-migrating-complete[Completing the Migration]

[IMPORTANT]
====
Before creating a default revision tag and relabelling the namespaces, you must migrate all remaining workload namespaces, including gateways.
====

// This sets the context to build the tasks for cluster-wide migration using the Istio injection label with cert-manager
:context: cw-injection-cm

include::modules/ossm-migrating-a-cluster-wide-deployment-using-the-istio-injection-label.adoc[leveloffset=+1]

include::modules/ossm-migrating-workloads-using-the-istio-injection-label.adoc[leveloffset=+2]

.Next steps

If you are using gateways, you must migrate them before you complete the migration process.

* xref:../../migrating/migrating-gateways/ossm-migrating-gateways.adoc#ossm-migrating-gateways[Migrating gateways]

If you are not using gateways, and have verified your cluster-wide migration, create a default revision tag and relabel namespaces.

[IMPORTANT]
====
Before creating a default revision tag and relabelling the namespaces, you must migrate all remaining workload namespaces, including gateways.
====

include::modules/ossm-creating-a-default-revision-tag-and-relabeling-the-namespaces-with-cert-manager.adoc[leveloffset=+2]

:context: ossm-migrating-cluster-wide

//The following tasks are for migration using the simple migration method
include::modules/ossm-migrating-a-cluster-wide-deployment-using-the-simple-migration-method.adoc[leveloffset=+1]
include::modules/ossm-migrating-workloads-using-the-simple-migration-method.adoc[leveloffset=+2]

.Next steps

If you are using gateways, you must migrate them before you complete the migration process.

* xref:../../migrating/migrating-gateways/ossm-migrating-gateways.adoc#ossm-migrating-gateways[Migrating gateways]

If you are not using gateways, you can complete your migration.

* xref:../../migrating/done/ossm-migrating-complete.adoc#ossm-migrating-complete[Completing the Migration]

[role="_additional-resources"]
[id="additional-resources_{context}"]
== Additional resources

* xref:../../install/ossm-sidecar-injection.adoc#ossm-identifying-revision-name_ossm-sidecar-injection[Identifying the revision name]
