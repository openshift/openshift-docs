:_content-type: ASSEMBLY
[id="windows-containers-release-notes-3-x"]
= Windows Container Support for Red Hat OpenShift release notes
include::_attributes/common-attributes.adoc[]
:context: windows-containers-release-notes

toc::[]

[id="about-windows-containers"]
== About Windows Container Support for Red Hat OpenShift

{productwinc} enables running Windows compute nodes in an {product-title} cluster. Running Windows workloads is possible by using the Red Hat Windows Machine Config Operator (WMCO) to install and manage Windows nodes. With Windows nodes available, you can run Windows container workloads in {product-title}.

The release notes for {productwinc} tracks the development of the WMCO, which provides all Windows container workload capabilities in {product-title}.

[IMPORTANT]
====
Because link:https://techcommunity.microsoft.com/t5/containers/important-update-deprecation-of-docker-virtual-machine-images/ba-p/3646272[Microsoft has stopped publishing Windows Server 2019 images with
Docker], Red Hat no longer supports Windows Azure for WMCO releases older than version 6.0.0. For WMCO 5.y.z and earlier, Windows Server 2019 images must have Docker pre-installed. WMCO 6.0.0 and later uses containerd as the runtime. You can upgrade to {product-title} 4.11, which uses WMCO 6.0.0.
====

ifndef::openshift-origin[]
[id="getting-support"]
== Getting support

// wording taken and modified from https://access.redhat.com/support/policy/updates/openshift#windows

{productwinc} is provided and available as an optional, installable component. Windows Container Support for Red Hat OpenShift is not part of the {product-title} subscription. It requires an additional Red Hat subscription and is supported according to the link:https://access.redhat.com/support/offerings/production/soc/[Scope of coverage] and link:https://access.redhat.com/support/offerings/production/sla[Service level agreements].

You must have this separate subscription to receive support for Windows Container Support for Red Hat OpenShift. Without this additional Red Hat subscription, deploying Windows container workloads in production clusters is not supported. You can request support through the link:http://access.redhat.com/[Red Hat Customer Portal].

For more information, see the Red Hat OpenShift Container Platform Life Cycle Policy document for link:https://access.redhat.com/support/policy/updates/openshift#windows[Red Hat OpenShift support for Windows Containers].

If you do not have this additional Red Hat subscription, you can use the Community Windows Machine Config Operator, a distribution that lacks official support.
endif::openshift-origin[]

[id="wmco-3-1-2"]
== Release notes for Red Hat Windows Machine Config Operator 3.1.2

Issued: 2022-11-09

The WMCO 3.1.2 is now available with bug fixes. The components of the WMCO were released in link:https://access.redhat.com/errata/RHBA-2022:7076[RHBA-2022:7076].

[id="wmco-3-1-2-bug-fixes"]
=== Bug fixes

* Previously, Windows containers on Windows nodes were assigned the wrong DNS Server IP if a non-default cluster DNS was specified during the cluster installation. Therefore, the DNS resolution did not work. This bug fix removes the hard-coded cluster DNS information and parametrizes the value as a command-line argument.
(link:https://bugzilla.redhat.com/show_bug.cgi?id=2030943[**BZ#2030943**])

[id="wmco-3-1-1"]
== Release notes for Red Hat Windows Machine Config Operator 3.1.1

Issued: 2021-12-07

The WMCO 3.1.1 is now available with bug fixes. The components of the WMCO were released in link:https://access.redhat.com/errata/RHBA-2021:4710[RHBA-2021:4710].

[id="wmco-3-1-1-bug-fixes"]
=== Bug fixes

* Previously, the `windows-exporter` metrics endpoint object contained a reference to a deleted machine. This incorrect reference caused the WMCO to ignore deleted events for machines with invalid IP addresses. This bug fix removes the validation of the machine object from the event filtering, allowing the `windows-exporter` metrics endpoint object to correctly update when the machine is still in the `Deleting` phase. (link:https://bugzilla.redhat.com/show_bug.cgi?id=2008994[**BZ#2008994**])

* Previously, deleting the node associated with a Windows `Machine` object threw a reconciliation error upon restart of the Operator. This bug fix opts not to react or reconcile when the node referenced by a Windows machine in the `Running` state is not found within the cluster, preventing any error loop and standardizing functionality with Linux machine objects. (link:https://bugzilla.redhat.com/show_bug.cgi?id=2009475[**BZ#2009475**])

* Previously, the WMCO did not properly associate BYOH Windows VMs with their `Node` object when the VM was specified with a DNS object. This caused the WMCO to attempt to configure VMs that were already fully configured. The WMCO now correctly resolves VMs specified by a DNS address when looking for an associated node. (link:https://bugzilla.redhat.com/show_bug.cgi?id=2020650[**BZ#2020650**])

* Previously, encrypted usernames were being generated with extra tags, which caused them not to display correctly. This bug fix removes the extra tags, allowing the encrypted username to display correctly. (link:https://bugzilla.redhat.com/show_bug.cgi?id=2023417[**BZ#2023417**])

* Previously, certain commands being run by the WMCO in Windows VMs were not parsed correctly by PowerShell. This caused Windows VMs with PowerShell as its default SSH shell to be unable to join to a cluster as a node. The WMCO can now identify the default SSH shell of a Windows VM and run the associated commands accordingly. This new capability allows Windows VMs with PowerShell as the default SSH shell to be configured as nodes in a cluster. (link:https://bugzilla.redhat.com/show_bug.cgi?id=2025730[**BZ#2025730**])

[id="wmco-3-1-0"]
== Release notes for Red Hat Windows Machine Config Operator 3.1.0

Issued: 2021-09-21

The WMCO 3.1.0 is now available with bug fixes and a new feature. The components of the WMCO were released in link:https://access.redhat.com/errata/RHBA-2021:3215[RHBA-2021:3215].

[id="wmco-3-1-0-new-features"]
=== New features

[id="wmco-3-1-0-byoh"]
==== Using Bring-Your-Own-Host (BYOH) Windows instances

You can now add an existing Windows instance to an {product-title} cluster as a compute node. This requires creating a config map in the WMCO namespace.

BYOH Windows instances are supported with installer-provisioned infrastructure for the following platforms:

* Amazon Web Services (AWS)
* Microsoft Azure
* VMware vSphere

BYOH Windows instances are supported with user-provisioned infrastructure, only when the `platform: none` field is set in the `install-config.yaml` file, for the following platforms:

* VMware vSphere
* bare metal

For more information on how to configure BYOH Windows instances, see xref:../windows_containers/byoh-windows-instance.adoc#byoh-windows-instance[Configuring BYOH Windows instance].

[id="wmco-3-1-0-bug-fixes"]
=== Bug fixes

* For clusters installed on VMware vSphere, the WMCO ignored the `Deleting` phase notification event, leaving incorrect node information in the `windows-exporter` metrics endpoint. This resulted in an invalid mapping for the Prometheus metrics endpoint. This bug has been fixed; the WMCO now recognizes the `Deleting` phase notification event and maps the Prometheus metrics endpoint appropriately. (link:https://bugzilla.redhat.com/show_bug.cgi?id=1995341[**BZ#1995341**])

[id="wmco-3-1-0-known-issues"]
=== Known issues

* When installing a BYOH Windows instance using a DNS name entry in the config map, the WMCO configures the instance twice before marking it as a `Ready` node. This will be fixed in a future release of the WMCO. (link:https://bugzilla.redhat.com/show_bug.cgi?id=2005360[**BZ#2005360**])

* When the `RunAsUser` permission is set in the security context of a Linux-based pod, the projected files have the correct permissions set, including container user ownership. However, when the Windows equivalent `RunAsUsername` permission is set in a Windows pod, the kubelet is prevented from setting correct ownership on the files in the projected volume. This problem can get exacerbated when used in conjunction with a xref:../storage/persistent_storage/persistent-storage-hostpath.adoc#persistent-storage-using-hostpath[hostPath volume] where best practices are not followed. For example, giving a pod access to the `C:\var\lib\kubelet\pods\` folder results in that pod being able to access service account tokens from other pods.
+
By default, the projected files will have the following ownership, as shown in this example Windows projected volume file:
+
[source,posh]
----
Path   : Microsoft.PowerShell.Core\FileSystem::C:\var\run\secrets\kubernetes.io\serviceaccount\..2021_08_31_22_22_18.318230061\ca.crt
Owner  : BUILTIN\Administrators
Group  : NT AUTHORITY\SYSTEM
Access : NT AUTHORITY\SYSTEM Allow  FullControl
         BUILTIN\Administrators Allow  FullControl
         BUILTIN\Users Allow  ReadAndExecute, Synchronize
Audit  :
Sddl   : O:BAG:SYD:AI(A;ID;FA;;;SY)(A;ID;FA;;;BA)(A;ID;0x1200a9;;;BU)
----
+
This indicates all administrator users, such as someone with the `ContainerAdministrator` role, have read, write, and execute access, while non-administrator users have read and execute access.
+
[IMPORTANT]
====
{product-title} applies the `RunAsUser` security context to all pods irrespective of its operating system. This means Windows pods automatically have the `RunAsUser` permission applied to its security context.
====
+
In addition, if a Windows pod is created with a projected volume with the default `RunAsUser` permission set, the pod remains in the `ContainerCreating` phase.
+
To handle these issues, {product-title} forces the file permission handling in projected service account volumes set in the security context of the pod to not be honored for projected volumes on Windows. Note that this behavior for Windows pods is how file permission handling used to work for all pod types prior to {product-title} 4.7. (link:https://bugzilla.redhat.com/show_bug.cgi?id=1971745[**BZ#1971745**])

[id="wmco-3-0-0"]
== Release notes for Red Hat Windows Machine Config Operator 3.0.0

This release of the WMCO provides bug fixes and enhancements for running Windows compute nodes in an {product-title} cluster. The components of the WMCO 3.0.0 were released in link:https://access.redhat.com/errata/RHSA-2021:3001[RHSA-2021:3001].

[IMPORTANT]
====
Users running WMCO 2.0.2 and below must uninstall the operator and reinstall WMCO 3.0.0 to work around a known issue that prevents users from upgrading from WMCO 2.0.2 to WMCO 3.0.0. (link:https://bugzilla.redhat.com/show_bug.cgi?id=1983153[*BZ#1983153*])
====

include::modules/wmco-prerequisites.adoc[leveloffset=+1]

[IMPORTANT]
====
Running Windows container workloads is not supported for clusters in a restricted network or disconnected environment.
====

Version 3.x of the WMCO is only compatible with {product-title} 4.8.

[id="wmco-3-0-0-improvements"]
=== New features and improvements

This release adds the following new features and improvements.

// Addresses Github #32620 - https://github.com/openshift/openshift-docs/pull/32620
==== Clarified limits on custom VXLAN port selection

Users must not select a custom VXLAN port when using the latest version of Windows server.

[id="wmco-3-0-0-bug-fixes"]
=== Bug fixes

* Previously, the load balancer service would become unstable when the backing deployment had multiple pods scheduled on different Windows nodes. This issue has been fixed. (link:https://bugzilla.redhat.com/show_bug.cgi?id=1905950[**BZ#1905950**])

* Previously, WMCO added the public key annotation `windowsmachineconfig.openshift.io/pub-key-hash` to Linux nodes. Now, WMCO no longer adds an annotation to Linux nodes. (link:https://bugzilla.redhat.com/show_bug.cgi?id=1930791[**BZ#1930791**])

* Previously, when users provided an invalid private key, the WMCO would fail. With this update, the WMCO produces an error alerting the user of an invalid key. (link:https://bugzilla.redhat.com/show_bug.cgi?id=1929579[*BZ#1929579*])

* Previously, the kube-proxy service would crash upon the creation of a load balancer service when the backing development had multiple pods scheduled on different Windows nodes. This issue has now been fixed. (link:https://bugzilla.redhat.com/show_bug.cgi?id=1939968[**BZ#1939968**])

* Previously, the `windows_exporter` component reported various metrics as `windows_*`. This error caused some of the node-level metrics that provide insight into the nodes through telemetry services to go unreported. Now, the components export correctly showing all of the expected metrics. (link:https://bugzilla.redhat.com/show_bug.cgi?id=1948037[**BZ#1948037**])

=== RHSA-2021:3001 - Windows Container support for {product-title} security update

As part of the previously noted bug fix (link:https://bugzilla.redhat.com/show_bug.cgi?id=1946538[**BZ#1946538**]), an update for Windows kube-proxy is now available for Red Hat Windows Machine Config Operator 2.0.1. Details of the update are documented in the link:https://access.redhat.com/errata/RHSA-2021:2130[RHSA-2021:2130] advisory.

[id="wmco-3-0-0-known-issues"]
== Known issues

* The file system graphs available in the web console do not display for Windows nodes. This is caused by changes in the file system queries. This will be fixed in a future release of WMCO. (link:https://bugzilla.redhat.com/show_bug.cgi?id=1930347[*BZ#1930347*])

* When installing a BYOH Windows instance using a DNS name entry in the config map, the WMCO configures the instance twice before marking it as a `Ready` node. This will be fixed in a future release of the WMCO. (link:https://bugzilla.redhat.com/show_bug.cgi?id=2005360[**BZ#2005360**])

include::modules/windows-containers-release-notes-limitations.adoc[leveloffset=+1]
