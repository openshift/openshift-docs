:_content-type: ASSEMBLY
[id="windows-containers-release-notes-2-x"]
= Windows Container Support for Red Hat OpenShift release notes
include::_attributes/common-attributes.adoc[]
:context: windows-containers-release-notes

toc::[]

[id="about-windows-containers"]
== About Windows Container Support for Red Hat OpenShift

{productwinc} enables running Windows compute nodes in an {product-title} cluster. Running Windows workloads is possible by using the Red Hat Windows Machine Config Operator (WMCO) to install and manage Windows nodes. With Windows nodes available, you can run Windows container workloads in {product-title}.

The release notes for {productwinc} tracks the development of the WMCO, which provides all Windows container workload capabilities in {product-title}.

[IMPORTANT]
====
Because link:https://techcommunity.microsoft.com/t5/containers/important-update-deprecation-of-docker-virtual-machine-images/ba-p/3646272[Microsoft has stopped publishing Windows Server 2019 images with
Docker], Red Hat no longer supports Windows Azure for WMCO releases older than version 6.0.0. For WMCO 5.y.z and earlier, Windows Server 2019 images must have Docker pre-installed. WMCO 6.0.0 and later uses containerd as the runtime. You can upgrade to {product-title} 4.11, which uses WMCO 6.0.0.
====

ifndef::openshift-origin[]
[id="getting-support"]
== Getting support

// wording taken and modified from https://access.redhat.com/support/policy/updates/openshift#windows

Windows Container Support for Red Hat OpenShift is provided and available as an optional, installable component. Windows Container Support for Red Hat OpenShift is not part of the {product-title} subscription. It requires an additional Red Hat subscription and is supported according to the link:https://access.redhat.com/support/offerings/production/soc/[Scope of coverage] and link:https://access.redhat.com/support/offerings/production/sla[Service level agreements].

You must have a separate subscription to receive support for Windows Container Support for Red Hat OpenShift. Without this additional Red Hat subscription, deploying Windows container workloads in production clusters is not supported. You can request support through the link:http://access.redhat.com/[Red Hat Customer Portal].

For more information, see the Red Hat OpenShift Container Platform Life Cycle Policy document for link:https://access.redhat.com/support/policy/updates/openshift#windows[Red Hat OpenShift support for Windows Containers].

If you do not have this additional Red Hat subscription, you can use the Community Windows Machine Config Operator, which is a distribution that lacks official support.
endif::openshift-origin[]

include::modules/wmco-prerequisites.adoc[leveloffset=+1]

[id="wmco-2-0-5"]
== Release notes for Red Hat Windows Machine Config Operator 2.0.5

Issued: 2022-05-02

The WMCO 2.0.5 is now available with bug fixes. The components of the WMCO were released in link:link:https://access.redhat.com/errata/RHSA-2022:93074[RHSA-2022:93074].


[id="wmco-2-0-4"]
== Release notes for Red Hat Windows Machine Config Operator 2.0.4

Issued: 2022-02-16

The WMCO 2.0.4 is now available with bug fixes. The components of the WMCO were released in link:https://access.redhat.com/errata/RHBA-2022:0241[RHBA-2022:0241].

[id="wmco-2-0-4-bug-fixes"]
=== Bug fixes

* For clusters installed on VMware vSphere, the WMCO ignored the `Deleting` phase notification event, leaving incorrect node information in the `windows-exporter` metrics endpoint. This resulted in an invalid mapping for the Prometheus metrics endpoint. This bug has been fixed; the WMCO now recognizes the `Deleting` phase notification event and maps the Prometheus metrics endpoint appropriately. (link:https://bugzilla.redhat.com/show_bug.cgi?id=1995340[**BZ#1995340**])

[id="wmco-2-0-3"]
== Release notes for Red Hat Windows Machine Config Operator 2.0.3

Issued: 2021-07-28

The WMCO 2.0.3 is now available with bug fixes. The components of the WMCO were released in link:https://access.redhat.com/errata/RHBA-2021:2926[RHBA-2021:2926].

[id="wmco-2-0-3-bug-fixes"]
=== Bug fixes

* This WMCO release fixes a bug that prevented users from upgrading to WMCO 3.0.0. Users should upgrade to WMCO 2.0.3 before upgrading to {product-title} 4.8, which only supports WMCO 3.0.0. (link:https://bugzilla.redhat.com/show_bug.cgi?id=1985349[**BZ#1985349**])

[id="wmco-2-0-2"]
== Release notes for Red Hat Windows Machine Config Operator 2.0.2

Issued: 2021-07-08

The WMCO 2.0.2 is now available with bug fixes. The components of the WMCO were released in link:https://access.redhat.com/errata/RHBA-2021:2671[RHBA-2021:2671].

[IMPORTANT]
====
Users who are running a version of WMCO prior to 2.0.3 should first upgrade to WMCO 2.0.3 prior to upgrading to WMCO 3.0.0. (link:https://bugzilla.redhat.com/show_bug.cgi?id=1983153[**BZ#1983153**])
====

[id="wmco-2-0-2-bug-fixes"]
=== Bug fixes
* {product-title} 4.8 enables the `BoundServiceAccountTokenVolume` option by default. This option attaches the projected volumes to all of the pods. In addition, {product-title} 4.8 adds xref:../rest_api/objects/index.adoc#podsecuritycontext-core-v1[the `RunAsUser` option to the `SecurityContext`]. This combination results in Windows pods being stuck in the `ContainerCreating` status. To work around this issue, you should upgrade to WMCO 2.0.2 before upgrading your cluster to {product-title} 4.8. (link:https://bugzilla.redhat.com/show_bug.cgi?id=1975553[**BZ#1975553**])

[id="wmco-2-0-1"]
== Release notes for Red Hat Windows Machine Config Operator 2.0.1

Issued: 2021-06-23

The WMCO 2.0.1 is now available with bug fixes. The components of the WMCO were released in link:https://access.redhat.com/errata/RHSA-2021:2130[RHSA-2021:2130].

[id="wmco-2-0-1-improvements"]
=== New features and improvements

This release adds the following new features and improvements.

[id="wmco-2-0-1-image-timeout"]
==== Increased image pull time-out duration

Image pull time-out has been increased to 30 minutes.

[id="wmco-2-0-1-autoscaling-windows-instances"]
==== Autoscaling for Windows instances

Cluster autoscaling is now supported for Windows instances. You can complete the following actions for Windows nodes:

* Define and deploy a xref:../machine_management/applying-autoscaling.adoc#configuring-clusterautoscaler[cluster autoscaler].
* Create a Windows node using a xref:../windows_containers/creating_windows_machinesets/creating-windows-machineset-vsphere.adoc#creating-windows-machineset-vsphere[Windows machine set].
* Define and deploy a xref:../machine_management/applying-autoscaling.adoc#configuring-machineautoscaler[machine autoscaler], referencing a Windows machine set.

[id="wmco-2-0-1-bug-fixes"]
=== Bug fixes

* Previously, when using the Windows kube-proxy component on an AWS installation, when you created a LoadBalancer service, packets would be misrouted and reached an unintended destination. Now, packets are no longer wrongly routed to unintended destinations. (link:https://bugzilla.redhat.com/show_bug.cgi?id=1946538[**BZ#1946538**])

* Previously, Windows nodes were not reporting some key node-level metrics via telemetry monitoring. The `windows_exporter` reports various metrics as `windows_*` instead of the `node_exporter` equivalent of `node_*`. Now, the telemetry results cover all of the expected metrics. (link:https://bugzilla.redhat.com/show_bug.cgi?id=1955319[**BZ#1955319**])

* Previously, when the WMCO configured Windows instances, if the hybrid-overlay or kube-proxy components failed, the node might report itself as `Ready`. Now, the error is detected and the node reports itself as `NotReady`. (link:https://bugzilla.redhat.com/show_bug.cgi?id=1956412[**BZ#1956412**])

* Previously, the kube-proxy service would terminate unexpectedly after the load balancer is created if you created the load balancer after the Windows pods begin running. Now, the kube-proxy service does not crash when recreating the load balancer service. (link:https://bugzilla.redhat.com/show_bug.cgi?id=1939968[**BZ#1939968**])

=== RHSA-2021:2130 - Windows Container support for {product-title} security update

As part of the previously noted bug fix (link:https://bugzilla.redhat.com/show_bug.cgi?id=1946538[**BZ#1946538**]), an update for Windows kube-proxy is now available for Red Hat Windows Machine Config Operator 2.0.1. Details of the update are documented in the link:https://access.redhat.com/errata/RHSA-2021:2130[RHSA-2021:2130] advisory.

[id="wmco-2-0-0"]
== Release notes for Red Hat Windows Machine Config Operator 2.0.0

This release of the WMCO provides bug fixes and enhancements for running Windows compute nodes in an {product-title} cluster. The components of the WMCO 2.0.0 were released in link:https://access.redhat.com/errata/RHBA-2021:0440[RHBA-2021:0440].

[IMPORTANT]
====
Running Windows container workloads is not supported for clusters in a restricted network or disconnected environment.
====

Version 2.x of the WMCO is only compatible with {product-title} 4.7.

[id="wmco-2-0-0-improvements"]
=== New features and improvements

This release adds the following new features and improvements.

[id="wmco-2-0-0-vsphere-support"]
==== Support for clusters running on VMware vSphere

You can now run Windows nodes on a cluster installed on VMware vSphere version 6.5, 6.7, or 7.0. You can create a Windows `MachineSet` object on vSphere to host Windows Server compute nodes. For more information, see xref:../windows_containers/creating_windows_machinesets/creating-windows-machineset-vsphere.adoc#creating-windows-machineset-vsphere[Creating a Windows `MachineSet` object on vSphere].

[id="wmco-2-0-0-monitoring"]
==== Enhanced Windows node monitoring

Windows nodes are now fully integrated with most of the monitoring capabilities provided by the web console. However, it is not possible to view workload graphs for pods running on Windows nodes in this release.

[id="wmco-2-0-0-known-issues"]
== Known issues

* When you create Windows pods with `RunAsUserName` set in its "SecurityContext" with a projected volume associated with these pods, the file ownership permissions for the projected entities are ignored, resulting in incorrectly configured ownership permissions.

* The filesystem graphs available in the web console do not display for Windows nodes. This is caused by changes in the filesystem queries. This will be fixed in a future release of WMCO. (link:https://bugzilla.redhat.com/show_bug.cgi?id=1930347[*BZ#1930347*])

* The Prometheus windows_exporter used by the WMCO currently collects metrics through HTTP, so it is considered unsafe. You must ensure that only trusted users can retrieve metrics from the endpoint. The windows_exporter feature recently added support for HTTPS configuration, but this configuration has not been implemented for WMCO. Support for HTTPS configuration in the WMCO will be added in a future release.

* When the `RunAsUser` permission is set in the security context of a Linux-based pod, the projected files have the correct permissions set, including container user ownership. However, when the Windows equivalent `RunAsUsername` permission is set in a Windows pod, the kubelet is prevented from setting correct ownership on the files in the projected volume. This problem can get exacerbated when used in conjunction with a xref:../storage/persistent_storage/persistent-storage-hostpath.adoc#persistent-storage-using-hostpath[hostPath volume] where best practices are not followed. For example, giving a pod access to the `C:\var\lib\kubelet\pods\` folder results in that pod being able to access service account tokens from other pods.
+
By default, the projected files will have the following ownership, as shown in this example Windows projected volume file:
+
[source,posh]
----
Path   : Microsoft.PowerShell.Core\FileSystem::C:\var\run\secrets\kubernetes.io\serviceaccount\..2021_08_31_22_22_18.318230061\ca.crt
Owner  : BUILTIN\Administrators
Group  : NT AUTHORITY\SYSTEM
Access : NT AUTHORITY\SYSTEM Allow  FullControl
         BUILTIN\Administrators Allow  FullControl
         BUILTIN\Users Allow  ReadAndExecute, Synchronize
Audit  :
Sddl   : O:BAG:SYD:AI(A;ID;FA;;;SY)(A;ID;FA;;;BA)(A;ID;0x1200a9;;;BU)
----
+
This indicates all administrator users, such as someone with the `ContainerAdministrator` role, have read, write, and execute access, while non-administrator users have read and execute access.
+
[IMPORTANT]
====
{product-title} applies the `RunAsUser` security context to all pods irrespective of its operating system. This means Windows pods automatically have the `RunAsUser` permission applied to its security context.
====
+
In addition, if a Windows pod is created with a projected volume with the default `RunAsUser` permission set, the pod remains in the `ContainerCreating` phase.
+
To handle these issues, {product-title} forces the file permission handling in projected service account volumes set in the security context of the pod to not be honored for projected volumes on Windows. Note that this behavior for Windows pods is how file permission handling used to work for all pod types prior to {product-title} 4.7. (link:https://bugzilla.redhat.com/show_bug.cgi?id=1971745[**BZ#1971745**])

include::modules/windows-containers-release-notes-limitations.adoc[leveloffset=+1]
