<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.20">
<title>Configuring PTP devices</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.square{list-style-type:square}
ul.circle ul:not([class]),ul.disc ul:not([class]),ul.square ul:not([class]){list-style:inherit}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:first-child,.sidebarblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child,.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,td.hdlist1,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body id="configuring-ptp" class="article">
<div id="header">
<h1>Configuring PTP devices</h1>
<div id="toc" class="toc">
<div id="toctitle"></div>
<ul class="sectlevel1">
<li><a href="#install-ptp-operator-cli_configuring-ptp">Installing the PTP Operator using the CLI</a></li>
<li><a href="#install-ptp-operator-web-console_configuring-ptp">Installing the PTP Operator by using the web console</a></li>
<li><a href="#discover-ptp-devices_configuring-ptp">Discovering PTP capable network devices in your cluster</a></li>
<li><a href="#ptp-using-hardware-specific-nic-features_configuring-ptp">Using hardware-specific NIC features with the PTP Operator</a></li>
<li><a href="#configuring-linuxptp-services-as-grandmaster-clock_configuring-ptp">Configuring linuxptp services as a grandmaster clock</a></li>
<li><a href="#configuring-linuxptp-services-as-grandmaster-clock-dual-nic_configuring-ptp">Configuring linuxptp services as a grandmaster clock for dual E810 Westport Channel NICs</a>
<ul class="sectlevel2">
<li><a href="#nw-ptp-grandmaster-clock-configuration-reference_configuring-ptp">Grandmaster clock PtpConfig configuration reference</a></li>
<li><a href="#nw-ptp-grandmaster-clock-class-reference_configuring-ptp">Grandmaster clock class sync state reference</a></li>
<li><a href="#nw-ptp-wpc-hardware-pins-reference_configuring-ptp">Intel Westport Channel E810 hardware configuration reference</a></li>
<li><a href="#nw-ptp-dual-wpc-hardware-config-reference_configuring-ptp">Dual E810 Westport Channel NIC configuration reference</a></li>
</ul>
</li>
<li><a href="#ptp-configuring-dynamic-leap-seconds-handling-for-tgm_configuring-ptp">Configuring dynamic leap seconds handling for PTP grandmaster clocks</a></li>
<li><a href="#configuring-linuxptp-services-as-boundary-clock_configuring-ptp">Configuring linuxptp services as a boundary clock</a>
<ul class="sectlevel2">
<li><a href="#ptp-configuring-linuxptp-services-as-bc-for-dual-nic_configuring-ptp">Configuring linuxptp services as boundary clocks for dual-NIC hardware</a></li>
<li><a href="#ptp-configuring-linuxptp-services-as-ha-bc-for-dual-nic_configuring-ptp">Configuring linuxptp as a highly available system clock for dual-NIC Intel E810 PTP boundary clocks</a></li>
</ul>
</li>
<li><a href="#configuring-linuxptp-services-as-ordinary-clock_configuring-ptp">Configuring linuxptp services as an ordinary clock</a>
<ul class="sectlevel2">
<li><a href="#nw-columbiaville-ptp-config-refererence_configuring-ptp">Intel Columbiaville E800 series NIC as PTP ordinary clock reference</a></li>
</ul>
</li>
<li><a href="#cnf-configuring-fifo-priority-scheduling-for-ptp_configuring-ptp">Configuring FIFO priority scheduling for PTP hardware</a></li>
<li><a href="#cnf-configuring-log-filtering-for-linuxptp_configuring-ptp">Configuring log filtering for linuxptp services</a></li>
<li><a href="#cnf-troubleshooting-common-ptp-operator-issues_configuring-ptp">Troubleshooting common PTP Operator issues</a></li>
<li><a href="#cnf-getting-the-dpll-firmware-version-for-intel-800-series-nics_configuring-ptp">Getting the DPLL firmware version for the CGU in an Intel 800 series NIC</a></li>
<li><a href="#cnf-about-collecting-nro-data_configuring-ptp">Collecting PTP Operator data</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<!-- toc disabled -->
<div class="paragraph">
<p>The PTP Operator adds the <code>NodePtpDevice.ptp.openshift.io</code> custom resource definition (CRD) to OpenShift Container Platform.</p>
</div>
<div class="paragraph">
<p>When installed, the PTP Operator searches your cluster for Precision Time Protocol (PTP) capable network devices on each node. It creates and updates a <code>NodePtpDevice</code> custom resource (CR) object for each node that provides a compatible PTP-capable network device.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="install-ptp-operator-cli_configuring-ptp"><a class="anchor" href="#install-ptp-operator-cli_configuring-ptp"></a>Installing the PTP Operator using the CLI</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As a cluster administrator, you can install the Operator by using the CLI.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A cluster installed on bare-metal hardware with nodes that have hardware that supports PTP.</p>
</li>
<li>
<p>Install the OpenShift CLI (<code>oc</code>).</p>
</li>
<li>
<p>Log in as a user with <code>cluster-admin</code> privileges.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create a namespace for the PTP Operator.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Save the following YAML in the <code>ptp-namespace.yaml</code> file:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: v1
kind: Namespace
metadata:
  name: openshift-ptp
  annotations:
    workload.openshift.io/allowed: management
  labels:
    name: openshift-ptp
    openshift.io/cluster-monitoring: "true"</code></pre>
</div>
</div>
</li>
<li>
<p>Create the <code>Namespace</code> CR:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc create -f ptp-namespace.yaml</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Create an Operator group for the PTP Operator.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Save the following YAML in the <code>ptp-operatorgroup.yaml</code> file:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: operators.coreos.com/v1
kind: OperatorGroup
metadata:
  name: ptp-operators
  namespace: openshift-ptp
spec:
  targetNamespaces:
  - openshift-ptp</code></pre>
</div>
</div>
</li>
<li>
<p>Create the <code>OperatorGroup</code> CR:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc create -f ptp-operatorgroup.yaml</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Subscribe to the PTP Operator.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Save the following YAML in the <code>ptp-sub.yaml</code> file:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: operators.coreos.com/v1alpha1
kind: Subscription
metadata:
  name: ptp-operator-subscription
  namespace: openshift-ptp
spec:
  channel: "stable"
  name: ptp-operator
  source: redhat-operators
  sourceNamespace: openshift-marketplace</code></pre>
</div>
</div>
</li>
<li>
<p>Create the <code>Subscription</code> CR:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc create -f ptp-sub.yaml</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>To verify that the Operator is installed, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc get csv -n openshift-ptp -o custom-columns=Name:.metadata.name,Phase:.status.phase</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">Name                         Phase
4.14.0-202301261535          Succeeded</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="install-ptp-operator-web-console_configuring-ptp"><a class="anchor" href="#install-ptp-operator-web-console_configuring-ptp"></a>Installing the PTP Operator by using the web console</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As a cluster administrator, you can install the PTP Operator by using the web console.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You have to create the namespace and Operator group as mentioned
in the previous section.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Install the PTP Operator using the OpenShift Container Platform web console:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>In the OpenShift Container Platform web console, click <strong>Operators</strong> &#8594; <strong>OperatorHub</strong>.</p>
</li>
<li>
<p>Choose  <strong>PTP Operator</strong> from the list of available Operators, and then click <strong>Install</strong>.</p>
</li>
<li>
<p>On the <strong>Install Operator</strong> page, under <strong>A specific namespace on the cluster</strong> select <strong>openshift-ptp</strong>. Then, click <strong>Install</strong>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Optional: Verify that the PTP Operator installed successfully:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Switch to the <strong>Operators</strong> &#8594; <strong>Installed Operators</strong> page.</p>
</li>
<li>
<p>Ensure that <strong>PTP Operator</strong> is listed in the <strong>openshift-ptp</strong> project with a <strong>Status</strong> of <strong>InstallSucceeded</strong>.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>During installation an Operator might display a <strong>Failed</strong> status.
If the installation later succeeds with an <strong>InstallSucceeded</strong> message, you can ignore the <strong>Failed</strong> message.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If the Operator does not appear as installed, to troubleshoot further:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Go to the <strong>Operators</strong> &#8594; <strong>Installed Operators</strong> page and inspect the <strong>Operator Subscriptions</strong> and <strong>Install Plans</strong> tabs for any failure or errors under <strong>Status</strong>.</p>
</li>
<li>
<p>Go to the <strong>Workloads</strong> &#8594; <strong>Pods</strong> page and check the logs for pods in the <code>openshift-ptp</code> project.</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="discover-ptp-devices_configuring-ptp"><a class="anchor" href="#discover-ptp-devices_configuring-ptp"></a>Discovering PTP capable network devices in your cluster</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>To return a complete list of PTP capable network devices in your cluster, run the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc get NodePtpDevice -n openshift-ptp -o yaml</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">apiVersion: v1
items:
- apiVersion: ptp.openshift.io/v1
  kind: NodePtpDevice
  metadata:
    creationTimestamp: "2022-01-27T15:16:28Z"
    generation: 1
    name: dev-worker-0 <i class="conum" data-value="1"></i><b>(1)</b>
    namespace: openshift-ptp
    resourceVersion: "6538103"
    uid: d42fc9ad-bcbf-4590-b6d8-b676c642781a
  spec: {}
  status:
    devices: <i class="conum" data-value="2"></i><b>(2)</b>
    - name: eno1
    - name: eno2
    - name: eno3
    - name: eno4
    - name: enp5s0f0
    - name: enp5s0f1
...</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The value for the <code>name</code> parameter is the same as the name of the parent node.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>devices</code> collection includes a list of the PTP capable devices that the PTP Operator discovers for the node.</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ptp-using-hardware-specific-nic-features_configuring-ptp"><a class="anchor" href="#ptp-using-hardware-specific-nic-features_configuring-ptp"></a>Using hardware-specific NIC features with the PTP Operator</h2>
<div class="sectionbody">
<div class="paragraph">
<p>NIC hardware with built-in PTP capabilities sometimes require device-specific configuration.
You can use hardware-specific NIC features for supported hardware with the PTP Operator by configuring a plugin in the <code>PtpConfig</code> custom resource (CR).
The <code>linuxptp-daemon</code> service uses the named parameters in the <code>plugin</code> stanza to start <code>linuxptp</code> processes (<code>ptp4l</code> and <code>phc2sys</code>) based on the specific hardware configuration.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In OpenShift Container Platform 4.14, the Intel E810 NIC is supported with a <code>PtpConfig</code> plugin.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configuring-linuxptp-services-as-grandmaster-clock_configuring-ptp"><a class="anchor" href="#configuring-linuxptp-services-as-grandmaster-clock_configuring-ptp"></a>Configuring linuxptp services as a grandmaster clock</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can configure the <code>linuxptp</code> services (<code>ptp4l</code>, <code>phc2sys</code>, <code>ts2phc</code>) as grandmaster clock (T-GM) by creating a <code>PtpConfig</code> custom resource (CR) that configures the host NIC.</p>
</div>
<div class="paragraph">
<p>The <code>ts2phc</code> utility allows you to synchronize the system clock with the PTP grandmaster clock so that the node can stream precision clock signal to downstream PTP ordinary clocks and boundary clocks.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Use the following example <code>PtpConfig</code> CR as the basis to configure <code>linuxptp</code> services as T-GM for an Intel Westport Channel E810-XXVDA4T network interface.</p>
</div>
<div class="paragraph">
<p>To configure PTP fast events, set appropriate values for <code>ptp4lOpts</code>, <code>ptp4lConf</code>, and <code>ptpClockThreshold</code>.
<code>ptpClockThreshold</code> is used only when events are enabled.
See "Configuring the PTP fast event notifications publisher" for more information.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>For T-GM clocks in production environments, install an Intel E810 Westport Channel NIC in the bare-metal cluster host.</p>
</li>
<li>
<p>Install the OpenShift CLI (<code>oc</code>).</p>
</li>
<li>
<p>Log in as a user with <code>cluster-admin</code> privileges.</p>
</li>
<li>
<p>Install the PTP Operator.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create the <code>PtpConfig</code> CR. For example:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Depending on your requirements, use one of the following T-GM configurations for your deployment.
Save the YAML in the <code>grandmaster-clock-ptp-config.yaml</code> file:</p>
<details>
<summary class="title">PTP grandmaster clock configuration for E810 NIC</summary>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: ptp.openshift.io/v1
kind: PtpConfig
metadata:
  name: grandmaster
  namespace: openshift-ptp
  annotations: {}
spec:
  profile:
    - name: "grandmaster"
      ptp4lOpts: "-2 --summary_interval -4"
      phc2sysOpts: -r -u 0 -m -w -N 8 -R 16 -s $iface_master -n 24
      ptpSchedulingPolicy: SCHED_FIFO
      ptpSchedulingPriority: 10
      ptpSettings:
        logReduce: "true"
      plugins:
        e810:
          enableDefaultConfig: false
          settings:
            LocalMaxHoldoverOffSet: 1500
            LocalHoldoverTimeout: 14400
            MaxInSpecOffset: 100
          pins: $e810_pins
          #  "$iface_master":
          #    "U.FL2": "0 2"
          #    "U.FL1": "0 1"
          #    "SMA2": "0 2"
          #    "SMA1": "0 1"
          ublxCmds:
            - args: #ubxtool -P 29.20 -z CFG-HW-ANT_CFG_VOLTCTRL,1
                - "-P"
                - "29.20"
                - "-z"
                - "CFG-HW-ANT_CFG_VOLTCTRL,1"
              reportOutput: false
            - args: #ubxtool -P 29.20 -e GPS
                - "-P"
                - "29.20"
                - "-e"
                - "GPS"
              reportOutput: false
            - args: #ubxtool -P 29.20 -d Galileo
                - "-P"
                - "29.20"
                - "-d"
                - "Galileo"
              reportOutput: false
            - args: #ubxtool -P 29.20 -d GLONASS
                - "-P"
                - "29.20"
                - "-d"
                - "GLONASS"
              reportOutput: false
            - args: #ubxtool -P 29.20 -d BeiDou
                - "-P"
                - "29.20"
                - "-d"
                - "BeiDou"
              reportOutput: false
            - args: #ubxtool -P 29.20 -d SBAS
                - "-P"
                - "29.20"
                - "-d"
                - "SBAS"
              reportOutput: false
            - args: #ubxtool -P 29.20 -t -w 5 -v 1 -e SURVEYIN,600,50000
                - "-P"
                - "29.20"
                - "-t"
                - "-w"
                - "5"
                - "-v"
                - "1"
                - "-e"
                - "SURVEYIN,600,50000"
              reportOutput: true
            - args: #ubxtool -P 29.20 -p MON-HW
                - "-P"
                - "29.20"
                - "-p"
                - "MON-HW"
              reportOutput: true
            - args: #ubxtool -P 29.20 -p CFG-MSG,1,38,248
                - "-P"
                - "29.20"
                - "-p"
                - "CFG-MSG,1,38,248"
              reportOutput: true
      ts2phcOpts: " "
      ts2phcConf: |
        [nmea]
        ts2phc.master 1
        [global]
        use_syslog  0
        verbose 1
        logging_level 7
        ts2phc.pulsewidth 100000000
        #cat /dev/GNSS to find available serial port
        #example value of gnss_serialport is /dev/ttyGNSS_1700_0
        ts2phc.nmea_serialport $gnss_serialport
        [$iface_master]
        ts2phc.extts_polarity rising
        ts2phc.extts_correction 0
      ptp4lConf: |
        [$iface_master]
        masterOnly 1
        [$iface_master_1]
        masterOnly 1
        [$iface_master_2]
        masterOnly 1
        [$iface_master_3]
        masterOnly 1
        [global]
        #
        # Default Data Set
        #
        twoStepFlag 1
        priority1 128
        priority2 128
        domainNumber 24
        #utc_offset 37
        clockClass 6
        clockAccuracy 0x27
        offsetScaledLogVariance 0xFFFF
        free_running 0
        freq_est_interval 1
        dscp_event 0
        dscp_general 0
        dataset_comparison G.8275.x
        G.8275.defaultDS.localPriority 128
        #
        # Port Data Set
        #
        logAnnounceInterval -3
        logSyncInterval -4
        logMinDelayReqInterval -4
        logMinPdelayReqInterval 0
        announceReceiptTimeout 3
        syncReceiptTimeout 0
        delayAsymmetry 0
        fault_reset_interval -4
        neighborPropDelayThresh 20000000
        masterOnly 0
        G.8275.portDS.localPriority 128
        #
        # Run time options
        #
        assume_two_step 0
        logging_level 6
        path_trace_enabled 0
        follow_up_info 0
        hybrid_e2e 0
        inhibit_multicast_service 0
        net_sync_monitor 0
        tc_spanning_tree 0
        tx_timestamp_timeout 50
        unicast_listen 0
        unicast_master_table 0
        unicast_req_duration 3600
        use_syslog 1
        verbose 0
        summary_interval -4
        kernel_leap 1
        check_fup_sync 0
        clock_class_threshold 7
        #
        # Servo Options
        #
        pi_proportional_const 0.0
        pi_integral_const 0.0
        pi_proportional_scale 0.0
        pi_proportional_exponent -0.3
        pi_proportional_norm_max 0.7
        pi_integral_scale 0.0
        pi_integral_exponent 0.4
        pi_integral_norm_max 0.3
        step_threshold 2.0
        first_step_threshold 0.00002
        clock_servo pi
        sanity_freq_limit  200000000
        ntpshm_segment 0
        #
        # Transport options
        #
        transportSpecific 0x0
        ptp_dst_mac 01:1B:19:00:00:00
        p2p_dst_mac 01:80:C2:00:00:0E
        udp_ttl 1
        udp6_scope 0x0E
        uds_address /var/run/ptp4l
        #
        # Default interface options
        #
        clock_type BC
        network_transport L2
        delay_mechanism E2E
        time_stamping hardware
        tsproc_mode filter
        delay_filter moving_median
        delay_filter_length 10
        egressLatency 0
        ingressLatency 0
        boundary_clock_jbod 0
        #
        # Clock description
        #
        productDescription ;;
        revisionData ;;
        manufacturerIdentity 00:00:00
        userDescription ;
        timeSource 0x20
  recommend:
    - profile: "grandmaster"
      priority: 4
      match:
        - nodeLabel: "node-role.kubernetes.io/$mcp"</code></pre>
</div>
</div>
</div>
</details>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For E810 Westport Channel NICs, set the value for <code>ts2phc.nmea_serialport</code> to <code>/dev/gnss0</code>.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Create the CR by running the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc create -f grandmaster-clock-ptp-config.yaml</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="olist arabic">
<div class="title">Verification</div>
<ol class="arabic">
<li>
<p>Check that the <code>PtpConfig</code> profile is applied to the node.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Get the list of pods in the <code>openshift-ptp</code> namespace by running the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc get pods -n openshift-ptp -o wide</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">NAME                          READY   STATUS    RESTARTS   AGE     IP             NODE
linuxptp-daemon-74m2g         3/3     Running   3          4d15h   10.16.230.7    compute-1.example.com
ptp-operator-5f4f48d7c-x7zkf  1/1     Running   1          4d15h   10.128.1.145   compute-1.example.com</code></pre>
</div>
</div>
</li>
<li>
<p>Check that the profile is correct. Examine the logs of the <code>linuxptp</code> daemon that corresponds to the node you specified in the <code>PtpConfig</code> profile.
Run the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc logs linuxptp-daemon-74m2g -n openshift-ptp -c linuxptp-daemon-container</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">ts2phc[94980.334]: [ts2phc.0.config] nmea delay: 98690975 ns
ts2phc[94980.334]: [ts2phc.0.config] ens3f0 extts index 0 at 1676577329.999999999 corr 0 src 1676577330.901342528 diff -1
ts2phc[94980.334]: [ts2phc.0.config] ens3f0 master offset         -1 s2 freq      -1
ts2phc[94980.441]: [ts2phc.0.config] nmea sentence: GNRMC,195453.00,A,4233.24427,N,07126.64420,W,0.008,,160223,,,A,V
phc2sys[94980.450]: [ptp4l.0.config] CLOCK_REALTIME phc offset       943 s2 freq  -89604 delay    504
phc2sys[94980.512]: [ptp4l.0.config] CLOCK_REALTIME phc offset      1000 s2 freq  -89264 delay    474</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configuring-linuxptp-services-as-grandmaster-clock-dual-nic_configuring-ptp"><a class="anchor" href="#configuring-linuxptp-services-as-grandmaster-clock-dual-nic_configuring-ptp"></a>Configuring linuxptp services as a grandmaster clock for dual E810 Westport Channel NICs</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can configure the <code>linuxptp</code> services (<code>ptp4l</code>, <code>phc2sys</code>, <code>ts2phc</code>) as grandmaster clock (T-GM) for dual E810 Westport Channel NICs by creating a <code>PtpConfig</code> custom resource (CR) that configures the host NICs.</p>
</div>
<div class="paragraph">
<p>For distributed RAN (D-RAN) use cases, you can configure PTP for dual-NICs as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>NIC one is synced to the global navigation satellite system (GNSS) time source.</p>
</li>
<li>
<p>NIC two is synced to the 1PPS timing output provided by NIC one. This configuration is provided by the PTP hardware plugin in the <code>PtpConfig</code> CR.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The dual-NIC PTP T-GM configuration uses a single instance of <code>ptp4l</code> and one <code>ts2phc</code> process reporting two <code>ts2phc</code> instances, one for each NIC.
The host system clock is synchronized from the NIC that is connected to the GNSS time source.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Use the following example <code>PtpConfig</code> CR as the basis to configure <code>linuxptp</code> services as T-GM for dual Intel Westport Channel E810-XXVDA4T network interfaces.</p>
</div>
<div class="paragraph">
<p>To configure PTP fast events, set appropriate values for <code>ptp4lOpts</code>, <code>ptp4lConf</code>, and <code>ptpClockThreshold</code>.
<code>ptpClockThreshold</code> is used only when events are enabled.
See "Configuring the PTP fast event notifications publisher" for more information.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>For T-GM clocks in production environments, install two Intel E810 Westport Channel NICs in the bare-metal cluster host.</p>
</li>
<li>
<p>Install the OpenShift CLI (<code>oc</code>).</p>
</li>
<li>
<p>Log in as a user with <code>cluster-admin</code> privileges.</p>
</li>
<li>
<p>Install the PTP Operator.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create the <code>PtpConfig</code> CR. For example:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Save the following YAML in the <code>grandmaster-clock-ptp-config-dual-nics.yaml</code> file:</p>
<details>
<summary class="title">PTP grandmaster clock configuration for dual E810 NICs</summary>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml"># In this example two cards $iface_nic1 and $iface_nic2 are connected via
# SMA1 ports by a cable and $iface_nic2 receives 1PPS signals from $iface_nic1
apiVersion: ptp.openshift.io/v1
kind: PtpConfig
metadata:
  name: grandmaster
  namespace: openshift-ptp
  annotations: {}
spec:
  profile:
    - name: "grandmaster"
      ptp4lOpts: "-2 --summary_interval -4"
      phc2sysOpts: -r -u 0 -m -w -N 8 -R 16 -s $iface_nic1 -n 24
      ptpSchedulingPolicy: SCHED_FIFO
      ptpSchedulingPriority: 10
      ptpSettings:
        logReduce: "true"
      plugins:
        e810:
          enableDefaultConfig: false
          settings:
            LocalMaxHoldoverOffSet: 1500
            LocalHoldoverTimeout: 14400
            MaxInSpecOffset: 100
          pins: $e810_pins
          #  "$iface_nic1":
          #    "U.FL2": "0 2"
          #    "U.FL1": "0 1"
          #    "SMA2": "0 2"
          #    "SMA1": "2 1"
          #  "$iface_nic2":
          #    "U.FL2": "0 2"
          #    "U.FL1": "0 1"
          #    "SMA2": "0 2"
          #    "SMA1": "1 1"
          ublxCmds:
            - args: #ubxtool -P 29.20 -z CFG-HW-ANT_CFG_VOLTCTRL,1
                - "-P"
                - "29.20"
                - "-z"
                - "CFG-HW-ANT_CFG_VOLTCTRL,1"
              reportOutput: false
            - args: #ubxtool -P 29.20 -e GPS
                - "-P"
                - "29.20"
                - "-e"
                - "GPS"
              reportOutput: false
            - args: #ubxtool -P 29.20 -d Galileo
                - "-P"
                - "29.20"
                - "-d"
                - "Galileo"
              reportOutput: false
            - args: #ubxtool -P 29.20 -d GLONASS
                - "-P"
                - "29.20"
                - "-d"
                - "GLONASS"
              reportOutput: false
            - args: #ubxtool -P 29.20 -d BeiDou
                - "-P"
                - "29.20"
                - "-d"
                - "BeiDou"
              reportOutput: false
            - args: #ubxtool -P 29.20 -d SBAS
                - "-P"
                - "29.20"
                - "-d"
                - "SBAS"
              reportOutput: false
            - args: #ubxtool -P 29.20 -t -w 5 -v 1 -e SURVEYIN,600,50000
                - "-P"
                - "29.20"
                - "-t"
                - "-w"
                - "5"
                - "-v"
                - "1"
                - "-e"
                - "SURVEYIN,600,50000"
              reportOutput: true
            - args: #ubxtool -P 29.20 -p MON-HW
                - "-P"
                - "29.20"
                - "-p"
                - "MON-HW"
              reportOutput: true
            - args: #ubxtool -P 29.20 -p CFG-MSG,1,38,248
                - "-P"
                - "29.20"
                - "-p"
                - "CFG-MSG,1,38,248"
              reportOutput: true
      ts2phcOpts: " "
      ts2phcConf: |
        [nmea]
        ts2phc.master 1
        [global]
        use_syslog  0
        verbose 1
        logging_level 7
        ts2phc.pulsewidth 100000000
        #cat /dev/GNSS to find available serial port
        #example value of gnss_serialport is /dev/ttyGNSS_1700_0
        ts2phc.nmea_serialport $gnss_serialport
        [$iface_nic1]
        ts2phc.extts_polarity rising
        ts2phc.extts_correction 0
        [$iface_nic2]
        ts2phc.master 0
        ts2phc.extts_polarity rising
        #this is a measured value in nanoseconds to compensate for SMA cable delay
        ts2phc.extts_correction -10
      ptp4lConf: |
        [$iface_nic1]
        masterOnly 1
        [$iface_nic1_1]
        masterOnly 1
        [$iface_nic1_2]
        masterOnly 1
        [$iface_nic1_3]
        masterOnly 1
        [$iface_nic2]
        masterOnly 1
        [$iface_nic2_1]
        masterOnly 1
        [$iface_nic2_2]
        masterOnly 1
        [$iface_nic2_3]
        masterOnly 1
        [global]
        #
        # Default Data Set
        #
        twoStepFlag 1
        priority1 128
        priority2 128
        domainNumber 24
        #utc_offset 37
        clockClass 6
        clockAccuracy 0x27
        offsetScaledLogVariance 0xFFFF
        free_running 0
        freq_est_interval 1
        dscp_event 0
        dscp_general 0
        dataset_comparison G.8275.x
        G.8275.defaultDS.localPriority 128
        #
        # Port Data Set
        #
        logAnnounceInterval -3
        logSyncInterval -4
        logMinDelayReqInterval -4
        logMinPdelayReqInterval 0
        announceReceiptTimeout 3
        syncReceiptTimeout 0
        delayAsymmetry 0
        fault_reset_interval -4
        neighborPropDelayThresh 20000000
        masterOnly 0
        G.8275.portDS.localPriority 128
        #
        # Run time options
        #
        assume_two_step 0
        logging_level 6
        path_trace_enabled 0
        follow_up_info 0
        hybrid_e2e 0
        inhibit_multicast_service 0
        net_sync_monitor 0
        tc_spanning_tree 0
        tx_timestamp_timeout 50
        unicast_listen 0
        unicast_master_table 0
        unicast_req_duration 3600
        use_syslog 1
        verbose 0
        summary_interval -4
        kernel_leap 1
        check_fup_sync 0
        clock_class_threshold 7
        #
        # Servo Options
        #
        pi_proportional_const 0.0
        pi_integral_const 0.0
        pi_proportional_scale 0.0
        pi_proportional_exponent -0.3
        pi_proportional_norm_max 0.7
        pi_integral_scale 0.0
        pi_integral_exponent 0.4
        pi_integral_norm_max 0.3
        step_threshold 2.0
        first_step_threshold 0.00002
        clock_servo pi
        sanity_freq_limit  200000000
        ntpshm_segment 0
        #
        # Transport options
        #
        transportSpecific 0x0
        ptp_dst_mac 01:1B:19:00:00:00
        p2p_dst_mac 01:80:C2:00:00:0E
        udp_ttl 1
        udp6_scope 0x0E
        uds_address /var/run/ptp4l
        #
        # Default interface options
        #
        clock_type BC
        network_transport L2
        delay_mechanism E2E
        time_stamping hardware
        tsproc_mode filter
        delay_filter moving_median
        delay_filter_length 10
        egressLatency 0
        ingressLatency 0
        boundary_clock_jbod 1
        #
        # Clock description
        #
        productDescription ;;
        revisionData ;;
        manufacturerIdentity 00:00:00
        userDescription ;
        timeSource 0x20
  recommend:
    - profile: "grandmaster"
      priority: 4
      match:
        - nodeLabel: "node-role.kubernetes.io/$mcp"</code></pre>
</div>
</div>
</div>
</details>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For E810 Westport Channel NICs, set the value for <code>ts2phc.nmea_serialport</code> to <code>/dev/gnss0</code>.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Create the CR by running the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc create -f grandmaster-clock-ptp-config-dual-nics.yaml</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="olist arabic">
<div class="title">Verification</div>
<ol class="arabic">
<li>
<p>Check that the <code>PtpConfig</code> profile is applied to the node.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Get the list of pods in the <code>openshift-ptp</code> namespace by running the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc get pods -n openshift-ptp -o wide</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">NAME                          READY   STATUS    RESTARTS   AGE     IP             NODE
linuxptp-daemon-74m2g         3/3     Running   3          4d15h   10.16.230.7    compute-1.example.com
ptp-operator-5f4f48d7c-x7zkf  1/1     Running   1          4d15h   10.128.1.145   compute-1.example.com</code></pre>
</div>
</div>
</li>
<li>
<p>Check that the profile is correct. Examine the logs of the <code>linuxptp</code> daemon that corresponds to the node you specified in the <code>PtpConfig</code> profile.
Run the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc logs linuxptp-daemon-74m2g -n openshift-ptp -c linuxptp-daemon-container</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">ts2phc[509863.660]: [ts2phc.0.config] nmea delay: 347527248 ns
ts2phc[509863.660]: [ts2phc.0.config] ens2f0 extts index 0 at 1705516553.000000000 corr 0 src 1705516553.652499081 diff 0
ts2phc[509863.660]: [ts2phc.0.config] ens2f0 master offset          0 s2 freq      -0
I0117 18:35:16.000146 1633226 stats.go:57] state updated for ts2phc =s2
I0117 18:35:16.000163 1633226 event.go:417] dpll State s2, gnss State s2, tsphc state s2, gm state s2,
ts2phc[1705516516]:[ts2phc.0.config] ens2f0 nmea_status 1 offset 0 s2
GM[1705516516]:[ts2phc.0.config] ens2f0 T-GM-STATUS s2
ts2phc[509863.677]: [ts2phc.0.config] ens7f0 extts index 0 at 1705516553.000000010 corr -10 src 1705516553.652499081 diff 0
ts2phc[509863.677]: [ts2phc.0.config] ens7f0 master offset          0 s2 freq      -0
I0117 18:35:16.016597 1633226 stats.go:57] state updated for ts2phc =s2
phc2sys[509863.719]: [ptp4l.0.config] CLOCK_REALTIME phc offset        -6 s2 freq  +15441 delay    510
phc2sys[509863.782]: [ptp4l.0.config] CLOCK_REALTIME phc offset        -7 s2 freq  +15438 delay    502</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="../../networking/ptp/ptp-cloud-events-consumer-dev-reference.html#cnf-configuring-the-ptp-fast-event-publisher-v2_ptp-consumer">Configuring the PTP fast event notifications publisher</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="nw-ptp-grandmaster-clock-configuration-reference_configuring-ptp"><a class="anchor" href="#nw-ptp-grandmaster-clock-configuration-reference_configuring-ptp"></a>Grandmaster clock PtpConfig configuration reference</h3>
<div class="paragraph">
<p>The following reference information describes the configuration options for the <code>PtpConfig</code> custom resource (CR) that configures the <code>linuxptp</code> services (<code>ptp4l</code>, <code>phc2sys</code>, <code>ts2phc</code>) as a grandmaster clock.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. PtpConfig configuration options for PTP Grandmaster clock</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">PtpConfig CR field</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>plugins</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specify an array of <code>.exec.cmdline</code> options that configure the NIC for grandmaster clock operation. Grandmaster clock configuration requires certain PTP pins to be disabled.</p>
<p class="tableblock">The plugin mechanism allows the PTP Operator to do automated hardware configuration.
For the Intel Westport Channel NIC, when <code>enableDefaultConfig</code> is true, The PTP Operator runs a hard-coded script to do the required configuration for the NIC.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ptp4lOpts</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specify system configuration options for the <code>ptp4l</code> service.
The options should not include the network interface name <code>-i &lt;interface&gt;</code> and service config file <code>-f /etc/ptp4l.conf</code> because the network interface name and the service config file are automatically appended.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ptp4lConf</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specify the required configuration to start <code>ptp4l</code> as a grandmaster clock.
For example, the <code>ens2f1</code> interface synchronizes downstream connected devices.
For grandmaster clocks, set <code>clockClass</code> to <code>6</code> and set <code>clockAccuracy</code> to <code>0x27</code>.
Set <code>timeSource</code> to <code>0x20</code> for when receiving the timing signal from a Global navigation satellite system (GNSS).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>tx_timestamp_timeout</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specify the maximum amount of time to wait for the transmit (TX) timestamp from the sender before discarding the data.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>boundary_clock_jbod</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specify the JBOD boundary clock time delay value.
This value is used to correct the time values that are passed between the network time devices.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>phc2sysOpts</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Specify system config options for the <code>phc2sys</code> service.
If this field is empty the PTP Operator does not start the <code>phc2sys</code> service.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Ensure that the network interface listed here is configured as grandmaster and is referenced as required in the <code>ts2phcConf</code> and <code>ptp4lConf</code> fields.</p>
</div>
</td>
</tr>
</table>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ptpSchedulingPolicy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configure the scheduling policy for <code>ptp4l</code> and <code>phc2sys</code> processes.
Default value is <code>SCHED_OTHER</code>.
Use <code>SCHED_FIFO</code> on systems that support FIFO scheduling.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ptpSchedulingPriority</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set an integer value from 1-65 to configure FIFO priority for <code>ptp4l</code> and <code>phc2sys</code> processes when <code>ptpSchedulingPolicy</code> is set to <code>SCHED_FIFO</code>.
The <code>ptpSchedulingPriority</code> field is not used when <code>ptpSchedulingPolicy</code> is set to <code>SCHED_OTHER</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ptpClockThreshold</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional.
If <code>ptpClockThreshold</code> stanza is not present, default values are used for <code>ptpClockThreshold</code> fields.
Stanza shows default <code>ptpClockThreshold</code> values. <code>ptpClockThreshold</code> values configure how long after the PTP master clock is disconnected before PTP events are triggered.
<code>holdOverTimeout</code> is the time value in seconds before the PTP clock event state changes to <code>FREERUN</code> when the PTP master clock is disconnected.
The <code>maxOffsetThreshold</code> and <code>minOffsetThreshold</code> settings configure offset values in nanoseconds that compare against the values for <code>CLOCK_REALTIME</code> (<code>phc2sys</code>) or master offset (<code>ptp4l</code>).
When the <code>ptp4l</code> or <code>phc2sys</code> offset value is outside this range, the PTP clock state is set to <code>FREERUN</code>. When the offset value is within this range, the PTP clock state is set to <code>LOCKED</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ts2phcConf</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Sets the configuration for the <code>ts2phc</code> command.</p>
</div>
<div class="paragraph">
<p><code>leapfile</code> is the default path to the current leap seconds definition file in the PTP Operator container image.</p>
</div>
<div class="paragraph">
<p><code>ts2phc.nmea_serialport</code> is the serial port device that is connected to the NMEA GPS clock source.
When configured, the GNSS receiver is accessible on <code>/dev/gnss&lt;id&gt;</code>.
If the host has multiple GNSS receivers, you can find the correct device by enumerating either of the following devices:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>/sys/class/net/&lt;eth_port&gt;/device/gnss/</code></p>
</li>
<li>
<p><code>/sys/class/gnss/gnss&lt;id&gt;/device/</code></p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ts2phcOpts</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set options for the <code>ts2phc</code> command.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>recommend</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specify an array of one or more <code>recommend</code> objects that define rules on how the <code>profile</code> should be applied to nodes.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.recommend.profile</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specify the <code>.recommend.profile</code> object name that is defined in the <code>profile</code> section.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.recommend.priority</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specify the <code>priority</code> with an integer value between <code>0</code> and <code>99</code>.
A larger number gets lower priority, so a priority of <code>99</code> is lower than a priority of <code>10</code>.
If a node can be matched with multiple profiles according to rules defined in the <code>match</code> field, the profile with the higher priority is applied to that node.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.recommend.match</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specify <code>.recommend.match</code> rules with <code>nodeLabel</code> or <code>nodeName</code> values.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.recommend.match.nodeLabel</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set <code>nodeLabel</code> with the <code>key</code> of the <code>node.Labels</code> field from the node object by using the <code>oc get nodes --show-labels</code> command.
For example, <code>node-role.kubernetes.io/worker</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.recommend.match.nodeName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set <code>nodeName</code> with the value of the <code>node.Name</code> field from the node object by using the <code>oc get nodes</code> command.
For example, <code>compute-1.example.com</code>.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="nw-ptp-grandmaster-clock-class-reference_configuring-ptp"><a class="anchor" href="#nw-ptp-grandmaster-clock-class-reference_configuring-ptp"></a>Grandmaster clock class sync state reference</h3>
<div class="paragraph">
<p>The following table describes the PTP grandmaster clock (T-GM) <code>gm.ClockClass</code> states.
Clock class states categorize T-GM clocks based on their accuracy and stability with regard to the Primary Reference Time Clock (PRTC) or other timing source.</p>
</div>
<div class="paragraph">
<p>Holdover specification is the amount of time a PTP clock can maintain synchronization without receiving updates from the primary time source.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. T-GM clock class states</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Clock class state</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>gm.ClockClass 6</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">T-GM clock is connected to a PRTC in <code>LOCKED</code> mode.
For example, the PRTC is traceable to a GNSS time source.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>gm.ClockClass 7</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">T-GM clock is in <code>HOLDOVER</code> mode, and within holdover specification.
The clock source might not be traceable to a category 1 frequency source.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>gm.ClockClass 140</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">T-GM clock is in <code>HOLDOVER</code> mode, is out of holdover specification, but it is still traceable to the category 1 frequency source.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>gm.ClockClass 248</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">T-GM clock is in <code>FREERUN</code> mode.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>For more information, see <a href="https://www.itu.int/rec/T-REC-G.8275.1-202211-I/en">"Phase/time traceability information", ITU-T G.8275.1/Y.1369.1 Recommendations</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="nw-ptp-wpc-hardware-pins-reference_configuring-ptp"><a class="anchor" href="#nw-ptp-wpc-hardware-pins-reference_configuring-ptp"></a>Intel Westport Channel E810 hardware configuration reference</h3>
<div class="paragraph">
<p>Use this information to understand how to use the <a href="https://github.com/openshift/linuxptp-daemon/blob/release-4.16/addons/intel/e810.go">Intel E810-XXVDA4T hardware plugin</a> to configure the E810 network interface as PTP grandmaster clock.
Hardware pin configuration determines how the network interface interacts with other components and devices in the system.
The E810-XXVDA4T NIC has four connectors for external 1PPS signals: <code>SMA1</code>, <code>SMA2</code>, <code>U.FL1</code>, and <code>U.FL2</code>.</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 90%;">
<caption class="title">Table 3. Intel E810 NIC hardware connectors configuration</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Hardware pin</th>
<th class="tableblock halign-left valign-top">Recommended setting</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>U.FL1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0 1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Disables the <code>U.FL1</code> connector input.
The <code>U.FL1</code> connector is output-only.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>U.FL2</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0 2</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Disables the <code>U.FL2</code> connector output.
The <code>U.FL2</code> connector is input-only.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SMA1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0 1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Disables the <code>SMA1</code> connector input.
The <code>SMA1</code> connector is bidirectional.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SMA2</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0 2</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Disables the <code>SMA2</code> connector output.
The <code>SMA2</code> connector is bidirectional.</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p><code>SMA1</code> and <code>U.FL1</code> connectors share channel one.
<code>SMA2</code> and <code>U.FL2</code> connectors share channel two.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Set <code>spec.profile.plugins.e810.ublxCmds</code> parameters to configure the GNSS clock in the <code>PtpConfig</code> custom resource (CR).
Each of these <code>ublxCmds</code> stanzas correspond to a configuration that is applied to the host NIC by using <code>ubxtool</code> commands.
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">ublxCmds:
  - args: #ubxtool -P 29.20 -z CFG-HW-ANT_CFG_VOLTCTRL,1
      - "-P"
      - "29.20"
      - "-z"
      - "CFG-HW-ANT_CFG_VOLTCTRL,1"
    reportOutput: false</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following table describes the equivalent <code>ubxtool</code> commands:</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 90%;">
<caption class="title">Table 4. Intel E810 ublxCmds configuration</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">ubxtool command</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ubxtool -P 29.20 -z CFG-HW-ANT_CFG_VOLTCTRL,1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables antenna voltage control. Enables antenna status to be reported in the <code>UBX-MON-RF</code> and <code>UBX-INF-NOTICE</code> log messages.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ubxtool -P 29.20 -e GPS</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables the antenna to receive GPS signals.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ubxtool -P 29.20 -d Galileo</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures the antenna to receive signal from the Galileo GPS satellite.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ubxtool -P 29.20 -d GLONASS</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Disables the antenna from receiving signal from the GLONASS GPS satellite.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ubxtool -P 29.20 -d BeiDou</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Disables the antenna from receiving signal from the BeiDou GPS satellite.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ubxtool -P 29.20 -d SBAS</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Disables the antenna from receiving signal from the SBAS GPS satellite.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ubxtool -P 29.20 -t -w 5 -v 1 -e SURVEYIN,600,50000</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures the GNSS receiver survey-in process to improve its initial position estimate. This can take up to 24 hours to achieve an optimal result.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ubxtool -P 29.20 -p MON-HW</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Runs a single automated scan of the hardware and reports on the NIC state and configuration settings.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The E810 plugin implements the following interfaces:</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 90%;">
<caption class="title">Table 5. E810 plugin interfaces</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Interface</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OnPTPConfigChangeE810</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Runs whenever you update the <code>PtpConfig</code> CR.
The function parses the plugin options and applies the required configurations to the network device pins based on the configuration data.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AfterRunPTPCommandE810</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Runs after launching the PTP processes and running the <code>gpspipe</code> PTP command.
The function processes the plugin options and runs <code>ubxtool</code> commands, storing the output in the plugin-specific data.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PopulateHwConfigE810</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Populates the <code>NodePtpDevice</code> CR based on hardware-specific data in the <code>PtpConfig</code> CR.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The E810 plugin has the following structs and variables:</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 90%;">
<caption class="title">Table 6. E810 plugin structs and variables</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Struct</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>E810Opts</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Represents options for the E810 plugin, including boolean flags and a map of network device pins.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>E810UblxCmds</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Represents configurations for <code>ubxtool</code> commands with a boolean flag and a slice of strings for command arguments.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>E810PluginData</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Holds plugin-specific data used during plugin execution.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="nw-ptp-dual-wpc-hardware-config-reference_configuring-ptp"><a class="anchor" href="#nw-ptp-dual-wpc-hardware-config-reference_configuring-ptp"></a>Dual E810 Westport Channel NIC configuration reference</h3>
<div class="paragraph">
<p>Use this information to understand how to use the <a href="https://github.com/openshift/linuxptp-daemon/blob/release-4.14/addons/intel/e810.go">Intel E810-XXVDA4T hardware plugin</a> to configure a pair of E810 network interfaces as PTP grandmaster clock (T-GM).</p>
</div>
<div class="paragraph">
<p>Before you configure the dual-NIC cluster host, you must connect the two NICs with an SMA1 cable using the 1PPS faceplace connections.</p>
</div>
<div class="paragraph">
<p>When you configure a dual-NIC T-GM, you need to compensate for the 1PPS signal delay that occurs when you connect the NICs using the SMA1 connection ports.
Various factors such as cable length, ambient temperature, and component and manufacturing tolerances can affect the signal delay.
To compensate for the delay, you must calculate the specific value that you use to offset the signal delay.</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 90%;">
<caption class="title">Table 7. E810 dual-NIC T-GM PtpConfig CR reference</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">PtpConfig field</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spec.profile.plugins.e810.pins</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Configure the E810 hardware pins using the PTP Operator E810 hardware plugin.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Pin <code>2 1</code> enables the <code>1PPS OUT</code> connection for <code>SMA1</code> on NIC one.</p>
</li>
<li>
<p>Pin <code>1 1</code> enables the <code>1PPS IN</code> connection for <code>SMA1</code> on NIC two.</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spec.profile.ts2phcConf</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use the <code>ts2phcConf</code> field to configure parameters for NIC one and NIC two.
Set <code>ts2phc.master 0</code> for NIC two.
This configures the timing source for NIC two from the 1PPS input, not GNSS.
Configure the <code>ts2phc.extts_correction</code> value for NIC two to compensate for the delay that is incurred for the specific SMA cable and cable length that you use.
The value that you configure depends on your specific measurements and SMA1 cable length.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spec.profile.ptp4lConf</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set the value of <code>boundary_clock_jbod</code> to 1 to enable support for multiple NICs.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ptp-configuring-dynamic-leap-seconds-handling-for-tgm_configuring-ptp"><a class="anchor" href="#ptp-configuring-dynamic-leap-seconds-handling-for-tgm_configuring-ptp"></a>Configuring dynamic leap seconds handling for PTP grandmaster clocks</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The PTP Operator container image includes the latest <code>leap-seconds.list</code> file  that is available at the time of release.
You can configure the PTP Operator to automatically update the leap second file by using Global Positioning System (GPS) announcements.</p>
</div>
<div class="paragraph">
<p>Leap second information is stored in an automatically generated <code>ConfigMap</code> resource named <code>leap-configmap</code> in the <code>openshift-ptp</code> namespace.
The PTP Operator mounts the <code>leap-configmap</code> resource as a volume in the <code>linuxptp-daemon</code> pod that is accessible by the <code>ts2phc</code> process.</p>
</div>
<div class="paragraph">
<p>If the GPS satellite broadcasts new leap second data, the PTP Operator updates the <code>leap-configmap</code> resource with the new data.
The <code>ts2phc</code> process picks up the changes automatically.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The following procedure is provided as reference.
The 4.14 version of the PTP Operator enables automatic leap second management by default.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You have installed the OpenShift CLI (<code>oc</code>).</p>
</li>
<li>
<p>You have logged in as a user with <code>cluster-admin</code> privileges.</p>
</li>
<li>
<p>You have installed the PTP Operator and configured a PTP grandmaster clock (T-GM) in the cluster.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Configure automatic leap second handling in the <code>phc2sysOpts</code> section of the <code>PtpConfig</code> CR.
Set the following options:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">phc2sysOpts: -r -u 0 -m -w -N 8 -R 16 -S 2 -s ens2f0 -n 24 <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Set <code>-w</code> to force <code>phc2sys</code> to wait until <code>ptp4l</code> has synchronized the system hardware clock before starting its own synchronization process.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Previously, the T-GM required an offset adjustment in the <code>phc2sys</code> configuration (<code>-O -37</code>) to account for historical leap seconds.
This is no longer needed.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Configure the Intel e810 NIC to enable periodical reporting of <code>NAV-TIMELS</code> messages by the GPS receiver in the <code>spec.profile.plugins.e810.ublxCmds</code> section of the <code>PtpConfig</code> CR.
For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">- args: #ubxtool -P 29.20 -p CFG-MSG,1,38,248
    - "-P"
    - "29.20"
    - "-p"
    - "CFG-MSG,1,38,248"</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="olist arabic">
<div class="title">Verification</div>
<ol class="arabic">
<li>
<p>Validate that the configured T-GM is receiving <code>NAV-TIMELS</code> messages from the connected GPS.
Run the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc -n openshift-ptp -c linuxptp-daemon-container exec -it $(oc -n openshift-ptp get pods -o name | grep daemon) -- ubxtool -t -p NAV-TIMELS -P 29.20</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">1722509534.4417
UBX-NAV-STATUS:
  iTOW 384752000 gpsFix 5 flags 0xdd fixStat 0x0 flags2 0x8
  ttff 18261, msss 1367642864

1722509534.4419
UBX-NAV-TIMELS:
  iTOW 384752000 version 0 reserved2 0 0 0 srcOfCurrLs 2
  currLs 18 srcOfLsChange 2 lsChange 0 timeToLsEvent 70376866
  dateOfLsGpsWn 2441 dateOfLsGpsDn 7 reserved2 0 0 0
  valid x3

1722509534.4421
UBX-NAV-CLOCK:
  iTOW 384752000 clkB 784281 clkD 435 tAcc 3 fAcc 215

1722509535.4477
UBX-NAV-STATUS:
  iTOW 384753000 gpsFix 5 flags 0xdd fixStat 0x0 flags2 0x8
  ttff 18261, msss 1367643864

1722509535.4479
UBX-NAV-CLOCK:
  iTOW 384753000 clkB 784716 clkD 435 tAcc 3 fAcc 218</code></pre>
</div>
</div>
</li>
<li>
<p>Validate that the <code>leap-configmap</code> resource has been successfully generated by the PTP Operator and is up to date with the latest version of the <a href="https://hpiers.obspm.fr/iers/bul/bulc/ntp/leap-seconds.list">leap-seconds.list</a>.
Run the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc -n openshift-ptp get configmap leap-configmap -o jsonpath='{.data.&lt;node_name&gt;}' <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Replace <code>&lt;node_name&gt;</code> with the node where you have installed and configured the PTP T-GM clock with automatic leap second management.
Escape special characters in the node name.
For example, <code>node-1\.example\.com</code>.</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal"># Do not edit
# This file is generated automatically by linuxptp-daemon
#$  3913697179
#@  4291747200
2272060800     10    # 1 Jan 1972
2287785600     11    # 1 Jul 1972
2303683200     12    # 1 Jan 1973
2335219200     13    # 1 Jan 1974
2366755200     14    # 1 Jan 1975
2398291200     15    # 1 Jan 1976
2429913600     16    # 1 Jan 1977
2461449600     17    # 1 Jan 1978
2492985600     18    # 1 Jan 1979
2524521600     19    # 1 Jan 1980
2571782400     20    # 1 Jul 1981
2603318400     21    # 1 Jul 1982
2634854400     22    # 1 Jul 1983
2698012800     23    # 1 Jul 1985
2776982400     24    # 1 Jan 1988
2840140800     25    # 1 Jan 1990
2871676800     26    # 1 Jan 1991
2918937600     27    # 1 Jul 1992
2950473600     28    # 1 Jul 1993
2982009600     29    # 1 Jul 1994
3029443200     30    # 1 Jan 1996
3076704000     31    # 1 Jul 1997
3124137600     32    # 1 Jan 1999
3345062400     33    # 1 Jan 2006
3439756800     34    # 1 Jan 2009
3550089600     35    # 1 Jul 2012
3644697600     36    # 1 Jul 2015
3692217600     37    # 1 Jan 2017

#h  e65754d4 8f39962b aa854a61 661ef546 d2af0bfa</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configuring-linuxptp-services-as-boundary-clock_configuring-ptp"><a class="anchor" href="#configuring-linuxptp-services-as-boundary-clock_configuring-ptp"></a>Configuring linuxptp services as a boundary clock</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can configure the <code>linuxptp</code> services (<code>ptp4l</code>, <code>phc2sys</code>) as boundary clock by creating a <code>PtpConfig</code> custom resource (CR) object.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Use the following example <code>PtpConfig</code> CR as the basis to configure <code>linuxptp</code> services as the boundary clock for your particular hardware and environment.
This example CR does not configure PTP fast events. To configure PTP fast events, set appropriate values for <code>ptp4lOpts</code>, <code>ptp4lConf</code>, and <code>ptpClockThreshold</code>.
<code>ptpClockThreshold</code> is used only when events are enabled.
See "Configuring the PTP fast event notifications publisher" for more information.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Install the OpenShift CLI (<code>oc</code>).</p>
</li>
<li>
<p>Log in as a user with <code>cluster-admin</code> privileges.</p>
</li>
<li>
<p>Install the PTP Operator.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create the following <code>PtpConfig</code> CR, and then save the YAML in the <code>boundary-clock-ptp-config.yaml</code> file.</p>
<div class="listingblock">
<div class="title">Example PTP boundary clock configuration</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: ptp.openshift.io/v1
kind: PtpConfig
metadata:
  name: boundary-clock
  namespace: openshift-ptp
  annotations: {}
spec:
  profile:
    - name: boundary-clock
      ptp4lOpts: "-2"
      phc2sysOpts: "-a -r -n 24"
      ptpSchedulingPolicy: SCHED_FIFO
      ptpSchedulingPriority: 10
      ptpSettings:
        logReduce: "true"
      ptp4lConf: |
        # The interface name is hardware-specific
        [$iface_slave]
        masterOnly 0
        [$iface_master_1]
        masterOnly 1
        [$iface_master_2]
        masterOnly 1
        [$iface_master_3]
        masterOnly 1
        [global]
        #
        # Default Data Set
        #
        twoStepFlag 1
        slaveOnly 0
        priority1 128
        priority2 128
        domainNumber 24
        #utc_offset 37
        clockClass 248
        clockAccuracy 0xFE
        offsetScaledLogVariance 0xFFFF
        free_running 0
        freq_est_interval 1
        dscp_event 0
        dscp_general 0
        dataset_comparison G.8275.x
        G.8275.defaultDS.localPriority 128
        #
        # Port Data Set
        #
        logAnnounceInterval -3
        logSyncInterval -4
        logMinDelayReqInterval -4
        logMinPdelayReqInterval -4
        announceReceiptTimeout 3
        syncReceiptTimeout 0
        delayAsymmetry 0
        fault_reset_interval -4
        neighborPropDelayThresh 20000000
        masterOnly 0
        G.8275.portDS.localPriority 128
        #
        # Run time options
        #
        assume_two_step 0
        logging_level 6
        path_trace_enabled 0
        follow_up_info 0
        hybrid_e2e 0
        inhibit_multicast_service 0
        net_sync_monitor 0
        tc_spanning_tree 0
        tx_timestamp_timeout 50
        unicast_listen 0
        unicast_master_table 0
        unicast_req_duration 3600
        use_syslog 1
        verbose 0
        summary_interval 0
        kernel_leap 1
        check_fup_sync 0
        clock_class_threshold 135
        #
        # Servo Options
        #
        pi_proportional_const 0.0
        pi_integral_const 0.0
        pi_proportional_scale 0.0
        pi_proportional_exponent -0.3
        pi_proportional_norm_max 0.7
        pi_integral_scale 0.0
        pi_integral_exponent 0.4
        pi_integral_norm_max 0.3
        step_threshold 2.0
        first_step_threshold 0.00002
        max_frequency 900000000
        clock_servo pi
        sanity_freq_limit 200000000
        ntpshm_segment 0
        #
        # Transport options
        #
        transportSpecific 0x0
        ptp_dst_mac 01:1B:19:00:00:00
        p2p_dst_mac 01:80:C2:00:00:0E
        udp_ttl 1
        udp6_scope 0x0E
        uds_address /var/run/ptp4l
        #
        # Default interface options
        #
        clock_type BC
        network_transport L2
        delay_mechanism E2E
        time_stamping hardware
        tsproc_mode filter
        delay_filter moving_median
        delay_filter_length 10
        egressLatency 0
        ingressLatency 0
        boundary_clock_jbod 0
        #
        # Clock description
        #
        productDescription ;;
        revisionData ;;
        manufacturerIdentity 00:00:00
        userDescription ;
        timeSource 0xA0
  recommend:
    - profile: boundary-clock
      priority: 4
      match:
        - nodeLabel: "node-role.kubernetes.io/$mcp"</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 8. PTP boundary clock CR configuration options</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">CR field</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the <code>PtpConfig</code> CR.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>profile</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specify an array of one or more <code>profile</code> objects.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specify the name of a profile object which uniquely identifies a profile object.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ptp4lOpts</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specify system config options for the <code>ptp4l</code> service. The options should not include the network interface name <code>-i &lt;interface&gt;</code> and service config file <code>-f /etc/ptp4l.conf</code> because the network interface name and the service config file are automatically appended.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ptp4lConf</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specify the required configuration to start <code>ptp4l</code> as boundary clock. For example, <code>ens1f0</code> synchronizes from a grandmaster clock and <code>ens1f3</code> synchronizes connected devices.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;interface_1&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The interface that receives the synchronization clock.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;interface_2&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The interface that sends the synchronization clock.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>tx_timestamp_timeout</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">For Intel Columbiaville 800 Series NICs, set <code>tx_timestamp_timeout</code> to <code>50</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>boundary_clock_jbod</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">For Intel Columbiaville 800 Series NICs, ensure <code>boundary_clock_jbod</code> is set to <code>0</code>. For Intel Fortville X710 Series NICs, ensure <code>boundary_clock_jbod</code> is set to <code>1</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>phc2sysOpts</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specify system config options for the <code>phc2sys</code> service. If this field is empty, the PTP Operator does not start the <code>phc2sys</code> service.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ptpSchedulingPolicy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Scheduling policy for ptp4l and phc2sys processes. Default value is <code>SCHED_OTHER</code>. Use <code>SCHED_FIFO</code> on systems that support FIFO scheduling.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ptpSchedulingPriority</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer value from 1-65 used to set FIFO priority for <code>ptp4l</code> and <code>phc2sys</code> processes when <code>ptpSchedulingPolicy</code> is set to <code>SCHED_FIFO</code>. The <code>ptpSchedulingPriority</code> field is not used when <code>ptpSchedulingPolicy</code> is set to <code>SCHED_OTHER</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ptpClockThreshold</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional. If <code>ptpClockThreshold</code> is not present, default values are used for the <code>ptpClockThreshold</code> fields. <code>ptpClockThreshold</code> configures how long after the PTP master clock is disconnected before PTP events are triggered. <code>holdOverTimeout</code> is the time value in seconds before the PTP clock event state changes to <code>FREERUN</code> when the PTP master clock is disconnected. The <code>maxOffsetThreshold</code> and <code>minOffsetThreshold</code> settings configure offset values in nanoseconds that compare against the values for <code>CLOCK_REALTIME</code> (<code>phc2sys</code>) or master offset (<code>ptp4l</code>). When the <code>ptp4l</code> or <code>phc2sys</code> offset value is outside this range, the PTP clock state is set to <code>FREERUN</code>. When the offset value is within this range, the PTP clock state is set to <code>LOCKED</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>recommend</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specify an array of one or more <code>recommend</code> objects that define rules on how the <code>profile</code> should be applied to nodes.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.recommend.profile</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specify the <code>.recommend.profile</code> object name defined in the <code>profile</code> section.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.recommend.priority</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specify the <code>priority</code> with an integer value between <code>0</code> and <code>99</code>. A larger number gets lower priority, so a priority of <code>99</code> is lower than a priority of <code>10</code>. If a node can be matched with multiple profiles according to rules defined in the <code>match</code> field, the profile with the higher priority is applied to that node.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.recommend.match</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specify <code>.recommend.match</code> rules with <code>nodeLabel</code> or <code>nodeName</code> values.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.recommend.match.nodeLabel</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set <code>nodeLabel</code> with the <code>key</code> of the <code>node.Labels</code> field from the node object by using the <code>oc get nodes --show-labels</code> command.
For example, <code>node-role.kubernetes.io/worker</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.recommend.match.nodeName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set <code>nodeName</code> with the value of the <code>node.Name</code> field from the node object by using the <code>oc get nodes</code> command.
For example, <code>compute-1.example.com</code>.</p></td>
</tr>
</tbody>
</table>
</li>
<li>
<p>Create the CR by running the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc create -f boundary-clock-ptp-config.yaml</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="olist arabic">
<div class="title">Verification</div>
<ol class="arabic">
<li>
<p>Check that the <code>PtpConfig</code> profile is applied to the node.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Get the list of pods in the <code>openshift-ptp</code> namespace by running the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc get pods -n openshift-ptp -o wide</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">NAME                            READY   STATUS    RESTARTS   AGE   IP               NODE
linuxptp-daemon-4xkbb           1/1     Running   0          43m   10.1.196.24      compute-0.example.com
linuxptp-daemon-tdspf           1/1     Running   0          43m   10.1.196.25      compute-1.example.com
ptp-operator-657bbb64c8-2f8sj   1/1     Running   0          43m   10.129.0.61      control-plane-1.example.com</code></pre>
</div>
</div>
</li>
<li>
<p>Check that the profile is correct. Examine the logs of the <code>linuxptp</code> daemon that corresponds to the node you specified in the <code>PtpConfig</code> profile. Run the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc logs linuxptp-daemon-4xkbb -n openshift-ptp -c linuxptp-daemon-container</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">I1115 09:41:17.117596 4143292 daemon.go:107] in applyNodePTPProfile
I1115 09:41:17.117604 4143292 daemon.go:109] updating NodePTPProfile to:
I1115 09:41:17.117607 4143292 daemon.go:110] ------------------------------------
I1115 09:41:17.117612 4143292 daemon.go:102] Profile Name: profile1
I1115 09:41:17.117616 4143292 daemon.go:102] Interface:
I1115 09:41:17.117620 4143292 daemon.go:102] Ptp4lOpts: -2
I1115 09:41:17.117623 4143292 daemon.go:102] Phc2sysOpts: -a -r -n 24
I1115 09:41:17.117626 4143292 daemon.go:116] ------------------------------------</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="../../networking/ptp/configuring-ptp.html#cnf-configuring-fifo-priority-scheduling-for-ptp_configuring-ptp">Configuring FIFO priority scheduling for PTP hardware</a></p>
</li>
<li>
<p><a href="../../networking/ptp/ptp-cloud-events-consumer-dev-reference.html#cnf-configuring-the-ptp-fast-event-publisher-v2_ptp-consumer">Configuring the PTP fast event notifications publisher</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="ptp-configuring-linuxptp-services-as-bc-for-dual-nic_configuring-ptp"><a class="anchor" href="#ptp-configuring-linuxptp-services-as-bc-for-dual-nic_configuring-ptp"></a>Configuring linuxptp services as boundary clocks for dual-NIC hardware</h3>
<div class="paragraph">
<p>You can configure the <code>linuxptp</code> services (<code>ptp4l</code>, <code>phc2sys</code>) as boundary clocks for dual-NIC hardware by creating a <code>PtpConfig</code> custom resource (CR) object for each NIC.</p>
</div>
<div class="paragraph">
<p>Dual NIC hardware allows you to connect each NIC to the same upstream leader clock with separate <code>ptp4l</code> instances for each NIC feeding the downstream clocks.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Install the OpenShift CLI (<code>oc</code>).</p>
</li>
<li>
<p>Log in as a user with <code>cluster-admin</code> privileges.</p>
</li>
<li>
<p>Install the PTP Operator.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create two separate <code>PtpConfig</code> CRs, one for each NIC, using the reference CR in "Configuring linuxptp services as a boundary clock" as the basis for each CR. For example:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Create <code>boundary-clock-ptp-config-nic1.yaml</code>, specifying values for <code>phc2sysOpts</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: ptp.openshift.io/v1
kind: PtpConfig
metadata:
  name: boundary-clock-ptp-config-nic1
  namespace: openshift-ptp
spec:
  profile:
  - name: "profile1"
    ptp4lOpts: "-2 --summary_interval -4"
    ptp4lConf: | <i class="conum" data-value="1"></i><b>(1)</b>
      [ens5f1]
      masterOnly 1
      [ens5f0]
      masterOnly 0
    ...
    phc2sysOpts: "-a -r -m -n 24 -N 8 -R 16" <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Specify the required interfaces to start <code>ptp4l</code> as a boundary clock. For example, <code>ens5f0</code> synchronizes from a grandmaster clock and <code>ens5f1</code> synchronizes connected devices.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Required <code>phc2sysOpts</code> values. <code>-m</code> prints messages to <code>stdout</code>. The <code>linuxptp-daemon</code> <code>DaemonSet</code> parses the logs and generates Prometheus metrics.</td>
</tr>
</table>
</div>
</li>
<li>
<p>Create <code>boundary-clock-ptp-config-nic2.yaml</code>, removing the <code>phc2sysOpts</code> field altogether to disable the <code>phc2sys</code> service for the second NIC:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: ptp.openshift.io/v1
kind: PtpConfig
metadata:
  name: boundary-clock-ptp-config-nic2
  namespace: openshift-ptp
spec:
  profile:
  - name: "profile2"
    ptp4lOpts: "-2 --summary_interval -4"
    ptp4lConf: | <i class="conum" data-value="1"></i><b>(1)</b>
      [ens7f1]
      masterOnly 1
      [ens7f0]
      masterOnly 0
...</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Specify the required interfaces to start <code>ptp4l</code> as a boundary clock on the second NIC.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You must completely remove the <code>phc2sysOpts</code> field from the second <code>PtpConfig</code> CR to disable the <code>phc2sys</code> service on the second NIC.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Create the dual-NIC <code>PtpConfig</code> CRs by running the following commands:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Create the CR that configures PTP for the first NIC:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc create -f boundary-clock-ptp-config-nic1.yaml</code></pre>
</div>
</div>
</li>
<li>
<p>Create the CR that configures PTP for the second NIC:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc create -f boundary-clock-ptp-config-nic2.yaml</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Verification</div>
<ul>
<li>
<p>Check that the PTP Operator has applied the <code>PtpConfig</code> CRs for both NICs. Examine the logs for the <code>linuxptp</code> daemon corresponding to the node that has the dual-NIC hardware installed. For example, run the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc logs linuxptp-daemon-cvgr6 -n openshift-ptp -c linuxptp-daemon-container</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">ptp4l[80828.335]: [ptp4l.1.config] master offset          5 s2 freq   -5727 path delay       519
ptp4l[80828.343]: [ptp4l.0.config] master offset         -5 s2 freq  -10607 path delay       533
phc2sys[80828.390]: [ptp4l.0.config] CLOCK_REALTIME phc offset         1 s2 freq  -87239 delay    539</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="ptp-configuring-linuxptp-services-as-ha-bc-for-dual-nic_configuring-ptp"><a class="anchor" href="#ptp-configuring-linuxptp-services-as-ha-bc-for-dual-nic_configuring-ptp"></a>Configuring linuxptp as a highly available system clock for dual-NIC Intel E810 PTP boundary clocks</h3>
<div class="paragraph">
<p>You can configure the <code>linuxptp</code> services <code>ptp4l</code> and <code>phc2sys</code> as a highly available (HA) system clock for dual PTP boundary clocks (T-BC).</p>
</div>
<div class="paragraph">
<p>The highly available system clock uses multiple time sources from dual-NIC Intel E810 Salem channel hardware configured as two boundary clocks.
Two boundary clocks instances participate in the HA setup, each with its own configuration profile.
You connect each NIC to the same upstream leader clock with separate <code>ptp4l</code> instances for each NIC feeding the downstream clocks.</p>
</div>
<div class="paragraph">
<p>Create two <code>PtpConfig</code> custom resource (CR) objects that configure the NICs as T-BC and a third <code>PtpConfig</code> CR that configures high availability between the two NICs.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You set <code>phc2SysOpts</code> options once in the <code>PtpConfig</code> CR that configures HA.
Set the <code>phc2sysOpts</code> field to an empty string in the <code>PtpConfig</code> CRs that configure the two NICs.
This prevents individual <code>phc2sys</code> processes from being set up for the two profiles.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The third <code>PtpConfig</code> CR configures a highly available system clock service.
The CR sets the <code>ptp4lOpts</code> field to an empty string to prevent the <code>ptp4l</code> process from running.
The CR adds profiles for the <code>ptp4l</code> configurations under the <code>spec.profile.ptpSettings.haProfiles</code> key and passes the kernel socket path of those profiles to the <code>phc2sys</code> service.
When a <code>ptp4l</code> failure occurs, the <code>phc2sys</code> service switches to the backup <code>ptp4l</code> configuration.
When the primary profile becomes active again, the <code>phc2sys</code> service reverts to the original state.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Ensure that you set <code>spec.recommend.priority</code> to the same value for all three <code>PtpConfig</code> CRs that you use to configure HA.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Install the OpenShift CLI (<code>oc</code>).</p>
</li>
<li>
<p>Log in as a user with <code>cluster-admin</code> privileges.</p>
</li>
<li>
<p>Install the PTP Operator.</p>
</li>
<li>
<p>Configure a cluster node with Intel E810 Salem channel dual-NIC.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create two separate <code>PtpConfig</code> CRs, one for each NIC, using the CRs in "Configuring linuxptp services as boundary clocks for dual-NIC hardware" as a reference for each CR.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Create the <code>ha-ptp-config-nic1.yaml</code> file, specifying an empty string for the <code>phc2sysOpts</code> field.
For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: ptp.openshift.io/v1
kind: PtpConfig
metadata:
  name: ha-ptp-config-nic1
  namespace: openshift-ptp
spec:
  profile:
  - name: "ha-ptp-config-profile1"
    ptp4lOpts: "-2 --summary_interval -4"
    ptp4lConf: | <i class="conum" data-value="1"></i><b>(1)</b>
      [ens5f1]
      masterOnly 1
      [ens5f0]
      masterOnly 0
    #...
    phc2sysOpts: "" <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Specify the required interfaces to start <code>ptp4l</code> as a boundary clock. For example, <code>ens5f0</code> synchronizes from a grandmaster clock and <code>ens5f1</code> synchronizes connected devices.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Set <code>phc2sysOpts</code> with an empty string.
These values are populated from the <code>spec.profile.ptpSettings.haProfiles</code> field of the <code>PtpConfig</code> CR that configures high availability.</td>
</tr>
</table>
</div>
</li>
<li>
<p>Apply the <code>PtpConfig</code> CR for NIC 1 by running the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc create -f ha-ptp-config-nic1.yaml</code></pre>
</div>
</div>
</li>
<li>
<p>Create the <code>ha-ptp-config-nic2.yaml</code> file, specifying an empty string for the <code>phc2sysOpts</code> field.
For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: ptp.openshift.io/v1
kind: PtpConfig
metadata:
  name: ha-ptp-config-nic2
  namespace: openshift-ptp
spec:
  profile:
  - name: "ha-ptp-config-profile2"
    ptp4lOpts: "-2 --summary_interval -4"
    ptp4lConf: |
      [ens7f1]
      masterOnly 1
      [ens7f0]
      masterOnly 0
    #...
    phc2sysOpts: ""</code></pre>
</div>
</div>
</li>
<li>
<p>Apply the <code>PtpConfig</code> CR for NIC 2 by running the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc create -f ha-ptp-config-nic2.yaml</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Create the <code>PtpConfig</code> CR that configures the HA system clock.
For example:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Create the <code>ptp-config-for-ha.yaml</code> file.
Set <code>haProfiles</code> to match the <code>metadata.name</code> fields that are set in the <code>PtpConfig</code> CRs that configure the two NICs.
For example: <code>haProfiles: ha-ptp-config-nic1,ha-ptp-config-nic2</code></p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: ptp.openshift.io/v1
kind: PtpConfig
metadata:
  name: boundary-ha
  namespace: openshift-ptp
  annotations: {}
spec:
  profile:
    - name: "boundary-ha"
      ptp4lOpts: "" <i class="conum" data-value="1"></i><b>(1)</b>
      phc2sysOpts: "-a -r -n 24"
      ptpSchedulingPolicy: SCHED_FIFO
      ptpSchedulingPriority: 10
      ptpSettings:
        logReduce: "true"
        haProfiles: "$profile1,$profile2"
  recommend:
    - profile: "boundary-ha"
      priority: 4
      match:
        - nodeLabel: "node-role.kubernetes.io/$mcp"</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Set the <code>ptp4lOpts</code> field to an empty string.
If it is not empty, the <code>p4ptl</code> process starts with a critical error.</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Do not apply the high availability <code>PtpConfig</code> CR before the <code>PtpConfig</code> CRs that configure the individual NICs.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Apply the HA <code>PtpConfig</code> CR by running the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc create -f ptp-config-for-ha.yaml</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Verification</div>
<ul>
<li>
<p>Verify that the PTP Operator has applied the <code>PtpConfig</code> CRs correctly.
Perform the following steps:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Get the list of pods in the <code>openshift-ptp</code> namespace by running the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc get pods -n openshift-ptp -o wide</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">NAME                            READY   STATUS    RESTARTS   AGE   IP               NODE
linuxptp-daemon-4xkrb           1/1     Running   0          43m   10.1.196.24      compute-0.example.com
ptp-operator-657bbq64c8-2f8sj   1/1     Running   0          43m   10.129.0.61      control-plane-1.example.com</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>There should be only one <code>linuxptp-daemon</code> pod.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Check that the profile is correct by running the following command.
Examine the logs of the <code>linuxptp</code> daemon that corresponds to the node you specified in the <code>PtpConfig</code> profile.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc logs linuxptp-daemon-4xkrb -n openshift-ptp -c linuxptp-daemon-container</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">I1115 09:41:17.117596 4143292 daemon.go:107] in applyNodePTPProfile
I1115 09:41:17.117604 4143292 daemon.go:109] updating NodePTPProfile to:
I1115 09:41:17.117607 4143292 daemon.go:110] ------------------------------------
I1115 09:41:17.117612 4143292 daemon.go:102] Profile Name: ha-ptp-config-profile1
I1115 09:41:17.117616 4143292 daemon.go:102] Interface:
I1115 09:41:17.117620 4143292 daemon.go:102] Ptp4lOpts: -2
I1115 09:41:17.117623 4143292 daemon.go:102] Phc2sysOpts: -a -r -n 24
I1115 09:41:17.117626 4143292 daemon.go:116] ------------------------------------</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configuring-linuxptp-services-as-ordinary-clock_configuring-ptp"><a class="anchor" href="#configuring-linuxptp-services-as-ordinary-clock_configuring-ptp"></a>Configuring linuxptp services as an ordinary clock</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can configure <code>linuxptp</code> services (<code>ptp4l</code>, <code>phc2sys</code>) as ordinary clock by creating a <code>PtpConfig</code> custom resource (CR) object.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Use the following example <code>PtpConfig</code> CR as the basis to configure <code>linuxptp</code> services as an ordinary clock for your particular hardware and environment.
This example CR does not configure PTP fast events.
To configure PTP fast events, set appropriate values for <code>ptp4lOpts</code>, <code>ptp4lConf</code>, and <code>ptpClockThreshold</code>. <code>ptpClockThreshold</code> is required only when events are enabled.
See "Configuring the PTP fast event notifications publisher" for more information.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Install the OpenShift CLI (<code>oc</code>).</p>
</li>
<li>
<p>Log in as a user with <code>cluster-admin</code> privileges.</p>
</li>
<li>
<p>Install the PTP Operator.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create the following <code>PtpConfig</code> CR, and then save the YAML in the <code>ordinary-clock-ptp-config.yaml</code> file.</p>
<div id="ptp-ordinary-clock" class="listingblock">
<div class="title">Example PTP ordinary clock configuration</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: ptp.openshift.io/v1
kind: PtpConfig
metadata:
  name: ordinary-clock
  namespace: openshift-ptp
  annotations: {}
spec:
  profile:
    - name: ordinary-clock
      # The interface name is hardware-specific
      interface: $interface
      ptp4lOpts: "-2 -s"
      phc2sysOpts: "-a -r -n 24"
      ptpSchedulingPolicy: SCHED_FIFO
      ptpSchedulingPriority: 10
      ptpSettings:
        logReduce: "true"
      ptp4lConf: |
        [global]
        #
        # Default Data Set
        #
        twoStepFlag 1
        slaveOnly 1
        priority1 128
        priority2 128
        domainNumber 24
        #utc_offset 37
        clockClass 255
        clockAccuracy 0xFE
        offsetScaledLogVariance 0xFFFF
        free_running 0
        freq_est_interval 1
        dscp_event 0
        dscp_general 0
        dataset_comparison G.8275.x
        G.8275.defaultDS.localPriority 128
        #
        # Port Data Set
        #
        logAnnounceInterval -3
        logSyncInterval -4
        logMinDelayReqInterval -4
        logMinPdelayReqInterval -4
        announceReceiptTimeout 3
        syncReceiptTimeout 0
        delayAsymmetry 0
        fault_reset_interval -4
        neighborPropDelayThresh 20000000
        masterOnly 0
        G.8275.portDS.localPriority 128
        #
        # Run time options
        #
        assume_two_step 0
        logging_level 6
        path_trace_enabled 0
        follow_up_info 0
        hybrid_e2e 0
        inhibit_multicast_service 0
        net_sync_monitor 0
        tc_spanning_tree 0
        tx_timestamp_timeout 50
        unicast_listen 0
        unicast_master_table 0
        unicast_req_duration 3600
        use_syslog 1
        verbose 0
        summary_interval 0
        kernel_leap 1
        check_fup_sync 0
        clock_class_threshold 7
        #
        # Servo Options
        #
        pi_proportional_const 0.0
        pi_integral_const 0.0
        pi_proportional_scale 0.0
        pi_proportional_exponent -0.3
        pi_proportional_norm_max 0.7
        pi_integral_scale 0.0
        pi_integral_exponent 0.4
        pi_integral_norm_max 0.3
        step_threshold 2.0
        first_step_threshold 0.00002
        max_frequency 900000000
        clock_servo pi
        sanity_freq_limit 200000000
        ntpshm_segment 0
        #
        # Transport options
        #
        transportSpecific 0x0
        ptp_dst_mac 01:1B:19:00:00:00
        p2p_dst_mac 01:80:C2:00:00:0E
        udp_ttl 1
        udp6_scope 0x0E
        uds_address /var/run/ptp4l
        #
        # Default interface options
        #
        clock_type OC
        network_transport L2
        delay_mechanism E2E
        time_stamping hardware
        tsproc_mode filter
        delay_filter moving_median
        delay_filter_length 10
        egressLatency 0
        ingressLatency 0
        boundary_clock_jbod 0
        #
        # Clock description
        #
        productDescription ;;
        revisionData ;;
        manufacturerIdentity 00:00:00
        userDescription ;
        timeSource 0xA0
  recommend:
    - profile: ordinary-clock
      priority: 4
      match:
        - nodeLabel: "node-role.kubernetes.io/$mcp"</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 9. PTP ordinary clock CR configuration options</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">CR field</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the <code>PtpConfig</code> CR.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>profile</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specify an array of one or more <code>profile</code> objects. Each profile must be uniquely named.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>interface</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specify the network interface to be used by the <code>ptp4l</code> service, for example <code>ens787f1</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ptp4lOpts</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specify system config options for the <code>ptp4l</code> service, for example <code>-2</code> to select the IEEE 802.3 network transport. The options should not include the network interface name <code>-i &lt;interface&gt;</code> and service config file <code>-f /etc/ptp4l.conf</code> because the network interface name and the service config file are automatically appended. Append <code>--summary_interval -4</code> to use PTP fast events with this interface.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>phc2sysOpts</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specify system config options for the <code>phc2sys</code> service. If this field is empty, the PTP Operator does not start the <code>phc2sys</code> service. For Intel Columbiaville 800 Series NICs, set <code>phc2sysOpts</code> options to <code>-a -r -m -n 24 -N 8 -R 16</code>. <code>-m</code> prints messages to <code>stdout</code>. The <code>linuxptp-daemon</code> <code>DaemonSet</code> parses the logs and generates Prometheus metrics.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ptp4lConf</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specify a string that contains the configuration to replace the default <code>/etc/ptp4l.conf</code> file. To use the default configuration, leave the field empty.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>tx_timestamp_timeout</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">For Intel Columbiaville 800 Series NICs, set <code>tx_timestamp_timeout</code> to <code>50</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>boundary_clock_jbod</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">For Intel Columbiaville 800 Series NICs, set <code>boundary_clock_jbod</code> to <code>0</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ptpSchedulingPolicy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Scheduling policy for <code>ptp4l</code> and <code>phc2sys</code> processes. Default value is <code>SCHED_OTHER</code>. Use <code>SCHED_FIFO</code> on systems that support FIFO scheduling.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ptpSchedulingPriority</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer value from 1-65 used to set FIFO priority for <code>ptp4l</code> and <code>phc2sys</code> processes when <code>ptpSchedulingPolicy</code> is set to <code>SCHED_FIFO</code>. The <code>ptpSchedulingPriority</code> field is not used when <code>ptpSchedulingPolicy</code> is set to <code>SCHED_OTHER</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ptpClockThreshold</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional. If <code>ptpClockThreshold</code> is not present, default values are used for the <code>ptpClockThreshold</code> fields. <code>ptpClockThreshold</code> configures how long after the PTP master clock is disconnected before PTP events are triggered. <code>holdOverTimeout</code> is the time value in seconds before the PTP clock event state changes to <code>FREERUN</code> when the PTP master clock is disconnected. The <code>maxOffsetThreshold</code> and <code>minOffsetThreshold</code> settings configure offset values in nanoseconds that compare against the values for <code>CLOCK_REALTIME</code> (<code>phc2sys</code>) or master offset (<code>ptp4l</code>). When the <code>ptp4l</code> or <code>phc2sys</code> offset value is outside this range, the PTP clock state is set to <code>FREERUN</code>. When the offset value is within this range, the PTP clock state is set to <code>LOCKED</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>recommend</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specify an array of one or more <code>recommend</code> objects that define rules on how the <code>profile</code> should be applied to nodes.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.recommend.profile</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specify the <code>.recommend.profile</code> object name defined in the <code>profile</code> section.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.recommend.priority</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set <code>.recommend.priority</code> to <code>0</code> for ordinary clock.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.recommend.match</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specify <code>.recommend.match</code> rules with <code>nodeLabel</code> or <code>nodeName</code> values.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.recommend.match.nodeLabel</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set <code>nodeLabel</code> with the <code>key</code> of the <code>node.Labels</code> field from the node object by using the <code>oc get nodes --show-labels</code> command.
For example, <code>node-role.kubernetes.io/worker</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.recommend.match.nodeName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set <code>nodeName</code> with the value of the <code>node.Name</code> field from the node object by using the <code>oc get nodes</code> command.
For example, <code>compute-1.example.com</code>.</p></td>
</tr>
</tbody>
</table>
</li>
<li>
<p>Create the <code>PtpConfig</code> CR by running the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc create -f ordinary-clock-ptp-config.yaml</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="olist arabic">
<div class="title">Verification</div>
<ol class="arabic">
<li>
<p>Check that the <code>PtpConfig</code> profile is applied to the node.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Get the list of pods in the <code>openshift-ptp</code> namespace by running the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc get pods -n openshift-ptp -o wide</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">NAME                            READY   STATUS    RESTARTS   AGE   IP               NODE
linuxptp-daemon-4xkbb           1/1     Running   0          43m   10.1.196.24      compute-0.example.com
linuxptp-daemon-tdspf           1/1     Running   0          43m   10.1.196.25      compute-1.example.com
ptp-operator-657bbb64c8-2f8sj   1/1     Running   0          43m   10.129.0.61      control-plane-1.example.com</code></pre>
</div>
</div>
</li>
<li>
<p>Check that the profile is correct. Examine the logs of the <code>linuxptp</code> daemon that corresponds to the node you specified in the <code>PtpConfig</code> profile. Run the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc logs linuxptp-daemon-4xkbb -n openshift-ptp -c linuxptp-daemon-container</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">I1115 09:41:17.117596 4143292 daemon.go:107] in applyNodePTPProfile
I1115 09:41:17.117604 4143292 daemon.go:109] updating NodePTPProfile to:
I1115 09:41:17.117607 4143292 daemon.go:110] ------------------------------------
I1115 09:41:17.117612 4143292 daemon.go:102] Profile Name: profile1
I1115 09:41:17.117616 4143292 daemon.go:102] Interface: ens787f1
I1115 09:41:17.117620 4143292 daemon.go:102] Ptp4lOpts: -2 -s
I1115 09:41:17.117623 4143292 daemon.go:102] Phc2sysOpts: -a -r -n 24
I1115 09:41:17.117626 4143292 daemon.go:116] ------------------------------------</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="../../networking/ptp/configuring-ptp.html#cnf-configuring-fifo-priority-scheduling-for-ptp_configuring-ptp">Configuring FIFO priority scheduling for PTP hardware</a></p>
</li>
<li>
<p><a href="../../networking/ptp/ptp-cloud-events-consumer-dev-reference.html#cnf-configuring-the-ptp-fast-event-publisher-v2_ptp-consumer">Configuring the PTP fast event notifications publisher</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="nw-columbiaville-ptp-config-refererence_configuring-ptp"><a class="anchor" href="#nw-columbiaville-ptp-config-refererence_configuring-ptp"></a>Intel Columbiaville E800 series NIC as PTP ordinary clock reference</h3>
<div class="paragraph">
<p>The following table describes the changes that you must make to the reference PTP configuration to use Intel Columbiaville E800 series NICs as ordinary clocks. Make the changes in a <code>PtpConfig</code> custom resource (CR) that you apply to the cluster.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 10. Recommended PTP settings for Intel Columbiaville NIC</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">PTP configuration</th>
<th class="tableblock halign-left valign-top">Recommended setting</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>phc2sysOpts</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-a -r -m -n 24 -N 8 -R 16</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>tx_timestamp_timeout</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>50</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>boundary_clock_jbod</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code></p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For <code>phc2sysOpts</code>, <code>-m</code> prints messages to <code>stdout</code>. The <code>linuxptp-daemon</code> <code>DaemonSet</code> parses the logs and generates Prometheus metrics.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For a complete example CR that configures <code>linuxptp</code> services as an ordinary clock with PTP fast events, see <a href="../../networking/ptp/configuring-ptp.html#configuring-linuxptp-services-as-ordinary-clock_configuring-ptp">Configuring linuxptp services as ordinary clock</a>.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="cnf-configuring-fifo-priority-scheduling-for-ptp_configuring-ptp"><a class="anchor" href="#cnf-configuring-fifo-priority-scheduling-for-ptp_configuring-ptp"></a>Configuring FIFO priority scheduling for PTP hardware</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In telco or other deployment types that require low latency performance, PTP daemon threads run in a constrained CPU footprint alongside the rest of the infrastructure components. By default, PTP threads run with the <code>SCHED_OTHER</code> policy. Under high load, these threads might not get the scheduling latency they require for error-free operation.</p>
</div>
<div class="paragraph">
<p>To mitigate against potential scheduling latency errors, you can configure the PTP Operator <code>linuxptp</code> services to allow threads to run with a <code>SCHED_FIFO</code> policy. If <code>SCHED_FIFO</code> is set for a <code>PtpConfig</code> CR, then <code>ptp4l</code> and <code>phc2sys</code> will run in the parent container under <code>chrt</code> with a priority set by the <code>ptpSchedulingPriority</code> field of the <code>PtpConfig</code> CR.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Setting <code>ptpSchedulingPolicy</code> is optional, and is only required if you are experiencing latency errors.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Edit the <code>PtpConfig</code> CR profile:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc edit PtpConfig -n openshift-ptp</code></pre>
</div>
</div>
</li>
<li>
<p>Change the <code>ptpSchedulingPolicy</code> and <code>ptpSchedulingPriority</code> fields:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: ptp.openshift.io/v1
kind: PtpConfig
metadata:
  name: &lt;ptp_config_name&gt;
  namespace: openshift-ptp
...
spec:
  profile:
  - name: "profile1"
...
    ptpSchedulingPolicy: SCHED_FIFO <i class="conum" data-value="1"></i><b>(1)</b>
    ptpSchedulingPriority: 10 <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Scheduling policy for <code>ptp4l</code> and <code>phc2sys</code> processes. Use <code>SCHED_FIFO</code> on systems that support FIFO scheduling.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Required. Sets the integer value 1-65 used to configure FIFO priority for <code>ptp4l</code> and <code>phc2sys</code> processes.</td>
</tr>
</table>
</div>
</li>
<li>
<p>Save and exit to apply the changes to the <code>PtpConfig</code> CR.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<div class="title">Verification</div>
<ol class="arabic">
<li>
<p>Get the name of the <code>linuxptp-daemon</code> pod and corresponding node where the <code>PtpConfig</code> CR has been applied:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc get pods -n openshift-ptp -o wide</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">NAME                            READY   STATUS    RESTARTS   AGE     IP            NODE
linuxptp-daemon-gmv2n           3/3     Running   0          1d17h   10.1.196.24   compute-0.example.com
linuxptp-daemon-lgm55           3/3     Running   0          1d17h   10.1.196.25   compute-1.example.com
ptp-operator-3r4dcvf7f4-zndk7   1/1     Running   0          1d7h    10.129.0.61   control-plane-1.example.com</code></pre>
</div>
</div>
</li>
<li>
<p>Check that the <code>ptp4l</code> process is running with the updated <code>chrt</code> FIFO priority:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc -n openshift-ptp logs linuxptp-daemon-lgm55 -c linuxptp-daemon-container|grep chrt</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">I1216 19:24:57.091872 1600715 daemon.go:285] /bin/chrt -f 65 /usr/sbin/ptp4l -f /var/run/ptp4l.0.config -2  --summary_interval -4 -m</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="cnf-configuring-log-filtering-for-linuxptp_configuring-ptp"><a class="anchor" href="#cnf-configuring-log-filtering-for-linuxptp_configuring-ptp"></a>Configuring log filtering for linuxptp services</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>linuxptp</code> daemon generates logs that you can use for debugging purposes. In telco or other deployment types that feature a limited storage capacity, these logs can add to the storage demand.</p>
</div>
<div class="paragraph">
<p>To reduce the number log messages, you can configure the <code>PtpConfig</code> custom resource (CR) to exclude log messages that report the <code>master offset</code> value. The <code>master offset</code> log message reports the difference between the current node&#8217;s clock and the master clock in nanoseconds.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Install the OpenShift CLI (<code>oc</code>).</p>
</li>
<li>
<p>Log in as a user with <code>cluster-admin</code> privileges.</p>
</li>
<li>
<p>Install the PTP Operator.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Edit the <code>PtpConfig</code> CR:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc edit PtpConfig -n openshift-ptp</code></pre>
</div>
</div>
</li>
<li>
<p>In <code>spec.profile</code>, add the <code>ptpSettings.logReduce</code> specification and set the value to <code>true</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: ptp.openshift.io/v1
kind: PtpConfig
metadata:
  name: &lt;ptp_config_name&gt;
  namespace: openshift-ptp
...
spec:
  profile:
  - name: "profile1"
...
    ptpSettings:
      logReduce: "true"</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For debugging purposes, you can revert this specification to <code>False</code> to include the master offset messages.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Save and exit to apply the changes to the <code>PtpConfig</code> CR.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<div class="title">Verification</div>
<ol class="arabic">
<li>
<p>Get the name of the <code>linuxptp-daemon</code> pod and corresponding node where the <code>PtpConfig</code> CR has been applied:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc get pods -n openshift-ptp -o wide</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">NAME                            READY   STATUS    RESTARTS   AGE     IP            NODE
linuxptp-daemon-gmv2n           3/3     Running   0          1d17h   10.1.196.24   compute-0.example.com
linuxptp-daemon-lgm55           3/3     Running   0          1d17h   10.1.196.25   compute-1.example.com
ptp-operator-3r4dcvf7f4-zndk7   1/1     Running   0          1d7h    10.129.0.61   control-plane-1.example.com</code></pre>
</div>
</div>
</li>
<li>
<p>Verify that master offset messages are excluded from the logs by running the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc -n openshift-ptp logs &lt;linux_daemon_container&gt; -c linuxptp-daemon-container | grep "master offset" <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>&lt;linux_daemon_container&gt; is the name of the <code>linuxptp-daemon</code> pod, for example <code>linuxptp-daemon-gmv2n</code>.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When you configure the <code>logReduce</code> specification, this command does not report any instances of <code>master offset</code> in the logs of the <code>linuxptp</code> daemon.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="cnf-troubleshooting-common-ptp-operator-issues_configuring-ptp"><a class="anchor" href="#cnf-troubleshooting-common-ptp-operator-issues_configuring-ptp"></a>Troubleshooting common PTP Operator issues</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Troubleshoot common problems with the PTP Operator by performing the following steps.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Install the OpenShift Container Platform CLI (<code>oc</code>).</p>
</li>
<li>
<p>Log in as a user with <code>cluster-admin</code> privileges.</p>
</li>
<li>
<p>Install the PTP Operator on a bare-metal cluster with hosts that support PTP.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Check the Operator and operands are successfully deployed in the cluster for the configured nodes.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc get pods -n openshift-ptp -o wide</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">NAME                            READY   STATUS    RESTARTS   AGE     IP            NODE
linuxptp-daemon-lmvgn           3/3     Running   0          4d17h   10.1.196.24   compute-0.example.com
linuxptp-daemon-qhfg7           3/3     Running   0          4d17h   10.1.196.25   compute-1.example.com
ptp-operator-6b8dcbf7f4-zndk7   1/1     Running   0          5d7h    10.129.0.61   control-plane-1.example.com</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When the PTP fast event bus is enabled, the number of ready <code>linuxptp-daemon</code> pods is <code>3/3</code>. If the PTP fast event bus is not enabled, <code>2/2</code> is displayed.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Check that supported hardware is found in the cluster.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc -n openshift-ptp get nodeptpdevices.ptp.openshift.io</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">NAME                                  AGE
control-plane-0.example.com           10d
control-plane-1.example.com           10d
compute-0.example.com                 10d
compute-1.example.com                 10d
compute-2.example.com                 10d</code></pre>
</div>
</div>
</li>
<li>
<p>Check the available PTP network interfaces for a node:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc -n openshift-ptp get nodeptpdevices.ptp.openshift.io &lt;node_name&gt; -o yaml</code></pre>
</div>
</div>
<div class="paragraph">
<p>where:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">&lt;node_name&gt;</dt>
<dd>
<p>Specifies the node you want to query, for example, <code>compute-0.example.com</code>.</p>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: ptp.openshift.io/v1
kind: NodePtpDevice
metadata:
  creationTimestamp: "2021-09-14T16:52:33Z"
  generation: 1
  name: compute-0.example.com
  namespace: openshift-ptp
  resourceVersion: "177400"
  uid: 30413db0-4d8d-46da-9bef-737bacd548fd
spec: {}
status:
  devices:
  - name: eno1
  - name: eno2
  - name: eno3
  - name: eno4
  - name: enp5s0f0
  - name: enp5s0f1</code></pre>
</div>
</div>
</dd>
</dl>
</div>
</li>
<li>
<p>Check that the PTP interface is successfully synchronized to the primary clock by accessing the <code>linuxptp-daemon</code> pod for the corresponding node.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Get the name of the <code>linuxptp-daemon</code> pod and corresponding node you want to troubleshoot by running the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc get pods -n openshift-ptp -o wide</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">NAME                            READY   STATUS    RESTARTS   AGE     IP            NODE
linuxptp-daemon-lmvgn           3/3     Running   0          4d17h   10.1.196.24   compute-0.example.com
linuxptp-daemon-qhfg7           3/3     Running   0          4d17h   10.1.196.25   compute-1.example.com
ptp-operator-6b8dcbf7f4-zndk7   1/1     Running   0          5d7h    10.129.0.61   control-plane-1.example.com</code></pre>
</div>
</div>
</li>
<li>
<p>Remote shell into the required <code>linuxptp-daemon</code> container:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc rsh -n openshift-ptp -c linuxptp-daemon-container &lt;linux_daemon_container&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>where:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">&lt;linux_daemon_container&gt;</dt>
<dd>
<p>is the container you want to diagnose, for example <code>linuxptp-daemon-lmvgn</code>.</p>
</dd>
</dl>
</div>
</li>
<li>
<p>In the remote shell connection to the <code>linuxptp-daemon</code> container, use the PTP Management Client (<code>pmc</code>) tool to diagnose the network interface. Run the following <code>pmc</code> command to check the sync status of the PTP device, for example <code>ptp4l</code>.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal"># pmc -u -f /var/run/ptp4l.0.config -b 0 'GET PORT_DATA_SET'</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output when the node is successfully synced to the primary clock</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">sending: GET PORT_DATA_SET
    40a6b7.fffe.166ef0-1 seq 0 RESPONSE MANAGEMENT PORT_DATA_SET
        portIdentity            40a6b7.fffe.166ef0-1
        portState               SLAVE
        logMinDelayReqInterval  -4
        peerMeanPathDelay       0
        logAnnounceInterval     -3
        announceReceiptTimeout  3
        logSyncInterval         -4
        delayMechanism          1
        logMinPdelayReqInterval -4
        versionNumber           2</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>For GNSS-sourced grandmaster clocks, verify that the in-tree NIC ice driver is correct by running the following command, for example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc rsh -n openshift-ptp -c linuxptp-daemon-container linuxptp-daemon-74m2g ethtool -i ens7f0</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">driver: ice
version: 5.14.0-356.bz2232515.el9.x86_64
firmware-version: 4.20 0x8001778b 1.3346.0</code></pre>
</div>
</div>
</li>
<li>
<p>For GNSS-sourced grandmaster clocks, verify that the <code>linuxptp-daemon</code> container is receiving signal from the GNSS antenna.
If the container is not receiving the GNSS signal, the <code>/dev/gnss0</code> file is not populated.
To verify, run the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc rsh -n openshift-ptp -c linuxptp-daemon-container linuxptp-daemon-jnz6r cat /dev/gnss0</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$GNRMC,125223.00,A,4233.24463,N,07126.64561,W,0.000,,300823,,,A,V*0A
$GNVTG,,T,,M,0.000,N,0.000,K,A*3D
$GNGGA,125223.00,4233.24463,N,07126.64561,W,1,12,99.99,98.6,M,-33.1,M,,*7E
$GNGSA,A,3,25,17,19,11,12,06,05,04,09,20,,,99.99,99.99,99.99,1*37
$GPGSV,3,1,10,04,12,039,41,05,31,222,46,06,50,064,48,09,28,064,42,1*62</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="cnf-getting-the-dpll-firmware-version-for-intel-800-series-nics_configuring-ptp"><a class="anchor" href="#cnf-getting-the-dpll-firmware-version-for-intel-800-series-nics_configuring-ptp"></a>Getting the DPLL firmware version for the CGU in an Intel 800 series NIC</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can get the digital phase-locked loop (DPLL) firmware version for the Clock Generation Unit (CGU) in an Intel 800 series NIC by opening a debug shell to the cluster node and querying the NIC hardware.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You have installed the OpenShift CLI (<code>oc</code>).</p>
</li>
<li>
<p>You have logged in as a user with <code>cluster-admin</code> privileges.</p>
</li>
<li>
<p>You have installed an Intel 800 series NIC in the cluster host.</p>
</li>
<li>
<p>You have installed the PTP Operator on a bare-metal cluster with hosts that support PTP.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Start a debug pod by running the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc debug node/&lt;node_name&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>where:</p>
</div>
<div class="openblock">
<div class="content">
<div class="dlist">
<dl>
<dt class="hdlist1">&lt;node_name&gt;</dt>
<dd>
<p>Is the node where you have installed the Intel 800 series NIC.</p>
</dd>
</dl>
</div>
</div>
</div>
</li>
<li>
<p>Check the CGU firmware version in the NIC by using the <code>devlink</code> tool and the bus and device name where the NIC is installed.
For example, run the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">sh-4.4# devlink dev info &lt;bus_name&gt;/&lt;device_name&gt; | grep cgu</code></pre>
</div>
</div>
<div class="paragraph">
<p>where:</p>
</div>
<div class="openblock">
<div class="content">
<div class="dlist">
<dl>
<dt class="hdlist1">&lt;bus_name&gt; </dt>
<dd>
<p>Is the bus where the NIC is installed. For example, <code>pci</code>.</p>
</dd>
<dt class="hdlist1">&lt;device_name&gt; </dt>
<dd>
<p>Is the NIC device name. For example, <code>0000:51:00.0</code>.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">cgu.id 36 <i class="conum" data-value="1"></i><b>(1)</b>
fw.cgu 8032.16973825.6021 <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>CGU hardware revision number</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The DPLL firmware version running in the CGU, where the DPLL firmware version is <code>6201</code>, and the DPLL model is <code>8032</code>.
The string <code>16973825</code> is a shorthand representation of the binary version of the DPLL firmware version (<code>1.3.0.1</code>).</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The firmware version has a leading nibble and 3 octets for each part of the version number.
The number <code>16973825</code> in binary is <code>0001 0000 0011 0000 0000 0000 0001</code>.
Use the binary value to decode the firmware version.
For example:</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 90%;">
<caption class="title">Table 11. DPLL firmware version</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Binary part</th>
<th class="tableblock halign-left valign-top">Decimal value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0001</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0000 0011</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0000 0000</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0000 0001</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
</tbody>
</table>
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="cnf-about-collecting-nro-data_configuring-ptp"><a class="anchor" href="#cnf-about-collecting-nro-data_configuring-ptp"></a>Collecting PTP Operator data</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can use the <code>oc adm must-gather</code> command to collect information about your cluster, including features and objects associated with PTP Operator.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You have access to the cluster as a user with the <code>cluster-admin</code> role.</p>
</li>
<li>
<p>You have installed the OpenShift CLI (<code>oc</code>).</p>
</li>
<li>
<p>You have installed the PTP Operator.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>To collect PTP Operator data with <code>must-gather</code>, you must specify the PTP Operator <code>must-gather</code> image.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc adm must-gather --image=registry.redhat.io/openshift4/ptp-must-gather-rhel8:v4.14</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2024-09-06 10:54:06 +0100
</div>
</div>
</body>
</html>