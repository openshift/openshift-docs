ifeval::["{context}" == "build-strategies-docker"]
:dockerstrategy:
endif::[]
ifeval::["{context}" == "build-strategies-s2i"]
:sourcestrategy:
endif::[]

:_content-type: PROCEDURE
[id="builds-using-build-volumes_{context}"]
= Using build volumes

You can mount build volumes to give running builds access to information that you don't want to persist in the output container image.

Build volumes provide sensitive information, such as repository credentials, that the build environment or configuration only needs at build time. Build volumes are different from xref:../../cicd/builds/creating-build-inputs.adoc#builds-define-build-inputs_creating-build-inputs[build inputs], whose data can persist in the output container image.

The mount points of build volumes, from which the running build reads data, are functionally similar to link:https://kubernetes.io/docs/concepts/storage/volumes/[pod volume mounts].

.Prerequisites
* You have xref:../../cicd/builds/creating-build-inputs.adoc#builds-input-secrets-configmaps_creating-build-inputs[added an input secret, config map, or both to a BuildConfig object].

.Procedure

ifdef::dockerstrategy[]

* In the `dockerStrategy` definition of the `BuildConfig` object, add any build volumes to the `volumes` array. For example:
+
[source,yaml]
----
spec:
  dockerStrategy:
    volumes:
      - name: secret-mvn <1>
        mounts:
        - destinationPath: /opt/app-root/src/.ssh <2>
        source:
          type: Secret <3>
          secret:
            secretName: my-secret <4>
      - name: settings-mvn <1>
        mounts:
        - destinationPath: /opt/app-root/src/.m2  <2>
        source:
          type: ConfigMap <3>
          configMap:
            name: my-config <4>
      - name: my-csi-volume <1>
        mounts:
        - destinationPath: /opt/app-root/src/some_path  <2>
        source:
          type: CSI <3>
          csi:
            driver: csi.sharedresource.openshift.io <5>
            readOnly: true <6>
            volumeAttributes: <7>
              attribute: value
----
<1> Required. A unique name.
<2> Required. The absolute path of the mount point. It must not contain `..` or `:` and doesn't collide with the destination path generated by the builder. The `/opt/app-root/src` is the default home directory for many Red Hat S2I-enabled images.
<3> Required. The type of source, `ConfigMap`, `Secret`, or `CSI`.
<4> Required. The name of the source.
<5> Required. The driver that provides the ephemeral CSI volume.
<6> Required. This value must be set to `true`. Provides a read-only volume.
<7> Optional. The volume attributes of the ephemeral CSI volume. Consult the CSI driver's documentation for supported attribute keys and values.

[NOTE]
====
The Shared Resource CSI Driver is supported as a Technology Preview feature.
====

endif::dockerstrategy[]

ifdef::sourcestrategy[]

* In the `sourceStrategy` definition of the `BuildConfig` object, add any build volumes to the `volumes` array. For example:
+
[source,yaml]
----
spec:
  sourceStrategy:
    volumes:
      - name: secret-mvn <1>
        mounts:
        - destinationPath: /opt/app-root/src/.ssh <2>
        source:
          type: Secret <3>
          secret:
            secretName: my-secret <4>
      - name: settings-mvn <1>
        mounts:
        - destinationPath: /opt/app-root/src/.m2 <2>
        source:
          type: ConfigMap <3>
          configMap:
            name: my-config <4>
      - name: my-csi-volume <1>
        mounts:
        - destinationPath: /opt/app-root/src/some_path  <2>
        source:
          type: CSI <3>
          csi:
            driver: csi.sharedresource.openshift.io <5>
            readOnly: true <6>
            volumeAttributes: <7>
              attribute: value
----

<1> Required. A unique name.
<2> Required. The absolute path of the mount point. It must not contain `..` or `:` and doesn't collide with the destination path generated by the builder. The `/opt/app-root/src` is the default home directory for many Red Hat S2I-enabled images.
<3> Required. The type of source, `ConfigMap`, `Secret`, or `CSI`.
<4> Required. The name of the source.
<5> Required. The driver that provides the ephemeral CSI volume.
<6> Required. This value must be set to `true`. Provides a read-only volume.
<7> Optional. The volume attributes of the ephemeral CSI volume. Consult the CSI driver's documentation for supported attribute keys and values.

[NOTE]
====
The Shared Resource CSI Driver is supported as a Technology Preview feature.
====

endif::sourcestrategy[]

ifeval::["{context}" == "build-strategies-docker"]
:!dockerstrategy:
endif::[]
ifeval::["{context}" == "build-strategies-s2i"]
:!sourcestrategy:
endif::[]
