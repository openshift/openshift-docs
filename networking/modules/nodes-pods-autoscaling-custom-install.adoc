// Module included in the following assemblies:
//
// * nodes/nodes-pods-autoscaling-custom.adoc

:_content-type: PROCEDURE
[id="nodes-pods-autoscaling-custom-install_{context}"]
= Installing the custom metrics autoscaler

You can use the {product-title} web console to install the Custom Metrics Autoscaler Operator.

The installation creates five CRDs:

* `ClusterTriggerAuthentication`
* `KedaController`
* `ScaledJob`
* `ScaledObject`
* `TriggerAuthentication`

.Prerequisites
ifdef::openshift-origin[]
* Ensure that you have downloaded the {cluster-manager-url-pull} as shown in _Obtaining the installation program_ in the installation documentation for your platform.
+
If you have the pull secret, add the `redhat-operators` catalog to the OperatorHub custom resource (CR) as shown in _Configuring {product-title} to use Red Hat Operators_.
endif::[]

* If you use the community KEDA:

** Uninstall the community KEDA. You cannot run both KEDA and the custom metrics autoscaler on the same {product-title} cluster.

** Remove the KEDA 1.x custom resource definitions by running the following commands:
+
[source,terminal]
----
$ oc delete crd scaledobjects.keda.k8s.io
----
+
[source,terminal]
----
$ oc delete crd triggerauthentications.keda.k8s.io
----

.Procedure

. In the {product-title} web console, click *Operators* -> *OperatorHub*.

. Choose *Custom Metrics Autoscaler* from the list of available Operators, and click *Install*.

. On the *Install Operator* page, ensure that the *All namespaces on the cluster (default)* option
is selected for *Installation Mode*. This installs the Operator in all namespaces.

. Ensure that the *openshift-keda* namespace is selected for *Installed Namespace*. {product-title} creates the namespace, if not present in your cluster.  

. Click *Install*.

. Verify the installation by listing the Custom Metrics Autoscaler Operator components:

.. Navigate to *Workloads* -> *Pods*.

.. Select the `openshift-keda` project from the drop-down menu and verify that the `custom-metrics-autoscaler-operator-*` pod is running.

.. Navigate to *Workloads* -> *Deployments* to verify that the `custom-metrics-autoscaler-operator` deployment is running.

. Optional: Verify the installation in the OpenShift CLI using the following commands:
+
[source,terminal]
----
$ oc get all -n openshift-keda
----
+
The output appears similar to the following:
+
.Example output
[source,terminal]
----
NAME                                                      READY   STATUS    RESTARTS   AGE
pod/custom-metrics-autoscaler-operator-5fd8d9ffd8-xt4xp   1/1     Running   0          18m

NAME                                                 READY   UP-TO-DATE   AVAILABLE   AGE
deployment.apps/custom-metrics-autoscaler-operator   1/1     1            1           18m

NAME                                                            DESIRED   CURRENT   READY   AGE
replicaset.apps/custom-metrics-autoscaler-operator-5fd8d9ffd8   1         1         1       18m
----

. Install the `KedaController` custom resource, which creates the required CRDs:

.. In the {product-title} web console, click *Operators* -> *Installed Operators*.

.. Click *Custom Metrics Autoscaler*.

.. On the *Operator Details* page, click the *KedaController* tab.

.. On the *KedaController* tab, click *Create KedaController* and edit the file.
+
[source,yaml]
----
kind: KedaController
apiVersion: keda.sh/v1alpha1
metadata:
  name: keda
  namespace: openshift-keda
spec:
  watchNamespace: '' <1>
  operator:
    logLevel: info <2>
    logEncoder: console <3>
  metricsServer:
    logLevel: '0' <4>
  serviceAccount: {}
----
<1> Specifies the namespaces that the custom autoscaler should watch. Enter names in a comma-separated list. Omit or set empty to watch all namespaces. The default is empty.
<2> Specifies the level of verbosity for the Custom Metrics Autoscaler Operator log messages. The allowed values are `debug`, `info`, `error`. The default is `info`.
<3> Specifies the logging format for the Custom Metrics Autoscaler Operator log messages. The allowed values are `console` or `json`. The default is `console`.
<4> Specifies the logging level for the Custom Metrics Autoscaler Metrics Server. The allowed values are `0` for `info` and `4` or `debug`. The default is `0`.

.. Click *Create* to create the KEDAController.
