[id="nw-control-dns-records-public-hosted-zone-aws_{context}"]
= Creating DNS records on an public hosted zone for AWS by using Red Hat External DNS Operator

.Procedure

. Export the kubeconfig file.
+
[source,terminal]
----
$ export KUBECONFIG=~/<path to>/kubeconfig
----

. Create CR ExternalDNS for route:
+
[source,yaml]
----
apiVersion: externaldns.olm.openshift.io/v1alpha1
kind: ExternalDNS
metadata:
  name: sample-aws <1>
spec:
  domains:
  - filterType: Include   <2>
    matchType: Exact   <3>
    name: testextdnsoperator.apacshift.support <4>
  provider:
    type: AWS <5>
  source:  <6>
    type: OpenShiftRoute <7>
    openshiftRouteOptions:
      routerName: default <8>
----

<1> Name of external dns CR which will cause the operator to create a deployment and thereby the pods containing this name
<2> By default all hosted zones are selected as potential targets. But it's possible to include only the one(s) we need.
<3> The matching of the target zone's domain has to be exact (as opposed to regular expression match).
<4> The exact domain of the zone we want to update. Note that the hostname of the routes should be subdomains of this one.
<5> The DNS provider which will be used is AWS Route53.
<6> You can define an option for route source under this field.
<7> Defines source route i.e dns records for routes will be created on your cloud DNS.
<8> If the source is openshift-route then you can pass the ingress controller name. Based on this name external-dns will select the respective router's canonical hostname to be put as the target while creating CNAME record.

. Check the *AWS Console > Route53* page to ensure you added the records to the hosted zone.

. Run `nslookup/dig` command to check if `service-name.<project>.svc.cluster.local` can be resolved to the service ClusterIP.

. Check if the dns record was recorded in the Route53 console for the routes whose domain we are filter in the CR.
