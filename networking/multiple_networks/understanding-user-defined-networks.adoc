:_mod-docs-content-type: ASSEMBLY
[id="understanding-user-defined-networks"]
= Understanding user-defined networks
include::_attributes/common-attributes.adoc[]
:context: understanding-user-defined-networks

toc::[]

The OVN-Kubernetes network plugin has traditionally supported layer 2, layer 3, and localnet network types for secondary interfaces, but limited primary networks to a single layer 3 topology. This allowed for network models where all pods shared the same network topology, but restricted the ability to customize primary network configurations.

With user-defined networks, cluster administrators and users are offered highly customizable network configuration options that provide users with the ability to define their own network topologies, ensure network isolation, manage IP addressing, and leverage advanced networking features. User-defined networks help enhance networking flexibility, security, and scalability.

== Benefits of user-defined networks

User-defined networks provide the following benefits:

. Enhanced network isolation
+
* **Tenant isolation**: Namespaces can have their own isolated primary network, similar to how tenants are isolated in {rh-openstack-first}. This improves security by reducing the risk of cross-tenant traffic.
* **Layer 2 and layer 3 support**: Cluster administrators can configure primary networks as layer 2 or layer 3 network types. This provides the flexibility of a secondary network to the primary network.
* **Namespace-scoped services*: Services created in namespaces with user-defined networks are only accessible to other namespaces connected to the same user-defined network. This enhances isolation and security.
* **Native isolation**: Provides a native way to isolate network tenants, which reduces the reliance on complex network policies.

. Simplified network management
+
* **Reduced network configuration complexity**: With user-defined networks, complex network isolation policies are eliminated, making it easier for cluster administrators to scale and manage networks.
* **Consistent IP addressing**: Users can specify and reuse or overlap IP subnets across different namespaces and clusters, providing a consistent networking environment.

. Scalability
+
* **Support for multiple networks**: The user-defined networking feature allows administrators to connect multiple namespaces to a single network, or to create distinct networks for different sets of namespaces. 

. Optimized traffic handling
+
* **Enhanced routing efficiency**: With 
* **North/south network traffic support**: Improves connectivity with services outside of the cluster by adding support for external traffic to and from pods.

. Ingress and egress support
+
* **Support for ingress and egress traffic**: Cluster ingress and egress traffic is supported for both primary and secondary networks.
* **Support for ingress and egress features**: User-defined networks support support the following ingress and egress features:
+
** EgressQoS
** EgressService
** EgressIP
** Load balancer and NodePort services, as well as services with external IPs.

. Simplification of application migration from {rh-openstack-first}
+
* **Network parity**: With user-defined networking, the migration of applications from OpenStack to {product-title} is simplified by providing similar network isolation and configuration options.

Before using user-defined networks, you should consider the limitations and best practices in the following sections.

[id="limitations"]
== User-defined network limitations

While user-defined networks offer highly customizable network configuration options, there are limitations that cluster administrators should be aware of when implementing and managing these networks. Consider the following limitations before implementing a user-defined network.

* *Scale limitations*: The number of internal OVN-Kubernetes objects, such as kernel devices, rules, and VRFs, multiply as the number of namespaces and networks increase. As a result, user-defined networks might cause potential performance issues and scalability challenges for some {product-title} deployments.

* *Complex network configurations*: User-defined networks reduce the complexity of isolation policies. However, setting up and managing multiple networking, wherein each have their own gateway router and load balancer, might require advanced networking knowledge. 

* *Interference with secondary projects*: User-defined networks increase the risk of breaking secondary projects that integrated with OVN-Kubernetes, such as MetalLB or Submariner.

* *DNS limitations*: DNS lookups for pods resolve to the pod's IP address on the cluster default network. Even if a pod is part of a user-defined network, DNS lookups will not resolve to the pod's IP address on that user-defined network.

* *Initial network assignment*: If a namespace is assigned to a new network, it cannot have existing pods, or else the new network assignment will not be accepted by OVN-Kubernetes.

* *Service reachability*: Services created in namespaces without user-defined networks using the default network are only accessible by other namespaces also using the default network. This can limit the flexibility of services across different networks.

* *Health check limitations*: Kubelet health checks are performed by the cluster default network, which does not confirm the network connectivity of the primary interface on the pod. Consequently, scenarios where a pod appears healthy by the default network, but has broken connectivity on the primary interface, are possible with user-defined networks.

* *Network policy limitations*: Network policies that enable traffic between namespaces connected to different user-defined primary networks are not effective. This traffic is blocked because there is no connectivity between these isolated networks. 

//list additional limitations

[id="best-practices-udn"]
== Best practices for user-defined networks

Networks in OVN-Kubernetes are configured by Network Attachment Definitions (NADs). NADs had two major shortcomings prior to the implementation of user-defined networks:

. NADs had free-form configuration that depended on the Container Network Interface (CNI). There was no API validation of what a user entered, which led to mistakes that were not caught during configuration and could cause unexpected functional behaviors during runtime. 

. NADs required the cluster administrator role-based access control (RBAC) to create the NAD. 

To address these shortcomings, a custom resource definition (CRD) that manages network configurations and validates inputs has been implemented. 