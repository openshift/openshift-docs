apiVersion: perses.dev/v1alpha1
kind: PersesDashboard
metadata:
  name: sample-stackrox-dashboard-mini
  namespace: stackrox
spec:
  display:
    name: Advanced Cluster Security / Sample
  panels:
    "total_policy_violations":
      kind: "Panel"
      spec:
        display:
          name: "Total policy violations"
        plugin:
          kind: "StatChart"
          spec:
            calculation: "last"
        queries:
          - kind: "TimeSeriesQuery"
            spec:
              plugin:
                kind: "PrometheusTimeSeriesQuery"
                spec:
                  query: sum(rox_central_policy_violation_namespace_severity{Cluster=~'$Cluster',Namespace=~'$Namespace'})

  layouts:
    - kind: Grid
      spec:
        display:
          title: Policies
          collapse:
            open: true
        items:
          - content:
              $ref: "#/spec/panels/total_policy_violations"
            "x": 0
            "y": 0
            "width": 6
            "height": 3

  variables:
    - kind: ListVariable
      spec:
        name: Cluster
        allowMultiple: true
        allowAllValue: true
        plugin:
          kind: PrometheusLabelValuesVariable
          spec:
            labelName: Cluster

    - kind: ListVariable
      spec:
        name: Namespace
        allowMultiple: true
        allowAllValue: true
        plugin:
          kind: PrometheusLabelValuesVariable
          spec:
            labelName: Namespace
  duration: 30d
  refreshInterval: 1m