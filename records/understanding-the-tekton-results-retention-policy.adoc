:_mod-docs-content-type: ASSEMBLY
include::_attributes/common-attributes.adoc[]
[id="understanding-the-tekton-results-retention-policy"]
= Understanding the Tekton Results retention policy
:context: understanding-the-tekton-results-retention-policy

toc::[]

[role="_abstract"]
The {tekton-results} Retention Policy Agent manages how long {tekton-results} and Records are retained in the database before they are pruned. You can configure the retention behavior by using the `tekton-results-config-results-retention-policy` config map in the `tekton-pipelines` namespace.

The retention policy determines when and how old {tekton-results} and Records are automatically deleted from the database. You can define global defaults as well as fine-grained rules based on namespaces, labels, annotations, or run statuses.

Use the following sample YAML configuration to define Tekton Results settings, including log retention policies, namespaces, and runtime options:

[source,YAML]
----
apiVersion: operator.tekton.dev/v1alpha1
kind: TektonConfig
metadata:
  labels:
    openshift-pipelines.tekton.dev/sa-created: "true"
    operator.tekton.dev/release-version: 1.21.0
  name: config
spec:
...
  result:
    disabled: false
    is_external_db: false
    log_level: debug
    loki_stack_name: logging-loki
    loki_stack_namespace: openshift-logging
    options:
      configMaps:
        tekton-results-config-results-retention-policy:
          data:
            defaultRetention: 30m
            policies: |
              - name: "prod-failed-retention"
                selector:
                  matchNamespaces:
                    - "prod-1"
                    - "prod-west"
                  matchStatuses:
                  - "Failed"
                  matchLabels:
                    "env": ["prod"]
                retention: "10m"
              - name: "all-prod-retention"
                selector:
                  matchNamespaces:
                    - "prod-1"
                    - "prod-west"
                retention: "3m"
            runAt: '*/1 * * * *'
          metadata:
            creationTimestamp: null
----

The following fields in the config map define the retention configuration:

[options="header"]
|===
|Field |Description |Default

|`runAt`
|Specifies when the pruning job runs. The value must use a cron schedule format.
|`"7 7 * * 7"` (every Sunday at 7:07 a.m.)

|`defaultRetention`
|Specifies the fallback retention period for Results and Records when no specific policy matches. The value can be a number (in days) or a duration string such as `30d` or `24h`.
|`30d`

|`maxRetention`
|(Deprecated). Used for backward compatibility if `defaultRetention` is not set. This field will be removed in a future release. This field functions in the same way as `defaultRetention`.
|N/A

|`policies`
|Defines a list of fine-grained retention policies for more specific control, in order of precedence. Each policy includes a name, selector, and retention period. For Records and Results matched by a policy's selector, the policy's retention period overrides the `defaultRetention`.
|None
|===

include::modules/op-fine-grained-retention-policies.adoc[leveloffset=+1]
