:_content-type: ASSEMBLY
[id="getting-started-rhacs-cloud-ocp"]
= Getting started with RHACS Cloud Service
include::modules/common-attributes.adoc[]
:context: getting-started-rhacs-cloud-ocp

toc::[]

[role="_abstract"]
{rh-rhacscs-first} provides security services for your Kubernetes clusters on link:https://access.redhat.com/node/5822721[different platforms].

This topic provides instructions to get started using {product-title-short} on {osp}, including {ocp}, OpenShift Kubernetes Engine (OKE), Red Hat OpenShift Dedicated (OSD), Azure Red Hat OpenShift (ARO), and Red Hat OpenShift Service on Amazon Web Services (ROSA). See the inline notes for information that differs for {product-title-short} on other Kubernetes platforms.

:FeatureName: {product-title-short}
include::snippets/field-trial.adoc[leveloffset=+1]

This installation example shows you how to set up {product-title-short} on {ocp} using the Operator. It does not cover installations using Helm charts or the `roxctl` CLI.

.Prerequisites

* Ensure that you can access the *Advanced Cluster Security* menu option from the {cloud-console}.

[id="accessing-acs-console"]
== Accessing the ACS Console

. In the {cloud-console}, from the navigation menu, select *Advanced Cluster Security* -> *ACS Instances*, and then select the instance that you want connected to your secured clusters.
* In the *Instance Details* section, note the *Central API Endpoint*. You use this address when creating secured clusters.
. Click *Open ACS Console*. You need your Red Hat Single Sign-On (RH-SSO) credentials, or credentials for another identity provider if that has been configured.

[id="create-rhacscs-project"]
== Creating an RHACS Cloud Service project

* In your {ocp} cluster, navigate to *Home* -> *Projects* and create a project for {product-title-short}. Red Hat suggests using `stackrox` as the project *Name*.

[id="generating-init-bundle-cloud-getting-started"]
== Generating an init bundle

. In the ACS console, navigate to *Platform Configuration* -> *Integrations*.
. Navigate to the *Authentication Tokens* section and click on *Cluster Init Bundle*.
. Click *Generate bundle*.
. Enter a name for the cluster init bundle and click *Generate*.
. Click *Download Kubernetes Secret File* to download the generated bundle.
+
[IMPORTANT]
====
Store this bundle securely because it contains secrets.
You can use the same bundle to create multiple secured clusters.
====

[id="applying-init-bundle-by-creating-resources"]
== Applying an init bundle by creating resources

. Using a terminal window, log in to your {ocp} cluster, and using the {osp} CLI, run the following command to create the resources:
+
[source,terminal]
----
$ oc create -f <init_bundle>.yaml \ <1>
  -n <stackrox> <2>
----
<1> Specify the file name of the init bundle containing the secrets.
<2> Specify the name of the project you created on your {ocp} cluster (for example, `stackrox`).

[NOTE]
====
For non-OpenShift Kubernetes clusters, enter the comparable `kubectl` commands to create the resources.
====

[id="installing-secured-cluster-resources-on-each-cluster"]
== Installing secured cluster resources on each cluster

These steps assume that you are installing resources by using the Operator.
[NOTE]
====
For installation on non-OpenShift Kubernetes clusters, you must use Helm charts or the `roxctl` CLI to install secured cluster resources.
====

[id="installing-operator-getting-started"]
=== Installing the Operator on the cluster

. On your cluster, in the web console, go to the *Operators* -> *OperatorHub* page.

. If {product-title} is not displayed, enter *Advanced Cluster Security* into the *Filter by keyword* box to find the {product-title} Operator.

. Select the *{product-title} Operator* to view the details page.

. Read the information about the Operator and click *Install*.

. On the *Install Operator* page:

** Keep the default value for *Installation mode* as *All namespaces on the cluster*.
** Choose a specific namespace for the *Installed namespace* field. Red Hat recommends installing the {product-title} Operator in the *rhacs-operator* namespace.
** Select automatic or manual updates for *Update approval*. Red Hat recommends that you select *automatic* updates and choose the *latest* option for the Operator channel.
. Click *Install*.

.Verification
* After the installation completes, navigate to *Operators* -> *Installed Operators* to verify that the {product-title} Operator is listed with the status of *Succeeded*.

[id="create-secured-cluster-resources-getting-started"]
=== Creating Secured Cluster resources

. On your cluster, navigate to *Operators* -> *Installed Operators*.
. Click the *Project* menu and select the `stackrox` namespace.
. Under *Provided APIs*, select *Secured Cluster*.
. In the *SecuredClusters* page, click *Create SecuredCluster*.
. Select *Form view*.
. Enter the new project name by accepting or editing the default name. The default value is *stackrox-secured-cluster-services*.
. Optional: Add any labels for the cluster.
. Enter a unique name for your `SecuredCluster` custom resource.
. Enter the *Central API Endpoint*, including the address and the port number. You can view this information again in the {cloud-console} console by choosing *Advanced Cluster Security* -> *ACS Instances*, and then clicking the ACS instance you created.
. Click *Create*.

[id="verifying-rhacscs-installation"]
=== Verifying RHACS Cloud Service installation

To verify installation, access your ACS Console from the {cloud-console}. The Dashboard displays the number of clusters that {product-title-short} is monitoring, along with information about nodes, deployments, images, and violations.

If no data appears in the ACS Console:

* Ensure that at least one secured cluster is connected to your {product-title-short} instance. For more information, see the "Installing secured cluster resources on each cluster" section.
* Examine your Sensor pod logs to ensure that the connection to your {product-title-short} instance is successful.
* In the {ocp-short} cluster, navigate to *Platform Configuration* -> *Clusters* to verify that the components are healthy and view additional operational information.
* Examine the values in the `SecuredCluster` API in the Operator on your local cluster to ensure that the *Central API Endpoint* has been entered correctly. This value should be the same value as shown in the *ACS instance* details in the {cloud-console}.

[id="default-access-acs-console"]
== Default access to ACS Console

By default, the authentication mechanism available to users is authentication by using Red Hat Single Sign-On (SSO).
You cannot delete or change the Red Hat SSO authentication provider.
However, you can change the minimum access role and add additional rules, or add another identity provider.

[NOTE]
====
To learn how authentication providers work in ACS, visit xref:../operating/manage-user-access/understanding-authentication-providers.adoc[Understanding authentication providers].
====

A dedicated OIDC client of `sso.redhat.com` is created for each ACS Console. All OIDC clients share the same `sso.redhat.com` realm.
Claims from the token issued by `sso.redhat.com` are mapped to an ACS-issued token as follows:

* `realm_access.roles` to `groups`
* `org_id` to `rh_org_id`
* `is_org_admin` to `rh_is_org_admin`
* `sub` to `userid`

The built-in Red Hat SSO authentication provider has the required attribute `rh_org_id` set to the organization ID assigned to account of the user who created the ACSCS instance.
This is the ID of the organizational account the user is a part of. This can be thought of as the "tenant" the user is under and owned by.
Only users with the same organizational account can access the ACS console by using the Red Hat SSO authentication provider.

[NOTE]
====
To gain more control over access to your ACS Console, configure another identity provider instead of relying on the Red Hat SSO authentication provider.
You can set up your own identity provider after provisioning by using one of the guides under *Operating -> Managing user access*.
====
[NOTE]
====
To configure this authentication provider to be the first authentication option on the login page, its name should be lexicographically smaller than `Red Hat SSO`.
====

The minimum access role is set to `None`. Assigning a different value to this field gives access to the ACSCS instance to all users with the same organizational account.

Other rules that are set up in the built-in Red Hat SSO authentication provider include the following:

* Rule mapping your `userid` to `Admin`
* Rules mapping administrators of the organization to `Admin`

You can add more rules to grant access to the ACS Console to someone else with the same organizational account; for example, by using `email` as a key.
