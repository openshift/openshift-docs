[id="acs-installation-overview"]
= {product-title} installation using Helm charts
include::modules/common-attributes.adoc[]
:context: acs-installation

toc::[]

Learn how to install and uninstall {product-title}.

{product-title} installs as a set of services on your {ocp} cluster.

High-level installation flow:

. Add {product-title} Helm chart repository
. Configure the `central-services` Helm chart.
. Install the centralized components (Central and Scanner).
. Install and set up the `roxctl` command-line interface.
. Generate an init bundle.
. Configure the `secured-cluster-services` Helm chart.
. Install per-cluster and per-node components (Sensor, Admission Controller, and Collector).

Before you install, understand xref:../architecture/index.adoc[{product-title} architecture] and review the system configuration requirements.

include::modules/acs-requirements.adoc[leveloffset=+1]

include::modules/add-helm-repository.adoc[leveloffset=+1]

[id="central-installation"]
== Install Central and Scanner

{product-title} installs as a set of containers in your {ocp} cluster and includes the multiple components.
You deploy centralized components only once and you can monitor multiple separate clusters by using the same installation.
You can install the centralized components (Central and Scanner) by using the Central services Helm chart (`central-services`).

include::modules/central-requirements.adoc[leveloffset=+2]

include::modules/scanner-requirements.adoc[leveloffset=+2]

[id="configure-central-services-helm-chart"]
=== Configure the central-services Helm chart

This section describes Helm charts configuration parameters that you can use with the `helm install` and `helm upgrade` commands.
You can specify these parameters by using the `--set` option or by creating YAML configuration files.

Create the following files for configuring the Helm chart for installing {product-title}.

* Public configuration file `values-public.yaml`: Use this file to save all non-sensitive configuration options.
* Private configuration file `values-private.yaml`: Use this file to save all sensitive configuration options. Make sure that you store this file securely.
//TODO: Add links to sample configuration files.

include::modules/central-services-public-config.adoc[leveloffset=+3]

include::modules/central-services-private-config.adoc[leveloffset=+3]

[id="install-central-services-helm-chart"]
=== Install the central-services Helm chart

After you configure the `values-public.yaml` and `values-private.yaml` files, use the following command to install the `central-services` Helm chart:

[source,terminal]
----
$ helm install -n stackrox --create-namespace \
  stackrox-central-services stackrox/central-services \
  -f <path-to-values-public.yaml> -f <path-to-values-private.yaml> <1>
----
<1> Use the `-f` option to specify the paths for your YAML configuration files.

include::modules/install-roxctl-cli.adoc[leveloffset=+1]

include::modules/generate-auth-token.adoc[leveloffset=+1]

include::modules/generate-cluster-init-bundle.adoc[leveloffset=+1]

[id="sensor-installation"]
== Install Sensor, Admission controller, and Collector
To monitor other clusters, you must deploy per-cluster (Sensor and Admission controller) and per-node (Collector) components.
Deploy the per-cluster components into each cluster that you want to monitor and deploy the per-node components in all nodes that you want to monitor.
You can install these components by using the Secured Cluster Services Helm chart (`secured-cluster-services`).

include::modules/sensor-requirements.adoc[leveloffset=+2]

include::modules/admission-controller-requirements.adoc[leveloffset=+2]
//TODO: add link to addmission controller topic

include::modules/collector-requirements.adoc[leveloffset=+2]

[NOTE]
====
Collector uses a mutable image tag (`<version>-latest`) so you get support for newer Linux kernel versions more easily.
We don't change code, preexisting kernel modules, or eBPF programs in image updates.
We only add a single image layer with support for new kernel versions published after the initial release.
====
//TODO: Add link to Mutable image tags topic.

[id="configure-secured-cluster-services-helm-chart"]
=== Configure the secured-cluster-services Helm chart

This section describes Helm charts configuration parameters that you can use with the `helm install` and `helm upgrade` commands.
You can specify these parameters by using the `--set` option or by creating YAML configuration files.

Create the following files for configuring the Helm chart for installing {product-title}.

* Public configuration file `values-public.yaml`: Use this file to save all non-sensitive configuration options.
* Private configuration file `values-private.yaml`: Use this file to save all sensitive configuration options. Make sure that you store this file securely.
//TODO: Add links to sample configuration files.


include::modules/secured-cluster-services-config.adoc[leveloffset=+3]

[id="install-secured-cluster-services-helm-chart"]
=== Install the secured-cluster-services Helm chart

After you configure the `values-public.yaml` and `values-private.yaml` files, use the following command to install the `secured-cluster-services` Helm chart:

[source,terminal]
----
$ helm install -n stackrox --create-namespace \
  stackrox-secured-cluster-services rhacs/secured-cluster-services \
  -f <name-of-cluster-init-bundle.yaml> \ <1>
  -f <path-to-values-public.yaml> -f <path-to-values-private.yaml> <2>
----
<1> Use the `-f` option to specify the paths for your cluster init bundle.
<2> Use the `-f` option to specify the paths for your YAML configuration files.

include::modules/verify-acs-installation.adoc[leveloffset=+1]