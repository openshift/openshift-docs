:_mod-docs-content-type: ASSEMBLY
[id="acs-install-helm-customization"]
= Installing with customizations using Helm charts
include::modules/common-attributes.adoc[]
:context: acs-install-helm-customization
:topic-helm:

toc::[]

High-level installation flow:

. Add {product-title} Helm chart repository.
. Configure the `central-services` Helm chart.
. Install the `central-services` Helm chart to install the xref:../../architecture/acs-architecture.adoc#centralized-components_acs-architecture[centralized components] (Central and Scanner).
. Generate an init bundle or CRS.
. Configure the `secured-cluster-services` Helm chart.
. Install the `secured-cluster-services` Helm chart to install the xref:../../architecture/acs-architecture.adoc#per-cluster-components_acs-architecture[per-cluster] and xref:../../architecture/acs-architecture.adoc#per-node-components_acs-architecture[per-node] components (Sensor, Admission controller, Collector, and Scanner-slim).

Before you install:

* Understand xref:../../architecture/acs-architecture.adoc[{product-title} architecture].
* Check the xref:../../installing/acs-default-requirements.adoc#acs-default-requirements[default resource requirements page].

include::modules/adding-helm-repository.adoc[leveloffset=+1]

[id="configure-central-services-helm-chart"]
== Configuring the central-services Helm chart

This section describes Helm chart configuration parameters that you can use with the `helm install` and `helm upgrade` commands.
You can specify these parameters by using the `--set` option or by creating YAML configuration files.

Create the following files for configuring the Helm chart for installing {product-title}:

* Public configuration file `values-public.yaml`: Use this file to save all non-sensitive configuration options.
* Private configuration file `values-private.yaml`: Use this file to save all sensitive configuration options. Ensure that you store this file securely.
//TODO: Add links to sample configuration files.

include::modules/central-services-private-config.adoc[leveloffset=+2]

include::modules/central-services-public-config.adoc[leveloffset=+2]

[role="_additional-resources"]
.Additional resources
* link:https://www.postgresql.org/docs/13/libpq-connect.html#LIBPQ-CONNSTRING[Connection Strings - PostgreSQL Docs]
* link:https://www.postgresql.org/docs/13/config-setting.html#CONFIG-SETTING-CONFIGURATION-FILE[Parameter Interaction via the Configuration File - PostgreSQL Docs]
* link:https://www.postgresql.org/docs/13/auth-pg-hba-conf.html[The pg_hba.conf File - PostgreSQL Docs]

include::modules/install-central-services-helm-chart.adoc[leveloffset=+1]

include::modules/change-config-options-after-deployment-central-service.adoc[leveloffset=+2]

[id="generate-init-bundle-helm"]
== Generating an init bundle or CRS

Before you set up a secured cluster, you must create an init bundle or CRS. The secured cluster then uses this bundle or CRS to authenticate with Central.

You can create an init bundle by using the `roxctl` CLI or from the {product-title-short} portal. You can use the `roxctl` CLI to create a CRS.

// Generating init bundle
include::modules/roxctl-generate-init-bundle.adoc[leveloffset=+2]
include::modules/crs-generate-roxctl.adoc[leveloffset=+2]

[role="_additional-resources"]
.Additional resources
* xref:../../cli/installing-the-roxctl-cli.adoc#installing-the-roxctl-cli[Installing the `roxctl` CLI]

// Generating init bundle
include::modules/portal-generate-init-bundle.adoc[leveloffset=+2]

[id="configure-secured-cluster-services-helm-chart"]
== Configuring the secured-cluster-services Helm chart

This section describes Helm chart configuration parameters that you can use with the `helm install` and `helm upgrade` commands.
You can specify these parameters by using the `--set` option or by creating YAML configuration files.

Create the following files for configuring the Helm chart for installing {product-title}:

* Public configuration file `values-public.yaml`: Use this file to save all non-sensitive configuration options.
* Private configuration file `values-private.yaml`: Use this file to save all sensitive configuration options. Ensure that you store this file securely.
//TODO: Add links to sample configuration files.

[IMPORTANT]
====
While using the `secured-cluster-services` Helm chart, do not modify the `values.yaml` file that is part of the chart.
====

include::modules/secured-cluster-services-config.adoc[leveloffset=+2]

include::modules/install-secured-cluster-services-helm-chart.adoc[leveloffset=+1]

include::modules/change-config-options-after-deployment.adoc[leveloffset=+2]

include::modules/verify-acs-installation.adoc[leveloffset=+1]
