:_content-type: ASSEMBLY
[id="installing-vsphere-network-customizations"]
= Installing a cluster on vSphere with network customizations
include::_attributes/common-attributes.adoc[]
:context: installing-vsphere-network-customizations

toc::[]

In {product-title} version {product-version}, you can install a cluster on
VMware vSphere infrastructure that you provision with customized network
configuration options. By customizing your network configuration, your cluster
can coexist with existing IP address allocations in your environment and
integrate with existing MTU and VXLAN configurations.

You must set most of the network configuration parameters during installation,
and you can modify only `kubeProxy` configuration parameters in a running
cluster.

include::snippets/vcenter-support.adoc[]

[IMPORTANT]
====
The steps for performing a user-provisioned infrastructure installation are provided as an example only. Installing a cluster with infrastructure you provide requires knowledge of the vSphere platform and the installation process of {product-title}. Use the user-provisioned infrastructure installation instructions as a guide; you are free to create the required resources through other methods.
====

== Prerequisites

* You reviewed details about the xref:../../architecture/architecture-installation.adoc#architecture-installation[{product-title} installation and update] processes.
* You read the documentation on xref:../../installing/installing-preparing.adoc#installing-preparing[selecting a cluster installation method and preparing it for users].
* Completing the installation requires that you upload the {op-system-first} OVA on vSphere hosts. The machine from which you complete this process requires access to port 443 on the vCenter and ESXi hosts. Verify that port 443 is accessible.
* If you use a firewall, you confirmed with the administrator that port 443 is accessible. Control plane nodes must be able to reach vCenter and ESXi hosts on port 443 for the installation to succeed.
* If you use a firewall, you xref:../../installing/install_config/configuring-firewall.adoc#configuring-firewall[configured it to allow the sites] that your cluster requires access to.

include::modules/cluster-entitlements.adoc[leveloffset=+1]

include::modules/installation-vsphere-infrastructure.adoc[leveloffset=+1]

include::modules/vmware-csi-driver-reqs.adoc[leveloffset=+1]

[role="_additional-resources"]
.Additional resources

* To remove a third-party CSI driver, see xref:../../storage/container_storage_interface/persistent-storage-csi-vsphere.adoc#persistent-storage-csi-vsphere-install-issues_persistent-storage-csi-vsphere[Removing a third-party vSphere CSI Driver].
* To update the hardware version for your vSphere nodes, see xref:../../updating/updating-hardware-on-nodes-running-on-vsphere.adoc#updating-hardware-on-nodes-running-on-vsphere[Updating hardware on nodes running in vSphere].

[id="installation-requirements-user-infra_{context}"]
== Requirements for a cluster with user-provisioned infrastructure

For a cluster that contains user-provisioned infrastructure, you must deploy all
of the required machines.

This section describes the requirements for deploying {product-title} on user-provisioned infrastructure.

include::modules/installation-machine-requirements.adoc[leveloffset=+2]
include::modules/installation-minimum-resource-requirements.adoc[leveloffset=+2]
include::modules/csr-management.adoc[leveloffset=+2]

include::modules/installation-network-user-infra.adoc[leveloffset=+2]

[role="_additional-resources"]
.Additional resources

* xref:../../installing/install_config/installing-customizing.adoc#installation-special-config-chrony_installing-customizing[Configuring chrony time service]

include::modules/installation-dns-user-infra.adoc[leveloffset=+2]

include::modules/installation-load-balancing-user-infra.adoc[leveloffset=+2]

include::modules/installation-infrastructure-user-infra.adoc[leveloffset=+1]

include::modules/installation-user-provisioned-validating-dns.adoc[leveloffset=+1]

include::modules/ssh-agent-using.adoc[leveloffset=+1]

include::modules/installation-obtaining-installer.adoc[leveloffset=+1]

include::modules/installation-initializing-manual.adoc[leveloffset=+1]

include::modules/installation-vsphere-config-yaml.adoc[leveloffset=+2]

include::modules/installation-configure-proxy.adoc[leveloffset=+2]

// Network Operator specific configuration
include::modules/nw-network-config.adoc[leveloffset=+1]
include::modules/nw-modifying-operator-install-config.adoc[leveloffset=+1]
include::modules/nw-operator-cr.adoc[leveloffset=+1]

include::modules/installation-generate-ignition-configs.adoc[leveloffset=+1]

include::modules/installation-extracting-infraid.adoc[leveloffset=+1]

include::modules/installation-vsphere-machines.adoc[leveloffset=+1]

include::modules/machine-vsphere-machines.adoc[leveloffset=+1]

include::modules/installation-disk-partitioning.adoc[leveloffset=+1]

include::modules/architecture-rhcos-updating-bootloader.adoc[leveloffset=+1]

include::modules/installation-installing-bare-metal.adoc[leveloffset=+1]

include::modules/cli-logging-in-kubeadmin.adoc[leveloffset=+1]

include::modules/installation-approve-csrs.adoc[leveloffset=+1]

include::modules/installation-operators-config.adoc[leveloffset=+2]

include::modules/registry-removed.adoc[leveloffset=+2]

include::modules/installation-registry-storage-config.adoc[leveloffset=+2]

include::modules/installation-registry-storage-block-recreate-rollout.adoc[leveloffset=+3]

For instructions about configuring registry storage so that it references the correct PVC, see xref:../../registry/configuring_registry_storage/configuring-registry-storage-vsphere.adoc#registry-configuring-storage-vsphere_configuring-registry-storage-vsphere[Configuring the registry for vSphere].

include::modules/installation-complete-user-infra.adoc[leveloffset=+1]

You can add extra compute machines after the cluster installation is completed by following xref:../../machine_management/user_infra/adding-vsphere-compute-user-infra.adoc#adding-vsphere-compute-user-infra[Adding compute machines to vSphere].

include::modules/vsphere-anti-affinity.adoc[leveloffset=+1]

include::modules/persistent-storage-vsphere-backup.adoc[leveloffset=+1]

include::modules/cluster-telemetry.adoc[leveloffset=+1]

[role="_additional-resources"]
.Additional resources

* See xref:../../support/remote_health_monitoring/about-remote-health-monitoring.adoc#about-remote-health-monitoring[About remote health monitoring] for more information about the Telemetry service

== Next steps

* xref:../../post_installation_configuration/cluster-tasks.adoc#available_cluster_customizations[Customize your cluster].
* If necessary, you can
xref:../../support/remote_health_monitoring/opting-out-of-remote-health-reporting.adoc#opting-out-remote-health-reporting_opting-out-remote-health-reporting[opt out of remote health reporting].
* xref:../../registry/configuring_registry_storage/configuring-registry-storage-vsphere.adoc#configuring-registry-storage-vsphere[Set up your registry and configure registry storage].
* Optional: xref:../../installing/installing_vsphere/using-vsphere-problem-detector-operator.adoc#vsphere-problem-detector-viewing-events_vsphere-problem-detector[View the events from the vSphere Problem Detector Operator] to determine if the cluster has permission or storage configuration issues.
