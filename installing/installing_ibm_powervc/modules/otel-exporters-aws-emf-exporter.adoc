// Module included in the following assemblies:
//
// * observability/otel/otel-collector/otel-collector-exporters.adoc

:_mod-docs-content-type: REFERENCE
[id="otel-exporters-aws-emf-exporter_{context}"]
= AWS EMF Exporter

[role="_abstract"]
The AWS EMF Exporter converts the following OpenTelemetry metrics datapoints to the AWS CloudWatch Embedded Metric Format (EMF):

- `Int64DataPoints`
- `DoubleDataPoints`
- `SummaryDataPoints`

The EMF metrics are then sent directly to the Amazon CloudWatch Logs service by using the `PutLogEvents` API.

One of the benefits of using this exporter is the possibility to view logs and metrics in the Amazon CloudWatch console at link:https://console.aws.amazon.com/cloudwatch/[].

:FeatureName: The AWS EMF Exporter
include::snippets/technology-preview.adoc[]

.OpenTelemetry Collector custom resource with the enabled AWS EMF Exporter
[source,yaml]
----
# ...
  config:
    exporters:
      awsemf:
        log_group_name: "<group_name_of_amazon_cloudwatch_logs>" # <1>
        log_stream_name: "<log_stream_of_amazon_cloudwatch_logs>" # <2>
        resource_to_telemetry_conversion: # <3>
          enabled: true
        region: <region> # <4>
        endpoint: <protocol><endpoint> # <5>
        log_retention: <supported_value_in_days> # <6>
        namespace: <custom_namespace> # <7>
        role_arn: "<iam_role>" # <8>
# ...
----
<1> You can use the `log_group_name` parameter to customize the log group name or set the default `+/metrics/default+` value or the following placeholders:
+
The `+/aws/metrics/{ClusterName}+` placeholder is for searching for the `ClusterName` or `+aws.ecs.cluster.name+` resource attribute in the metrics data and replacing it with the actual cluster name.
+
The `+{NodeName}+` placeholder is for searching for the `NodeName` or `+k8s.node.name+` resource attribute.
+
The `+{TaskId}+` placeholder is for searching for the `TaskId` or `+aws.ecs.task.id+` resource attribute.
+
If no resource attribute is found in the resource attribute map, the placeholder is replaced by the `undefined` value.
<2> You can use the `log_stream_name` parameter to customize the log stream name or set the default `+otel-stream+` value or the following placeholders:
+
The `+{ClusterName}+` placeholder is for searching for the `+ClusterName+` or `+aws.ecs.cluster.name+` resource attribute.
+
The `+{ContainerInstanceId}+` placeholder is for searching for the `+ContainerInstanceId+` or `+aws.ecs.container.instance.id+` resource attribute. This resource attribute is valid only for the AWS ECS EC2 launch type.
+
The `+{NodeName}+` placeholder is for searching for the `+NodeName+` or `+k8s.node.name+` resource attribute.
+
The `+{TaskDefinitionFamily}+` placeholder is for searching for the `+TaskDefinitionFamily+` or `+aws.ecs.task.family+` resource attribute.
+
The `+{TaskId}+` placeholder is for searching for the `TaskId` or `+aws.ecs.task.id+` resource attribute in the metrics data and replacing it with the actual task ID.
+
If no resource attribute is found in the resource attribute map, the placeholder is replaced by the `undefined` value.
<3> Optional. Converts resource attributes to telemetry attributes such as metric labels. Disabled by default.
<4> The AWS region of the log stream. If a region is not already set in the default credential provider chain, you must specify the region.
<5> Optional. You can override the default Amazon CloudWatch Logs service endpoint to which the requests are forwarded. You must include the protocol, such as `https://`, as part of the endpoint value. For the list of service endpoints by region, see link:https://docs.aws.amazon.com/general/latest/gr/cwl_region.html[Amazon CloudWatch Logs endpoints and quotas] (AWS General Reference).
<6> Optional. With this parameter, you can set the log retention policy for new Amazon CloudWatch log groups. If this parameter is omitted or set to `0`, the logs never expire by default. Supported values for retention in days are `1`, `3`, `5`, `7`, `14`, `30`, `60`, `90`, `120`, `150`, `180`, `365`, `400`, `545`, `731`, `1827`, `2192`, `2557`, `2922`, `3288`, or `3653`.
<7> Optional. A custom namespace for the Amazon CloudWatch metrics.
<8> Optional. The AWS Identity and Access Management (IAM) role for uploading the metric segments to a different account.

[role="_additional-resources"]
.Additional resources
* link:https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/CloudWatch_Embedded_Metric_Format_Specification.html[Amazon CloudWatch User Guide: Specification: Embedded metric format]
* link:https://docs.aws.amazon.com/AmazonCloudWatchLogs/latest/APIReference/API_PutLogEvents.html[Amazon CloudWatch Logs API Reference: PutLogEvents]
* link:https://docs.aws.amazon.com/general/latest/gr/cwl_region.html[AWS General Reference: Amazon CloudWatch Logs endpoints and quotas]
