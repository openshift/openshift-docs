:_mod-docs-content-type: ASSEMBLY
include::_attributes/common-attributes.adoc[]

:context: installing-aws-wavelength

// Context Variables for edge zones
:aws-service-name-full: AWS Wavelength
:aws-service-name-short: Wavelength Zones
:aws-service-name-single: Wavelength Zone
:zone-type: wavelength-zone

[id="installing-aws-wavelength"]
= Installing a cluster on AWS with worker nodes on {aws-service-name-full}

// ATTENTION: All the content from here is shared between the pages:
// installing-aws-local-zones
// installing-aws-wavelength

ifeval::["{zone-type}" == "{aws-zone-type-local}"]
:aws-localzones:
:aws-doc-zone: https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-regions-availability-zones.html#concepts-local-zones
endif::[]
ifeval::["{zone-type}" == "{aws-zone-type-wavelength}"]
:aws-wavelength:
:aws-doc-zone: https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-regions-availability-zones.html#concepts-wavelength-zones
endif::[]

toc::[]

// Intro Installing in AWS Edge zones ({aws-service-name-full})
include::modules/aws-edge-zones-installing-intro.adoc[leveloffset=+0]

// Additional Permissions for {aws-service-name-full}
include::modules/aws-edge-zones-permissions.adoc[leveloffset=+0]

== About {aws-service-name-full} and edge compute pool

// Cluster limitations in {aws-service-name-full}
include::modules/aws-edge-zones-cluster-limitations.adoc[leveloffset=+2]

// Edge compute pools and AWS {aws-service-name-full}
include::modules/edge-machine-pools-aws-local-zones.adoc[leveloffset=+2]

[role="_additional-resources"]
.Additional resources

* xref:../../networking/changing-cluster-network-mtu.adoc#mtu-value-selection_changing-cluster-network-mtu[Changing the MTU for the cluster network]
* xref:../../networking/changing-cluster-network-mtu.adoc#nw-ovn-ipsec-enable_configuring-ipsec-ovn[Enabling IPsec encryption]
* xref:../../nodes/scheduling/nodes-scheduler-taints-tolerations.adoc#nodes-scheduler-taints-tolerations-about_nodes-scheduler-taints-tolerations[Understanding taints and tolerations]


[role="_additional-resources"]
.Additional resources

* xref:../../storage/understanding-persistent-storage.adoc#pvc-storage-class_understanding-persistent-storage[Storage classes]

* xref:../../networking/ingress-sharding.html#nw-ingress-sharding_ingress-sharding[Ingress Controller sharding]

== Prerequisites for the installation

// Opting in to the {aws-service-name-short} Group
include::modules/installation-aws-add-local-zone-locations.adoc[leveloffset=+2]

// Internet access for OpenShift Container Platform
include::modules/cluster-entitlements.adoc[leveloffset=+2]

// Obtaining an AWS Marketplace image
include::modules/installation-aws-marketplace-subscribe.adoc[leveloffset=+2]

//Installing the OpenShift CLI by downloading the binary: Moved up to precede `ccoctl` steps, which require the use of `oc`
include::modules/cli-installing-cli.adoc[leveloffset=+2]

// Obtaining the installation program
include::modules/installation-obtaining-installer.adoc[leveloffset=+2]

// Generating a key pair for cluster node SSH access
include::modules/ssh-agent-using.adoc[leveloffset=+2]

== Preparing for the installation

Before you extend nodes to {aws-service-name-full}, you must prepare certain resources for the cluster installation environment.

// Minimum resource requirements for cluster installation
include::modules/installation-minimum-resource-requirements.adoc[leveloffset=+2]

// Tested instance types for AWS
include::modules/installation-aws-tested-machine-types.adoc[leveloffset=+2]

[role="_additional-resources"]
.Additional resources

ifdef::aws-localzones[]
* See link:https://aws.amazon.com/about-aws/global-infrastructure/localzones/features/[AWS Local Zones features]
  in the AWS documentation for more information about {aws-service-name-full} and the supported instances types and services.
endif::aws-localzones[]
ifdef::aws-wavelength[]
* See link:https://aws.amazon.com/wavelength/features[Features][{aws-service-name-full}] 
  in the AWS documentation for more information about {aws-service-name-full} features.
endif::aws-wavelength[]

// Creating the installation files for AWS
//include::modules/installation-user-infra-generate.adoc[leveloffset=+2]

// Creating the installation configuration file
include::modules/installation-generate-aws-user-infra-install-config.adoc[leveloffset=+2]

// Examples of the installation configuration file with edge compute pools
include::modules/installation-aws-edge-compute-pools-examples.adoc[leveloffset=+2]

// Customizing Cluster Network MTU
include::modules/installation-aws-cluster-network-mtu.adoc[leveloffset=+2]

// Cluster installation options for an {aws-service-name-full} environment
include::modules/aws-cluster-installation-options-aws-lzs.adoc[leveloffset=+1]

.Next steps

Choose one of the following options to install an {product-title} cluster in an {aws-service-name-short} environment:

ifdef::aws-localzones[]
* xref:../../installing/installing_aws/installing-aws-localzone.adoc#installation-cluster-quickly-extend-workers_installing-aws-localzone[Installing a cluster quickly in AWS {aws-service-name-full}]
* xref:../../installing/installing_aws/installing-aws-localzone.adoc#creating-aws-local-zone-environment-existing_installing-aws-localzone[Installing a cluster in an existing VPC with defined Local Zone subnets]
endif::aws-localzones[]
ifdef::aws-wavelength[]
* xref:../../installing/installing_aws/installing-aws-wavelength.adoc#installation-cluster-quickly-extend-workers_installing-aws-wavelength[Install a cluster quickly in AWS Wavelength]
* xref:../../installing/installing_aws/installing-aws-wavelength.adoc#creating-aws-local-zone-environment-existing_installing-aws-wavelength[Installing a cluster in an existing VPC that has Wavelength Zones subnets]
endif::aws-wavelength[]

// Installing a cluster quickly in {aws-service-name-full}
include::modules/installation-cluster-quickly-extend-workers.adoc[leveloffset=+1]

// Modifying an installation configuration to use {aws-service-name-full}
include::modules/install-creating-install-config-aws-local-zones.adoc[leveloffset=+2]

[role="_additional-resources"]
.Additional resources

* xref:../../installing/installing_aws/installing-aws-localzone.adoc#cluster-limitations-local-zone_installing-aws-localzone[Creating the installation configuration file]

* xref:../../installing/installing_aws/installing-aws-localzone.adoc#cluster-limitations-local-zone_installing-aws-localzone[Cluster limitations in AWS {aws-service-name-full}]

.Next steps
* xref:../../installing/installing_aws/installing-aws-localzone.adoc#installation-launching-installer_installing-aws-localzone[Deploying the cluster]

[id="creating-aws-local-zone-environment-existing_{context}"]
== Installing a cluster in an existing VPC that has {aws-service-name-short} subnets

You can install a cluster into an existing Amazon Virtual Private Cloud (VPC) on Amazon Web Services (AWS).
The installation program provisions the rest of the required infrastructure, which you can further customize.
To customize the installation, modify parameters in the `install-config.yaml` file before you install the cluster.

Installing a cluster on AWS into an existing VPC requires the creation of subnets on {aws-service-name-full}
before deploying workers to the edge of the cloud infrastructure.

You can use a provided CloudFormation template to create the required network component (VPC, gateways, and subnets).
Additionally, you can modify a template to customize your infrastructure or use the information that they contain to
create AWS objects according to your company's policies.

ifdef::aws-localzones[]
[NOTE]
====
If you want to create private subnets, you must either modify the provided CloudFormation template
or create your own template.
====
endif::aws-localzones[]

[IMPORTANT]
====
The steps for performing an installer-provisioned infrastructure installation are provided for example purposes only.
Installing a cluster in an existing VPC requires that you have knowledge of the cloud provider and the
installation process of {product-title}. You can use a CloudFormation template to assist you with completing
these steps or to help model your own cluster installation. Instead of using the CloudFormation template to create
resources, you can decide to use other methods for generating these resources.
====

// Creating a VPC in AWS
include::modules/installation-creating-aws-vpc-localzone.adoc[leveloffset=+2]

// CloudFormation template for the VPC
include::modules/installation-cloudformation-vpc-localzone.adoc[leveloffset=+2]

ifdef::aws-localzones[]
// AWS security groups
// Do we need this for LZ as the example is already provided in the section "Edge compute pools and AWS Local Zones"?
include::modules/installation-aws-security-groups.adoc[leveloffset=+2]

// CloududFormation template for the subnet for {aws-service-name-full}
include::modules/installation-cloudformation-subnet-localzone.adoc[leveloffset=+2]

endif::aws-localzones[]
ifdef::aws-wavelength[]

// Creating a Carrier Gateway in AWS VPC Carrier Gateway
include::modules/installation-creating-aws-vpc-carrier-gw.adoc[leveloffset=+2]

// CloudFormation template for the VPC Carrier Gateway
include::modules/installation-cloudformation-vpc-carrier-gw.adoc[leveloffset=+2]

// Creating the subnets in AWS {aws-service-name-full}
include::modules/installation-creating-aws-vpc-subnets.adoc[leveloffset=+2]

// CloudFormation template for the VPC Subnets
include::modules/installation-cloudformation-vpc-subnets.adoc[leveloffset=+2]

endif::aws-wavelength[]

[role="_additional-resources"]
.Additional resources

* You can view details about the CloudFormation stacks that you create by navigating to the
  link:https://console.aws.amazon.com/cloudformation/[AWS CloudFormation console].

// Modifying an installation configuration file to use AWS {aws-service-name-full} subnets
include::modules/installing-aws-edge-zones-custom-vpc-config.adoc[leveloffset=+2]

[role="_additional-resources"]
.Additional resources

* See link:https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-files.html[Configuration and credential file settings]
  in the AWS documentation for more information about AWS profile and credential configuration.

.Next steps
* xref:../../installing/installing_aws/installing-aws-localzone.adoc#installation-launching-installer_installing-aws-localzone[Deploying the cluster]

// Creating edge worker nodes in public subnets (optional)
include::modules/machineset-aws-edge-zone-public.adoc[leveloffset=+1]

//TODO: Put this back if QE validates it:
//include::modules/installation-configure-proxy.adoc[leveloffset=+2]

//TODO: Verify removal due to automation.
// include::modules/installation-localzone-generate-k8s-manifest.adoc[leveloffset=+2]

// Deploying the cluster
include::modules/installation-launching-installer.adoc[leveloffset=+1]

.Next steps
* xref:../../post_installation_configuration/cluster-tasks.adoc#installation-extend-edge-nodes-aws-local-zones_post-install-cluster-tasks[Creating user workloads in AWS {aws-service-name-full}]

[id="reviewing-installation_{context}"]
== Reviewing the Installation

// Logging in to the cluster by using the CLI
include::modules/cli-logging-in-kubeadmin.adoc[leveloffset=+2]

// Logging in to the cluster by using the web console
include::modules/logging-in-by-using-the-web-console.adoc[leveloffset=+2]

[role="_additional-resources"]
.Additional resources

* See xref:../../web_console/web-console.adoc#web-console[Accessing the web console] for more details about
accessing and understanding the {product-title} web console.

// Verifying nodes that were created with edge compute pool
include::modules/machine-edge-pool-review-nodes.adoc[leveloffset=+2]

// Telemetry access for OpenShift Container Platform
include::modules/cluster-telemetry.adoc[leveloffset=+1]

[role="_additional-resources"]
.Additional resources

* See xref:../../support/remote_health_monitoring/about-remote-health-monitoring.adoc#about-remote-health-monitoring[About remote health monitoring]
  for more information about the Telemetry service.

[id="installing-aws-edge-next-steps_{context}"]
== Next steps

* xref:../../post_installation_configuration/cluster-tasks.adoc#installation-extend-edge-nodes-aws-local-zones_post-install-cluster-tasks[Creating user workloads in AWS {aws-service-name-full}].
* xref:../../installing/validating-an-installation.adoc#validating-an-installation[Validating an installation].
* xref:../../post_installation_configuration/cluster-tasks.adoc#available_cluster_customizations[Customize your cluster].
* If necessary, you can xref:../../support/remote_health_monitoring/opting-out-of-remote-health-reporting.adoc#opting-out-remote-health-reporting_opting-out-remote-health-reporting[opt out of remote health reporting].

ifeval::["{zone-type}" == "{aws-zone-type-local}"]
:!aws-localzones:
endif::[]
ifeval::["{zone-type}" == "{aws-zone-type-wavelength}"]
:!aws-wavelength:
endif::[]