[id="installing-fips"]
= FIPS compliant {product-title} clusters
include::modules/common-attributes.adoc[]
:context: installing-fips

toc::[]

Starting with version 4.3, you can install an {product-title} cluster that that use FIPS validated cryptographic libraries.

For the {op-system-first} machines in your cluster, this change is applied when the machines are deployed based on the status of an option in the `install-config.yaml` file, which governs the cluster options that a user can change during cluster deployment. With Red Hat Enterprise Linux machines, you must enable FIPS mode when you install the operating system on the machines that you plan to use as worker machines. These configuration methods ensure that your cluster meet the requirements of a FIPS compliance audit: only FIPS validated cryptography packages are enabled before the initial system boot.

Because FIPS must be enabled before the operating system that your cluster uses boots for the first time, you cannot enable FIPS after you deploy a cluster.

[id="installation-about-fips-validation_{context}"]
== FIPS validation in {product-title}

{product-title} uses certain FIPS validated modules within Red Hat Enterprise Linux (RHEL) and {op-system} for the operating system components that it uses. See link:https://access.redhat.com/articles/3359851[RHEL7 core crypto components]. For example, when users SSH into {product-title} clusters and containers, those connections are properly encrypted.

{product-title} components are written in Go and built with Red Hat’s golang compiler. When you enable FIPS mode for your cluster, Red Hat’s golang compiler calls RHEL and {op-system} cryptographic libraries for all {product-title} components that require cryptographic signing. At the initial release of {product-title} version 4.3, only the `ose-sdn` package uses the native golang cryptography, which is not FIPS validated. Red Hat verifies that all other packages use the FIPS validated OpenSSL module.

.FIPS mode attributes and limitations in {product-title} {product-version}
[cols="8a,8a",options="header"]
|===

|Attributes
|Limitations

|FIPS compliant operating systems: RHEL 7 and {op-system}.
.3+|The FIPS implementation does not offer a single function that both computes hash functions and validates the keys that are based on that hash. This limitation will continue to be evaluated and improved in future {product-title} releases.

|FIPS compliant CRI-O runtimes.
|FIPS compliant {product-title} services.

|FIPS validated cryptographic module and algorithms that are obtained from RHEL 7 and {op-system} binaries and images.
|

|Use of FIPS compatible golang compiler.
|TLS FIPS compliance is not complete but is planned for future {product-title} releases.

|===

[id="installation-about-fips-components_{context}"]
==  FIPS compliance in components that the cluster uses

Although the {product-title} cluster itself uses FIPS validated modules, ensure that the systems that support your {product-title} cluster use FIPS validated modules for cryptography.

[id="installation-about-fips-components-etcd_{context}"]
=== etcd

To ensure that the secrets that are stored in etcd use FIPS validated encryption, encrypt the etcd datastore by using a FIPS-approved cryptographic algorithm. After you install the cluster, you can xref:../authentication/encrypting-etcd.adoc#encrypting-etcd[encrypt the etcd data] by using the `aes cbc` algorithm.

[id="installation-about-fips-components-storage_{context}"]
=== Storage

For local storage, use RHEL-provided disk encryption or Container Native Storage that uses RHEL-provided disk encryption. By storing all data in volumes that use RHEL-provided disk encryption and enabling FIPS mode for your cluster, both data at rest and data in motion, or network data, are protected by FIPS validated encryption.

[id="installation-about-fips-components-runtimes_{context}"]
=== Runtimes

To ensure that containers know that they are running on a host that has is using FIPS validated cryptography modules, use CRI-O to manage your runtimes. CRI-O supports FIPS-Mode, in that it configures the containers to know that they are running in FIPS mode.

[id="installing-fips-mode_{context}"]
==  Installing a cluster in FIPS mode

To install a cluster in FIPS mode, follow the instructions to install a customized cluster on your preferred infrastructure. Ensure that that you set `fips: true` in the `install-config.yaml` file before you deploy your cluster.

* xref:../installing/installing_aws/installing-aws-customizations.adoc#installing-aws-customizations[Amazon Web Services]
* xref:../installing/installing_azure/installing-azure-customizations.adoc#installing-azure-customizations[Microsoft Azure]
* xref:../installing/installing_bare_metal/installing-bare-metal.adoc#installing-bare-metal[Bare metal]
* xref:../installing/installing_gcp/installing-gcp-customizations.adoc#installing-gcp-customizations[Google Cloud Platform]
* xref:../installing/installing_openstack/installing-openstack-installer-custom.adoc#installing-openstack-installer-custom[{rh-openstack-first}]
* xref:../installing/installing_vsphere/installing-vsphere.adoc#installing-vsphere[VMware vSphere]

To apply `AES CBC` encryption to your etcd data store, follow the xref:../authentication/encrypting-etcd.adoc#encrypting-etcd[Encrypting etcd data] process after you install your cluster.

If you add RHEL nodes to your cluster, ensure that you enable FIPS mode on the machines before their initial boot. See xref:../machine_management/adding-rhel-compute.adoc#adding-rhel-compute[Adding RHEL compute machines to an {product-title} cluster] and link:https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/security_guide/chap-federal_standards_and_regulations#sec-Enabling-FIPS-Mode[Enabling FIPS Mode] in the RHEL 7 documentation.
