:_content-type: ASSEMBLY
[id="logging-release-notes-5-4"]
= Logging 5.4 Release Notes
include::_attributes/common-attributes.adoc[]
:context: logging-release-notes-5-4

toc::[]

include::snippets/logging-compatibility-snip.adoc[]

include::modules/cluster-logging-rn-5.4.14.adoc[leveloffset=+1]

include::modules/cluster-logging-rn-5.4.13.adoc[leveloffset=+1]

include::modules/cluster-logging-rn-5.4.12.adoc[leveloffset=+1]

include::modules/cluster-logging-rn-5.4.11.adoc[leveloffset=+1]

include::modules/cluster-logging-rn-5.4.10.adoc[leveloffset=+1]

include::modules/cluster-logging-rn-5.4.9.adoc[leveloffset=+1]

include::modules/cluster-logging-rn-5.4.8.adoc[leveloffset=+1]

//include::modules/cluster-logging-rn-5.4.7.adoc[leveloffset=+1]

include::modules/cluster-logging-rn-5.4.6.adoc[leveloffset=+1]

include::modules/cluster-logging-rn-5.4.5.adoc[leveloffset=+1]

include::modules/cluster-logging-rn-5.4.4.adoc[leveloffset=+1]

include::modules/cluster-logging-rn-5.4.3.adoc[leveloffset=+1]

include::modules/cluster-logging-rn-5.4.2.adoc[leveloffset=+1]

[id="cluster-logging-release-notes-5-4-1_{context}"]
== Logging 5.4.1
This release includes link:https://access.redhat.com/errata/RHSA-2022:2216[RHSA-2022:2216-OpenShift Logging Bug Fix Release 5.4.1].

[id="openshift-logging-5-4-1-bug-fixes_{context}"]
=== Bug fixes
* Before this update, the log file metric exporter only reported logs created while the exporter was running, which resulted in inaccurate log growth data. This update resolves this issue by monitoring `/var/log/pods`. (https://issues.redhat.com/browse/LOG-2442[LOG-2442])

* Before this update, the collector would be blocked because it continually tried to use a stale connection when forwarding logs to fluentd forward receivers. With this release, the `keepalive_timeout` value has been set to 30 seconds (`30s`) so that the collector recycles the connection and re-attempts to send failed messages within a reasonable amount of time. (https://issues.redhat.com/browse/LOG-2534[LOG-2534])

* Before this update, an error in the gateway component enforcing tenancy for reading logs limited access to logs with a Kubernetes namespace causing "audit" and some "infrastructure" logs to be unreadable. With this update, the proxy correctly detects users with admin access and allows access to logs without a namespace. (https://issues.redhat.com/browse/LOG-2448[LOG-2448])

* Before this update, the `system:serviceaccount:openshift-monitoring:prometheus-k8s` service account had cluster level privileges as a `clusterrole` and `clusterrolebinding`. This update restricts the service account` to the `openshift-logging` namespace with a role and rolebinding. (https://issues.redhat.com/browse/LOG-2437[LOG-2437])

* Before this update, Linux audit log time parsing relied on an ordinal position of a key/value pair. This update changes the parsing to use a regular expression to find the time entry.  (https://issues.redhat.com/browse/LOG-2321[LOG-2321])

[id="openshift-logging-5-4-1-CVEs_{context}"]
=== CVEs
.Click to expand CVEs
[%collapsible]
====
* https://access.redhat.com/security/cve/CVE-2018-25032[CVE-2018-25032]
* https://access.redhat.com/security/cve/CVE-2021-4028[CVE-2021-4028]
* https://access.redhat.com/security/cve/CVE-2021-37136[CVE-2021-37136]
* https://access.redhat.com/security/cve/CVE-2021-37137[CVE-2021-37137]
* https://access.redhat.com/security/cve/CVE-2021-43797[CVE-2021-43797]
* https://access.redhat.com/security/cve/CVE-2022-0778[CVE-2022-0778]
* https://access.redhat.com/security/cve/CVE-2022-1154[CVE-2022-1154]
* https://access.redhat.com/security/cve/CVE-2022-1271[CVE-2022-1271]
* https://access.redhat.com/security/cve/CVE-2022-21426[CVE-2022-21426]
* https://access.redhat.com/security/cve/CVE-2022-21434[CVE-2022-21434]
* https://access.redhat.com/security/cve/CVE-2022-21443[CVE-2022-21443]
* https://access.redhat.com/security/cve/CVE-2022-21476[CVE-2022-21476]
* https://access.redhat.com/security/cve/CVE-2022-21496[CVE-2022-21496]
* https://access.redhat.com/security/cve/CVE-2022-21698[CVE-2022-21698]
* https://access.redhat.com/security/cve/CVE-2022-25636[CVE-2022-25636]
====

[id="cluster-logging-release-notes-5-4-0_{context}"]
== Logging 5.4
The following advisories are available for logging 5.4:
link:https://access.redhat.com/errata/RHSA-2022:1461[{logging-title-uc} Release 5.4]

[id="openshift-logging-5-4-0-tech-prev_{context}"]
=== Technology Previews

include::modules/cluster-logging-vector-tech-preview.adoc[leveloffset=+2]
include::modules/cluster-logging-loki-tech-preview.adoc[leveloffset=+2]

[id="openshift-logging-5-4-0-bug-fixes_{context}"]
=== Bug fixes

*	Before this update, the `cluster-logging-operator` used cluster scoped roles and bindings to establish permissions for the Prometheus service account to scrape metrics. These permissions were created when deploying the Operator using the console interface but were missing when deploying from the command line. This update fixes the issue by making the roles and bindings namespace-scoped. (link:https://issues.redhat.com/browse/LOG-2286[LOG-2286])

* Before this update, a prior change to fix dashboard reconciliation introduced a `ownerReferences` field to the resource across namespaces. As a result, both the config map and dashboard were not created in the namespace. With this update, the removal of the `ownerReferences` field resolves the issue, and the OpenShift Logging dashboard is available in the console. (link:https://issues.redhat.com/browse/LOG-2163[LOG-2163])

* Before this update, changes to the metrics dashboards did not deploy because the `cluster-logging-operator` did not correctly compare existing and modified config maps that contain the dashboard. With this update, the addition of a unique hash value to object labels resolves the issue.	(link:https://issues.redhat.com/browse/LOG-2071[LOG-2071])

*	Before this update, the OpenShift Logging dashboard did not correctly display the pods and namespaces in the table, which displays the top producing containers collected over the last 24 hours. With this update, the pods and namespaces are displayed correctly.	(link:https://issues.redhat.com/browse/LOG-2069[LOG-2069])

*	Before this update, when the `ClusterLogForwarder` was set up with `Elasticsearch OutputDefault` and Elasticsearch outputs did not have structured keys, the generated configuration contained the incorrect values for authentication. This update corrects the secret and certificates used.	(link:https://issues.redhat.com/browse/LOG-2056[LOG-2056])

*	Before this update, the OpenShift Logging dashboard displayed an empty CPU graph because of a reference to an invalid metric. With this update, the correct data point has been selected, resolving the issue.	(link:https://issues.redhat.com/browse/LOG-2026[LOG-2026])

*	Before this update, the Fluentd container image included builder tools that were unnecessary at run time. This update removes those tools from the image.(link:https://issues.redhat.com/browse/LOG-1927[LOG-1927])

*	Before this update, a name change of the deployed collector in the 5.3 release caused the logging collector to generate the `FluentdNodeDown` alert. This update resolves the issue by fixing the job name for the Prometheus alert. (link:https://issues.redhat.com/browse/LOG-1918[LOG-1918])

*	Before this update, the log collector was collecting its own logs due to a refactoring of the component name change. This lead to a potential feedback loop of the collector processing its own log that might result in memory and log message size issues. This update resolves the issue by excluding the collector logs from the collection. (link:https://issues.redhat.com/browse/LOG-1774[LOG-1774])

* Before this update, Elasticsearch generated the error `Unable to create PersistentVolumeClaim due to forbidden: exceeded quota: infra-storage-quota.` if the PVC already existed. With this update, Elasticsearch checks for existing PVCs, resolving the issue. (link:https://issues.redhat.com/browse/LOG-2131[LOG-2131])

* Before this update, Elasticsearch was unable to return to the ready state when the `elasticsearch-signing` secret was removed. With this update, Elasticsearch is able to go back to the ready state after that secret is removed. (link:https://issues.redhat.com/browse/LOG-2171[LOG-2171])

* Before this update, the change of the path from which the collector reads container logs caused the collector to forward some records to the wrong indices. With this update, the collector now uses the correct configuration to resolve the issue. (link:https://issues.redhat.com/browse/LOG-2160[LOG-2160])

* Before this update, clusters with a large number of namespaces caused Elasticsearch to stop serving requests because the list of namespaces reached the maximum header size limit. With this update, headers only include a list of namespace names, resolving the issue. (link:https://issues.redhat.com/browse/LOG-1899[LOG-1899])

* Before this update, the *{product-title} Logging* dashboard showed the number of shards 'x' times larger than the actual value when Elasticsearch had 'x' nodes. This issue occurred because it was printing all primary shards for each Elasticsearch pod and calculating a sum on it, although the output was always for the whole Elasticsearch cluster. With this update, the number of shards is now correctly calculated. (link:https://issues.redhat.com/browse/LOG-2156[LOG-2156])

* Before this update, the secrets `kibana` and `kibana-proxy` were not recreated if they were deleted manually. With this update, the `elasticsearch-operator` will watch the resources and automatically recreate them if deleted.	(link:https://issues.redhat.com/browse/LOG-2250[LOG-2250])

* Before this update, tuning the buffer chunk size could cause the collector to generate a warning about the chunk size exceeding the byte limit for the event stream. With this update, you can also tune the read line limit, resolving the issue.	(link:https://issues.redhat.com/browse/LOG-2379[LOG-2379])

* Before this update, the logging console link in OpenShift web console was not removed with the ClusterLogging CR. With this update, deleting the CR or uninstalling the Cluster Logging Operator removes the link. (link:https://issues.redhat.com/browse/LOG-2373[LOG-2373])

* Before this update, a change to the container logs path caused the collection metric to always be zero with older releases configured with the original path. With this update, the plugin which exposes metrics about collected logs supports reading from either path to resolve the issue. (link:https://issues.redhat.com/browse/LOG-2462[LOG-2462])

=== CVEs
[id="openshift-logging-5-4-0-CVEs_{context}"]
* link:https://access.redhat.com/security/cve/CVE-2022-0759[CVE-2022-0759]
** link:https://bugzilla.redhat.com/show_bug.cgi?id=2058404[BZ-2058404]
* link:https://access.redhat.com/security/cve/CVE-2022-21698[CVE-2022-21698]
** link:https://bugzilla.redhat.com/show_bug.cgi?id=2045880[BZ-2045880]
