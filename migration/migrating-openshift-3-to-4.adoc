[id="migrating-openshift-3-to-4"]
= Migrating {product-title} version 3 to 4
include::modules/common-attributes.adoc[]
:context: migrating-openshift-3-to-4

toc::[]

You can migrate application workloads from {product-title} 3.7 to a later version with the Cluster Application Migration (CAM) tool. The CAM enables you to control the migration and to minimize application downtime. The CAM provides a web console and an API, based on Kubernetes custom resources, for migrating stateful application workloads, at the granularity of a namespace, from a source to a target cluster.

You can migrate data to any storage class that is available on the target cluster, for example, from Red Hat Gluster Storage or NFS storage to Red Hat Ceph Storage.

Optionally, you can migrate the {product-title} 3.7 (and later) control plane settings to {product-title} 4.x with the Control Plane Migration Assistant (CPMA). See xref:migration-understanding-cpma_{context}[].

.Prerequisites

* You must have `cluster-admin` privileges.
* You must have `podman` installed.
* The source cluster(s) must be {product-title} 3.7 or later.
* The target cluster must be {product-title} 3.9 or later.
* The replication repository object storage must support the S3 API, for example, Red Hat NooBaa Storage, AWS S3, and generic S3 storage providers.
* If your applications use images from the `openshift` namespace, the required versions of the images must be present on the target cluster. If not, you must link:../openshift_images/image-streams-manage.html#images-imagestreams-update-tag_image-streams-managing[update the `imagestreamtags` references] to use an available version that is compatible with your application.
+
[NOTE]
====
If the `imagestreamtags` cannot be updated, you can manually upload equivalent images to the application namespaces and update the applications to reference them.

The following `imagestreamtags` have been _removed_ from {product-title} 4.2:

* `dotnet:1.0`, `dotnet:1.1`, `dotnet:2.0`
* `dotnet-runtime:2.0`
* `mariadb:10.1`
* `mongodb:2.4`, `mongodb:2.6`
* `mysql:5.5`, `mysql:5.6`
* `nginx:1.8`
* `nodejs:0.10`, `nodejs:4`, `nodejs:6`
* `perl:5.16`, `perl:5.20`
* `php:5.5`, `php:5.6`
* `postgresql:9.2`, `postgresql:9.4`, `postgresql:9.5`
* `python:3.3`, `python:3.4`
* `ruby:2.0`, `ruby:2.2`
====

include::modules/migration-understanding-cam.adoc[leveloffset=+1]

== Installing the CAM operator

The CAM operator installed on all clusters:

* {product-title} 3.x: You must install the CAM operator manually, because OLM is not supported.
* {product-title} 4.x: You can install the CAM operator with OLM.

include::modules/migration-installing-migration-operator-manually.adoc[leveloffset=+2]
include::modules/migration-installing-migration-operator-olm.adoc[leveloffset=+2]

== Configuring cross-origin resource sharing

You enable communication with the CAM by configuring cross-origin resource sharing on {product-title} 3 and 4 (if the {product-title}  4 cluster is not hosting the CAM).

include::modules/migration-configuring-cors-3.adoc[leveloffset=+2]

You can now verify xref:migration-verifying-cors_{context}[cross-origin resource sharing].

include::modules/migration-configuring-cors-4.adoc[leveloffset=+2]

You can now verify xref:migration-verifying-cors_{context}[cross-origin resource sharing].

include::modules/migration-verifying-cors.adoc[leveloffset=+2]

== Migrating applications with the CAM web console

include::modules/migration-launching-cam.adoc[leveloffset=+2]
include::modules/migration-adding-cluster-to-cam.adoc[leveloffset=+2]
include::modules/migration-adding-replication-repository-to-cam.adoc[leveloffset=+2]
include::modules/migration-creating-migration-plan-cam.adoc[leveloffset=+2]
include::modules/migration-running-migration-plan-cam.adoc[leveloffset=+2]

== Migrating control plane settings with the Control Plane Migration Assistant

include::modules/migration-understanding-cpma.adoc[leveloffset=+2]
include::modules/migration-installing-cpma.adoc[leveloffset=+2]
include::modules/migration-using-cpma.adoc[leveloffset=+2]

== Troubleshooting a failed migration

You can view the migration custom resources (CRs) and download logs to troubleshoot a failed migration.

include::modules/migration-custom-resources.adoc[leveloffset=+2]
include::modules/migration-viewing-migration-crs.adoc[leveloffset=+2]
include::modules/migration-downloading-logs.adoc[leveloffset=+2]
include::modules/migration-restic-timeout.adoc[leveloffset=+2]

include::modules/migration-known-issues.adoc[leveloffset=+1]
