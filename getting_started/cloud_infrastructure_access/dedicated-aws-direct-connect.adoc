[id="dedicated-aws-direct-connect"]
= AWS Direct Connect Configuration
include::modules/common-attributes.adoc[]
:context: dedicated-aws-direct-connect
toc::[]

This is the process for accepting an AWS Direct Connect virtual interface. For more information about AWS Direct Connect types and configuration, see the link:https://docs.aws.amazon.com/directconnect/latest/UserGuide/Welcome.html#overview-components[AWS Direct Connect components guide].

[id="direct-connect-methods"]
== AWS Direct Connect methods

A Direct Connect connection requires a Hosted Virtual Interface (VIF) connected to a Direct Connect Gateway (DXGateway), which is in turn associated to a Virtual Gateway (VGW) or a Transit Gateway in order to access a remote VPC in the same or another account. If you do not have an existing DXGateway, the typical process involves creating the Hosted VIF, with the DXGateway and VGW being created in the OSD AWS Account. If you have an existing DXGateway connected to one or more existing VGWs, the process involves the OSD AWS Account sending an Association Proposal to the DXGateway owner. The DXGateway owner must ensure that the proposed CIDR will not conflict with any other VGWs they have associated.

AWS Documentation:

* link:https://docs.aws.amazon.com/directconnect/latest/UserGuide/WorkingWithVirtualInterfaces.html[Virtual Interfaces]
* link:https://docs.aws.amazon.com/directconnect/latest/UserGuide/direct-connect-gateways-intro.html[Direct Connect Gateways]
* link:https://docs.aws.amazon.com/directconnect/latest/UserGuide/multi-account-associate-vgw.html[Associating a VGW across accounts]

[IMPORTANT]
====
When connecting to an existing DXGateway, you are responsible for the link:https://aws.amazon.com/directconnect/pricing/[costs].
====

There are two Direct Connection configuration options available:

. Create the hosted VIF and then the DXGateway and VGW.
. Request a connection via an existing Direct Connect Gateway that you own.

[id="direct-connect-create"]
== Creating the hosted Virtual Interface
Before you create the Hosted Virtual Interface (VIF), you will need the OSD AWS Account ID.

[id="direct-connect-connection"]
=== Determine the type of Direct Connect connection
View the Direct Connect Virtual Interface details.

.Procedure
. Log into the OSD AWS Account Dashboard and select the correct region.
. Select *Direct Connect* from the *Services* menu.
. There will be one or more Virtual Interfaces waiting to be accepted, select one of them to view the *Summary*.
. View the Virtual Interface type (private or public).
. Record the *Amazon side ASN* value.

If the Direct Connect Virtual Interface type is Private, a Virtual Private Gateway is created. If the Direct Connect Virtual Interface is Public, a Direct Connect Gateway is created.

[id="direct-connect-private"]
=== Creating a Private Direct Connect
A Private Direct Connect is created if the Direct Connect Virtual Interface type is Private.

.Procedure
. Log into the OSD AWS Account Dashboard and select the correct region.
. From the AWS region, select *VPC* from the *Services* menu.
. Select *Virtual Private Gateways* from *VPN Connections*.
. Click *Create Virtual Private Gateway*.
. Give the Virtual Private Gateway a suitable name.
. Select *Custom ASN* and enter the *Amazon side ASN* value gathered previously.
. Create the Virtual Private Gateway.
. Click the newly created Virtual Private Gateway and choose *Attach to VPC* from the *Actions* Tab.
. Select the *OSD Cluster VPC* from the list, and attach the Virtual Private Gateway to the VPC.
. From the *Services* menu, click *Direct Connect*. Choose one of the Direct Connect Virtual Interfaces from the list.
. Acknowledge the *I understand that Direct Connect port charges apply once I click Accept Connection* message, and then choose *Accept Connection*.
. Choose to Accept the Virtual Private Gateway Connection and select the Virtual Private Gateway that was created in the previous steps.
. Select *Accept* to accept the connection.
. Repeat the previous steps if there is more than one Virtual Interface.

[id="direct-connect-public"]
=== Creating a Public Direct Connect
A Public Direct Connect is created if the Direct Connect Virtual Interface type is Public.

.Procedure
. Log into the OSD AWS Account Dashboard and select the correct region.
. From the OSD AWS Account region, select *Direct Connect* from the *Services* menu.
. Select *Direct Connect Gateways* and *Create Direct Connect Gateway*.
. Give the Direct Connect Gateway a suitable name.
. In the *Amazon side ASN* enter the Amazon side ASN value gathered previously.
. Create the Direct Connect Gateway.
. Select  *Direct Connect* from the *Services* menu.
. Select one of the Direct Connect Virtual Interfaces from the list.
. Acknowledge the *I understand that Direct Connect port charges apply once I click Accept Connection* message, and then choose *Accept Connection*.
. Choose to Accept the Direct Connect Gateway Connection and select the Direct Connect Gateway that was created in the previous steps.
. Click *Accept* to accept the connection.
. Repeat the previous steps if there is more than one Virtual Interface.

[id="direct-connect-verification-troubleshooting"]
=== Verification and Troubleshooting

Once the Direct Connect Virtual Interfaces have been accepted, wait a short period and view the status of the Interfaces.

.Procedure
. Log into the OSD AWS Account Dashboard and select the correct region.
. From the OSD AWS Account region, select *Direct Connect* from the *Services* menu.
. Select one of the Direct Connect Virtual Interfaces from the list.
. Check the Interface State has become *Available*
. Check the Interface BGP Status has become *up*.
. Repeat verification for any remaining Direct Connect Interfaces.

Once the Direct Connect Virtual Interfaces are available, you will then be able to login to the OSD AWS Account Dashboard and download the Direct Connect configuration file for configuration on your side.


[id="direct-connect-existing"]
== Connecting to an existing Direct Connect Gateway

.Prerequisites
The following details should be gathered:

* Confirm the CIDR range of the OSD VPC will not conflict with any other VGWs you have associated
* The Direct Connect Gateway ID
* The AWS Account ID associated with the virtual interface
* The BGP ASN assigned for the DXGateway (optional; the Amazon default ASN may also be used)

.Procedure
. Log into the OSD AWS Account Dashboard and select the correct region.
. From the OSD AWS Account region, select *VPC* from the *Services* menu.
. From *VPN Connections*, select *Virtual Private Gateways*.
. Select *Create Virtual Private Gateway*.
. Give the Virtual Private Gateway a suitable name.
. Click *Custom ASN* and enter the *Amazon side ASN* value gathered previously or use the Amazon Provided ASN.
. Create the Virtual Private Gateway.
. In the *Navigation* pane of the OSD AWS Account Dashboard, choose *Virtual private gateways* and select the virtual private gateway. Choose *View details*.
. Choose *Direct Connect gateway associations* and click *Associate Direct Connect gateway*.
. Under *Association account type*, for Account owner, choose *Another account*.
. For *Direct Connect gateway owner*, enter the ID of the AWS account that owns the Direct Connect gateway.
. Under *Association settings*, for Direct Connect gateway ID, enter the ID of the Direct Connect gateway.
. Under *Association settings*, for Virtual interface owner, enter the ID of the AWS account that owns the virtual interface for the association.
. Optional - Add prefixes to Allowed prefixes, separating them using commas.
. Choose *Associate Direct Connect gateway*.

Once the Association Proposal has been sent, it will be waiting for your acceptance. The final steps you have to perform are available in link:https://docs.aws.amazon.com/directconnect/latest/UserGuide/multi-account-associate-vgw.html[AWS Documentation].


[id="direct-connect-troubleshooting"]
== Troubleshooting

Further troubleshooting can be found link:https://docs.aws.amazon.com/directconnect/latest/UserGuide/Troubleshooting.html[here].
