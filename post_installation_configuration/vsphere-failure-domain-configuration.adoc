:_content-type: ASSEMBLY
:context: post-install-vsphere-failure-domain-configuration
[id="post-install-vsphere-failure-domain-configuration"]
=  Configuring a cluster on vSphere with multiple failure domains
include::_attributes/common-attributes.adoc[]

toc::[]

After deploying {product-title}, you can configure a cluster to utilize multiple failure domains. A failure domain describes a unique topology which may consist of:

* datacenter

* compute cluster

* datastore

* portgroup

* resource pool

By defining multiple failure domains, administrators are able to distribute key control plane and workload elements among varied hardware resources in their datacenter. 

include::modules/installation-vsphere-zones-prerequisites.adoc[leveloffset=+1]

[IMPORTANT]
====
If tags are not applied prior to node migration or creation, nodes may not be labeled with the `topology.kubernetes.io/zone` and `topology.kubernetes.io/region` labels by the cloud provider.
====

[IMPORTANT]
====
The API and ingress VIPs require that failure domains share a common Layer 3 network. 
====

include::modules/infrastructure-vsphere-failure-domains-yaml.adoc[leveloffset=+1]

## Node Placement

After you have defined failure domains, nodes may be migrated or created in the required failure domains.

### Control Plane Nodes

Control plane nodes may be migrated with compute vMotion to the desired failure domain. Nodes will be labeled with `topology.kubernetes.io/zone` and `topology.kubernetes.io/region` labels associated with their failure domains by the cloud provider.

### Compute Nodes

Preexsting compute nodes may be migrated as with control plane nodes. However, it is recommended that new xref:../machine_management/creating_machinesets/creating-machineset-vsphere.html[machinesets] be created to provision compute nodes in the topology associated with each failure domain. For example, the failure domains defined in <<infrastructure-vsphere-failure-domains-yaml_{context},Defining the Failure Domain Topology>> will require new `machinesets` corresponding to `failure-domain-1`, `failure-domain-2`, and `failure-domain-3`. Once adequate compute nodes are scaled up in the required failure domains, the preexisting compute nodes may be scaled down. Nodes provisioned by the created `machinesets` will be labeled with `topology.kubernetes.io/zone` and `topology.kubernetes.io/region` labels associated with their failure domains by the cloud provider.
