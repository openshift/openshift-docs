:_content-type: ASSEMBLY
include::_attributes/common-attributes.adoc[]
[id="multitenancy-support-in-gitops"]
= Multitenancy support in GitOps
:context: multitenancy-support-in-gitops

toc::[]

Multitenancy is a software architecture where a single software instance serves multiple distinct user groups, or tenants. Using multitenancy, you can share a single Argo CD instance to deploy resources while maintaining isolation between users. This section helps cluster administrators to understand Argo CD instance scopes and when to choose a particular mode.

With {gitops-title} Operator on {OCP}, as a cluster administrator, you can provide multitenant access to the cluster for application delivery teams (tenants). You can allow tenants to create and manage dedicated Argo CD instances in their user-defined namespaces without having administrative permissions. The tenants have full autonomy and can tailor this instance to their needs and requirements without interfering with other tenants.

[NOTE]
====
For a multitenant cluster, the person managing the Argo CD instance may not be the person who manages the cluster and its users. Therefore, you cannot have the Argo CD Application Controller (`argocd-application-controller` component) as a superuser in the cluster.
====

The Argo CD Application Controller reconciles resources in the managed clusters. Therefore, to use multitenancy in the {gitops-shortname} Operator, depending on your use cases, tenants, and requirements, you must configure, grant, extend, or restrict specific permissions explicitly to Argo CD instances, applications, and on remote clusters to perform certain operations.

[id="gitops-argocd-instance-scopes_{context}"]
== Argo CD instance scopes

The {gitops-title} Operator creates instances that you can classify broadly into the following modes, all supporting multitenancy:

* Namespace-scoped instance (Application delivery instance)
* Cluster-scoped instance
* Default cluster-scoped instance

// Namespace-scoped instance (Application delivery instance)
include::modules/gitops-namespace-scoped-instance.adoc[leveloffset=+2]

[role="_additional-resources"]
.Additional resources
* xref:../argocd_instance/setting-up-argocd-instance.adoc#gitops-deploy-resources-different-namespaces_setting-up-argocd-instance[Deploying resources to a different namespace]

// Cluster-scoped instance
include::modules/gitops-cluster-scoped-instance.adoc[leveloffset=+2]

[role="_additional-resources"]
.Additional resources
* xref:../argocd_applications/managing-apps-in-non-control-plane-namespaces.adoc#managing-apps-in-non-control-plane-namespaces[Managing the application resources in non-control plane namespaces]

// Default cluster-scoped instance
include::modules/gitops-default-cluster-scoped-instance.adoc[leveloffset=+2]

[id="important-considerations-when-adopting-the-multitenancy-model_{context}"]
== Important considerations when adopting the multitenancy model

Granting multitenant cluster administration privileges might allow tenants to bypass any multitenancy efforts and permission restrictions because they might elevate their privileges using permissions granted to the application by Argo CD. To prevent such situations, you must understand the permission model for Argo CD installed through the {gitops-title} Operator and how to leverage it to be successful with OpenShift {gitops-shortname} for application delivery.

// Argo CD role-based access control (RBAC)
include::modules/gitops-argocd-rbac.adoc[leveloffset=+2]

// Argo CD projects
include::modules/gitops-argocd-projects.adoc[leveloffset=+2]

// Enable tenant namespace management with the NamespaceManagement CR
include::modules/gitops-enable-tenant-namespace-management-with-namespacemanagement.adoc[leveloffset=+1]

// Configuring namespace management for Argo CD tenants
include::modules/gitops-configuring-namespace-management-argocd-tenants.adoc[leveloffset=+2]

[role="_additional-resources"]
[id="additional-resources_{context}"]
== Additional resources

* xref:../understanding_openshift_gitops/about-redhat-openshift-gitops.adoc#gitops-openshift-go-common-terms_about-redhat-openshift-gitops[Glossary of common terms for OpenShift {gitops-shortname}]
* link:https://developers.redhat.com/articles/2023/03/06/5-global-environment-variables-provided-openshift-gitops#[5 global environment variables provided by {gitops-title}]
* xref:../declarative_clusterconfig/configuring-an-openshift-cluster-by-deploying-an-application-with-cluster-configurations.adoc#configuring-an-openshift-cluster-by-deploying-an-application-with-cluster-configurations[Elevating Argo CD instances to cluster-scoped instances]
* link:https://argo-cd.readthedocs.io/en/stable/operator-manual/rbac/[Understanding on how to set up the role-based access control (RBAC) policies]
* link:https://argo-cd.readthedocs.io/en/stable/user-guide/projects/#configuring-global-projects-v18[Configuring global projects]
* link:https://www.redhat.com/en/blog/a-guide-to-using-gitops-and-argocd-with-rbac[Using {gitops-shortname} and Argo CD with RBAC]