:_content-type: ASSEMBLY
[id="ztp-support-for-deployment-of-multi-node-clusters"]
= ZTP support for deployment of multi-node clusters
include::modules/common-attributes.adoc[]
:context: ztp-support-for-deployment-of-multi-node-clusters

toc::[]

= ZTP support for deployment of multi-node clusters

The Telco 5G zero touch provisioning (ZTP) flow uses the Assisted Service, which is
part of {rh-rhacm-first} on the hub cluster, to install clusters.
This is done by generating all of the custom resources (CRs) required by Assisted Service including:

* `AgentClusterInstall`
* `ClusterDeployment`
* `NMStateConfig`
* `ManagedCluster and `KlusterletAddonConfig` (integration with {rh-rhacm})`
* `InfraEnv`
* `BareMetalHost`
* `ConfigMap` for extra install manifests

Extending ZTP to support three-node clusters and standard clusters requires updates to these CRs,
including multiple instantiations of some CRs.

ZTP provides support for deploying single node clusters, three-node clusters,
and standard OpenShift clusters. This includes the installation of OpenShift and deployment of
the distributed units (DUs) at scale.

The overall flow is identical to the ZTP support for single node clusters,
with some differentiation in configuration depending on the type of cluster:

`SiteConfig`::
* For single node clusters, the `SiteConfig` must have exactly one entry in the `nodes` section.
* For three-node clusters, the `SiteConfig` must have exactly three entries defined in the `nodes` section.
* For standard clusters, the `SiteConfig` must have exactly three entries in the `nodes` section
with `role: master` and one or more additional entries with `role: worker`.

`PolicyGenTemplate`::
* The example common PGT is common across all types of clusters.
* There are example group PGTs for each single node, three-node, and standard clusters.
* Site-specific PGTs are still specific to each site.

The following topics contain additional information on the extended support for single node, three-node, and standard clusters.

include::modules/ztp-provisioning-edge-sites-at-scale.adoc[leveloffset=+1]

include::modules/about-ztp-and-distributed-units-on-openshift-clusters.adoc[leveloffset=+1]

include::modules/ztp-applying-the-ran-policies-for-monitoring-cluster-activity.adoc[leveloffset=+1]

include::modules/ztp-the-policygentemplate.adoc[leveloffset=+1]

include::modules/ztp-creating-the-policygentemplate-cr.adoc[leveloffset=+1]

include::modules/ztp-generating-ran-policies.adoc[leveloffset=+1]
.Additional resources
* link:https://github.com/stolostron/policy-generator-plugin[Kustomize Policy Generator plug-in]

include::modules/ztp-creating-ztp-custom-resources-for-multiple-managed-clusters.adoc[leveloffset=+1]

include::modules/ztp-installing-the-gitops-ztp-pipeline.adoc[leveloffset=+1]

include::modules/ztp-preparing-the-ztp-git-repository.adoc[leveloffset=+2]

include::modules/ztp-preparing-the-hub-cluster-for-ztp.adoc[leveloffset=+2]
.Additional resources
* link:https://github.com/openshift-kni/cluster-group-upgrades-operator#readme[Topology Aware Lifecycle Operator]

include::modules/ztp-deploying-a-site.adoc[leveloffset=+2]

include::modules/ztp-monitoring-deployment-progress.adoc[leveloffset=+1]

include::modules/ztp-site-cleanup.adoc[leveloffset=+1]
.Additional resources
* link:https://access.redhat.com/documentation/en-us/red_hat_advanced_cluster_management_for_kubernetes/2.4/html/clusters/managing-your-clusters#remove-managed-cluster[Removing a cluster from management]

include::modules/ztp-removing-obsolete-content.adoc[leveloffset=+2]

include::modules/ztp-tearing-down-the-pipeline.adoc[leveloffset=+1]

include::modules/ztp-upgrading-gitops-ztp.adoc[leveloffset=+1]
.Additional resources
* link:https://github.com/openshift-kni/cnf-features-deploy/blob/master/ztp/gitops-subscriptions/argocd/Upgrade.md[Upgrading GitOps ZTP]

include::modules/ztp-troubleshooting-gitops-ztp.adoc[leveloffset=+1]

include::modules/ztp-validating-the-generation-of-installation-crs.adoc[leveloffset=+2]

include::modules/ztp-validating-the-generation-of-policy-crs.adoc[leveloffset=+2]

include::modules/ztp-restarting-policies-reconciliation.adoc[leveloffset=+2]
.Additional resources
* link:https://github.com/openshift-kni/cluster-group-upgrades-operator#readme[Topology Aware Lifecycle Operator (TALO)]
