[[dev-guide-deployments]]
= Kubernetes Deployments
{product-author}
{product-version}
:data-uri:
:icons:
:experimental:
:toc: macro
:toc-title:

toc::[]

== Overview

Deployments have been added in Kubernetes and serve as a descendant of {product-title} 
DeploymentConfigs. Since DeploymentConfigs have existed since prior to the 1.0 release in
{product-title} and Deployments were added in Kubernetes 1.2, it is natural that the latter
will slightly diverge from the former. This document serves to call out the differences
between the two resources. Our long-term goal is to provide full feature parity in upstream
Deployments and switch to use them as a single resource that will provide fine-grained
management over applications. If you want to look at documentation specifically related to
upstream Deployments, see xref:http://kubernetes.io/docs/user-guide/deployments/[here].

[NOTE]
====
As of writing this, upstream Deployments are still a beta feature and {product-title} provides
them as a tech preview whereas DeploymentConfigs have been stable since 1.0.
====

[[Features-not-in-upstream]]
== Features DeploymentConfigs have / Deployments don't support yet

- Automatic rollbacks

Deployments do not support automatically rolling back to the last successfully
deployed ReplicaSet in case of a failure. This feature should be added soon.

- Triggers

Deployments have an implicit ConfigChange trigger in that every change in the pod
template of a Deployment will automatically trigger a new rollout. If you don't want
new rollouts on pod template changes, pause the Deployment.

----
$ oc rollout pause deploy/<name>
----

At the moment, upstream Deployment do not support ImageChange triggers. A generic triggering
mechanism has been proposed upstream but it is unknown if and when will it be accepted.
Eventually, we can implement our own mechanism on top but it would be more desirable for it
to exist as part of the Kubernetes core.

- Hooks

Deployments do not support any lifecycle hooks.

- Custom strategies

Deployments do not support user-specified custom strategies yet.

- Canary deployments

Deployments do not run canaries as part of a new rollout yet.

- Test deployments

Deployments do not support running test tracks.


[[Features-in-upstream]]
== Features Deployments have / DeploymentConfigs cannot support

- Rollover

The deployment process for Deployments is driven by a controller loop in contrast
to DeploymentConfigs which use deployer pods for every new rollout. This means that
a Deployment can have as many active ReplicaSets as possible and eventually the
Deployment controller will scale down all old ReplicaSets and scale up the newest one.
DeploymentConfigs can have at most one deployer pod running, otherwise multiple
deployers end up fighting with each other trying to scale up what they think should
be the newest ReplicationController. Hence, only two ReplicationControllers can be
active at any point in time. In the grand scheme of things, this translates to faster
rapid rollouts for Deployments.

- Proportional scaling

The Deployment controller being the sole source of truth for the sizes of new and
old ReplicaSets owned by a Deployment is able to scale ongoing rollouts. Additional
replicas are distributed proportionally based on the size of each ReplicaSet.
DeploymentConfigs cannot be scaled when a rollout is ongoing because the deployment
config controller will end up fighting with the deployer process about the size of
the new ReplicationController.

- Pausing in the middle of a rollout

Upstream Deployments can be paused at any point in time meaning you can also pause
ongoing rollouts. On the other hand, you cannot pause deployer pods currently so if
you try to pause a DeploymentConfig in the middle of a rollout, the deployer process
will not be affected and will continue until it finishes.