[[dev-guide-templates-self-provision]]
= Creating Pre-Populated Project Templates
{product-author}
{product-version}
:data-uri:
:icons:
:experimental:
:toc: macro
:toc-title:
:prewrap!:

toc::[]
{nbsp} +

//https://access.redhat.com/support/cases/#/case/01503177
The API server automatically provisions projects based on the template that is
identified by the `projectRequestTemplate` parameter of the *_master-config.yaml_*
file. If the parameter is not defined, the API server
creates a default template for new projects.

You can create _read-only_ default project templates and uses those templates in place of the default template.
The project template allows you to  include restrictions on quotas, limits, and other resources you do not want template users changing.

Along with the project templates, you can create multiple application templates also configured with quota/limit restrictions. Standard users do not have authorization to 
edit templates, so the limits you specify cannot be changed.

//From https://access.redhat.com/support/cases/#/case/01503177
A system administrator can create a new project with hard ResourceQuotas, LimitRanges, and so forth. -

//https://access.redhat.com/support/cases/#/case/01503177
For each template, you can specify:
https://docs.openshift.com/enterprise/3.0/dev_guide/quota.html#usage-limits

* CPU

* memory

* pods

* replication controllers

* resource quotas

* services

* secrets

* persistent volume claims

For specific examples, you can also see xref:../../admin_guide/quota.adoc#sample-resource-quota-definitions[Sample Resource Quota Definitions] 

Users are not able to edit these settings even if they have created the project but still have project administrator control. 

This topic includes the following:
 
* How to set up a default project template and multiple project templates that can be called on by the user. 

* Examples of to add Resource Quotas, RangeLimits, and so forth to these templates. 

* Steps on how a system administrator can restrict users from editing preset objects but still allow the user administrator control over the project. 

== Create a Project Template

. Create a role, such as `my-project-admin-role`, with access to resources pods, replicationcontrollers, 
deploymentconfigs, builds, and add a rolebinding to bind the the ${PROJECT_ADMIN_USER} to this role in the template. 
Role bindings give a user a certain role in a project and grant that user project access.

. Create a project template based on the default project template: 
+
----
$ oc adm create-bootstrap-project-template -o json/yaml > <template-name>
----
+
For example, the following command exports the default project template
to a file named _*myproject.yaml*_:
+
----
$ oc adm create-bootstrap-project-template -o yaml > myproject.yaml 
----

. Edit the new project template file to change the `RoleBinding`:
+
[source,yaml]
----
"kind": "RoleBinding",
"apiVersion": "v1",
"metadata": {
    "name": "admin",
    "namespace": "${PROJECT_NAME}", <1>
    "creationTimestamp": null
    },
   "userNames": [
       "${PROJECT_ADMIN_USER}" <2>
   ],
   "groupNames": null,
   "subjects": [
       {
           "kind": "User",
           "name": "${PROJECT_ADMIN_USER}"
       }
   ],
   "roleRef": {
       "name": "admin"
----
+
<1> Specify the name of the project you want to limit access to.
<2> specify the name of an admin user you want to be able to access to the template.
+
When a project request is submitted, the API substitutes the following parameters into the template:
+
[cols="4,8",options="header"]
|===
|Parameter |Description

|*PROJECT_NAME*
|The name of the project. Required.

|*PROJECT_DISPLAYNAME*
|The display name of the project. May be empty.

|*PROJECT_DESCRIPTION*
|The description of the project. May be empty.

|*PROJECT_ADMIN_USER*
|The user name of the administrating user.

|*PROJECT_REQUESTING_USER*
|The user name of the requesting user.
|===
+
Access to the API is granted to developers with the
xref:../../architecture/additional_concepts/authorization.adoc#roles[`self-provisioner`
role] and the `self-provisioners` cluster role binding. This role is available
to all authenticated developers by default.
+
//https://access.redhat.com/support/cases/#/case/01503177

. Create the template object:
+
----
$ oc create -f template.yaml -n myproject.yaml
----

. Modify the *_/etc/origin/master/master-config.yaml_* file to reference the project template you want as the default:
+
----
...
projectConfig:
  projectRequestTemplate: "default/<name>"
  ...
----
+
For example:
+
----
...
projectConfig:
  projectRequestTemplate: "default/myproject.yaml"
  ...
----

. Use a text editor to modify the *_myproject.yaml_* file by adding objects or modifying existing objects.
+
The following sections show you how to limit access to certain resources using this template.

. Restart {product-title} for the changes to take
effect.
+
ifdef::openshift-origin[]
----
# systemctl restart origin-master
----
endif::[]
ifdef::openshift-enterprise[]
----
# systemctl restart atomic-openshift-master
----
endif::[]
