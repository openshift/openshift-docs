[[dev-guide-templates-components]]
= Template Components
{product-author}
{product-version}
:data-uri:
:icons:
:experimental:
:toc: macro
:toc-title:
:prewrap!:

toc::[]
{nbsp} +


//https://docs.openshift.com/container-platform/3.6/dev_guide/templates.html#writing-templates
[[dev-guide-templates-components-sections]]
When working with templates, it can be helpful to think of the template configuration file 
as a set of sections or layers:

* xref:dev-guide-templates-components-description[Description]
* xref:dev-guide-templates-components-labels[Labels]
* xref:dev-guide-templates-components-parameters[Parameters]
* xref:dev-guide-templates-components-object-list[Object List]

To get more information about a template, use the following command:

----
# oc describe template <template-name>
----

For example:

----
# oc describe template mlbparks

Name:    mlbparks <1>
Created: 7 days ago
Labels:     <none>
Description:   Application template for MLB Parks application on EAP 6 & MongoDB built using STI
Annotations:   iconClass=icon-jboss

Parameters:
    Name:      EAP_RELEASE  <2>
    Description:  EAP Release version, e.g. 6.4, etc.
    Value:     6.4
    Name:      APPLICATION_NAME
    Description:  The name for the application.
    Value:     mlbparks
    Name:      APPLICATION_HOSTNAME
    Description:  Custom hostname for service routes.
    Value:     <none>
    Name:      GIT_URI
    Description:  Git source URI for application
    Value:     https://github.com/jorgemoralespou/openshift3mlbparks.git  +++++++CHANGE THIS+++++
    Name:      GIT_REF
    Description:  Git branch/tag reference
    Value:     master
    Name:      MONGODB_DATABASE
    Description:  Database name
    Value:     root
    Name:      MONGODB_NOPREALLOC
    Description:  Disable data file preallocation.
    Value:     <none>
    Name:      MONGODB_SMALLFILES
    Description:  Set MongoDB to use a smaller default data file size.
    Value:     <none>
    Name:      MONGODB_QUIET
    Description:  Runs MongoDB in a quiet mode that attempts to limit the amount of output.
    Value:     <none>
    Name:      MONGODB_USER
    Description:  Database user name
    Generated:    expression
    From:      user[a-zA-Z0-9]{3}

    Name:      MONGODB_PASSWORD
    Description:  Database user password
    Generated:    expression
    From:      [a-zA-Z0-9]{8}

    Name:      MONGODB_ADMIN_PASSWORD
    Description:  Database admin password
    Generated:    expression
    From:      [a-zA-Z0-9]{8}

    Name:      GITHUB_TRIGGER_SECRET
    Description:  Github trigger secret
    Generated:    expression
    From:      [a-zA-Z0-9]{8}

    Name:      GENERIC_TRIGGER_SECRET
    Description:  Generic build trigger secret
    Generated:    expression
    From:      [a-zA-Z0-9]{8}


Object Labels: template=mlbparks <3>

Objects:  <4>
    BuildConfig      ${APPLICATION_NAME}
    ImageStream      ${APPLICATION_NAME}
    DeploymentConfig ${APPLICATION_NAME}-mongodb
    DeploymentConfig ${APPLICATION_NAME}
    Route      ${APPLICATION_NAME}-http-route
    Service    mongodb
    Service    ${APPLICATION_NAME}-http
    Service    ${APPLICATION_NAME}-ping
----

<1> xref:../../dev_guide/templates/template_components.adoc#dev-guide-templates-components-description[Descriptive information] to identify the template.
<2> xref:../../dev_guide/templates/template_components.adoc#dev-guide-templates-components-parameters[Values] to be supplied by the user or generated when the template is instantiated. Parameters with the `generated` flag require the user to enter the value.
<3> xref:../../dev_guide/templates/template_components.adoc#dev-guide-templates-components-labels[Labels] to be added to each object created when the template is instantiated
<4> xref:../../dev_guide/templates/template_components.adoc#dev-guide-templates-components-object-list[Objects] created when the template is instantiated.



[[dev-guide-templates-components-description]]
== Description

The template description reports what the template does and helps you
find a the right template when searching in the web console. Additional metadata beyond the
template name is optional, but useful to have. In addition to general
descriptive information, the metadata also includes a set of tags. Useful tags
include the name of the language the template is related to (for example,
*java*, *php*, *ruby*, and so forth).

.Template Description Metadata
[source,yaml]
----
kind: Template
apiVersion: v1
metadata:
  name: cakephp-mysql-example <1>
  annotations:
    openshift.io/display-name: "CakePHP MySQL Example (Ephemeral)" <2>
    description: >-
      An example CakePHP application with a MySQL database. For more information
      about using this template, including {product-title} considerations, see
      https://github.com/openshift/cakephp-ex/blob/master/README.md.


      WARNING: Any data stored will be lost upon pod destruction. Only use this
      template for testing." <3>
    template.openshift.io/long-description: >-
      This template defines resources needed to develop a CakePHP application,
      including a build configuration, application deployment configuration, and
      database deployment configuration.  The database is stored in
      non-persistent storage, so this configuration should be used for
      experimental purposes only. <4>
    tags: "quickstart,php,cakephp" <5>
    iconClass: icon-php <6>
    template.openshift.io/provider-display-name: "Red Hat, Inc." <7>
    template.openshift.io/documentation-url: "https://github.com/openshift/cakephp-ex" <8>
    template.openshift.io/support-url: "https://access.redhat.com" <9>
message: "Your admin credentials are ${ADMIN_USERNAME}:${ADMIN_PASSWORD}" <10>
----
<1> The unique internal name for the template.
<2> A brief, user-friendly name, which can be employed by user interface.
<3> A description of the template. Include enough detail that the user will
understand what is being deployed and any caveats they need to know before
deploying. It should also provide links to additional information, such as a
*_README_* file. Newlines can be included to create paragraphs.
<4> Additional template description. For example, this can be displayed by the service
catalog.
<5> Tags to be associated with the template for searching and grouping. Add tags
that will include it into one of the provided catalog categories. Refer to the
`id` and `categoryAliases` in `CATALOG_CATEGORIES` in the console's
link:https://github.com/openshift/origin-web-console/blob/master/app/scripts/constants.js[constants
file].
ifdef::openshift-enterprise,openshift-origin[]
The categories can also be
xref:../../install_config/web_console_customization.adoc#configuring-catalog-categories[customized]
for the whole cluster.
endif::[]
<6> An icon to be displayed with your template in the web console. Choose from
our existing
link:https://rawgit.com/openshift/openshift-logos-icon/master/demo.html[logo icons] when possible. You can also use icons from
link:http://fontawesome.io/icons/[FontAwesome] and
link:https://www.patternfly.org/styles/icons/[Patternfly].
ifdef::openshift-enterprise,openshift-origin[]
Alternatively, provide icons through
xref:../../install_config/web_console_customization.adoc#loading-custom-scripts-and-stylesheets[CSS
customizations] that can be added to an {product-title} cluster that uses your
template. You must specify an icon class that exists, or it will prevent falling
back to the generic icon.
endif::[]
<7> The name of the person or organization providing the template.
<8> A URL referencing further documentation for the template.
<9> A URL where support can be obtained for the template.
<10> An instructional message that is displayed when this template is
instantiated. This field should inform the user how to use the newly created
resources. Parameter substitution is performed on the message before being
displayed so that generated credentials and other parameters can be included in
the output. Include links to any next-steps documentation that users should
follow.

[[dev-guide-templates-components-labels]]
== Labels

Templates can include a set of
xref:../../architecture/core_concepts/pods_and_services.adoc#labels[labels]
that are added to each object created when the template is instantiated.
Defining a label in this way makes it easy for users to find and manage all the
objects created from a particular template.
+
.Template Object Labels

[source,yaml]
----
kind: "Template"
apiVersion: "v1"
...
labels:
  template: "cakephp-mysql-example" <1>
----
<1> A label to be applied to all objects created from this template.

For highly-detailed information on template labels, see xref:../../dev_guide/templates/templates_deep.adoc#dev-guide-templates-designing-labels[Template Deep Dive].

[[dev-guide-templates-components-parameters]]
== Parameters

Parameters allow a value to be supplied by the user or generated when the
template is instantiated. Then, that value is substituted wherever the parameter
is referenced. Parameters can be defined in any field in the objects list field.

Parameters are useful for generating random  passwords or allowing the user to supply a
host name or other user-specific value that is required to customize the
template. 

Parameters can be referenced in two ways:

* As a string value by placing values in the form *${PARAMETER_NAME}* in any string field in the
template.
* As a json/yaml value by placing values in the form *${{PARAMETER_NAME}}* in place of any
field in the template.

When using the *${PARAMETER_NAME}* syntax, multiple parameter references can be
combined in a single field and the reference can be embedded within fixed data,
such as *"http://{PARAMETER_1}#{$PARAMETER_2}"*. Both parameter values will be
substituted and the resulting value will be a quoted string.

When using the *${{PARAMETER_NAME}}* syntax only a single parameter reference is
allowed and leading/trailing characters are not permitted.  The resulting value
will be unquoted unless, after substitution is performed, the result is not a
valid JSON object.  If the result is not a valid JSON value, the resulting value
will be quoted and treated as a standard string.

A single parameter can be referenced multiple times within a template and it can
be referenced using both substitution syntaxes within a single template.

A default value can be provided, which is used if the user does not supply a
different value:

.Setting an Explicit Value as the Default Value
[source,yaml]
----
parameters:
  - name: USERNAME
    description: "The user name for Joe"
    value: joe
----

Parameter values can also be generated based on rules specified in the parameter
definition:

.Generating a Parameter Value
[source,yaml]
----
parameters:
  - name: PASSWORD
    description: "The random user password"
    generate: expression
    from: "[a-zA-Z0-9]{12}"
----

In the example above, processing will generate a random password 12
characters long consisting of all upper and lowercase alphabet letters
and numbers.

The syntax available is not a full regular expression syntax. However, you can
use `\w`, `\d`, and `\a` modifiers:

- `[\w]{10}` produces 10 alphabet characters, numbers, and underscores. This
follows the PCRE standard and is equal to `[a-zA-Z0-9_]{10}`.
- `[\d]{10}` produces 10 numbers. This is equal to `[0-9]{10}`.
- `[\a]{10}` produces 10 alphabetical characters. This is equal to
`[a-zA-Z]{10}`.

For highly-detailed information on template parameters, see xref:../../dev_guide/templates/templates_deep.adoc#dev-guide-templates-designing-parameters[Template Deep Dive].

[[dev-guide-templates-components-object-list]]
== Object List

The main portion of the template is the list of objects that are created
when the template is instantiated. 

This can be any
xref:../../architecture/core_concepts/index.adoc#architecture-core-concepts-index[valid API object], such as a
xref:../../dev_guide/builds/index.adoc#defining-a-buildconfig[build configuration][build configuration (`BuildConfig`)], 
xref:../../architecture/core_concepts/deployments.adoc#deployments-and-deployment-configurations[deployment configuration (`DeploymentConfig`)], 
xref:../../architecture/core_concepts/pods_and_services.adoc#architecture-core-concepts-pods-and-services[service (`Service`)], and so forth. The object is
created exactly as defined here, with any parameter values substituted in prior
to creation. The definition of these objects can reference xref:dev-guide-templates-components-parameters[template parameters].

[source,yaml]
----
kind: "Template"
apiVersion: "v1"
objects:
  - kind: "Service" <1>
    apiVersion: "v1"
    metadata:
      name: "cakephp-mysql-example"
      annotations:
        description: "Exposes and load balances the application pods"
    spec:
      ports:
        - name: "web"
          port: 8080
          targetPort: 8080
      selector:
        name: "cakephp-mysql-example"
----
<1> The definition of a `Service` that is created by this template.

[NOTE]
====
If the object definition metadata includes a fixed `namespace` field value, the
field will be stripped out of the definition during template instantiation. If
the `namespace` field contains a parameter reference, normal parameter
substitution will be performed and the object will be created in whatever
project the parameter substitution resolved the value to, assuming the user
has permission to create objects in that project.
====

For highly-detailed information on the Object List, see xref:../../dev_guide/templates/templates_deep.adoc#dev-guide-templates-designing[Template Deep Dive].
