[id='configuring-monitoring-stack']
= Configuring monitoring stack
include::modules/common-attributes.adoc[]

Prior to {product-title} 4, the Prometheus Cluster Monitoring stack was configured through the Ansible inventory file. For that purpose, the stack exposed a subset of its available configuration options as Ansible variables. You configured the stack prior to the installation of {product-title}.

In {product-title} 4, Ansible is not the primary technology to install {product-title} anymore. The installer only provides a very low number of configuration options pre-installation. Configuring any OpenShift framework components, including the Prometheus Cluster Monitoring stack, happens post-installation.

This section explains what configuration is supported, shows how to configure the monitoring stack, and demonstrates several common configuration scenarios.

.Prerequisites

* The monitoring stack imposes additional resource requirements. Consult the computing resources recommendations in xref:../scalability_and_performance/scaling-cluster-monitoring-operator.adoc#scaling-cluster-monitoring-operator[Scaling the Cluster Monitoring Operator] and verify that you have sufficient resources.

.Additional resources

* See link:https://docs.openshift.com/container-platform/3.11/install_config/prometheus_cluster_monitoring.html#configuring-openshift-cluster-monitoring[the documentation for configuring the monitoring stack on {product-title} 3.11].

include::modules/monitoring-supported-configuration.adoc[leveloffset=+1]

include::modules/monitoring-creating-cluster-monitoring-configmap.adoc[leveloffset=+1]
include::modules/monitoring-general-procedure-for-configuring-monitoring-stack.adoc[leveloffset=+1]
include::modules/monitoring-components-available-for-configuration.adoc[leveloffset=+1]
include::modules/monitoring-moving-monitoring-components-to-different-nodes.adoc[leveloffset=+1]

[id='configuring-persistent-storage']
== Configuring persistent storage

Running cluster monitoring with persistent storage means that your metrics are stored to a persistent volume and can survive a pod being restarted or recreated. This is ideal if you require your metrics or alerting data to be guarded from data loss. For production environments, it is highly recommended to configure persistent storage.

.Prerequisites

* Dedicate sufficient persistent storage to ensure that the disk does not become full. How much storage you need depends on the number of pods. For information on system requirements for persistent storage, see xref:../scalability_and_performance/scaling-cluster-monitoring-operator.adoc#prometheus-database-storage-requirements[Prometheus database storage requirements].
* Unless you enable dynamically-provisioned storage, make sure you have a persistent volume (PV) ready to be claimed by the PVC, one PV for each replica. Prometheus has two replicas and Alertmanager has three replicas, which amounts to five PVs. #FIXME does this note still apply?#
* Use the block type of storage.

.Additional resources

* See LINK for details.
// FIXME link to the persistent storage docs once they are available
// used to link to ../architecture/additional_concepts/storage.adoc#persistent-volumes[Persistent Storage]
* See LINK for storage recommendations.
// FIXME add link to storage recommendations

include::modules/monitoring-configuring-a-persistent-volume-claim.adoc[leveloffset=+2]

include::modules/monitoring-modifying-retention-time-for-prometheus-metrics-data.adoc[leveloffset=+1]

[id='configuring-alertmanager']
== Configuring Alertmanager

The Prometheus Alertmanager is a component that manages incoming alerts. This includes:

* alert silencing
* alert inhibition
* alert aggregation
* reliable deduplication of alerts
* grouping alerts
* sending grouped alerts as notifications through receviers such as email, PagerDuty, and HipChat

This section shows how to configure Alertmanager.

.Additional resources

* See also link:https://prometheus.io/docs/alerting/alertmanager/[the Alertmanager documentation].

include::modules/monitoring-alertmanager-default-configuration.adoc[leveloffset=+2]
include::modules/monitoring-applying-custom-alertmanager-configuration.adoc[leveloffset=+2]
include::modules/monitoring-alerting-rules.adoc[leveloffset=+2]

[id='managing-alerts-using-alertmanager-ui-{context}']
== Managing alerts using Alertmanager UI

{product-title} 4 provides a Web interface to the Alertmanager, which enables you to manage alerts. This section demonstrates how to use the Alertmanager UI.

include::../modules/monitoring-contents-of-alertmanager-ui.adoc[leveloffset=+2]
include::../modules/monitoring-getting-information-about-alerts-and-alerting-rules.adoc[leveloffset=+2]
include::../modules/monitoring-silencing-alerts.adoc[leveloffset=+2]
include::../modules/monitoring-getting-information-about-silences.adoc[leveloffset=+2]
include::../modules/monitoring-editing-silences.adoc[leveloffset=+2]
include::../modules/monitoring-expiring-silences.adoc[leveloffset=+2]
