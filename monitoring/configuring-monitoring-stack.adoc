[id='configuring-monitoring-stack']
= Configuring monitoring stack
include::modules/common-attributes.adoc[]

The Cluster Monitoring Operator is installed with OpenShift. It is configured and deployed by the {product-title} Ansible `openshift_cluster_monitoring_operator` role using the variables from the inventory file. To configure the monitoring stack, modify the inventory file prior to installation. See the following sections for common configuration.

.Prerequisites

* The monitoring stack imposes additional resource requirements. Consult the computing resources recommendations in xref:../scalability_and_performance/scaling-cluster-monitoring-operator.adoc#scaling-cluster-monitoring-operator[Scaling the Cluster Monitoring Operator] and verify that you have sufficient resources.

[id='configuring-persistent-storage']
== Configuring persistent storage

Running cluster monitoring with persistent storage means that your metrics are stored to a persistent volume and can survive a pod being restarted or recreated. This is ideal if you require your metrics or alerting data to be guarded from data loss. For production environments it is highly recommended to configure persistent storage.

.Prerequisites

* Dedicate sufficient persistent storage to ensure that the disk does not become full. How much storage you need depends on the number of pods. For information on system requirements for persistent storage, see xref:../scalability_and_performance/scaling-cluster-monitoring-operator.adoc#prometheus-database-storage-requirements[Prometheus database storage requirements].
// FIXME if possible, link the string "enable dynamically-provisioned storage" to section "Enabling dynamically-provisioned storage"
* Unless you enable dynamically-provisioned storage, make sure you have a persistent volume (PV) ready to be claimed by the PVC, one PV for each replica. Prometheus has two replicas and Alertmanager has three replicas, which amounts to five PVs.

.Additional resources

// FIXME once persistent storage docs are available
// used to link to ../architecture/additional_concepts/storage.adoc#persistent-volumes[Persistent Storage]
* See LINK for details.

include::modules/monitoring-enabling-persistent-storage.adoc[leveloffset=+2]
include::modules/monitoring-setting-persistent-storage-size.adoc[leveloffset=+2]
include::modules/monitoring-enabling-dynamically-provisioned-storage.adoc[leveloffset=+2]

[id='configuring-alertmanager']
== Configuring Alertmanager

The Alertmanager manages incoming alerts, including silencing, inhibition, aggregation, and sending out notifications through methods such as email, PagerDuty, and HipChat.

include::modules/monitoring-alertmanager-default-configuration.adoc[leveloffset=+2]
include::modules/monitoring-applying-custom-alertmanager-configuration.adoc[leveloffset=+2]
include::modules/monitoring-dead-mans-switch.adoc[leveloffset=+2]
include::modules/monitoring-dead-mans-switch-pagerduty.adoc[leveloffset=+2]
include::modules/monitoring-grouping-alerts.adoc[leveloffset=+2]
include::modules/monitoring-alerting-rules.adoc[leveloffset=+2]

include::modules/monitoring-full-list-of-configuration-variables.adoc[leveloffset=+1]
include::modules/monitoring-supported-configuration.adoc[leveloffset=+1]
