language: minimal
services:
  - docker

git:
  depth: 10
jobs:
  include:
      name: "Preview, validate, and build"
      before_install:
        - chmod +x autopreview.sh
        - ./autopreview.sh
        - docker pull quay.io/ganelson/asciidoctor-aura

      script:
        - docker run -v $(pwd):/ ganelson/asciidoctor-aura /bin/sh -c 'python3 build.py --distro openshift-enterprise --product "OpenShift Container Platform" --version 4.14 --no-upstream-fetch; if [ -d "drupal-build" ]; then python3 makeBuild.py; fi'
