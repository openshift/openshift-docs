language: python
cache:
  pip: true

git:
  depth: 10
jobs:
  include:
    - name: "Preview, validate, and build"
      before_install:
        #- ./autopreview.sh
      install:
        - gem install --local _gemfiles/asciidoctor-2.0.20.gem _gemfiles/asciidoctor-diagram-plantuml-1.2023.10.gem _gemfiles/asciidoctor-diagram-ditaamini-1.0.3.gem _gemfiles/rexml-3.2.6.gem _gemfiles/asciidoctor-diagram-2.2.14.gem _gemfiles/rouge-4.1.3.gem
        - pip3 install pyyaml aura.tar.gz
      script:
        # Fail if Asciidoctor encounters errors. Pass otherwise. Then, build updated distros
        #- ./scripts/check-asciidoctor-build.sh || travis_terminate 1
        - ./scripts/get-updated-distros.sh | ./scripts/build-distros.sh || travis_terminate 1
        - if [ -d "drupal-build" ]; then
            echo "Running makeBuild.py"
            python3 makeBuild.py || travis_terminate 1
          else
            echo "No drupal-build directory found."
          fi
