language: minimal
services:
  - docker

git:
  depth: 10
jobs:
  include:
      name: "Preview, validate, and build"
      before_install:
        - echo '{"registry-mirrors": ["https://quay.io/"]}' | sudo tee -a /etc/docker/daemon.json && sudo systemctl reload docker
        - docker pull quay.io/ganelson/asciidoctor-aura:latest

      script:
        - docker run -v $(pwd):/ ganelson/asciidoctor-aura /bin/sh -c 'python3 build.py --distro openshift-enterprise --product "OpenShift Container Platform" --version 4.14 --no-upstream-fetch; if [ -d "drupal-build" ]; then python3 makeBuild.py; fi'
