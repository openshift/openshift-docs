:_mod-docs-content-type: ASSEMBLY
[id="examine-images-for-vulnerabilities"]
= Examining images for vulnerabilities
include::modules/common-attributes.adoc[]
:context: examine-images-for-vulnerabilities

toc::[]

[role="_abstract"]
With {product-title}, you can analyze images for vulnerabilities using the {product-title-short} scanners, or you can xref:../integration/integrate-with-image-vulnerability-scanners.adoc#integrate-with-image-vulnerability-scanners[configure an integration] to use another supported scanner.

The scanners in {product-title-short} analyze each image layer to find packages and match them against known vulnerabilities by comparing them with a vulnerability database populated from different sources. Depending on the scanner used, sources include the National Vulnerability Database (NVD), the Open Source Vulnerabilities (OSV) database, and operating system vulnerability feeds.

[NOTE]
====
The {product-title-short} Scanner V4 uses the OSV database available at link:https://osv.dev/[OSV.dev] under link:https://github.com/google/osv.dev/blob/master/LICENSE[Apache License 2.0].
====

{product-title-short} contains two scanners: the StackRox Scanner and Scanner V4.

The StackRox Scanner originates from a fork of the Clair v2 open source scanner and is the default scanner. In version 4.4, {product-title-short} introduced Scanner V4, built on ClairCore, which provides additional image scanning features.

[NOTE]
====
This documentation uses the term "{product-title-short} scanner" or "Scanner" to refer to the combined scanning capabilities provided by the two scanners: the StackRox Scanner and Scanner V4. When referring to the capabilities of a specific scanner, the name of the specific scanner is used.
====

When the {product-title-short} scanner finds any vulnerabilities, it performs the following actions:

* Shows them in the xref:../operating/manage-vulnerabilities/common-vuln-management-tasks.adoc#common-vuln-management-tasks[*Vulnerability Management*] view for detailed analysis
* Ranks vulnerabilities according to risk and highlights them in the {product-title-short} portal for risk assessment
* Checks them against enabled xref:../operating/manage_security_policies/about-security-policies.adoc#about-security-policies[security policies]

The {product-title-short} scanner inspects the images and identifies the installed components based on the files in the images.
It might fail to identify installed components or vulnerabilities if the final images are modified to remove the following files:

[cols=",a"options="header"]
|===
|Components |Files

|Package managers
|
* `/etc/alpine-release`
* `/etc/apt/sources.list`
* `/etc/lsb-release`
* `/etc/os-release` or `/usr/lib/os-release`
* `/etc/oracle-release`, `/etc/centos-release`, `/etc/redhat-release`, or `/etc/system-release`
* Other similar system files.

|Language-level dependencies
|
* `package.json` for JavaScript.
* `dist-info` or `egg-info` for Python.
* `MANIFEST.MF` in Java Archive (JAR) for Java.

|Application-level dependencies
|
* `dotnet/shared/Microsoft.AspNetCore.App/`
* `dotnet/shared/Microsoft.NETCore.App/`

|===

//About Scanner V4
include::modules/consolidated-scanner.adoc[leveloffset=+1]

[id="enabling_scanner_v4_{context}"]
== Enabling Scanner V4

Scanner V4 is not enabled by default, but you can enable Scanner V4 during or after installation. Because the StackRox Scanner provides information about Kubernetes system platform vulnerabilities and non-{op-system} vulnerabilities, you must keep the StackRox scanner enabled to continue receiving reports for that data.

Scanner V4 is enabled in Central and is not required in secured clusters, unless you have specific needs, such as the need to access image registries that are located outside of the cluster and are not accessible from Central. For example, you enable Scanner V4 on secured clusters when using the OpenShift image registry, or in a {product-title-managed-short} system that only allows traffic to the registry from within its own firewalls. It is also required when using registry mirroring. For more information, see xref:../operating/examine-images-for-vulnerabilities.adoc#accessing-delegated-image-scanning_examine-images-for-vulnerabilities[Accessing delegated image scanning].

[id="enabling-scanner-v4-operator_{context}"]
=== Enabling Scanner V4 when installing by using the Operator

To use Scanner V4, you can enable it during installation on the cluster where Central is installed. Optionally, you can enable it on secured clusters during installation.

include::modules/enabling-scanner-v4-operator-central.adoc[leveloffset=+3]
include::modules/enabling-scanner-v4-operator-secured-cluster.adoc[leveloffset=+3]

[role="_additional-resources"]
.Additional resources

* xref:../installing/installing_ocp/install-central-ocp.adoc#install-central-operator_install-central-ocp[Installing Central using the Operator method]
* xref:../installing/installing_ocp/install-secured-cluster-ocp.adoc#installing-sc-operator[Installing {product-title-short} on secured clusters by using the Operator]
* xref:../installing/installing_ocp/install-central-config-options-ocp.adoc#scannerv4-settings_install-central-config-options-ocp[Scanner V4 settings for the Operator]
* xref:../installing/installing_ocp/init-bundle-ocp.adoc#init-bundle-ocp[Generating and applying an init bundle or cluster registration secret for RHACS on Red Hat OpenShift]

[id="enabling-scanner-v4-helm_{context}"]
=== Enabling Scanner V4 when installing by using Helm

To use Scanner V4, you can enable it during installation on the cluster where Central is installed. Optionally, you can enable it on secured clusters during installation.

include::modules/enabling-scanner-v4-helm-central.adoc[leveloffset=+3]
include::modules/enabling-scanner-v4-helm-secured-cluster.adoc[leveloffset=+3]

[role="_additional-resources"]
.Additional resources

* xref:../installing/installing_ocp/install-central-ocp.adoc#install-using-helm-customizations-ocp[Install Central using Helm charts with customizations]
* xref:../installing/installing_ocp/install-secured-cluster-ocp.adoc#configure-secured-cluster-services-helm-chart-customizations[Configuring the secured-cluster-services Helm chart with customizations ({ocp})]
* xref:../installing/installing_other/install-secured-cluster-other.adoc#configure-secured-cluster-services-helm-chart-customizations-other[Configuring the secured-cluster-services Helm chart with customizations (Kubernetes)]
* xref:../installing/installing_ocp/install-central-ocp.adoc#central-services-public-configuration-file-scannerv4_install-central-ocp[Scanner V4 settings for installing {product-title-short} on Central by using Helm ({ocp})]
* xref:../installing/installing_other/install-central-other.adoc#central-services-public-configuration-file-scannerv4_install-central-other[Scanner V4 settings for installing {product-title-short} on Central by using Helm (Kubernetes)]

[id="enabling-scanner-v4-after-installation-operator_{context}"]
=== Enabling Scanner V4 after installing by using the Operator

To use Scanner V4, you can enable it after installation on the cluster where Central is installed. Optionally, you can enable it on secured clusters after installation.

include::modules/enabling-scanner-v4-after-operator-installation-central.adoc[leveloffset=+3]

include::modules/enabling-scanner-v4-after-operator-installation-secured-cluster.adoc[leveloffset=+3]

[id="enabling-scanner-v4-after-installation-helm_{context}"]
=== Enabling Scanner V4 after installing by using Helm

To use Scanner V4, you can enable it after installation on the cluster where Central is installed. Optionally, you can enable it on secured clusters after installation.

include::modules/enabling-scanner-v4-after-helm-installation-central.adoc[leveloffset=+3]

include::modules/enabling-scanner-v4-after-helm-installation-secured-cluster.adoc[leveloffset=+3]

[role="_additional-resources"]
.Additional resources

* xref:../installing/installing_ocp/install-central-ocp.adoc#change-config-options-after-deployment-central-services_install-central-ocp[Changing configuration options after deploying the central-services Helm chart]
* xref:../installing/installing_ocp/install-central-ocp.adoc#automatically-generated-ca_install-central-ocp[Retrieving the automatically generated certificate authority]
* xref:../upgrading/upgrade-helm.adoc#upgrade-helm[Upgrading using Helm charts]

//roxctl cli?

include::modules/scanning-images.adoc[leveloffset=+1]

[role="_additional-resources"]
.Additional resources

* xref:../architecture/acs-architecture.adoc#vulnerability-sources_acs-architecture[Vulnerability sources]

* xref:../integration/integrate-with-image-vulnerability-scanners.adoc#integrate-with-image-vulnerability-scanners[Integrating with image vulnerability scanners]

include::modules/redirecting-image-pulls-from-a-source-registry-to-a-mirrored-registry.adoc[leveloffset=+2]

[role="_additional-resources"]
.Additional resources

* link:https://docs.redhat.com/en/documentation/openshift_container_platform/{ocp-latest-version}/html/images/image-configuration#images-configuration-registry-mirror-configuring_image-configuration[Configuring image registry repository mirroring]

* xref:../operating/examine-images-for-vulnerabilities.adoc#scanning-images-by-using-secured-clusters_examine-images-for-vulnerabilities[Scanning images by using secured clusters]

include::modules/accessing-delegated-image-scanning.adoc[leveloffset=+1]

include::modules/enhancing-image-scanning-by-accessing-delegated-image-scanning.adoc[leveloffset=+2]

include::modules/scanning-images-by-using-secured-clusters.adoc[leveloffset=+2]

[role="_additional-resources"]
.Additional resources

* xref:../operating/examine-images-for-vulnerabilities.adoc#redirecting-image-pulls-from-a-source-registry-to-a-mirrored-registry_examine-images-for-vulnerabilities[Redirecting image pulls from a source registry to a mirrored registry]

[id="installing-and-configuring-scanning-on-secured-clusters_{context}"]
=== Installing and configuring Scanner-slim on secured clusters

[id="using-the-operator_{context}"]
==== Using the Operator

{product-title-short} Operator installs a Scanner-slim version on each secured cluster to scan images in the {ocp} integrated registry and optionally other registries.

For more information, see xref:../installing/installing_ocp/install-secured-cluster-ocp.adoc#installing-sc-operator[Installing {product-title-short} on secured clusters by using the Operator].


[id="using-helm_{context}"]
==== Using Helm

Secured Cluster Services Helm chart (`secured-cluster-services`) installs a Scanner-slim version on each secured cluster.
In Kubernetes, the secured cluster services include Scanner-slim as an optional component.
On {ocp}, however, {product-title-short} installs a Scanner-slim version on each secured cluster to scan images in the {ocp} integrated registry and optionally other registries.

* For {ocp} installations, see xref:../installing/installing_ocp/install-secured-cluster-ocp.adoc#installing-secured-cluster-services-quickly_install-secured-cluster-ocp[Installing the secured-cluster-services Helm chart without customization].

* For non-{ocp} installations, such as Amazon Elastic Kubernetes Service (Amazon EKS), Google Kubernetes Engine (Google GKE), and Microsoft Azure Kubernetes Service (Microsoft AKS), see xref:../installing/installing_other/install-secured-cluster-other.adoc#installing-secured-cluster-services-quickly_install-secured-cluster-other[Installing the secured-cluster-services Helm chart without customization].

[id="verifying-after-installation_{context}"]
==== Verifying after installation

.Procedure

* Verify that the status of the secured cluster indicates that Scanner is present and healthy:
.. In the {product-title-short} portal, go to *Platform Configuration -> Clusters*.
.. In the *Clusters* view, select a cluster to view its details.
.. In the *Health Status* card, ensure that *Scanner* is present and is marked as *Healthy.*

[id="using-image-scanning_{context}"]
==== Using image scanning

You can scan images stored in a cluster specific {ocp} integrated image registry by using `roxctl` CLI, Jenkins, and API. You can specify the appropriate cluster in the delegated scanning configuration or use the cluster parameter available in `roxctl` CLI, Jenkins, and API.

For more information about how to scan images by using the `roxctl` CLI, see xref:../cli/image-scanning-by-using-the-roxctl-cli.adoc#image-scanning-by-using-the-roxctl-cli[Image scanning by using the roxctl CLI].

[id="setting-up-scanning_{context}"]
== Setting up scanning

You can configure settings for scanning, such as automatic scanning of active and inactive images.

include::modules/periodic-scanning-of-images.adoc[leveloffset=+2]

include::modules/scan-inactive-images.adoc[leveloffset=+2]

[role="_additional-resources"]
.Additional resources

* xref:../operating/examine-images-for-vulnerabilities.adoc#scan-inactive-images_examine-images-for-vulnerabilities[Scanning inactive images]
* xref:../cli/installing-the-roxctl-cli.adoc#installing-the-roxctl-cli[Installing the roxctl CLI]

[id="about-vulnerabilities_{context}"]
== About vulnerabilities

//Removed a lot of "additional resources" and added link below to the vulnerability management chapter, common vulnerability management tasks

{product-title-short} fetches vulnerability definitions and updates from multiple vulnerability feeds. These feeds are both general in nature, such as NVD, or distribution-specific, such as Alpine, Debian, and Ubuntu. For more information on viewing and addressing vulnerabilities that are found, see xref:../operating/manage-vulnerabilities/vulnerability-management.adoc#vulnerability-management[Vulnerability management].

include::modules/fetching-vulnerability-definitions.adoc[leveloffset=+2]

[role="_additional-resources"]
.Additional resources

* xref:../architecture/acs-architecture.adoc#vulnerability-sources_acs-architecture[Vulnerability sources]

include::modules/understanding-vulnerability-scores.adoc[leveloffset=+2]

//moved identify-dockerfile-line-component-cve.adoc to common vulnerability management chapter

include::modules/disable-language-specific-vulnerability-scanning.adoc[leveloffset=+1]

[id="additional-resources_examine-images-for-vulnerabilities"]
== Additional resources

* link:https://access.redhat.com/security/cve[Red{nbsp}Hat CVE Database]