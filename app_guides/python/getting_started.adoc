[[appguides-php-getting-started]]
= Getting Started with PHP
{product-author}
{product-version}
:data-uri:
:icons:
:experimental:
:toc: macro
:toc-title:

toc::[]

=== Overview

This tutorial walks through the creation of a PHP application titled `myapp`.
Before going through the rest of the tutorial, be sure to have created an
ifdef::openshift-online[]
https://console.preview.openshift.com[{product-title} account]
endif::[]
ifdef::openshift-origin,openshift-enterprise,openshift-dedicated[]
{product-title} account
endif::[]
and installed the `oc` command line tools.

[[php-gs-step1]]
== Step 1: The Sample Application and Git Repository

[[php-gs-sample-php-application]]
=== Sample PHP Application

The link:https://github.com/OpenShiftDemos/os-sample-php[sample PHP application]
used in this tutorial is a single PHP script that prints out information about
the environment using the `phpinfo();` function.

Even though it is a minimal application, it serves well to describe the basic
concepts. You do not have to use our sample application, but for the first steps
it might be helpful.

[[php-git-repo-hosting]]
=== Git Repository Hosting

To create new application, you must have your source code hosted somewhere on
the Internet and have it accessible using Git. Popular choices are
link:https://github.com/[GitHub], link:https://gitlab.com/[GitLab] or
link:https://bitbucket.org/[BitBucket].

For example, our sample application is hosted at GitHub. For this tutorial, you
may use the code from the provided repository or you can
link:https://help.github.com/articles/fork-a-repo/[_fork_] the repository.
Forking is necessary if you want to follow also through xref:php-gs-step3[Step
3].

[[php-getting-started-step2]]
== Step 2: Creating a New Application

[[php-gs-creating-new-app-cli]]
=== Creating a New Application with the CLI

Open a terminal and at the command prompt enter the following command to create
a PHP application, replacing the user name in the URL if you have forked, or the
whole URL if you are using your own application:

----
$ oc new-app --name=myapp php~https://github.com/OpenShiftDemos/os-sample-php.git
----

The output should look something like this:

====
----
--> Found image bbfc4eb (5 weeks old) in image stream "php" in project "openshift" under tag "5.6" for "php"

    Apache 2.4 with PHP 5.6
    -----------------------
    Platform for building and running PHP 5.6 applications

    Tags: builder, php, php56, rh-php56

    * A source build using source code from https://github.com/OpenShiftDemos/os-sample-php.git will be created
      * The resulting image will be pushed to image stream "myapp:latest"
    * This image will be deployed in deployment config "myapp"
    * Port 8080/tcp will be load balanced by service "myapp"
      * Other containers can access this service through the hostname "myapp"

--> Creating resources with label app=myapp ...
    imagestream "myapp" created
    buildconfig "myapp" created
    deploymentconfig "myapp" created
    service "myapp" created
--> Success
    Build scheduled, use 'oc logs -f bc/myapp' to track its progress.
    Run 'oc status' to view your app.
----
====

The `--name=myapp` option names the application. By default, it would be the
base name of the URL without an extension, in our case `os-sample-php`. But it
is much nicer to have the application named `myapp`, which is what we have done
using this switch.

OpenShift automatically linked php with `PHP 5.6` as the latest version. You
could as well use `php55` as the template to deploy using the specific version,
e.g.

[source]
----
oc new-app --name=myapp php55~https://github.com/OpenShiftDemos/os-sample-php.git
----

{product-title} prints a lot of information here that is not that important for
us at this moment. What we care about is if our application is accessible from
the Internet and if we can see it running.

For exposing application to the outside world, {product-title} has a concept of
_routes_ that map domain names to specific applications. To expose our
application we must know the name of the internal service; in the information
printed when we created our application, look for the line `service "myapp"
created`. {product-title} automatically created the new service, according to
the name of the application.

Now, let's expose that service. To do so, run this command:

----
$ oc expose svc myapp
----

You should see something like this:

====
----
route "myapp" exposed
----
====

Now we can run `oc status` to get information about your deployment:

----
$ oc status
----

You should see something like this:

====
----
http://myapp-demo.44fs.preview.openshiftapps.com to pod port 8080-tcp (svc/myapp)
  dc/myapp deploys istag/myapp:latest <-
    bc/myapp builds https://github.com/OpenShiftDemos/os-sample-php.git with openshift/php:5.6
    deployment #1 deployed about a minute ago - 1 pod
----
====

There again is a lot of information that we mostly do not care about at this
moment, but what we need is the first line. It shows you the domain where your
application is available. To access the application, simply open the domain in
your browser of choice and you should see the output of `phpinfo();`.

[[php-gs-creating-new-app-webconsole]]
=== Creating a New Application with the Web Console

In addition to using the CLI tools, you can deploy your application using the
{product-title} web console as well. To deploy using the web console, click on
the *Add to Project* at the top of the page. Then type `php` into the *Filter by
keyword* text field. You will then see a list of PHP based templates similar to:

image::builders-list.png[]

Select `php:latest` and fill in the form like this:

image::new-app.png[]

Depending on whether you forked the sample repository or not, you may need to
adjust the *Git Repository URL* field accordingly.

Finally, click *Create* and you will be taken to summary page like this:

image::new-app-overview.png[]

Click *Continue to overview*. On the overview page, you will see the details of
your new deployment similar to:

image::new-deployment.png[]

Clicking the URL in the top white box will take you straight to your newly
deployed application with the information from the `phpinfo();` function.

[[php-gs-step3]]
== Step 3: Making Your First Changes

To make changes to the application, you must
link:https://help.github.com/articles/fork-a-repo/[fork] it and deploy from your
own fork instead of from the original repository of the sample application. That
means that for creating the application, the URL will have a different user name
or organization:

----
$ oc new-app --name=myapp php~https://github.com/<user_name>/os-sample-php.git
----

Aside from that, the whole process from xref:php-gs-step1[Step 1] is the same.

[[php-gs-editing-source-code]]
==== Editing the Source Code

You can edit the source code in GitHub's web based editor. If you choose to do
so, there no need to copy the source code to your local machine and can skip
directly to xref:php-gs-deploying-changes-cli[Deploying the Changes with the
CLI] or xref:php-gs-deploying-changes-webconsole[Deploying the Changes with the
Web Console].

Or you can clone the repository locally, edit the file, and push back to the
server. To do so, first clone the Git repository and enter the new directory:

----
$ git clone https://github.com/[your user name]/os-sample-php.git
$ cd os-sample-php
----

Edit the *_index.php_* file to your liking and commit the changes:

----
$ git add -A .
$ git commit -m "My application changes"
----

And finally push the changes back to GitHub:

----
$ git push origin master
----

That's it; the change is in the Git repository. Now let's go and deploy it.

[[php-gs-deploying-changes-cli]]
=== Deploying the Changes with the CLI

{product-title} already knows how to reach your Git repository as it did when
first deploying the application. When it created the service that we referenced
before, ot also created a build configuration:

----
buildconfig "myapp" created
----

A build configuration is the reference for building objects for your application
and allows us to trigger the build process.

[NOTE]
====
In addition to containing information necessary for building an application, a
build configuration also defines which build strategy should be used. In our
case, the strategy is `Source`. This strategy contains the URL of the Git
repository to fetch the source code from and other important information. You
can check more details by running:

----
$ oc describe bc myapp
----
====

To trigger the build process, run:

----
$ oc start-build myapp
----

You should see something like this:

----
myapp-2
----

After the build finishes, refresh your browser with the application and you
should see the changed you just made.

[[php-gs-deploying-changes-webconsole]]
=== Deploying the Changes with the Web Console

The web console allows you to trigger builds. In the web console, go to *Browser ->
Builds*, and there you will see a line similar to:

image::new-build.png[]

Click on `myapp` and on the next page click the *Start Build* button in the top
right corner:

image::start-build.png[]

Then click *Overview* in the left navigation panel. You will be taken back to
the *Overview* page, where you will see that you build is running:

image::running-build.png[]

And after it is finished:

image::finished-build.png[]

You can then click your application URL and see the changes you made.
