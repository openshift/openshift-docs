[[admin-solutions-certificate-management]]
= Certificate Management
{product-author}
{product-version}
:data-uri:
:icons:
:experimental:
:toc: macro
:toc-title:

toc::[]

== Overview

Over the lifetime of a {product-title} cluster, certificates will enter various phases of their lifecycle.  The following
procedures describe how to manage various parts of that lifecycle.

[[change-metrics-to-ca-signed-cert]]
=== Changing Metrics' Self-Signed Certificate to CA-signed Certificate
By default, as part of the {product-title} ansible installer deployment process, the metrics deployer creates self-signed certificates.
These self-signed certificates will not be recognized by browsers.  To alleviate this issue, a publicly-signed certificate
can be used at the router and configured to re-encrypt traffic with the self-signed certificate. 

The first step is to delete the existing route.

 oc delete route hawkular-metrics

With the route deleted, the certificates that will be used in the new route with the re-encrypt strategy must be assembled from
the existing wildcard and self-signed certificates created by the metrics deployer. The following certificates must be
available
* Wildcard CA certificate
* Wildcard private key
* Wildcard certificate
* Hawkular CA certificate

Each certificate must be available as a file on the filesystem for the new route.

The Hawkular CA can be retrieved and stored in a file by executing the following command:

 oc get secrets hawkular-metrics-certificate -n openshift-infra \
   -o jsonpath='{.data.hawkular-metrics-ca\.certificate}' | base64 -d > hawkular-internal-ca.crt

Locate the wildcard private key, certificate and CA certificate and place each into a separate file, such as `wildcard.key`,
`wildcard.crt` and `wildcard.ca`

Create the new re-encrypt route

 oc create route reencrypt hawkular-metrics-reencrypt \
            -n openshift-infra \
            --hostname hawkular-metrics.ocp.example.com \ 
            --key wildcard.key \ 
            --cert wildcard.crt \ 
            --ca-cert wildcard.ca \ 
            --service hawkular-metrics \
            --dest-ca-cert hawkular-internal-ca.crt

