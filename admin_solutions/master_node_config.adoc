= Master and Node Configuration
{product-author}
{product-version}
:data-uri:
:icons:
:experimental:
:toc: macro
:toc-title:

toc::[]

== Overview

ToDo{write overview once chapter comes into focus}

== Master Configuration

=== What does it do? What can it do?

The master configuration file (*_master-config.yaml_*) defines a wide range of options that can be configured on the link:../architecture/infrastructure_components/kubernetes_infrastructure.html#master[OpenShift master].

[cols="1,4"]
.Master Configuration File Options
|===
|Option |Description

|`*servingInfo*`
|Describes how to start serving.

|`*corsAllowedOrigins*`
|Specifies the host name to use to access the API server from a web application. 
|`*apiLevels*`
|A list of API levels that should be enabled on startup; for example, `v1beta3` and `v1`.

|`*masterPublicURL*`
|The way clients can access the OpenShift API server.

|`*controllers*`
|A list of the controllers that should be started. If set to `none`, then no controllers will start automatically. The default value is `\*` which will start all controllers. When using `*`, you may exclude controllers by prepending a `-` in front of the controller name. No other values are recognized at this time.

|`*pauseControllers*`
|When set to `true`, this instructs the master to not automatically start controllers, but instead to wait until a notification to the server is received before launching them.

|`*controllerLeaseTTL*`
|Enables controller election, instructing the master to attempt to acquire a lease before controllers start, and renewing it within a number of seconds defined by this value. Setting this value as a non-negative forces `*pauseControllers=true*`. The value default is off (`0`, or omitted) and controller election can be disabled with `-1`.

|`*admissionConfig*`
|Contains admission control plug-in configuration. *NeedInfo*: How do I set this? What do possible values look like?

|`*disabledFeatures*`
|A list of features that should _not_ be started. This is defined as `omitempty`  because it is unlikely that you would want to manually disable features.

|`*etcdStorageConfig*`
|Contains information about how API resources are stored in etcd. These values are only relevant when etcd is the backing store for the cluster.

|`*etcdClientInfo*`
|Contains information about how to connect to etcd. *NeedInfo*: How do I set this? What do possible values look like?

|`*kubernetesMasterConfig*`
|Contains information about how to connect to kubelet's KubernetesMasterConfig, if present start the kubernetes master in this process KubernetesMasterConfig.

|`*etcdConfig*`
|If present, then start etcd in this process.

|`*oauthConfig*`
|If present, then start the /oauth endpoint in this process.

|`*assetConfig*`
|If present, then start the asset server in this process.

|`*dnsConfig*`
|If present, then start the DNS server in this process.

|`*serviceAccountConfig*`
|Holds options related to service accounts. *NeedInfo*: How do I set this? What do possible values look like?

|`*masterClients*`
|Holds all the client connection information for controllers and other system components. NeedInfo: How do I set this? What do possible values look like?

|`*imageConfig*`
|Holds options that describe how to build image names for system components. NeedInfo: How do I set this? What do possible values look like?

|`*imagePolicyConfig*`
|Controls limits and behavior for importing images. *NeedInfo*: How do I set this? What do possible values look like?

|`*policyConfig*`
|Holds information about where to locate critical pieces of bootstrapping policy. *NeedInfo*: How do I set this? What do possible values look like?

|`*projectConfig*`
|Holds information about project creation and defaults. *NeedInfo*: How do I set this? What do possible values look like?

|`*routingConfig*`
|Holds information about routing and route generation. *NeedInfo*: How do I set this? What do possible values look like?

|`*networkConfig*`
|To be passed to the compiled in network plug-in. *NeedInfo*: How do I set this? What do possible values look like?

|`*volumeConfig*`
|Contains options for configuring volume plug-ins in the master node. *NeedInfo*: How do I set this? What do possible values look like?

|===

*NeedInfo*:Which items are configurable? Or, if it's a shorter list, which items are NOT configurable? I'd like to provide some easy examples of how these can be configured or altered.

=== How to configure in the Ansible hosts file

Only a portion of the variables exposed to Ansible relate directly to the master configuration files, and you cannot configure all of the master options with Ansible, but
link:../install_config/install/advanced_install.html#configuring-ansible[some options are configurable].
Ansible will lay down a template with some values substituted in.

*NeedInfo*: Which variables do relate to the master configs? Which ones are configurable with Ansible? Can I get an example of this template so I can see which values are substituted in?

In many deployments, the generated configuration files are added into a configuration management solution that can create and deploy modifications.

*NeedInfo*: Can you please explain what kind of config management solutions people might use?

== How many masters do I need?

For the purposes of
link:../admin_guide/high_availability.html[high availability]
(HA), it is a good idea to use
link:../install_config/install/advanced_install.html#multiple-masters[multiple masters].
A reference architecture of three masters is recommended, and
link:../architecture/infrastructure_components/kubernetes_infrastructure.html#master[HAproxy] is the recommended solution for this.

*NeedInfo*: What do you mean by "reference" architecture?

[CAUTION]
====
If etcd is being installed on the master hosts, then do _not_ configure your
cluster to use two masters, because etcd will not be able to decide which one
is authoritative when there are only two cluster members.
If you are hosting etcd on different hosts, then it is possible to run only two
masters.
====

== Node Configuration

=== What does it do? What can it do?

The node configuration file (*_node-config.yaml_*) defines a wide range of
options that can be configured on
link:../architecture/infrastructure_components/kubernetes_infrastructure.html#node[OpenShift nodes].

[cols="1,4"]
.Master Configuration File Options
|===
|Option |Description

|`*nodeName*`
|The value used to identify this particular node in the cluster. If possible, this should be your fully qualified hostname. If you're describing a set of static nodes to the master, this value must match one of the values in the list

|`*nodeIP*`
|Node may have multiple IPs, specify the IP to use for pod traffic routing. If not specified, network parse/lookup on the nodeName is performed and the first non-loopback address is used.

|`*servingInfo*`
|Describes how to start serving. *NeedInfo*: How do I set this? What do possible values look like?

|`*masterKubeConfig*`
|The filename for the .kubeconfig file that describes how to connect this node to the master.

|`*dnsDomain*`
|Holds the domain suffix. *NeedInfo*: How do I set this? What do possible values look like?

|`*dnsIP*`
|Holds the IP. *NeedInfo*: How do I set this? What do possible values look like?

|`*networkPluginName,omitempty*`
|Deprecated and maintained for backward compatibility, use `*NetworkConfig.NetworkPluginName*` instead.

|`*networkConfig*`
|Provides network options for the node. *NeedInfo*: How do I set this? What do possible values look like?

|`*volumeDirectory*`
|The directory that volumes will be stored under.

|`*imageConfig*`
|Holds options that describe how to build image names for system components.

|`*allowDisabledDocker*`
|If this is set to `true`, then the Kubelet will ignore errors from Docker.  This means that a node can start on a machine that does not have docker started.

|`*podManifestConfig*`
|Holds the configuration for enabling the Kubelet to create pods based from a manifest file or files placed locally on the node.

|`*authConfig*`
|Holds authn/authz configuration options.

|`*dockerConfig*`
|Holds Docker related configuration options.

|`*kubeletArguments,omitempty*`
|Key value pairs that are passed directly to the Kubelet that matches the Kubelet's command line arguments. These are not migrated or validated, so if you use them, then they may become invalid. Use caution, because these values override other settings in the NodeConfig which may cause invalid configurations.

|`*proxyArguments,omitempty*`
|ProxyArguments are key value pairs that are passed directly to the Proxy that matches the Proxy's command line arguments. These are not migrated or validated, so if you use them they may become invalid. Use caution, because these values override other settings in the NodeConfig which may cause invalid configurations.

|`*iptablesSyncPeriod*`
|How often iptable rules are refreshed. *NeedInfo*: How do I set this? What do possible values look like?

|`*volumeConfig*`
|Contains options for configuring volumes on the node. *NeedInfo*: How do I set this? What do possible values look like?

|===

*NeedInfo*:Which items are configurable? Or, if it's a shorter list, which items are NOT configurable? I'd like to provide some easy examples of how these can be configured or altered.

== How to configure in the Ansible hosts file

Only a portion of the variables exposed to Ansible relate directly to the node configuration files, and you cannot configure all of the node options with Ansible, but
link:../install_config/install/advanced_install.html#configuring-ansible[some options are configurable].
Ansible will lay down a template with some values substituted in.

*NeedInfo*: Which variables do relate to the node configs? Which ones are configurable with Ansible? Can I get an example of this template so I can see which values are substituted in?
