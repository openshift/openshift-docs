:_mod-docs-content-type: ASSEMBLY
[id="network-observability-dns-decoding_{context}"]
= Network observability DNS resolution analysis
:context: network-observability-dns-decoding
:toc:
include::_attributes/common-attributes.adoc[]

toc::[]

[role="_abstract"]
Learn how DNS resolution analysis uses eBPF-based decoding to identify service discovery issues and follow the steps to enable DNS tracking in the FlowCollector resource to enrich network flow records with domain names.

include::modules/network-observability-dns-decoding-strategic-benefits.adoc[leveloffset=+1]

include::modules/network-observability-dns-decoding-configuring.adoc[leveloffset=+1]

include::modules/network-observability-dns-decoding-tracking-field-reference.adoc[leveloffset=+1]

////
Drafty draft to get a sense of structure, all the parts (CONCEPT, PROCEDURE, etc)
- May fit with existing observing-network-traffic.adoc assembly, but will add to the already extensive mixed content in that assembly. There are 31 includes in the observing-network-traffic.adoc assembly already.


:_content-type: ASSEMBLY
[id="configuring-dns-tracking-visibility"]
= Configuring DNS tracking and visibility
include::_attributes.adoc[]

[role="_abstract"]
To maintain high availability and security in distributed cloud environments, Enterprise Architects and Cluster Administrators must have visibility into service discovery patterns. Enhanced DNS decoding in the Network Observability Operator provides granular visibility into Domain Name System (DNS) traffic by extracting domain names, response codes, and DNS class information directly from eBPF-enriched network flows.

== Understanding enhanced DNS decoding
Enhanced DNS decoding allows the eBPF agent to inspect UDP and TCP traffic on port 53. While standard network flows identify traffic only by IP address and port, decoded DNS flows provide the specific intent of the request.



=== Strategic benefits
* *Reduced Mean Time to Identification (MTTI)*: Distinguish immediately between a network routing failure and a DNS resolution failure, such as an `NXDOMAIN` error.
* *Improved security posture*: Detect potential data exfiltration or Command and Control (C2) activity by auditing the Fully Qualified Domain Names (FQDNs) queried by internal workloads.
* *Architectural efficiency*: Analyze the *DNS Class* to ensure traffic follows expected Internet (IN) protocols and identify legacy or non-standard configurations.

:_content-type: PROCEDURE
[id="enabling-dns-tracking-ebpf"]
= Enabling DNS tracking in the eBPF agent

To identify the root cause of service discovery failures, you must enable DNS decoding in the `FlowCollector` resource.

.Prerequisites
* You have cluster-administrator permissions for {product-title}.
* The Network Observability Operator is installed.

.Procedure
. In the {product-title} web console, navigate to *Operators* -> *Installed Operators* -> *Network Observability*.
. Under the *Flow Collector* tab, click the `cluster` instance and select the *YAML* tab.
. Configure the `spec.agent.ebpf` section to enable `DNSTracking`:
+
[source,yaml]
----
apiVersion: flows.netobserv.io/v1alpha1
kind: FlowCollector
metadata:
  name: cluster
spec:
  agent:
    type: eBPF
    ebpf:
      features:
        - DNSTracking <1>
      dnsTrackingPort: 53 <2>
----
<1> Enables the extraction of DNS ID, Query Name, DNS Class, and Response Code (RCODE).
<2> Optional: Defines the port to monitor for DNS protocol packets. Defaults to `53`.

. Click *Save*.

.Verification
. Navigate to *Observe* -> *Network Traffic*.
. In the *Traffic Flows* view, click the *Manage columns* icon.
. Ensure the following columns are selected and visible:
** *DNS Query Name*
** *DNS Response Code*
** *DNS Latency*
. Filter the view by setting *Port* to `53`. If the columns populate with domain names (e.g., `kubernetes.default.svc.cluster.local`), DNS tracking is active.



:_content-type: REFERENCE
[id="dns-tracking-field-reference"]
= DNS tracking field reference

The following table describes the metadata fields added to network flows when DNS tracking is enabled.

.DNS flow metadata
[cols="1,2,1",options="header"]
|===
|Field |Description |Example
|`dns_query_name` |The Fully Qualified Domain Name (FQDN) being queried. |`example.com`
|`dns_response_code` |The status code returned by the DNS server. |`NoError`, `NXDomain`
|`dns_id` |The transaction ID used to match queries with responses. |`45213`
|`dns_class` |The DNS class, typically representing the protocol family. |`IN`
|===

[id="leveraging-dns-data-optimization"]
== Leveraging DNS data for network optimization

Utilize the captured DNS metadata for the following operational outcomes:

* *Identify misconfigurations*: A high frequency of `NXDOMAIN` responses typically indicates service discovery errors in application code or stale environment variables.
* *Audit external dependencies*: Review `dns_query_name` values to ensure workloads are not reaching out to unauthorized external APIs or high-risk domains.
* *Performance tuning*: Monitor `DNS Latency` to identify if CoreDNS pods require additional scaling or if upstream DNS providers are lagging.

[id="interoperability-considerations"]
== Interoperability considerations
* *Loki Storage*: DNS tracking increases the number of labels and metadata per flow. Ensure your Loki storage is sized to accommodate the increased log volume.
* *Performance Impact*: The eBPF implementation is optimized for high-throughput clusters; however, monitor the CPU usage of `netobserv-ebpf-agent` pods in environments exceeding 100k DNS queries per second.
////