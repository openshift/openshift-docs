:_content-type: ASSEMBLY
[id="common-monitoring-configuration-monitoring-stack"]
= Common monitoring configuration scenarios
include::_attributes/common-attributes.adoc[]
:context: common-monitoring-configuration-scenarios

toc::[]

The default platform monitoring stack is available for use after installing {product-title}.
The in-cluster stack includes the core platform Prometheus instance that collects metrics from your cluster and the core Alertmanager instance that  routes alerts.

In addition to core platform monitoring, you can also optionally xref:../monitoring/enabling-monitoring-for-user-defined-projects.adoc#enabling-monitoring-for-user-defined-projects[enable monitoring for user-defined projects] for user workload monitoring.
After doing so, users can then monitor their own services and workloads without the need for an additional monitoring solution.

Depending on which users will use the monitoring stack and for what purposes, as a cluster administrator, you can configure monitoring components to suit the needs of different users in various scenarios.

[id="core-platform-monitoring-first-steps_{context}"]
== Core platform monitoring: First steps

After {product-title} is installed, cluster administrators typically perform certain basic activities to configure core platform monitoring to suit their needs.
These activities include configuring options for Prometheus and Alertmanager, setting up short-term and long-term storage, and adding service monitors.
When you have completed these configuration activities, users can query and view collected metrics and receive alerts.

* xref:../../observability/monitoring/enabling-monitoring-for-user-defined-projects.adoc#granting-users-permission-to-monitor-user-defined-projects_enabling-monitoring-for-user-defined-projects[Assign monitoring cluster roles] to any non-administrator users that need to access certain monitoring features.
The `monitoring-edit` cluster role permits users to create alerts and to create, modify, and delete `ServiceMonitor` and `PodMonitor` resources to scrape metrics from services and pods.
The `alert-routing-edit` cluster role permits users to route alerts.
* xref:../../observability/monitoring/configuring-the-monitoring-stack.adoc#creating-cluster-monitoring-configmap_configuring-the-monitoring-stack[Create the `cluster-monitoring-config` `ConfigMap` object] if it does not exist.
* xref:../../observability/monitoring/configuring-the-monitoring-stack.adoc#assigning-tolerations-to-monitoring-components_configuring-the-monitoring-stack[Assign tolerations] to monitoring stack components to enable moving them to tainted nodes.
* xref:../../observability/monitoring/configuring-the-monitoring-stack.adoc#setting-the-body-size-limit-for-metrics-scraping_configuring-the-monitoring-stack[Set the body size limit] for metrics collection to help avoid situations in which Prometheus consumes excessive amounts of memory when scraped targets return a response that contains a large amount of data.
* For short-term data retention, xref:../../observability/monitoring/configuring-the-monitoring-stack.adoc#configuring-persistent-storage_configuring-the-monitoring-stack[configure persistent storage] by creating Persistent Volume Claims (PVCs) to provision persistent storage volumes (PVs).
Configure these PVs to be used by Prometheus to store metrics data and by Alertmanager to store alert data. Specify the metrics data retention parameters for Prometheus and Thanos Ruler.
+
[NOTE]
====
By default, a newly installed {product-title} system is configured to fire an alert named `PodStartupStorageOperationsFailing` to remind you that storage is not configured.
You can resolve this alert on the *Alerts* tab in the *Observe* -> *Alerting* section of the {product-title} web console.
====
+
* For long-term data retention, xref:../../observability/monitoring/configuring-the-monitoring-stack.adoc#configuring_remote_write_storage_configuring-the-monitoring-stack[configure the remote write feature] to enable Prometheus to send ingested metrics to remote systems for storage.
Be sure to xref:../../observability/monitoring/configuring-the-monitoring-stack.adoc#adding-cluster-id-labels-to-metrics_configuring-the-monitoring-stack[add cluster ID labels to metrics] for use with your remote write storage configuration.
* xref:../../observability/monitoring/managing-alerts.adoc#managing-core-platform-alerting-rules_managing-alerts[Modify or create alerting rules] for your cluster by defining alerting rules for different conditions based on metrics and labels.
These rules specify the conditions that trigger alerts, such as high CPU or memory usage, network latency, and so forth.
* xref:../../observability/monitoring/managing-alerts.adoc#sending-notifications-to-external-systems_managing-alerts[Configure alert receivers] so that Alertmanager can send alerts to an external notification system such as email, Slack, or PagerDuty.
* xref:../../observability/monitoring/configuring-the-monitoring-stack.adoc#managing-cpu-and-memory-resources-for-monitoring-components[Specify resource limits and requests for monitoring components] to ensure that the containers that run monitoring components have enough CPU and memory resources.
* xref:../../observability/monitoring/managing-metrics.adoc#managing-metrics[Configure ServiceMonitors], which define the set of services and endpoints that Prometheus will scrape for metrics.
Create these ServiceMonitor resources for each service you want to monitor.
These resources specify the labels that identify the target services and the scraping configuration, including the endpoint paths and HTTP ports to scrape.

With the monitoring stack configured to suit your needs, Prometheus will start scraping metrics from the specified services and storing these metrics.
You can now use the collected metrics to monitor your services and applications, to identify performance bottlenecks, and to scale resources as needed:

* You can view dashboards to visualize the collected metrics by xref:../../observability/monitoring/reviewing-monitoring-dashboards.adoc#reviewing-monitoring-dashboards[viewing the *Observe* pages in the {product-title} web console], where you can view and troubleshoot alerts and monitor other information about your cluster.
* You can also xref:../../observability/monitoring/managing-metrics.adoc#about-querying-metrics_managing-metrics[query collected metrics] by creating PromQL queries.

