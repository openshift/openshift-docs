:_mod-docs-content-type: ASSEMBLY
[id="installing-end-to-end-observability"]
= Installing end-to-end observability
include::_attributes/common-attributes.adoc[]
:context: installing-end-to-end-observability

toc::[]

The `ClusterObservability` CRD can be used to install the end-to-end observability stack.

== Distributed tracing

The distributed tracing capability installs the OpenTelemetry Collector, Tempo and the distributed tracing UI plugin.

. Install distributed tracing with `ClusterObservability`.
+
[source,yaml]
----
apiVersion: observability.openshift.io/v1alpha1
kind: ClusterObservability
metadata:
  name: tracing
  namespace: observability # <1>
spec:
  capabilities:
    tracing:
      enabled: true  # <2>
      operators:
        install: true # <3>
      storage:
        objectStorage: <4>
----
<1> Namespace where the `ClusterObservability` CR is created. The namespace should contain the secret(s) referenced in the object storage configuration.
<2> Enable the tracing capability. This will install the OpenTelemetry Collector, Tempo and all necessary configuration.
<3> Installs the operators required by the tracing capability. The default is `true`.
<4> Required object storage configuration for the tracing capability. This is used to store traces in an object storage service.

== Object storage configuration

=== S3

. S3 object storage configuration.
+
[source,yaml]
----
      storage:
        objectStorage:
          s3:
            bucket:  # <1>
            endpoint: # <3>
            accessKeyID: # <4>
            accessKeySecret: # <5>
              name: s3-access-secret
              key: access_key_secret
            region: us-east-1
----

<1> Name of the bucket to store data in.
<2> Endpoint of the S3-compatible object storage service.
<3> Access key ID for the S3-compatible object storage service.
<4> Access key ID for the S3-compatible object storage service.
<5> Secret containing the access key secret for the S3-compatible object storage service.

The secret containing the access key can be created using the following command:

. Set the relevant log level in the `OpenTelemetryCollector` custom resource (CR):
+
[source,bash]
----
kubectl create secret generic s3-access-secret \
--from-literal=access_key_secret="secret"
----

=== S3 with Secure Token Service (STS)

TODO add all object storage types from https://github.com/rhobs/observability-operator/blob/34bf82b9acfb070a9c23275a102f211635531538/docs/clusterobservability.md#L217