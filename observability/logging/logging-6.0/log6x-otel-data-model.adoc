:_mod-docs-content-type: ASSEMBLY
[id="log6x-otel-data-model"]
= OTEL data model
include::_attributes/common-attributes.adoc[]
:context: logging-6x

toc::[]

This document outlines the protocol and semantic conventions for Red Hat OpenShift Logging's OTEL support with Logging v6.1, which is in Technology Preview.

== Forwarding and Ingestion Protocol

Red Hat OpenShift Logging collects and forwards logs to OpenTelemetry endpoints using link:https://opentelemetry.io/docs/specs/otlp/[OTLP]. OTLP encodes, transports, and delivers telemetry data. This product can also deploy Loki storage, which provides an OTLP endpont to ingest log streams. This document defines the semantic conventions for the logs collected from various OpenShift cluster sources.

[NOTE]
====
Logs are forwarded using OTLP or HTTP, as defined by the OpenTelemetry Observability Framework, with Protobuf payloads encoded in JSON format.
====

== Semantic Conventions

The log collector in this solution gathers the following log streams:

* Container logs
* Cluster node journal logs
* Cluster node auditd logs
* Kubernetes and OpenShift API server logs
* OpenShift Virtual Network (OVN) logs

These streams are forwarded according to the sementatic conventions defined by OpenTelemetry semantic attributes. The semantic conventions in OpenTelemetry define a *Resource* as an immutable representation of the entity producing telemetry, identified by *Attributes*. For example, a process running in a container includes attributes such as container_name, cluster_id, pod_name, namespace, and possibly deployment or app_name. These *Attributes* are grouped in the *Resource* object, which helps reduce repetition and optimizes log transmission as telemetry data.

The following sections define the attributes that are generally forwarded.

=== Log Entry Structure

All log streams include the following linK:https://opentelemetry.io/docs/specs/otel/logs/data-model/#log-and-event-record-definition[log data] fields:

The *Applicable Sources* column indicates which log sources each field applies to:

* `all`: This field is present in all logs.
* `container`: This field is present in Kubernetes container logs, both application and infrastructure.
* `audit`: This field is present in Kubernetes, OpenShift API, and OVN logs.
* `auditd`: This field is present in node auditd logs.
* `journal`: This field is present in node journal logs.

[cols="1,1,1", options="header"]
|===
|Name |Applicable Sources |Comment 

|`body`
|all
|

|`observedTimeUnixNano`
|all
|

|`timeUnixNano`
|all
|

|`severityText`
|container, journal
|

|`attributes`
|all
|(Optional) Present when forwarding stream specific attributes
|===

=== Attributes

Log entries include a set of resource, scope, and log attributes based on their source, as described in the following table.

The *Location* column specifies the type of attribute:

* `resource`: Indicates a resource attribute
* `scope`: Indicates a scope attribute
* `log`: Indicates a log attribute

The *Storage* column indicates whether the attribute is stored in a LokiStack using the default `openshift-logging` tenancy mode and specifies where the attribute is stored:

* `stream label`
* `structured metadata`

[cols="1,1,1,1", options="header"]
|===
|Name |Location |Applicable Sources |Storage (LokiStack) |Comment

|`log_source`
|resource
|all
|stream label
|*(DEPRECATED)* Compatibility attribute, contains same information as `openshift.log.source`

|`log_type`
|resource
|all
|stream label
|*(DEPRECATED)* Compatibility attribute, contains same information as `openshift.log.type`

|`kubernetes.container_name`
|resource
|container
|stream label
|*(DEPRECATED)* Compatibility attribute, contains same information as `k8s.container.name`

|`kubernetes.host`
|resource
|all
|stream label
|*(DEPRECATED)* Compatibility attribute, contains same information as `k8s.node.name`

|`kubernetes.namespace_name`
|resource
|container
|stream label
|*(DEPRECATED)* Compatibility attribute, contains same information as `k8s.namespace.name`

|`kubernetes.pod_name`
|resource
|container
|stream label
|*(DEPRECATED)* Compatibility attribute, contains same information as `k8s.pod.name`

|`openshift.cluster_id`
|resource
|all
|stream label
|*(DEPRECATED)* Compatibility attribute, contains same information as `openshift.cluster.uid`

|`openshift.cluster.uid`
|resource
|all
|stream label
|

|`openshift.log.source`
|resource
|all
|stream label
|

|`openshift.log.type`
|resource
|all
|stream label
|

|`openshift.labels.*`
|resource
|all
|stream label
|

|`k8s.node.name`
|resource
|all
|stream label
|

|`k8s.namespace.name`
|resource
|container
|stream label
|

|`k8s.container.name`
|resource
|container
|stream label
|

|`k8s.pod.labels.*`
|resource
|container
|structured metadata
|

|`k8s.pod.name`
|resource
|container
|stream label
|

|`k8s.pod.uid`
|resource
|container
|stream label
|

|`k8s.cronjob.name`
|resource
|container
|structured metadata
|Conditionally forwarded based on creator of Pod

|`k8s.daemonset.name`
|resource
|container
|structured metadata
|Conditionally forwarded based on creator of Pod

|`k8s.deployment.name`
|resource
|container
|structured metadata
|Conditionally forwarded based on creator of Pod

|`k8s.job.name`
|resource
|container
|structured metadata
|Conditionally forwarded based on creator of Pod

|`k8s.replicaset.name`
|resource
|container
|structured metadata
|Conditionally forwarded based on creator of Pod

|`k8s.statefulset.name`
|resource
|container
|structured metadata
|Conditionally forwarded based on creator of Pod

|`log.iostream`
|log
|container
|structured metadata
|

|`k8s.audit.event.level`
|log
|audit
|structured metadata
|

|`k8s.audit.event.stage`
|log
|audit
|structured metadata
|

|`k8s.audit.event.user_agent`
|log
|audit
|structured metadata
|

|`k8s.audit.event.request.uri`
|log
|audit
|structured metadata
|

|`k8s.audit.event.response.code`
|log
|audit
|structured metadata
|

|`k8s.audit.event.annotation.*`
|log
|audit
|structured metadata
|

|`k8s.audit.event.object_ref.resource`
|log
|audit
|structured metadata
|

|`k8s.audit.event.object_ref.name`
|log
|audit
|structured metadata
|

|`k8s.audit.event.object_ref.namespace`
|log
|audit
|structured metadata
|

|`k8s.audit.event.object_ref.api_group`
|log
|audit
|structured metadata
|

|`k8s.audit.event.object_ref.api_version`
|log
|audit
|structured metadata
|

|`k8s.user.username`
|log
|audit
|structured metadata
|

|`k8s.user.groups`
|log
|audit
|structured metadata
|

|`process.executable.name`
|resource
|journal
|structured metadata
|

|`process.executable.path`
|resource
|journal
|structured metadata
|

|`process.command_line`
|resource
|journal
|structured metadata
|

|`process.pid`
|resource
|journal
|structured metadata
|

|`service.name`
|resource
|journal
|structured metadata
|

|`systemd.t.*`
|log
|journal
|structured metadata
|

|`systemd.u.*`
|log
|journal
|structured metadata
|
|===

[NOTE]
====
Attributes marked as *Compatibility attribute* support minimal backward compatibility with the ViaQ data model. These attributes are deprecated and will be removed one release after the *General Availability* of Red Hat OpenShift Logging.
====

[NOTE]
====
Loki changes the attribute names when persisting them to storage. The names will be lowercased, and all characters in the set: (`.`,`/`,`-`) will be replaced by underscores (`_`). For example, `k8s.namespace.name` will become `k8s_namespace_name`.
====

== References

* link:https://opentelemetry.io/docs/specs/semconv/[Semantic Conventions]
* link:https://opentelemetry.io/docs/specs/otel/logs/data-model/[Logs Data Model]
* link:https://opentelemetry.io/docs/specs/semconv/general/logs/[General Logs Attributes]
* link:https://github.com/openshift/enhancements/pull/1684[Cluster Logging OTEL Support]