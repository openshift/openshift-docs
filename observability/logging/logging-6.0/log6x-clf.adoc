:_mod-docs-content-type: ASSEMBLY
include::_attributes/common-attributes.adoc[]
[id="log6x-clf"]
= Configuring log forwarding
:context: logging-6x

toc::[]

The `ClusterLogForwarder` CR serves as a single point of configuration for log forwarding, making it easier to manage and maintain log collection and forwarding rules.

* Defines inputs (sources) for log collection
* Specifies outputs (destinations) for log forwarding
* Configures filters for log processing
* Defines pipelines to route logs from inputs to outputs
* Indicates management state (managed or unmanaged)

// Needs engineering eval re applicability to 6.0
include::modules/log6x-forwarder-feature.adoc[leveloffset=+1]

// This needs to be called out extensively.
[source,yaml]
----
apiVersion: observability.openshift.io/v1
kind: ClusterLogForwarder
metadata:
  name: <clf-name>
spec:
  managementState: <Managed|Unmanaged>
  collector:
    nodeSelector:
    resources:
    tolerations:
  inputs:
    - application:
        excludes:
        includes:
        selector:
        tuning:
      name: <name>
      type: <application>
    - infrastructure:
        sources:
          - container
          - node
      name: <name>
      type: infrastructure
    - audit:
        sources:
          - auditd
          - kubeAPI
          - openshiftAPI
          - ovn
      name: <name>
      type: audit
    - receiver:
        http:
        port:
        tls:
        type: <http|syslog>
      name: <name>
      type: receiver
  filters:
    - name: <name>
      type: detectMultilineException
    - name: <name>
      type: parse
    - openShiftLabels:
        <key>: <value>
      name: <name>
      type: openShiftLabels
    - drop:
      - test:  
      type: drop
    - kubeAPIAudit:
        omitResponseCodes:
        omitStages:
        rules:
      name: <name>
      type: kubeAPIAudit
    - prune:
        in:
        notin:
      name: <name>
      type: prune
  outputs:
    - azureMonitor:
        authentication:
          sharedKey:
        customerId: <spaceID>
      name: <name>
      type: azureMonitor
    - cloudwatch:
        authentication:
          type: <awsAccessKey|iamRole>
        groupName: {.log_type||"default"}
        region: us-east-2
      name: <name>
      type: cloudwatch
    - elasticsearch:
        index: {.log_type|"default"}
        url: <url>
      name: <name>
      type: elasticsearch
    - http:
        authentication:
          username:
          password:
          token:
        url: <url>
      name: <name>
      type: http
    - kafka:
        authentication:
          sasl:
        brokers:
        topic:
        url: <url>
      name: <name>
      type: kafka
    - loki:
        authentication:
        labelKeys:
        tenantKey:
        url: <url>
      name: <name>
      type: loki
    - lokiStack:
        authentication:
        target:
      name: <name>
      type: lokiStack
    - googleCloudLogging:
        authentication: 
        id:
        logId:
      name: <name>
      type: googleCloudLogging
    - splunk:
        authentication: 
        index: '{.log_type|""}'
        url: <url>
      name: <name>
      type: splunk
    - syslog
        rfc:
        url: 
      name: <name>
      type: splunk
    - otlp:
        authentication: 
        url:
      name: <name>
      type: splunk
  pipelines:
    - inputRefs:
        - <input-name>
        - application
        - infrastructure
        - audit
      name: <pipeline-name>
      filterRefs:
        - <filter-name1>
        - <filter-namex>
      outputRefs:
        - <output-name>
  serviceAccount:
    name: <account-name>
----

// All of these need to be validated by engineering for 6.0.
include::modules/log6x-audit-log-filtering.adoc[leveloffset=+1]

include::modules/log6x-content-filter-drop-records.adoc[leveloffset=+1]

include::modules/log6x-content-filter-prune-records.adoc[leveloffset=+1]

include::modules/log6x-input-spec-filter-audit-infrastructure.adoc[leveloffset=+1]

include::modules/log6x-input-spec-filter-labels-expressions.adoc[leveloffset=+1]

include::modules/log6x-input-spec-filter-namespace-container.adoc[leveloffset=+1]

include::modules/log6x-multiline-except.adoc[leveloffset=+1]

[id="log6x-CLF-samples_{context}"]
== Use case samples
// Should be an include, create: modules/log6x-use-metric-export.adoc - Associated JIRA?
* Log File Metric Exporter as a Separate Deployment