= Image Metadata
{product-author}
{product-version}
:data-uri:
:icons:
:experimental:
:toc: macro
:toc-title:

toc::[]

== Constraints and Assumptions

For the time being, there is no good way to define metadata for Docker
images other than specifying extra environment variables. There is upstream
work currently being done to fix this situation and we should switch to that in
the implementation in the future.

This document only defines the metadata needed by the current set of use cases.
Additional metadata and/or use cases may be added in the future.

== How to define metadata for Docker images

Right know, the only method is it use the `ENV` instruction in the Dockerfile.
This instruction is used to define environment variables that are available
inside the container and the application running in container can consume it.

The environment variables are also available in the Docker image JSON
representation, where the platform can see them and use them.

== Supported metadata variables

=== IMAGE_TAGS

This metadata variable contains a list of tags. The tags are the way to
categorize Docker images into broad areas of functionality. Tags help UI and
generation tools to suggest relevant Docker images during the application
creation process.

Example format:

----
IMAGE_TAGS=database,mysql
----

=== IMAGE_WANTS

Specifies a list of tags that generation tools and UI might suggest to provide
if you don't have the Docker images with given tags already. For example, if the
Docker image wants 'mysql' and 'redis' and you don't have the Docker image with
'redis' tag, then UI might suggest you to add this image into your application.

The format of the values is the same as for `IMAGE_TAGS`.

=== IMAGE_DESCRIPTION

This variable is used to give the image consumers more detailed description
about the service or functionality given image provides. The UI can use this
description together with the image name to give users more informations about
the image.

Example:

----
IMAGE_DESCRIPTION="MySQL 5.5 database"
----

=== IMAGE_EXPOSE_SERVICES

This variable contains a list of ports that match with the EXPOSE instructions
in Dockerfile and provide more descriptive information about what actual service
the given port provides.

The format is `PORT[/PROTO]:SERVICE_NAME` where the `[PROTO]` part is optional
and it defaults to `tcp` if it is not specified.

Example:

----
IMAGE_EXPOSE_SERVICES="3128/tcp:mysql,8080:http"
----

=== IMAGE_NON_SCALABLE

An image might use this variable to suggest that it does not support scaling.
The UI will then communicate this to consumers of that image.
Being not-scalable basically means that the value of 'replicas' should initially
not be set higher than 1.

=== IMAGE_MIN_CPU and IMAGE_MIN_MEMORY

This variable suggests how much resources the Docker image might need in order
to work properly. The UI might warn the user that deploying this Docker image
may exceed the user quota.

The values must be compatible with [Kubernetes
quantity](https://github.com/GoogleCloudPlatform/kubernetes/blob/master/docs/resources.md#resource-quantities) values for CPU and memory.

Examples:

----
IMAGE_MIN_MEMORY=8Gi
IMAGE_MIN_CPU=4
----
