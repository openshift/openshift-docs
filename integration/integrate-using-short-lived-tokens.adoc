:_mod-docs-content-type: ASSEMBLY
[id="integrate-using-short-lived-tokens"]
= Integrating RHACS using short-lived tokens
include::modules/common-attributes.adoc[]
:context: integrate-using-short-lived-tokens

toc::[]

[role="_abstract"]
With {rh-rhacs-first} you can authenticate against selected cloud provider APIs using short-lived tokens. {product-title-short} supports the following cloud provider integrations:

* Amazon Web Services (AWS) using the Secure Token Service (STS)
* Google Cloud Platform (GCP) using workload identity federation
* Microsoft Azure using Microsoft Entra ID with managed identities

{product-title-short} supports short-lived token integrations only when you install {product-title-short} on the following platforms:

* Elastic Kubernetes Service (EKS) on AWS
* Google Kubernetes Engine (GKE) on GCP
* Microsoft Azure Kubernetes Service (AKS)
* {ocp}

To activate short-lived authentication, you must establish trust between your Kubernetes or {ocp} cluster and your cloud provider. For EKS, GKE and AKS clusters, use the cloud provider metadata service. For {ocp} clusters, you need a publicly available OpenID Connect (OIDC) provider bucket containing the {ocp} service account signer key.

[NOTE]
====
You must establish trust with your cloud provider for every Central cluster that uses the short-lived token integration. However, if you use delegated scanning in combination with short-lived token image integrations, you must also establish trust for the Sensor cluster.
====

== Configuring AWS Secure Token Service

{product-title-short} integrations can authenticate against Amazon Web Services using
the link:https://docs.aws.amazon.com/STS/latest/APIReference/welcome.html[Secure Token Service]. You must configure `AssumeRole` with {product-title-short} before enabling the *Use container IAM role* option in integrations.

[IMPORTANT]
====
Verify that the AWS role associated with the {product-title-short} pod must have the IAM permissions required by the integration. For example, to set up a container role for integrating with the Elastic Container Registry, enable full read access to the registry. For more information about AWS IAM roles, see link:https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles.html[IAM roles].
====

include::modules/aws-secure-token-service-eks.adoc[leveloffset=+2]
include::modules/aws-secure-token-service-openshift.adoc[leveloffset=+2]

== Configuring Google workload identity federation

{product-title-short} integrations can authenticate against the Google Cloud Platform by using link:https://cloud.google.com/iam/docs/workload-identity-federation[workload identities]. Select the *Use workload identity* option upon creation to enable workload identity authentication in a Google Cloud integration.

[IMPORTANT]
====
The Google service account associated with the {product-title-short} pod through the workload identity must have the IAM permissions required by the integration. For example, to set up a workload identity for integrating with Google Artifact Registry, connect a service account with the *roles/artifactregistry.reader* role. For more information about Google IAM roles see link:https://cloud.google.com/artifact-registry/docs/access-control[Configure roles and permissions].
====

include::modules/google-workload-identity-federation-gke.adoc[leveloffset=+2]
include::modules/google-workload-identity-federation-openshift.adoc[leveloffset=+2]

== Configuring Microsoft Entra ID federation

{product-title-short} integrations can authenticate to Microsoft Azure by using managed or workload identities.
Select the *Use workload identity* checkbox during the creation of a new Microsoft Azure Container Registry (ACR) integration, if you want to enable authentication by using  managed or workload identities in a Microsoft Azure integration.

For more information about Azure managed identities, see link:https://learn.microsoft.com/en-us/entra/identity/managed-identities-azure-resources/overview[What are managed identities for Azure resources?] (Microsoft Azure documentation).

For more information about Azure workload identities, see link:https://learn.microsoft.com/en-us/entra/workload-id/workload-identity-federation[Workload identity federation] (Microsoft Azure documentation).

[IMPORTANT]
====
The identity associated with the {product-title-short} pod through the workload identity must have the IAM permissions for the integration. For example, to set up a workload identity for integrating with Microsoft ACR, assign the *Reader* role over a scope that includes the registry.

For more information about Microsoft Azure IAM roles, see link:https://learn.microsoft.com/en-us/azure/role-based-access-control/[Azure RBAC documentation] (Microsoft Azure documentation).
====

include::modules/azure-workload-identity-federation-aks.adoc[leveloffset=+2]
include::modules/azure-workload-identity-federation-openshift.adoc[leveloffset=+2]
