:_mod-docs-content-type: ASSEMBLY
[id="integrate-with-ci-systems"]
= Integrating with CI systems
include::modules/common-attributes.adoc[]
:context: integrate-with-ci-systems

toc::[]

[role="_abstract"]

{product-title} ({product-title-short}) integrates with a variety of continuous integration (CI) products. Before you deploy images, you can use {product-title-short} to apply build-time and deploy-time security rules to your images.

After images are built and pushed to a registry, {product-title-short} integrates into CI pipelines. Pushing the image first allows developers to continue testing their artifacts while dealing with any policy violations alongside any other CI test failures, linter violations, or other problems.

If possible, configure the version control system to block pull or merge requests from being merged if the build stage, which includes {product-title-short} checks, fails.

The integration with your CI product functions by contacting your {product-title-short} installation to check whether the image complies with build-time policies you have configured. If there are policy violations, a detailed message is displayed on the console log, including the policy description, rationale, and remediation instructions.

Each policy includes an optional enforcement setting. If you mark a policy for build-time enforcement, failure of that policy causes the client to exit with a nonzero error code.

To integrate {product-title} with your CI system, follow these steps:

. xref:../integration/integrate-with-ci-systems.adoc#configure-build-policies[Configure build policies].
. xref:../integration/integrate-with-ci-systems.adoc#configure-registry-integration[Configure a registry integration].
. xref:../integration/integrate-with-ci-systems.adoc#configure-access[Configure access] to your {product-title-short} instance.
. xref:../integration/integrate-with-ci-systems.adoc#integrate-with-your-ci-pipeline[Integrate with your CI pipeline].

[id="configure-build-policies"]
== Configuring build policies

You can check {product-title-short} policies during builds.

.Procedure

. Configure policies in {product-title-short} that apply to the build stage of the container lifecycle.
. Integrate {product-title-short} with the registry that images are pushed to during the build.
.. In your CI system, configure {product-title-short} to check your builds against policies by using an {product-title-short} token to connect to {product-title-short} and run the `roxctl image check` command. This command queries Central and Scanner to check the input image against a set of policies. If the image violates any build-time policy of the requested policy set, which is by default all policies, then the FAIL_BUILD_ENFORCEMENT flag is set. The check result is an error with the return code of 1.
.. Configure your CI system to fail the build if the `roxctl image check` command returns an error code of `1`.

[role="_additional-resources"]
.Additional resources

* xref:..//operating/manage_security_policies/custom-security-policies.adoc#custom-security-policies[Creating and modifying security policies]
* xref:../integration/integrate-with-image-registries.adoc#integrate-with-image-registries[Integrating with image registries]

include::modules/integrate-ci-check-existing-build-phase-policies.adoc[leveloffset=+2]

include::modules/

include::modules/policy-enforcement-deploy.adoc[leveloffset=+2]

[role="_additional-resources"]
.Additional resources

* xref:../operating/manage_security_policies/use-admission-controller-enforcement.adoc#use-admission-controller-enforcement[Using admission controller enforcement]

[id="configure-registry-integration"]
== Configuring registry integration

To scan images, you must provide {product-title} with access to the image registry you are using in your build pipeline.

include::modules/check-for-existing-registry-integration.adoc[leveloffset=+2]

[role="_additional-resources"]
=== Additional resources
* xref:../integration/integrate-with-image-registries.adoc#integrate-with-image-registries[Integrating with image registries]

[id="configure-access"]
== Configuring access

{product-title-short} provides the `roxctl` command-line interface (CLI) to make it easy to integrate {product-title-short} policies into your build pipeline.
The `roxctl` CLI prints detailed information about problems and how to fix them so that developers can maintain high standards in the early phases of the container lifecycle.

To securely authenticate to the {product-title} API server, you must create an API token.

include::modules/cli-authentication.adoc[leveloffset=+2]

[id="install-roxctl-cli-binary"]
=== Installing the roxctl CLI by downloading the binary

You can install the `roxctl` CLI to interact with {product-title} from a
command-line interface. You can install `roxctl` on Linux, Windows, or macOS.

// Installing the CLI by downloading the binary
include::modules/install-roxctl-cli-linux.adoc[leveloffset=+3]
include::modules/install-roxctl-cli-macos.adoc[leveloffset=+3]
include::modules/install-roxctl-cli-windows.adoc[leveloffset=+3]

// Running the CLI by using a container image
include::modules/run-roxctl-from-container.adoc[leveloffset=+2]

[id="integrate-with-your-ci-pipeline"]
== Integrating with your CI pipeline

After you have finished these procedures, the next step is to integrate with your CI pipeline.

Each CI system might require a slightly different configuration.

[id="using-jenkins"]
=== Using Jenkins

Use the link:https://plugins.jenkins.io/stackrox-container-image-scanner[StackRox Container Image Scanner] Jenkins plugin for integrating with Jenkins.
You can use this plugin in both Jenkins freestyle projects and pipelines.

include::modules/integrate-circle-ci.adoc[leveloffset=+2]