= Red Hat JBoss A-MQ xPaaS Image
{product-author}
{product-version}
:data-uri:
:icons:
:experimental:

Red Hat JBoss A-MQ (JBoss A-MQ) is available as a containerized xPaaS image that is designed for use with OpenShift v3. It allows developers to quickly deploy an A-MQ message broker in a hybrid cloud environment.

[IMPORTANT]
There are significant differences in supported configurations and functionality in the JBoss A-MQ image compared to the regular release of JBoss A-MQ.

This topic details the differences between the JBoss A-MQ xPaaS image and the regular release of JBoss A-MQ, and provides instructions specific to running and configuring the JBoss A-MQ xPaaS image. Documentation for other JBoss A-MQ functionality not specific to the JBoss A-MQ xPaaS image can be found in the https://access.redhat.com/documentation/en-US/Red_Hat_JBoss_A-MQ/[JBoss A-MQ documentation on the Red Hat Customer Portal].

== Differences Between the JBoss A-MQ xPaaS Image and the Regular Release of JBoss A-MQ

There are several major functionality differences in the OpenShift JBoss A-MQ xPaaS image:

* The Karaf shell is not available.
* The Fuse Management Console (Hawtio) is not available.
* Configuration of the broker can be performed:
** using parameters specified in the A-MQ application template, as described in xref:configuring-params[Application Template Parameters].
** using the STI (Source-to-image) tool, as described in xref:configuring-sti[Configuration Using STI].


== Installing the JBoss A-MQ xPaaS Images

To use the Red Hat xPaaS middleware images in your OpenShift project, you must first install the image streams and source-to-image (S2I) application templates.

. In a terminal, change into the root directory of your OpenShift master. It should contain the 'examples' subdirectory.
. Create the image stream from which the A-MQ image will be obtained:
+
----
# oc create -f examples/application-templates/jboss-image-streams.json -n <project>
----
. Create the S2I templates for your A-MQ application:
+
----
# oc create -f examples/application-templates/amq/amq6.json -n <project>
# oc create -f examples/application-templates/amq/amq6-persistence.json -n <project>
----

You will now have the JBoss A-MQ xPaaS images stream and S2I application templates available for use in your OpenShift project. 

To create an application based on the template, follow instructions in the *Creating a Configuration From a Template* section of the link:../dev_guide/templates.html[Creating New Applications] topic in the OpenShift documentation. For a reference on template parameters specified when creating the application, see the xref:configuring-params[Application Template Parameters] section below.

== Configuring the JBoss A-MQ Image

[[configuring-params]]
=== Application Template Parameters

Basic configuration of the JBoss A-MQ xPaaS image is performed by specifying values of application template parameters. The following parameters can be configured:

AMQ_RELEASE::
  The JBoss A-MQ release version. This determines which JBoss A-MQ image will be used as a basis for the application. At the moment, only version _6.2_ is available.
APPLICATION_NAME::
  The name of the application used internally in OpenShift. It is used in names of services, pods and other objects within the application.
MQ_USERNAME::
  The user name used for authentication to the broker. In a standard non-containerized JBoss A-MQ, you would specify the user name in the 'AMQ_HOME/opt/user.properties' file. If no value is specified, a random user name is generated.
MQ_PASSWORD::
  The password used for authentication to the broker. In a standard non-containerized JBoss A-MQ, you would specify the password in the 'AMQ_HOME/opt/user.properties' file. If no value is specified, a random password is generated.
MQ_PROTOCOL::
  Comma-separated list of the messaging protocols used by the broker. Available options are _amqp_, _mqtt_, _openwire_, and _stomp_. If left empty, all available protocols will be available. Please note that for integration of the image with Red Hat JBoss Enterprise Application Platform, the _openwire_ protocol must be specified, while other protocols can be optionally specified as well.
MQ_QUEUES::
  Comma-separated list of queues available by default on the broker on its startup.
MQ_TOPICS::
  Comma-separated list of topics available by default on the broker on its startup.

[[configuring-sti]]
=== Configuration Using STI

Configuration of the JBoss A-MQ image can also be modified using the Source-to-image feature, described in full detail at link:../s2i_images/overview.html[Source-to-image (S2I)].

Custom A-MQ broker configuration can be specified by creating an 'openshift-activemq.xml' file inside the 'git' directory of your application's Git project root. On each commit, the file will be copied to the 'conf' directory in the A-MQ root and its contents used to configure the broker.

== Security

Only SSL connections can connect from outside of the OpenShift instance, regardless of the protocol specified in the _MQ_PROTOCOL_ property of the A-MQ application templates. The non-SSL version of the protocols can only be used inside the OpenShift instance.

For security reasons, using the default KeyStore and TrustStore generated by the system is discouraged. It is recommended to generate your own KeyStore and TrustStore and supply them to the image using the OpenShift secrets mechanism or STI.

== Scalability

It is possible to run multiple JBoss A-MQ containers on a single OpenShift instance at the same time. However, real-time scalability is not supported as messages stored on a discarded broker would be lost when downscaling.

== Logging

In addition to viewing the OpenShift logs, you can troubleshoot a running JBoss A-MQ image by viewing the JBoss A-MQ logs that are outputted to the container's console:

----
oc logs -f <pod_name> <container_name>
----

[NOTE]
By default, the OpenShift JBoss A-MQ xPaaS image does not have a file log handler configured. Logs are only sent to the console.

