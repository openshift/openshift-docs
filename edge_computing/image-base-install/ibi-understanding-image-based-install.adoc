:_mod-docs-content-type: ASSEMBLY
[id="ibi-image-based-install_{context}"]
= Understanding an image-based installation for {sno} clusters
include::_attributes/common-attributes.adoc[]
:context: ibi-understanding-image-based-install

toc::[]

Image-based installations streamline the deployment process for {sno} clusters, reducing both installation and deployment times. By leveraging an image-based approach, you can preinstall configured and validated instances of {sno} on target hosts. These prepared hosts can be rapidly reconfigured and deployed at the far edge of the network with minimal intervention.

== Understanding an image-based installation and deployment for {sno} clusters

Service providers continue to deploy their infrastructure at the far edge of the network. However, this presents challenges in terms of the cost, time, and expertise needed for installing and deploying {sno} clusters at remote sites on an enterprise scale.

At the far edge of the network, challenges such as low bandwidth and high latency can increase installation times and complicate {sno} cluster deployments. These circumstances require experienced technicans to spend considerable time at remote sites, overseeing the installation and deployment of a {sno} cluster.

An image-based installation and deployment overcomes the deficiencies of this workflow by separating the installation and deployment stages for {sno} clusters. Using an image-based installation, you can preinstall multiple hosts with {sno} at a central site, such as a service depot or a factory.
You can also validate the base configuration for these hosts and leverage the image-based approach to perform reproducible factory installs at scale using a single container image.
The preinstalled and validated hosts are shipped to a remote site where they can be rapidly reconfigured and deployed in a matter of minutes.

.Overview of an image-based installation and deployment for {sno} clusters
image::../images/711_OpenShift_IBI_Installation_high-level_0624.png[][Overview of an image-based installation and deployment]

=== Image-based installation for {sno} clusters
Using the {lcao}, you can generate an OCI container image that encapsulates an instance of a {sno} cluster. This image is derived from a dedicated cluster that you can configure with the target {product-title} version.  

You can reference this image in a live installation ISO to consistently preinstall configured and validated instances of {sno} to multiple hosts. This approach enables the preparation of hosts at a central location, for example in a factory or service depot, before shipping the preinstalled hosts to a remote site for rapid reconfiguration and deployment. 

The following is a high-level overview of the image-based installation process:

* Generate an image from a {sno} cluster.
* Use the {lcao} to embed the seed image URL, and other installation artifacts, in a live installation ISO.
* Restart the host using the live installation ISO to preinstall the host. 
+
During this process, the installation program installs {op-system-first} to the disk, pulls the image you generated, and precaches release container images to the disk.

* When the installation completes, the host is ready to ship to the remote site for rapid reconfiguration and deployment.

=== Imaged-based deployment for {sno} clusters
{rh-rhacm-first} and the multicluster engine for Kubernetes operator (MCE) use a hub-and-spoke approach to manage and deploy {sno} clusters across multiple sites. Using this approach, the hub cluster serves as a central control plane that manages the spoke clusters, which are often remote {sno} clusters deployed at the far edge of the network.

The hub cluster is responsible for defining and distributing configuration resources, policies, and updates to the spoke clusters. The configuration resources defined in the hub cluster ensure consistency and compliance across all spoke clusters from a single point of administration.

An image-based installation and deployment combines the benefits of the hub-and-spoke approach with an image-based approach. Preinstalled hosts from an image-based installation require minimal configuration details to deploy a managed {sno} cluster at a remote site. This approach is especially beneficial for telecommunications providers and other service providers with extensive, distributed infrastructures, where manual installation would be time-consuming and costly.

The following is a high-level overview of the image-based deployment process for hosts preinstalled with an imaged-based installation:

* Define the site-specific configuration resources for the preinstalled host in the hub cluster.
* Apply these resources in the hub cluster. This initiates the deployment process.
* The IBI Operator creates a configuration ISO.
* The IBI Operator boots the target preinstalled host with the configuration ISO attached.
* The host mounts the configuration ISO and begins the reconfiguration process.
* When the reconfiguration completes, the {sno} cluster is ready.

As the host is already preinstalled using an image-based installation, a technician can reconfigure and deploy the host in a matter of minutes.

== Image-based installation and deployment key components

The following content describes key components in image-based installation and deployments.

Seed image:: A seed image is an OCI container image generated from a dedicated cluster with the target {product-title} version. 

Seed cluster:: A seed cluster is a dedicated {sno} cluster that you use to create a seed image and is deployed with the target {product-title} version.

{lcao}:: In image-based installations, you can use the {lcao} to generate a seed image, embed the seed image URL in a live installation ISO, and reconfigure the host during a deployment at a remote site.

`ib-cli` CLI tool:: Extract the binary for the `ib-cli` CLI tool from the {lcao}. Use the `ib-cli` CLI tool to create a live installation ISO for preinstalling {sno} on bare-metal hosts.

Image Based Install (IBI) Operator:: The IBI Operator creates a configuration ISO from the site-specific resources you define in the hub cluster, attaches the configuration ISO to the remote host using a bare-metal provisioning service.

include::modules/ibi-image-based-install-cluster-guide.adoc[leveloffset=+1]


include::modules/ibi-validated-software-versions.adoc[leveloffset=+1]

////
Possibly repeating myself with the below content, so I've commented it out for now. Perhaps I could add more detail to the above sections instead.

== Image-based installation with zero touch configuration end-to-end workflow

The following steps details the high-level workflow from installation at a core location to final configuration at a remote site. 

.Generate a seed image
Image-based installations require a seed image generated from a seed cluster with the target {product-title} version.

The seed image provides a reproducible version of a {sno} cluster that you can use to preinstall {sno} to hosts. You can adjust the seed image by adjusting the seed cluster. You can use this approach to validate the instance of {sno} based on a desired cluster configuration before creating the seed image.

.Embed the seed image URL in an installation ISO 
To boot the host with the seed image, you must create a live installation ISO. The {lcao} features the `ib-cli` CLI tool binary, which you can use to create the live installation ISO. `ib-cli` takes the seed image URL and other inputs and creates a live ISO featuring {op-system} that you can attach to a specific disk on the host.

.Boot the ISO to target hosts
Using you're preferred method, you can attach the ISO to the target hosts. When you boot the host from the installation ISO, the {lcao} completes the following tasks:

* Installs {op-system} to disk
* An extra partition is created to store precached release images
* Grows the specified partition to occupy all available space on the disk
* Mounts the filesystem to the partition to enable access to {op-system}
* Pulls the seed image and creates a state root with its content
* Optional: precaches the release images on the disk

The host is then ready for deployment at the remote site.

.Deploy the cluster at a remote site with zero touch configuration
Create configuration resources on the hub cluster containing the site-specific cluster configuration details for the host. These include the `BareMetalHost`, `ImageClusterInstall`, and `ClusterDeployment` resources. 

The IBI Operator creates a configuration ISO from these configuration resources. The Operator then boots the host with the configuration ISO attached. The node mounts the configuration ISO and runs the reconfiguration process. When the reconfiguration completes, the {sno} cluster is ready. As the host is already preinstalled using an image-based installation, a technician can deploy the host using ZTC in a matter of minutes.
////

[role="_additional-resources"]
.Additional resources

* link:https://access.redhat.com/documentation/en-us/red_hat_advanced_cluster_management_for_kubernetes/2.7/html/about/welcome-to-red-hat-advanced-cluster-management-for-kubernetes#multicluster-architecture[Multicluster architecture]

* link:https://docs.openshift.com/container-platform/4.16/edge_computing/image_based_upgrade/cnf-understanding-image-based-upgrade.html[Understanding the image-based upgrade for single-node OpenShift clusters]