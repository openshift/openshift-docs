:_mod-docs-content-type: ASSEMBLY
include::_attributes/common-attributes.adoc[]
[id="upgrading-to-logging-6"]
= Upgrading to logging 6

:context: upgrading-to-logging-6

toc::[]

[id="changes-in-logging-6_{context}"]
== An overview of changes in Logging 6

Logging 6 is a significant upgrade from earlier releases, achieving several longstanding goals of Cluster Logging. Following are some of the notable changes:

Introduction of distinct Operators to manage logging components::

* {clo} manages both collection and forwarding.
* {loki-op} manages storage.
* {coo-first} manages visualization.

Removal of support for managed log storage and visualization based on Elastic products::

* Elasticsearch is replaced with Loki.
* Kibana is replaced with the UIplugin provided by {coo-short}.

Removal of the Fluentd log collector implementation::
Vector is now the supported collection service.

API change for log collection and forwarding::
* The API for log collection is changed from `logging.openshift.io` to `observability.openshift.io`.
* `ClusterLogForwarder` and `ClusterLogging` have been combined under the `ClusterLogForwarder` resource in the new API.

[id="steps-for-upgrading-logging-5-to-6_{context}"]
== An overview of steps for upgrading Logging 5 to 6
The broad steps to upgrade Logging 5 to Logging 6 are as follows:

. Ensure that you are not using any deprecated resources. For more information, see "Preparation for upgrading to Logging 6".
. Migrate log visualization from Kibana to {coo-first}. For more information, see "Migrating logging visualization". 
. Upgrade log storage. For more information, see "Upgrading log storage".
. Upgrade log collection and forwarding. For more information, see "Upgrading log collection and forwarding".
. Finally, delete resources that you no longer need. For more information, see "Deleting old resources".

[id="preparation-for-upgrading-to-logging-6_{context}"]
== Preparation for upgrading to Logging 6

Before being able to upgrade to Logging 6 from Logging 5, you must first ensure that you are not using any deprecated resources. Therefore, if you haven't already, you must make the following migrations:

* Migrate collection service from Fluentd to Vector.
For more information, see https://access.redhat.com/articles/6999658[how to migrate Fluentd to Vector in Red Hat OpenShift Logging 5.5+ versions]. 

* Migrate storage from Elasticsearch to LokiStack. For more information, see "Migrating storage from Elasticsearch to LokiStack".

include::modules/migrating-storage-from-elasticsearch-to-lokistack.adoc[leveloffset=+2]


[id="migrating-logging-visualization_{context}"]
== Migrating logging visualization

The OpenShift console UI plugin for log visualization is moved to the {coo-full} from the Cluster Logging Operator.

include::modules/deleting-the-logging-view-plugin.adoc[leveloffset=+2]

include::modules/installing-the-logging-ui-plug-in-gui.adoc[leveloffset=+2]

[id="log-storage_{context}"]
== Upgrading log storage

The only managed log storage solution available in this release is a LokiStack, managed by the {loki-op}. This solution, previously available as the preferred alternative to the managed Elasticsearch offering, remains unchanged in its deployment process.

[IMPORTANT]
====
To continue using an existing Red{nbsp}Hat-managed Elasticsearch or Kibana deployment provided by the `elasticsearch-operator`, remove the owner references from the `Elasticsearch` resource named `elasticsearch`, and  the `Kibana` resource named `kibana` in the `openshift-logging` namespace before removing the `ClusterLogging` resource named `instance` in the same namespace.
====

To upgrade Loki storage, follow these steps:

. Update the {loki-op}. For more information, see "Updating the {loki-op}".

. Upgrade the LokiStack storage schema. For more information, see "Upgrading the LokiStack storage schema".

include::modules/logging-upgrading-loki.adoc[leveloffset=+2]

include::modules/logging-upgrading-loki-schema.adoc[leveloffset=+2]

[id="log-collection-and-forwarding_{context}"]
== Upgrading log collection and forwarding

Log collection and forwarding configurations are now specified under the new link:https://github.com/openshift/cluster-logging-operator/blob/master/docs/reference/operator/api_observability_v1.adoc[API], part of the `observability.openshift.io` API group. 

[NOTE]
====
Vector is the only supported collector implementation.
====

To upgrade the {clo}, follow these steps:

. Update the log collection and forwarding configurations by going through the changes listed in "Changes to Cluster logging and forwarding in Logging 6".
. Update the {clo}.

include::modules/changes-to-cluster-logging-and-forwarding-in-logging-6.adoc[leveloffset=+2]

include::modules/logging-upgrading-clo.adoc[leveloffset=+2]

[id="deleting-old-resources_{context}"]
== Deleting old resources

include::modules/deleting-the-clusterlogging-instance.adoc[leveloffset=+2]

include::modules/deleting-red-hat-openshift-logging-5-crd.adoc[leveloffset=+2]

include::modules/uninstalling-elasticsearch.adoc[leveloffset=+2]
