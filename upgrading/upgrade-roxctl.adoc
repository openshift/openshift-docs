:_content-type: ASSEMBLY
[id="upgrade-roxctl"]
= Manually upgrading using the roxctl CLI
include::modules/common-attributes.adoc[]
:context: upgrade-roxctl

toc::[]

[role="_abstract"]
You can upgrade to the latest version of {product-title} from a supported older version.

To upgrade {product-title} to the latest version, you must perform the following:

* Set the `ROX_SCANNER_DB_INIT` environment variable
* Backup the Central database
* Upgrade Central
* Upgrade the `roxctl` CLI
* Upgrade Scanner
* Verify that all secured clusters are upgraded

include::modules/set-rox-scanner-init-db-env-variable.adoc[leveloffset=+1]

include::modules/back-up-central-database.adoc[leveloffset=+1]

[role="_additional-resources"]
.Additional resources
* xref:../cli/getting-started-cli.adoc#cli-authentication_cli-getting-started[Authenticating using the `roxctl` CLI]

[id="upgrade-central-cluster"]
== Upgrading the Central cluster

After you have backed up the Central database, the next step is to upgrade the Central cluster. This step includes upgrading Central, the `roxctl` CLI, and the Scanner.

[id="upgrade-central"]
=== Upgrading Central

You can update Central to the latest version by downloading and deploying the updated images.

include::modules/upgrade-central-openshift.adoc[leveloffset=+3]

include::modules/upgrade-central-kubernetes.adoc[leveloffset=+3]

[id="upgrade-roxctl-cli"]
=== Upgrading the roxctl CLI

To upgrade the `roxctl` CLI to the latest version you must uninstall the existing version of `roxctl` CLI and then install the latest version of the `roxctl` CLI.

include::modules/uninstall-roxctl-cli.adoc[leveloffset=+3]
include::modules/install-roxctl-cli-linux.adoc[leveloffset=+3]
include::modules/install-roxctl-cli-macos.adoc[leveloffset=+3]
include::modules/install-roxctl-cli-windows.adoc[leveloffset=+3]

After you upgrade the `roxctl` CLI you can upgrade Scanner.

include::modules/upgrade-scanner.adoc[leveloffset=+2]
include::modules/upgrade-scanner-roxctl-371.adoc[leveloffset=+3]

include::modules/verify-central-cluster-upgrade.adoc[leveloffset=+2]

[id="upgrade-secured-clusters"]
== Upgrading all secured clusters

After upgrading Central services, you must upgrade all secured clusters.

[IMPORTANT]
====
* If you are using automatic upgrades:
** Update all your secured clusters by using automatic upgrades.
** Skip the instructions in this section and follow the instructions in the xref:../upgrading/upgrade-roxctl.adoc#verify-upgrades_{context}[Verify upgrades] and xref:../upgrading/upgrade-roxctl.adoc#revoke-the-api-token_{context}[Revoking the API token] sections.
* If you are not using automatic upgrades, you must run the instructions in this section on all secured clusters including the Central cluster.
** To ensure optimal functionality, use the same {product-title-short} version for your secured clusters and the cluster on which Central is installed.
====

To complete manual upgrades of each secured cluster running Sensor, Collector, and Admission controller, follow the instructions in this section.

include::modules/update-validating-webhook-configuration.adoc[leveloffset=+2]

include::modules/update-other-images.adoc[leveloffset=+2]

include::modules/verify-secured-cluster-upgrade.adoc[leveloffset=+2]

[id="rollback-central"]
== Rolling back Central

You can roll back to a previous version of Central if the upgrade to a new version is unsuccessful.

include::modules/rollback-central-normal.adoc[leveloffset=+2]

include::modules/rollback-central-forced.adoc[leveloffset=+2]

include::modules/verify-upgrades.adoc[leveloffset=+1]

include::modules/revoke-the-api-token.adoc[leveloffset=+1]
