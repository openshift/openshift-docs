:_mod-docs-content-type: ASSEMBLY
[id="upgrade-roxctl"]
= Manually upgrading using the `roxctl` CLI
include::modules/common-attributes.adoc[]
:context: upgrade-roxctl

toc::[]

[role="_abstract"]
You can upgrade to the latest version of {rh-rhacs-first} from a supported older version.

[IMPORTANT]
====
* You need to perform the manual upgrade procedure only if you used the `roxctl` CLI to install {product-title-short}.
* There are manual steps for each version upgrade that must be followed, for example, from version 3.74 to version 4.0, and from version 4.0 to version 4.1. Therefore, Red{nbsp}Hat recommends upgrading first from 3.74 to 4.0, then from 4.0 to 4.1, then 4.1 to 4.2, until the selected version is installed. For full functionality, Red{nbsp}Hat recommends upgrading to the most recent version.
====

To upgrade {product-title-short} to the latest version, perform the following steps:

. xref:../upgrading/upgrade-roxctl.adoc#back-up-central-database_upgrade-roxctl[Backup the Central database]
. xref:../upgrading/upgrade-roxctl.adoc#upgrade-roxctl-cli[Upgrade the `roxctl` CLI]
. xref:../upgrading/upgrade-roxctl.adoc#upgrade-central-cluster[Upgrade the Central cluster]
. xref:../upgrading/upgrade-roxctl.adoc#upgrade-secured-clusters[Upgrade all secured clusters]

// include::modules/set-rox-scanner-init-db-env-variable.adoc[leveloffset=+1]

include::modules/back-up-central-database.adoc[leveloffset=+1]

[role="_additional-resources"]
.Additional resources
* xref:../cli/using-the-roxctl-cli.adoc#authenticating-by-using-the-roxctl-cli_using-roxctl-cli[Authenticating by using the roxctl CLI]

[id="upgrade-roxctl-cli"]
== Upgrading the `roxctl` CLI

To upgrade the `roxctl` CLI to the latest version you must uninstall the existing version of `roxctl` CLI and then install the latest version of the `roxctl` CLI.

include::modules/uninstall-roxctl-cli.adoc[leveloffset=+2]
include::modules/install-roxctl-cli-linux.adoc[leveloffset=+2]
include::modules/install-roxctl-cli-macos.adoc[leveloffset=+2]
include::modules/install-roxctl-cli-windows.adoc[leveloffset=+2]

[id="upgrade-central-cluster"]
== Upgrading the Central cluster

After you have created a backup of the Central database and generated the necessary resources by using the provisioning bundle, the next step is to upgrade the Central cluster. This process involves upgrading Central and Scanner.

include::modules/upgrade-central-cluster-central.adoc[leveloffset=+2]

include::modules/edit-memlimit-variable-central.adoc[leveloffset=+3]

include::modules/upgrade-central-cluster-scanner.adoc[leveloffset=+2]

include::modules/edit-memlimit-variable-scanner.adoc[leveloffset=+3]

include::modules/verify-central-cluster-upgrade.adoc[leveloffset=+2]

[id="upgrade-secured-clusters"]
== Upgrading all secured clusters

After upgrading Central services, you must upgrade all secured clusters.

[IMPORTANT]
====
* If you are using automatic upgrades:
** Update all your secured clusters by using automatic upgrades.
** For information about troubleshooting problems with the automatic cluster upgrader, see xref:../upgrading/upgrade-roxctl.adoc#troubleshooting-upgrader_{context}[Troubleshooting the cluster upgrader].
** Skip the instructions in this section and follow the instructions in the xref:../upgrading/upgrade-roxctl.adoc#verify-upgrades_{context}[Verify upgrades] and xref:../upgrading/upgrade-roxctl.adoc#revoke-the-api-token_{context}[Revoking the API token] sections.
* If you are not using automatic upgrades, you must run the instructions in this section on all secured clusters including the Central cluster.
** To ensure optimal functionality, use the same {product-title-short} version for your secured clusters and the cluster on which Central is installed.
====

To complete manual upgrades of each secured cluster running Sensor, Collector, and Admission controller, follow the instructions in this section.

include::modules/update-other-images.adoc[leveloffset=+2]

.Next steps
* xref:../upgrading/upgrade-roxctl.adoc#verify-secured-cluster-upgrade_upgrade-roxctl[Verifying secured cluster upgrade]

[role="_additional-resources"]
.Additional resources
* xref:../upgrading/upgrade-roxctl.adoc#migrating-sccs-during-the-manual-upgrade_upgrade-roxctl[Migrating SCCs during the manual upgrade]

include::modules/migrating-sccs-during-the-manual-upgrade.adoc[leveloffset=+2]

include::modules/edit-memlimit-variable-sensor.adoc[leveloffset=+3]

include::modules/edit-memlimit-variable-collector.adoc[leveloffset=+3]

include::modules/edit-memlimit-variable-admcontroller.adoc[leveloffset=+3]

include::modules/verify-secured-cluster-upgrade.adoc[leveloffset=+3]

include::modules/rhcos-enable-node-scan.adoc[leveloffset=+1]

[role="_additional-resources"]
.Additional resources
* xref:../operating/manage-vulnerabilities/scan-rhcos-node-host.adoc#scan-rhcos-node-host[Scanning {op-system} node hosts]


include::modules/remove-central-attached-pv-overview.adoc[leveloffset=+1]

include::modules/remove-central-attached-pv-roxctl.adoc[leveloffset=+2]

[id="rollback-central"]
== Rolling back Central

You can roll back to a previous version of Central if the upgrade to a new version is unsuccessful.

include::modules/rollback-central-normal.adoc[leveloffset=+2]

include::modules/rollback-central-forced.adoc[leveloffset=+2]

include::modules/verify-upgrades.adoc[leveloffset=+1]

include::modules/revoke-the-api-token.adoc[leveloffset=+1]

include::modules/troubleshooting-cluster-upgrader.adoc[leveloffset=+1]
