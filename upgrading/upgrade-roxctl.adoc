:_content-type: ASSEMBLY
[id="upgrade-roxctl"]
= Manually upgrading using the `roxctl` CLI
include::modules/common-attributes.adoc[]
:context: upgrade-roxctl

toc::[]

[role="_abstract"]
You can upgrade to the latest version of {rh-rhacscs-first} from a supported older version.

[IMPORTANT]
====
* You need to perform the manual upgrade procedure only if you used the `roxctl` CLI to install {product-title-short}.
* For upgrading to {product-title-short} 4.0, you must be using the latest patch release of {product-title-short} 3.74. If you are using an older version, you must first upgrade to {product-title-short} 3.74 before upgrading to {product-title-short} 4.0.
====

To upgrade {product-title} to the latest version, you must perform the following:

* Backup the Central database
* Upgrade the `roxctl` CLI
* Generate Central database provisioning bundle
* Upgrade Central
* Upgrade Scanner
* Verify all the upgraded secured clusters

// include::modules/set-rox-scanner-init-db-env-variable.adoc[leveloffset=+1]

include::modules/back-up-central-database.adoc[leveloffset=+1]

[role="_additional-resources"]
.Additional resources
* xref:../cli/getting-started-cli.adoc#cli-authentication_cli-getting-started[Authenticating using the `roxctl` CLI]

[id="upgrade-roxctl-cli"]
== Upgrading the `roxctl` CLI

To upgrade the `roxctl` CLI to the latest version you must uninstall the existing version of `roxctl` CLI and then install the latest version of the `roxctl` CLI.

include::modules/uninstall-roxctl-cli.adoc[leveloffset=+2]
include::modules/install-roxctl-cli-linux.adoc[leveloffset=+2]
include::modules/install-roxctl-cli-macos.adoc[leveloffset=+2]
include::modules/install-roxctl-cli-windows.adoc[leveloffset=+2]

include::modules/generate-central-database-provisioning-bundle.adoc[leveloffset=+1]
include::modules/create-resource-central-db-bundle.adoc[leveloffset=+1]

[id="upgrade-central-cluster"]
== Upgrading the Central cluster

After you have created a backup of the Central database and generated the necessary resources by using the provisioning bundle, the next step is to upgrade the Central cluster. This process involves upgrading Central and Scanner.

include::modules/upgrade-central-cluster-central.adoc[leveloffset=+2]

include::modules/upgrade-central-cluster-scanner.adoc[leveloffset=+2]

include::modules/verify-central-cluster-upgrade.adoc[leveloffset=+2]

[id="upgrade-secured-clusters"]
== Upgrading all secured clusters

After upgrading Central services, you must upgrade all secured clusters.

[IMPORTANT]
====
* If you are using automatic upgrades:
** Update all your secured clusters by using automatic upgrades.
** Skip the instructions in this section and follow the instructions in the xref:../upgrading/upgrade-roxctl.adoc#verify-upgrades_{context}[Verify upgrades] and xref:../upgrading/upgrade-roxctl.adoc#revoke-the-api-token_{context}[Revoking the API token] sections.
* If you are not using automatic upgrades, you must run the instructions in this section on all secured clusters including the Central cluster.
** To ensure optimal functionality, use the same {product-title-short} version for your secured clusters and the cluster on which Central is installed.
====

To complete manual upgrades of each secured cluster running Sensor, Collector, and Admission controller, follow the instructions in this section.

include::modules/update-other-images.adoc[leveloffset=+2]

include::modules/verify-secured-cluster-upgrade.adoc[leveloffset=+2]

[id="rollback-central"]
== Rolling back Central

You can roll back to a previous version of Central if the upgrade to a new version is unsuccessful.

include::modules/rollback-central-normal.adoc[leveloffset=+2]

include::modules/rollback-central-forced.adoc[leveloffset=+2]

include::modules/verify-upgrades.adoc[leveloffset=+1]

include::modules/revoke-the-api-token.adoc[leveloffset=+1]
