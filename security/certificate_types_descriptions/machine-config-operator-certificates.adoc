:_content-type: ASSEMBLY
[id="cert-types-machine-config-operator-certificates"]
= Machine Config Operator certificates
include::_attributes/common-attributes.adoc[]
:context: cert-types-machine-config-operator-certificates

toc::[]

== Purpose

This certificate authority is used to secure connections from nodes to Machine Config Server during initial provisioning.

There are two certificates: a self-signed CA ("the MCS CA") as well as a derived certificate ("the MCS cert").

=== Provisioning details

OpenShift installations using {op-system-first} are installed using Ignition.  This Ignition configuration is split into two parts; the first part is a "pointer" config which is just a reference to a URL for the full configuration served by the Machine Config Server (MCS).

The "pointer" Ignition config manifests as e.g. the `worker.ign` file created by `openshift-install` for User Provisioned Infrastucture installs. For Installer Provisioned Infrastructure (IPI) installs using the Machine API Operator, this configuration appears as the `worker-user-data` secret.

include::snippets/mcs-endpoint-limitation.adoc[]

.Additional resources

* xref:../../networking/openshift_sdn/about-openshift-sdn.adoc#about-openshift-sdn[About the OpenShift SDN network plugin].

=== Provisioning chain of trust

The MCS CA is injected into the pointer configuration under the Ignition `security.tls.certificateAuthorities` configuration option. The Machine Config Server provides its "full" Ignition configuration via a webserver using the "MCS cert".

Hence, this combination ensures that the client (Ignition running on a machine in the initramfs) is accessing the correct server because it validates that the MCS cert presented by the server has a chain of trust to an authority ("the MCS CA") it recognizes.

=== Key material inside a cluster

The "MCS CA" appears in cluster as a configmap under the `kube-system` namespace, object `root-ca` and with key `ca.crt`.  The private key is not stored in cluster and is discarded after an installation is complete.

The "MCS cert" appears in cluster as a secret under the `openshift-machine-config-operator` namespace, object `machine-config-server-tls` with keys `tls.crt` and `tls.key`.

== Management

At this time, modifying either of these certificates directly is not supported.

== Expiration
The MCS CA is valid for 10 years.

The issued serving certificates are valid for 10 years.

== Customization

You cannot customize the Machine Config Operator certificates.
