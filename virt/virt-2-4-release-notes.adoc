[id="virt-2-4-release-notes"]
= {RN_BookName}
include::modules/virt-document-attributes.adoc[]
:context: virt-release-notes
toc::[]

== About Red Hat {VirtProductName}

Red Hat {VirtProductName} is now a fully supported and generally available feature of {product-title} 4.5. Previously known as container-native virtualization, {VirtProductName} enables you to bring traditional virtual machines (VMs) into {product-title} where they run alongside containers, and are managed as native Kubernetes objects.

//RN-CNV-5460-Branding-Logo
{VirtProductName} is represented by a new logo:

image::Operator_Icon-OpenShift_Virtualization-5.png[{VirtProductName}]

include::modules/virt-what-you-can-do-with-virt.adoc[leveloffset=+2]
// This line is attached to the above `virt-what-you-can-do-with-virt` module.
// It is included here in the assembly because of the xref ban.
You can use {VirtProductName} with either the xref:../networking/ovn_kubernetes_network_provider/about-ovn-kubernetes.adoc#about-ovn-kubernetes[OVN-Kubernetes] or the xref:../networking/openshift_sdn/about-openshift-sdn.adoc#about-openshift-sdn[OpenShiftSDN] default Container Network Interface (CNI) network provider.
//Commented out because for GA release we have special text that covers this info. But going forward, we will want to include the following:
//include::modules/virt-supported-cluster-version.adoc[leveloffset=+2]

[id="virt-2-4-new"]
== New and changed features
//Placeholder for new content.

//CNV-5459 - Installation of Openshift virtualization using the CLI with kustomize is now supported.

* You can now xref:../virt/install/installing-virt-cli.adoc#installing-virt-cli[install {VirtProductName} by using the CLI] to apply manifests to your {product-title} cluster.

* {VirtProductName} is certified in Microsoft's Windows Server Virtualization Validation Program (SVVP) to run Windows Server workloads.
+
The SVVP Certification applies to:

** Red Hat Enterprise Linux CoreOS 8 workers. In the Microsoft SVVP Catalog, they are named _Red Hat {product-title} 4 on RHEL CoreOS 8_.

** Intel and AMD CPUs.

//CNV-5371 - Import existing virtual machines from Red Hat Virtualization to OpenShift Virtualization.

//CNV-5439 - TLS certificate rotation
* {VirtProductName} rotates and renews TLS certificates at regular intervals. This automatic process does not disrupt any operations.

//CNV-5438 - svirt-support-for-cnv
* This release features significant security enhancements. {VirtProductName} now supports SELinux with Mandatory Access Control (MAC) for isolating virtual machines (VMs). Previously, all VMs were managed by using privileged xref:../security/container_security/security-platform.adoc#security-deployment-sccs_security-platform[Security Context Constraints (SCC)]. Now, you can use less privileged custom SCCs for VMs and limit the use of privileged SCCs to infrastructure containers in the cluster.

//CNV-4572-Guest-OS
[id="virt-guest-os-new"]
=== Supported guest operating systems
{VirtProductName} guests can use the following operating systems:

* Red Hat Enterprise Linux 6, 7, and 8.
* Microsoft Windows Server 2012 R2, 2016, and 2019.
* Microsoft Windows 10.

Other operating system templates shipped with {VirtProductName} are not supported.

[id="virt-2-4-networking-new"]
=== Networking
//Placeholder for new content.

//CNV-5286 - SR-IOV Networking (no xref yet, PR not merged)
* {VirtProductName} is now integrated with the {product-title} xref:../networking/hardware_networks/about-sriov.adoc#about-sriov[Single Root I/O Virtualization (SR-IOV) Operator]. You can now xref:../virt/virtual_machines/vm_networking/virt-attaching-vm-to-sriov-network.adoc#virt-attaching-vm-to-sriov-network[attach virtual machines to SR-IOV networks] in your cluster.

//CNV-5285 - MAC pool support
* xref:../virt/virtual_machines/vm_networking/virt-using-mac-address-pool-for-vms.adoc#virt-using-mac-address-pool-for-vms[MAC address pool] is now supported in {VirtProductName}. It is disabled by default in the cluster and can be enabled per namespace.

[id="virt-2-4-storage-new"]
=== Storage
//Placeholder for new content.

//CNV-5274 - Customize accessMode and volumeMode when creating VM disks.
* You can now configure the *Volume Mode* and *Access Mode* for a virtual disk when you xref:../virt/virtual_machines/virt-edit-vms.adoc#virt-vm-add-disk_virt-edit-vms[add a disk to a virtual machine] in the web console. This is also possible when adding a disk to a xref:../virt/virtual_machines/virt-create-vms.adoc#virt-creating-vm-wizard-web_virt-create-vms[new virtual machine using the wizard].

//CNV-5422 - CNV support for Ceph-based OCS 4.4.
* Using OpenShift Container Storage (OCS) with {VirtProductName} gives you the benefits of fault-tolerant storage and the ability to live migrate between nodes.

//CNV-5423 - CDI support for namespaces that are restricted by resource quotas.
* You can now use the Containerized Data Importer (CDI) to import, upload, and clone virtual machine disks into namespaces
that are subject to CPU and memory resource restrictions. The default compute resource limits are set to `0` but administrators can configure
the resource limits applied to CDI worker Pods.

//CNV-5424 - virtctl can now use a DataVolume when uploading virtual machine disks.
* The `virtctl` tool can now use a `DataVolume` when uploading virtual machine disks to the cluster. This helps prevent virtual machines
from being inadvertently started before an upload has completed.

//CNV-5421 - OpenShift Container Storage (OCS) DataVolumes
* OpenShift Container Storage DataVolumes have been enhanced with conditions and events that make it easier to understand the state of virtual disk imports, clones, and upload operations.
Conditions and events also simplify troubleshooting.

[id="virt-2-4-web-new"]
=== Web console
//Placeholder for new content.

//CNV-5275 - Update template designs - virtual machines and virtual machine templates merged under one menu called Virtualization.
* In the web console, the sidebar items *Virtual Machines* and *Virtual Machine Templates* have been replaced by a
single sidebar menu item labeled *Virtualization*. When you click *Virtualization*, you have access to two tabs: *Virtual Machines* and *Virtual Machine Templates*.

//CNV-5272 - Configure scheduling directly from CNV UI.
* You can now configure the scheduling properties of virtual machines by accessing the *Scheduling and resources requirements* section of the *Virtual Machine Details* page. For example, you can view and manage affinity rules, dedicated resources, and tolerations for tainted nodes. You can also search for nodes with labels that match specific key/value pairs by using the *Node Selector*.

//CNV-5273 - Attach a config map / secret / service account to a VM from the UI.
* You can now add xref:../virt/virtual_machines/virt-managing-configmaps-secrets-service-accounts.adoc#virt-managing-configmaps-secrets-service-accounts[secrets, ConfigMaps, and service accounts] to a virtual machineÂ on the *Virtual Machine Overview* -> *Environment* page of the {product-title} web console. You can also remove these resources on the same page.

[id="virt-2-4-changes"]
== Notable technical changes
//Placeholder for new content.

//CNV-5465-Disconnected installation
* {VirtProductName} can be installed on disconnected clusters in restricted network environments that do not have Internet connectivity. You can create local mirrors for the {VirtProductName} Operator and install the Operator from a local catalog image that is accessible to the disconnected cluster. Learn more about https://access.redhat.com/articles/4827691[Installing OpenShift Virtualization on a restricted network cluster].

//CNV-5371 - Import existing virtual machines from Red Hat Virtualization to OpenShift Virtualization.
* You can import a single Red Hat Virtualization virtual machine by using the virtual machine wizard or the CLI.

//CNV-5463 - New API Subgroup for Virt
* Every component in {VirtProductName} now uses its own API subgroup, `<component_name>.kubevirt.io`.

[id="virt-2-4-known-issues"]
== Known issues
//https://bugzilla.redhat.com/show_bug.cgi?id=1855067 - Requested doc text for this defect.
//https://bugzilla.redhat.com/show_bug.cgi?id=1835426 - Requested doc text for this defect.
//https://bugzilla.redhat.com/show_bug.cig?=id=1959237
* If you upgrade to {VirtProductName} {VirtVersion}, both older and newer versions of common templates are available for each combination of operating system, workload, and flavor. When you create a virtual machine by using a common template, you must use the newer version of the template. Disregard the older version to avoid issues. (link:https://bugzilla.redhat.com/show_bug.cgi?id=1859237[*BZ#1859237*])

* Running virtual machines that cannot be live migrated might block an {product-title} cluster upgrade. This includes virtual machines that use hostpath-provisioner storage or SR-IOV network interfaces.
As a workaround, you can reconfigure the virtual machines so that they can be powered off during a cluster upgrade. In the `spec` section of the virtual machine configuration file:
+
** Remove the `evictionStrategy: LiveMigrate` field. See xref:../virt/live_migration/virt-configuring-vmi-eviction-strategy.adoc#virt-configuring-vmi-eviction-strategy[Configuring virtual machine eviction strategy] for more information on how to configure eviction strategy.
** Set the `runStrategy` field to `Always`.


* If you do not specify an IPAM configuration in the SriovNetwork configuration, the NetworkAttachmentDefinition is not created.
As a workaround, you must include an empty `ipam: {}` parameter in the SriovNetwork configuration.
(link:https://bugzilla.redhat.com/show_bug.cgi?id=1859231[*BZ#1859231*])

* For unknown reasons, memory consumption for the `containerDisk` volume type might gradually increase until it exceeds the memory limit. To resolve this issue, restart the VM. (link:https://bugzilla.redhat.com/show_bug.cgi?id=1855067[*BZ#1855067*])

* Sometimes, when attempting to edit the subscription channel of the *{VirtProductName} Operator* in the web console, clicking the
*Channel* button of the *Subscription Overview* results in a JavaScript error.
(link:https://bugzilla.redhat.com/show_bug.cgi?id=1796410[*BZ#1796410*])

** As a workaround, trigger the upgrade process to {VirtProductName} {VirtVersion}
from the CLI by running the following `oc` patch command:
+
----
$ export TARGET_NAMESPACE=openshift-cnv CNV_CHANNEL=2.4 && oc patch -n "${TARGET_NAMESPACE}" $(oc get subscription -n ${TARGET_NAMESPACE} --no-headers -o name) --type='json' -p='[{"op": "replace", "path": "/spec/channel", "value":"'${CNV_CHANNEL}'"}, {"op": "replace", "path": "/spec/installPlanApproval", "value":"Automatic"}]'
----
+
This command points your subscription to upgrade channel `2.4` and enables automatic updates.

//This bug - 1686208- was listed in POST status in Bugzilla:
* After migration, a virtual machine is assigned a new IP address. However, the
commands `oc get vmi` and `oc describe vmi` still generate output containing the
obsolete IP address. (link:https://bugzilla.redhat.com/show_bug.cgi?id=1686208[*BZ#1686208*])
+
** As a workaround, view the correct IP address by running the following command:
+
----
$ oc get pod -o wide
----

//This defect was closed therefor the content for this defect was deleted:(link:https://bugzilla.redhat.com/show_bug.cgi?id=1743985[*BZ#1743985*])
//This defect is in POST status [*BZ#1760028*]
* Live migration fails when nodes have different CPU models. Even in cases where
nodes have the same physical CPU model, differences introduced by microcode
updates have the same effect. This is because the default settings trigger
host CPU passthrough behavior, which is incompatible with live migration.
(link:https://bugzilla.redhat.com/show_bug.cgi?id=1760028[*BZ#1760028*])
+
** As a workaround, set the default CPU model in the `kubevirt-config` ConfigMap,
as shown in the following example:
+
[NOTE]
====
You must make this change before starting the virtual machines that support
live migration.
====
+
. Open the `kubevirt-config` ConfigMap for editing by running the following command:
+
----
$ oc edit configmap kubevirt-config -n openshift-cnv
----
+
. Edit the ConfigMap:
+
[source,yaml]
----
kind: ConfigMap
metadata:
  name: kubevirt-config
data:
  default-cpu-model: "<cpu-model>" <1>
----
<1> Replace `<cpu-model>` with the actual CPU model value. You can determine this
value by running `oc describe node <node>` for all nodes and looking at the
`cpu-model-<name>` labels. Select the CPU model that is present on all of your
nodes.

//Jira story for the following content https://issues.redhat.com/browse/CNV-4757. Nelli noted that for CNV 2.5, this can be removed from Known Issues. The defect status, however, is CLOSED.
* {VirtProductName} cannot reliably identify node drains that are triggered by
running either `oc adm drain` or `kubectl drain`. Do not run these commands on
the nodes of any clusters where {VirtProductName} is deployed. The nodes might not
drain if there are virtual machines running on top of them.

The current solution is to xref:../virt/node_maintenance/virt-setting-node-maintenance.adoc#virt-setting-node-maintenance[put nodes into maintenance].
