:_content-type: ASSEMBLY
[id="virt-post-install-storage-config"]
= Post-installation storage configuration
include::_attributes/common-attributes.adoc[]
:context: virt-post-install-storage-config

toc::[]

After you install {VirtProductName}, you can perform the following tasks:

* Define a default storage class.
+
You must define a default storage class for your cluster. Otherwise, the cluster cannot receive automated boot source updates. See xref:../../post_installation_configuration/storage-configuration.adoc#defining-storage-classes_post-install-storage-configuration[Defining a storage class].
+
If you deploy {VirtProductName} with {rh-storage-first}, you must define a dedicated storage class for Windows virtual machine disks. See link:https://access.redhat.com/articles/6978371[Optimizing ODF PersistentVolumes for Windows VMs].

* Configure local storage:

** If you deploy {VirtProductName} on a {sno} cluster, you can configure logical volume manager storage. See xref:../../storage/persistent_storage/persistent_storage_local/persistent-storage-using-lvms.adoc#persistent-storage-using-lvms[Persistent storage using logical volume manager storage].
** If your storage provider uses the Container Storage Interface (CSI), you can configure local storage by using a xref:../../virt/post_installation_configuration/virt-post-install-storage-config.adoc#configuring-local-storage-hpp[hostpath provisioner (HPP)].

[id="configuring-local-storage-hpp"]
== Configuring local storage by using a hostpath provisioner

The Hostpath Provisioner (HPP) Operator is automatically installed with the {VirtProductName} Operator. The HPP Operator creates an HPP provisioner, which is a local storage provisioner designed for {VirtProductName}.

You create an HPP custom resource (CR) with a xref:../../virt/post_installation_configuration/virt-post-install-storage-config.adoc#virt-creating-hpp-basic-storage-pool_virt-post-install-storage-config[single storage pool] or with xref:../../virt/post_installation_configuration/virt-post-install-storage-config.adoc#creating-storage-pools-by-using-pvc-templates[multiple storage pools].

[IMPORTANT]
====
HPP storage pools must not be in the same partition as the operating system. Otherwise, the storage pools might fill the operating system partition. If the operating system partition is full, performance can be effected or the node can become unstable or unusable.
====

include::modules/virt-creating-hpp-basic-storage-pool.adoc[leveloffset=+2]

include::modules/virt-creating-storage-class-csi-driver.adoc[leveloffset=+2]

[id="creating-storage-pools-by-using-pvc-templates"]
=== Creating storage pools by using PVC templates

If you have a single, large persistent volume (PV), you can create a storage pool by defining a PVC template in the hostpath provisioner (HPP) custom resource (CR).

A storage pool created with a PVC template can contain multiple HPP volumes. Splitting a PV into smaller volumes provides greater flexibility for data allocation.

The PVC template is based on the `spec` stanza of the `PersistentVolumeClaim` object:

.Example `PersistentVolumeClaim` object
[source,yaml]
----
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: iso-pvc
spec:
  volumeMode: Block <1>
  storageClassName: my-storage-class
  accessModes:
  - ReadWriteOnce
  resources:
    requests:
      storage: 5Gi
----
<1> This value is only required for block volume mode PVs.

You define a storage pool using a `pvcTemplate` specification in the HPP CR. The Operator creates a PVC from the `pvcTemplate` specification for each node containing the HPP CSI driver. The PVC created from the PVC template consumes the single large PV, allowing the HPP to create smaller dynamic volumes.

You can combine basic storage pools with storage pools created from PVC templates.

include::modules/virt-creating-storage-pool-pvc-template.adoc[leveloffset=+3]

