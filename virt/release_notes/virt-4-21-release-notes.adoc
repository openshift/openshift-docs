:_mod-docs-content-type: ASSEMBLY
include::_attributes/common-attributes.adoc[]
[id="virt-4-21-release-notes"]
= {VirtProductName} release notes
:context: virt-4-21-release-notes

[role="_abstract"]
These release notes describe new features and enhancements, Technology Preview features, deprecated and removed features, fixed issues, and known issues for {VirtProductName} {VirtVersion}.

toc::[]

[id="virt-guest-os_{context}"]
== Supported guest operating systems

To view the supported guest operating systems for {VirtProductName}, see link:https://access.redhat.com/articles/973163#ocpvirt[Certified Guest Operating Systems in Red Hat OpenStack Platform, Red Hat Virtualization, OpenShift Virtualization and Red Hat Enterprise Linux with KVM].

//Ensure platform passes Windows Server Virtualization Validation Program. Otherwise, comment out the section below.
[id="virt-svvp-certification_{context}"]
== Microsoft Windows SVVP certification

{VirtProductName} is certified in Microsoft's Windows Server Virtualization Validation Program (SVVP) to run Windows Server workloads.

The SVVP certification applies to:

* Red Hat Enterprise Linux CoreOS workers. In the Microsoft SVVP Catalog, they are named __Red{nbsp}Hat {product-title} 4.20__.
* Intel and AMD CPUs.

[id="virt-4-21-new_{context}"]
== New features and enhancements

// Example release note format:
//
// Improved lorem installation workflow for clusters::
// Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed non risus vitae justo interdum lobortis non id velit. Integer at lorem ac velit lacinia placerat in non urna. As a result, lorem updates complete more predictably on large clusters.
// +
// link:https://issues.redhat.com/browse/CNV-00001[CNV-00001]

// Installation and update


// Infrastructure



// Virtualization
{ibm-name} Secure Execution for VMs on {ibm-z-name} and {ibm-linuxone-name} is generally available::
{ibm-name} Secure Execution for VMs on {ibm-z-name} and {ibm-linuxone-name} is now generally available. This capability provides hardware based memory encryption that protects virtual machine workloads from access by the host or hypervisor environment. For more information, see xref:../../virt/creating_vm/virt-configuring-ibm-secure-execution-vms-ibm-z.adoc#virt-configuring-ibm-secure-execution-vms-ibm-z[Configuring {ibm-name} Secure Execution virtual machines on {ibm-z-name} and {ibm-linuxone-name}].


// Networking
Custom MAC pool range configuration:: With this update, cluster administrators can specify a custom MAC pool range for a {VirtProductName} environment, preventing potential MAC address conflicts with other virtualization solutions on the same network. This gives cluster administrators more control over network resources, ensuring greater network stability and resource management efficiency.
+
link:https://issues.redhat.com/browse/CNV-63212[CNV-63212]

Import VMs into {VirtProductName} while maintaining their previously assigned IP and MAC addresses:: 
With this update, you can import VMs into {VirtProductName}, preserving their original IP and MAC addresses when connected to custom, primary layer 2 networks. This enhancement streamlines the import process, ensuring network consistency and a seamless transition of VMs, resulting in minimal disruption.
+
link:https://issues.redhat.com/browse/CNV-61227[CNV-61227]

// Storage



// Web console

Enhancements for the virtual machines *Search* menu::
With this update, the search interface is enhanced, making it more noticeable and user-friendly. A prominent *Search* button and an advanced search option are introduced, allowing users to initiate a search with either the primary button or the *Enter* key. This streamlines the user experience and improves overall search functionality.
+
link:https://issues.redhat.com/browse/CNV-70130[CNV-70130]

New flag introduced to prevent unintentional VNC disconnects:: A new, optional `--preserve-session` flag has been introduced for VMs. This flag prevents an existing VNC console connection from being disconnected if you attempt to start a new session.
+
If you attempt to create a second connection to the VNC console by using the `virtctl` CLI when this flag is set, an error is displayed and the connection fails.
+
If you attempt to create a second connection to the VNC console by using the web console, a warning is displayed, and you are prompted to disconnect the existing session before you create the new session.
+
link:https://issues.redhat.com/browse/CNV-66115[CNV-66115]

Starting a virtual machine console from the tree-view::
You can now start a virtual machine (VM) console session by clicking on the name of the running VM in the navigation panel, and then selecting *Open Console*.
+
link:https://issues.redhat.com/browse/CNV-70942[CNV-70942]

Viewing and changing the current memory overcommit using the web console::
An admin can now view and change the memory overcommit of the  cluster from the *Virtualization* page of the web console.
+
link:https://issues.redhat.com/browse/CNV-69264[CNV-69264]

// Monitoring



// Documentation improvements



// Notable technical changes





[id="virt-4-21-deprecated_{context}"]
== Deprecated features

The `HotplugVolume` feature gate is deprecated::

The `HotplugVolume` feature gate, which allows you to add storage without restarting your VM, is deprecated and will be removed in a future release. This feature gate will be replaced by `DeclarativeHotplugVolumes`.
+
[NOTE]
====
`DeclarativeHotplugVolumes` does not support hot plugging ephemeral volumes. Ephemeral volumes are hot plugged to a VMI and do not persist in the owner VM. Existing ephemeral volumes that are hot plugged are automatically detached after you switch to the `DeclarativeHotplugVolumes` feature gate.
====

link:https://issues.redhat.com/browse/CNV-73301[CNV-73301]

[id="virt-4-21-removed_{context}"]
== Removed features

[role="_abstract"]
Removed features are no longer supported in {VirtProductName}.

Legacy virtctl ssh target syntax removed::
With this release, support for the `virtctl ssh type/name[.namespace]` target syntax has been removed. You must specify the target by using an explicit resource type, such as `vmi/<name>` or `vm/<name>`. Scripts and automation that rely on the removed syntax must be updated.

// CNV-71950
Support for `kubevirt-virtctl` RPM removed::
With this release, support for the RHEL 8 `kubevirt-virtctl` RPM is removed and no longer supported.

[id="virt-4-21-technology-preview_{context}"]
== Technology Preview features

[role="_abstract"]
Some features in this release are currently in Technology Preview. These experimental features are not intended for production use. Note the following scope of support on the Red Hat Customer Portal for these features:

link:https://access.redhat.com/support/offerings/techpreview[Technology Preview Features Support Scope]

//CNV-62357
Golden image support for heterogeneous clusters (Technology Preview)::
Golden image support is available for heterogeneous clusters, which enables you to create and use golden images for virtual machines in environments with differing node configurations. This capability is a Technology Preview feature.
+
link:https://issues.redhat.com/browse/CNV-62357[CNV-62357]

//CNV-71192
Custom video device support in virtual machines (Technology Preview)::
You can now configure a custom video device type when creating a virtual machine. Configuring a custom device type overrides the default video configuration, and allows you to specify different video devices, based on your guest operating system requirements and performance needs. This capability is a Technology Preview feature.
+
link:https://issues.redhat.com/browse/CNV-71192[CNV-71192]

[id="virt-4-21-bug-fixes_{context}"]
== Fixed issues

[id="virt-4-21-known-issues_{context}"]
== Known issues

[role="_abstract"]
Some linked Jira tickets are accessible only with Red Hat credentials.

//CNV-38746: According to Petr, this will remain relevant as long as 4.12 is available. Anyone upgrading from 4.12 could be affected. Version 4.12 is supported until January 2026
[id="virt-4-21-ki-networking_{context}"]
VMs using the cnv-bridge CNI fail to live migrate after updates from 4.12::
When you update from {product-title} 4.12 to a newer minor version, virtual machines that use the `cnv-bridge` Container Network Interface (CNI) fail to live migrate. As a consequence, live migration fails for affected VMs.
+
To work around this problem, change the `spec.config.type` field in your `NetworkAttachmentDefinition` manifest from `cnv-bridge` to `bridge` before you perform the update. As a result, live migration succeeds for VMs that use the updated network attachment definitions.
+
link:https://access.redhat.com/solutions/7069807[Known issue when migrating VMs that use the cnv-bridge CNI]

//CNV-69039
{SMProductName} 3.1.1 and Istio 1.25 and later are incompatible with {VirtProductName}::
{SMProductName} 3.1.1 and Istio versions 1.25 and later are incompatible with {VirtProductName} {VirtVersion} because the `traffic.sidecar.istio.io/kubevirtInterfaces` annotation is deprecated. As a consequence, service mesh integration with {VirtProductName} can fail when you use these versions.
+
To work around this problem, when you install {SMProductShortName} for integration with {VirtProductName}, select {SMProductName} version 3.0.4 and Istio 1.24.4 instead of the default versions that are displayed in the web console.
+
link:https://issues.redhat.com/browse/OSSM-10883[OSSM-10883]

//CNV-38543: According to Stu, this remains an issue in 4.21
[id="virt-4-21-ki-nodes_{context}"]
Node labels remain after uninstalling {VirtProductName}::
Uninstalling {VirtProductName} does not remove the `feature.node.kubevirt.io` node labels that {VirtProductName} creates. As a consequence, nodes can still appear as if they are configured for virtualization workloads.
+
To work around this problem, manually remove the `feature.node.kubevirt.io` labels from affected nodes after you uninstall {VirtProductName}.
+
link:https://issues.redhat.com/browse/CNV-38543[CNV-38543]

//CNV-61066: According to Kedar, this remains an issue in 4.21
[id="virt-4-21-ki-virtualization_{context}"]
Live migration fails when VM names exceed 47 characters::
Live migration fails if a virtual machine name exceeds 47 characters. As a consequence, you cannot live migrate VMs with longer names.
+
To work around this problem, use VM names that are 47 characters or fewer when you create VMs that you plan to live migrate.
+
link:https://issues.redhat.com/browse/CNV-61066[CNV-61066]

//CNV-33835: According to Kedar, this remains an issue in 4.21 (see also CNV-27131)
Service account volume becomes invalid after VM migration::
{VirtProductName} links a service account token in use by a pod to that specific pod by creating a disk image that contains the token. If you migrate a VM, the service account volume becomes invalid for the migrated VM. As a consequence, workloads that rely on that service account token can fail after migration.
+
To work around this problem, use user accounts instead of service accounts, because user account tokens are not bound to a specific pod.
+
link:https://issues.redhat.com/browse/CNV-33835[CNV-33835]

Upgrading to {VirtProductName} 4.21 when using wasp-agent:: If you are upgrading {VirtProductName} from version 4.20 to 4.21 and using `wasp-agent` to increase VM workload density, you must perform the following steps after you begin the upgrade:

. Wait for the Machine Configuration Pool (MCP) to complete the updating of the infra nodes.

. Edit the `KubeletConfig` file to remove the `failSwapOn: false` key-value pair.

. Wait for the MCP to finish updating the worker nodes.

+
link:https://issues.redhat.com/browse/CNV-75837[CNV-75837]
