[[admin-guide-iptables]]
= iptables
{product-author}
{product-version}
:data-uri:
:icons:
:experimental:
:toc: macro
:toc-title:

toc::[]

== Overview
The kernel iptables component is used for a variety of traffic
filtering, routing, and monitoring purposes:

. Most hosts will use either
xref:../admin_guide/iptables.adoc#admin-guide-iptables-firewalld[firewalld] or
xref:../admin_guide/iptables.adoc#admin-guide-iptables-iptables-service[iptables.service]
to manage firewall rules.

. {product-title} adds rules to ensure that generic firewall rules
do not restrict traffic between pods.

. {product-title} adds rules to properly route and load-balance
traffic to service IP addresses, and to accept traffic for services
using
xref:../dev_guide/getting_traffic_into_cluster.adoc#using-nodeport[NodePorts].

. Docker and some other software on the system can use iptables rules for their
own purposes.

. Administrators can add their own local rules to log or filter traffic.

Components that access the kernel iptables rules do not require knowledge of how
other components work, which means certain functions can break another
component's configuration. Therefore, firewalld is recommended if you want to
create your own rules.

[[admin-guide-iptables-firewalld]]
== Firewalld

link:http://firewalld.org/[Firewalld] is a daemon that manages iptables rules
and provides a standard API for adding and editing rules in a way that avoids
conflicts between different applications. Firewalld is the preferred iptables
management system for {product-title}. The
xref:../install_config/install/advanced_install.adoc#install-config-install-advanced-install[advanced
installation method] configures a firewalld-based firewall by default on new
installations.

Use the
link:http://www.firewalld.org/documentation/man-pages/firewall-cmd[`firewall-cmd`]
tool to manage iptables rules. Use the `--permanent` flag to edit the permanent
configuration that will be preserved after restarts.

[WARNING]
====
If you use the `firewall-cmd --direct` command to directly add "raw" iptables
rules, ensure you avoid interfering with the rules that {product-title} and
Docker add. To do this, restrict yourself to the `_direct` tables provided by
firewalld. For example, use the `FORWARD_direct` table rather than `FORWARD`.
====

[[admin-guide-iptables-iptables-service]]
== iptables.service

On older systems, or systems that do not support firewalld, your firewall might
be managed by *iptables.service*. As with firewalld, *iptables.service* controls
the iptables configuration, but it does not provide any way for
{product-title} to dynamically manage iptables rules. When *iptables.service*
starts, it flushes and restores the complete iptables configuration. The
restored rules are from *_/etc/sysconfig/iptables_* configuration file. The
configuration file is not kept up to date during operation, so the dynamically
added rules are lost during every restart.

[WARNING]
====
Stopping and starting *iptables.service* will destroy configuration that is
required by {product-title} and Docker. {product-title} and Docker are not
notified of the change.
====

If you need to run *iptables.service*, keep a limited configuration in the
configuration file and rely on {product-title} and Docker to install their
needed rules.

The *iptables.service* configuration is loaded from:

----
/etc/sysconfig/iptables
----

To make permanent rules changes, edit the changes into this file. Do not include
Docker or {product-title} rules.

After *iptables.service* is started or restarted on a node, the Docker service
and *atomic-openshift-node.service* must be restarted to reconstruct the needed
iptables configuration.

[IMPORTANT]
====
Restarting the Docker service will cause all containers running on the node to
be stopped and restarted.
====

----
# systemctl restart iptables.service
# systemctl restart docker
# systemctl restart atomic-openshift-node.service
----
