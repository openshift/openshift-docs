////
Creating statefulsets

Module included in the following assemblies:

* admin_guide/statefulsets.adoc
////

[id='creating-statefulsets_{context}']
= Creating Statefulsets

Create a StatefulSet

. Configure the StatefulSet in a YAML file, similar to the following.
+
----
apiVersion: v1
kind: Service
metadata:
  name: frontend-headless  <1>
  labels:
    app: ruby-helloworld-sample
spec:
  ports:
  - port: 80
    name: web
  clusterIP: None  <2>
  selector:
    app: ruby-helloworld-sample
---
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: hello
spec:
  selector:
    matchLabels:
      app: ruby-helloworld-sample <1>
  serviceName: "ruby-helloworld"
  replicas: 3 <2>
  template:
    metadata:
      labels:
        app: ruby-helloworld <3>
    spec:
      terminationGracePeriodSeconds: 10
      containers:
      - name: nginx
        image: k8s.gcr.io/nginx-slim:0.8
        ports:
        - containerPort: 80
          name: ruby-helloworld
        volumeMounts:
        - name: www
          mountPath: /usr/share/nginx/html
  volumeClaimTemplates:
  - metadata:
      name: www
    spec:
      accessModes: [ "ReadWriteOnce" ]
      storageClassName: "my-storage-class"
      resources:
        requests:
          storage: 1Gi
----

<1> The `app` has to match `.spec.template.metadata.labels`.
<2> Indicates the number of replicas of the container that will be launched in unique pods. This is 1 by default.
<2> The `app` has to match `.spec.selector.matchLabels`.

. Create the object:
+
----
oc create -f web.yaml 

service "frontend-headless" created
statefulset "hello" created
----

. View the objects to verify that they were created:
+
----
oc get service frontend-headless
NAME                  CLUSTER-IP   EXTERNAL-IP   PORT(S)   AGE
frontend-headless     None         <none>        80/TCP    12s

kubectl get statefulset web
NAME        DESIRED   CURRENT   AGE
hello       2         1         20s

. Use the `oc get pods` commands to view the ordered pod creation, in order from {0..N-1}. Eventually, the output will look like the example below:
+
----
kubectl get pods -w -l app=nginx
NAME      READY     STATUS    RESTARTS   AGE
web-0     0/1       Pending   0          0s
web-0     0/1       Pending   0         0s
web-0     0/1       ContainerCreating   0         0s
web-0     1/1       Running   0         19s
web-1     0/1       Pending   0         0s
web-1     0/1       Pending   0         0s
web-1     0/1       ContainerCreating   0         0s
web-1     1/1       Running   0         18s
----

