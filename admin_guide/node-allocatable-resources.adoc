= Node Allocatable resources
{product-author}
{product-version}
:data-uri:
:icons:
:experimental:
:toc: macro
:toc-title:

toc::[]

== Overview
To provide more reliable scheduling and minimize node resource overcommitment,
each node has a chance to reserve a portion of its resources for use by all
openshift-node underlying components (e.g. kubelet, kube-proxy, docker)
and remaining system components (e.g. sshd, NetworkManager) on a node.
Once specified, scheduler has more information about how much resources
(e.g. memory, cpu) a node has allocated for pods.

== Settings

Resources reserved for components are based on two node settings:

[options="header",cols="1,2"]
|===

|Setting |Description

|`*kube-reserved*`
| A set of `ResourceName=ResourceQuantity` (e.g. cpu=200m,memory=30G) pairs that describe resources reserved for openshift-node components. Default is none.

|`*system-reserved*`
|A set of `ResourceName=ResourceQuantity` (e.g. cpu=200m,memory=30G) pairs that describe resources reserved for remaining system components. Default is none.
|===

You can specify values for these settings in the `*kubeletArguments*` section of
the
link:../install_config/master_node_configuration.html#node-configuration-files[node
configuration file] (the *_/etc/origin/node/node-config.yaml_* file by default). Add the section if it does not already exist:

====
.Node Allocatable Resources Settings
[source,yaml]
----
kubeletArguments:
  kube-reserved:
    - "cpu=200m,memory=30G"
  system-reserved:
    - "cpu=200m,memory=30G"
----
====

Currently, `cpu` and `memory` resource types are supported.

Each resource types is specified in `ResourceQuantity` units. For `cpu` it is
in units of cores (e.g. 200m, 100Ki, 50M),
for ``memory`` in units of bytes (e.g. 200Ki, 100M, 50Gi).

See
link:../dev_guide/compute_resources.html[Compure Resources]
for more details.

If a flag is not set, it defaults to `0`.
If none of the flags is set, allocated resource is set to node's capacity as it was
before introduction of allocatable resources.

== Computation of allocated resource

An allocated amount of a resource is computed based on the following formula:

----
[Allocatable] = [Node Capacity] - [Kube-Reserved] - [System-Reserved]
----

If `[Allocatable]` is negative, it is set to `0`.

== Node status

To see node's current capacity and allocatable resources, you can run:

----
$ oc get node/NODENAME -o json
...
    "status": {
        "capacity": {
            "cpu": "2",
            "memory": "3882324Ki",
            "pods": "110"
        },
        "allocatable": {
            "cpu": "2",
            "memory": "3882324Ki",
            "pods": "110"
        },
...
----

== Scheduler

Scheduler now uses value of `node.Status.Allocatable` instead of `node.Status.Capacity`
to decide if a node will become a candidate for pod scheduling.

By default, the node will report its machine capacity as fully schedulable by the cluster.
