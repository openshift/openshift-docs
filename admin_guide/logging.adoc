[[admin-guide-logging]]
= Logging
{product-author}
{product-version}
:data-uri:
:icons:
:experimental:
:toc: macro
:toc-title:
:prewrap!:

toc::[]

== Overview

As an {product-title} cluster administrator, you can deploy the EFK stack to
aggregate logs for a range of {product-title} services. Application developers
can view the logs of the projects for which they have view access. The EFK stack
aggregates logs from hosts and applications, whether coming from multiple
containers or even deleted pods.

Once deployed in a cluster, the stack aggregates logs from all nodes and
projects into Elasticsearch, and provides a Kibana UI to view any logs. Cluster
administrators can view all logs, but application developers can only view logs
for projects they have permission to view. The stack components communicate
securely.

[[tune-buffer-chunk-limit]]
== Tuning Buffer Chunk Limit

If the Fluentd logger is unable to keep up with a high number of logs, it will
need to switch to file buffering to reduce memory usage and prevent data loss.

The Fluentd `buffer_chunk_limit` is determined by the environment variable
`BUFFER_SIZE_LIMIT`, which has the default value 16 MB. The file buffer size per
output is determined by the environment variable `FILE_BUFFER_LIMIT`, which has
the default value 2 GB. The permanent volume size has to be larger than
`FILE_BUFFER_LIMIT` times number of output.

On the Fluentd and Mux pods, permanent volume `/var/lib/fluentd` should be
prepared by the PVC or hostmount, for example. That area is then used for the
file buffers.

The `buffer_type` and `buffer_path` are configured in the Fluentd config files as
follows:

----
$ egrep "buffer_type|buffer_path" *.conf
output-es-config.conf:
  buffer_type file
  buffer_path `/var/lib/fluentd/buffer-output-es-config`
output-es-ops-config.conf:
  buffer_type file
  buffer_path `/var/lib/fluentd/buffer-output-es-ops-config`
es-copy-config.conf:
  buffer_type file
  buffer_path `/var/lib/fluentd/buffer-es-copy-config`
es-ops-copy-config.conf:
  buffer_type file
  buffer_path `/var/lib/fluentd/buffer-es-ops-copy-config`
----

The Fluentd `buffer_queue_limit` is calculated as follows:

----
FILE_BUFFER_LIMIT / FILE_SIZE_LIMIT
----
