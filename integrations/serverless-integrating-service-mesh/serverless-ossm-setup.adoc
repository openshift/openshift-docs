:_mod-docs-content-type: ASSEMBLY
[id="serverless-ossm-setup"]
= Integrating Service Mesh 2.x with OpenShift Serverless
include::_attributes/common-attributes.adoc[]
:context: serverless-ossm-setup

toc::[]

The {ServerlessOperatorName} provides Kourier as the default ingress for Knative. However, you can use {SMProductShortName} with {ServerlessProductName} whether Kourier is enabled or not. Integrating with Kourier disabled allows you to configure additional networking and routing options that the Kourier ingress does not support, such as mTLS functionality.

Note the following assumptions and limitations:

* All Knative internal components, as well as Knative Services, are part of the {SMProductShortName} and have sidecars injection enabled. This means that strict mTLS is enforced within the whole mesh. All requests to Knative Services require an mTLS connection, with the client having to send its certificate, except calls coming from OpenShift Routing.

* {ServerlessProductName} with {SMProductShortName} integration can only target *one* service mesh. Multiple meshes can be present in the cluster, but {ServerlessProductName} is only available on one of them.

* Changing the target `ServiceMeshMemberRoll` that {ServerlessProductName} is part of, meaning moving {ServerlessProductName} to another mesh, is not supported. The only way to change the targeted Service mesh is to uninstall and reinstall {ServerlessProductName}.

[id="prerequisites_serverless-ossm-setup"]
== Prerequisites

* You have access to an {product-title} account with cluster administrator access.

* You have installed the OpenShift CLI (`oc`).

* You have installed the {ServerlessProductShortName} Operator.

* You have installed the {SMProductName} 2.x Operator.

* The examples in the following procedures use the domain `example.com`. The example certificate for this domain is used as a certificate authority (CA) that signs the subdomain certificate.
+
To complete and verify these procedures in your deployment, you need either a certificate signed by a widely trusted public CA or a CA provided by your organization. Example commands must be adjusted according to your domain, subdomain, and CA.

* You must configure the wildcard certificate to match the domain of your {ocp-product-title} cluster. For example, if your {ocp-product-title} console address is `https://console-openshift-console.apps.openshift.example.com`, you must configure the wildcard certificate so that the domain is `*.apps.openshift.example.com`. For more information about configuring wildcard certificates, see the following topic about _Creating a certificate to encrypt incoming external traffic_.

* If you want to use any domain name, including those which are not subdomains of the default {ocp-product-title} cluster domain, you must set up domain mapping for those domains. For more information, see the {ServerlessProductName} documentation about xref:../../knative-serving/config-custom-domains/create-domain-mapping.adoc#serverless-create-domain-mapping_create-domain-mapping[Creating a custom domain mapping].

[IMPORTANT]
====
{ServerlessProductName} only supports the use of {SMProductName} functionality that is explicitly documented in this guide, and does not support other undocumented features.

Using {ServerlessProductShortName} 1.31 with {SMProductShortName} is only supported with {SMProductShortName} version 2.2 or later. For details and information on versions other than 1.31, see the "Red Hat OpenShift Serverless Supported Configurations" page.
====

include::modules/serverless-ossm-external-certs.adoc[leveloffset=+1]

// without kourier
[id="serverless-ossm-setup_integrating-ossm-with-serverless"]
== Integrating {SMProductShortName} with {ServerlessProductName}

You can integrate {SMProductShortName} 2.x with {ServerlessProductName} to enable advanced traffic management, security, and observability for your serverless applications. This section provides the steps to verify prerequisites, install and configure both components, and confirm that the integration is functioning as expected.

include::modules/serverless-ossm-verifying-installation-prerequisites.adoc[leveloffset=+2]
include::modules/serverless-ossm-installing-and-configuring-openshift-service-mesh.adoc[leveloffset=+2]
include::modules/serverless-ossm-installing-and-configuring-openshift-serverless.adoc[leveloffset=+2]
include::modules/serverless-ossm-verifying-the-integration.adoc[leveloffset=+2]

include::modules/serverless-ossm-enabling-serving-metrics.adoc[leveloffset=+1]
include::modules/serverless-ossm-disabling-network-policies.adoc[leveloffset=+1]
// with kourier
include::modules/serverless-ossm-secret-filtering-net-istio.adoc[leveloffset=+1]

[id="additional-resources_serverless-ossm-setup"]
[role="_additional-resources"]
== Additional resources
* link:https://access.redhat.com/articles/4912821[Red Hat OpenShift Serverless Supported Configurations]
* xref:../../knative-serving/kourier-and-istio-ingresses.adoc#kourier-and-istio-ingresses[Kourier and Istio ingresses]
