// This module is included in the following assemblies:
// * pac/creating-pipeline-runs-pac.adoc

:_mod-docs-content-type: PROCEDURE
[id="creating-pipeline-run-pac_{context}"]
= Creating a pipeline run in {pac}

You can create a pipeline run definition for {pac} in your repository and match it to an event, such as a pull request.

.Prerequisites

* You configured {pac} to integrate with your Git repository hosting service provider.

* You created a `Repository` custom resource (CR) to define the connection to your repository in {pac}.

. You have a `.tekton` directory in the root of your repository.

.Procedure

. Use any text editor to create a file with a `.yaml` or `.yml` extension in the `.tekton` directory.

. In this file, create a YAML specification for a `PipelineRun` CR. This specification can use all features of {pipelines-shortname}.

. Depending on the requirements of your pipeline run definition, complete any of the following optional steps. For more information about the components that you can create in these steps, see "Components of a pipeline run in {pac}".

** Create other files with a `.yaml` or `.yml` extension in the `.tekton` directory. In these files, provide definitions of resources that your pipeline run definition references.

** Use dynamic variables in your pipeline run specification.

** Add one or more {pac} resolver annotations to your pipeline run definition.

. Match the pipeline run to events by adding any of the annotations for matching pipeline run to events. For more information about matching the pipeline run to events, see "Components of a pipeline run in {pac}".

. Optional: Add one or more annotations that filter the matching events. For more information about filtering the events for matching the pipeline, see "Components of a pipeline run in {pac}".

. Optional: Add the annotation to enable automatic cancellation of the pipeline run in certain cases. For more information about enabling automatic cancellation, see "Components of a pipeline run in {pac}".

.Example {pac} pipeline run definition
[source,yaml]
----
apiVersion: tekton.dev/v1
kind: PipelineRun
metadata:
  name: maven-build
annotations:
  pipelinesascode.tekton.dev/task: "[git-clone]" # <1>
  pipelinesascode.tekton.dev/on-event: "[pull_request]" # <2>
  pipelinesascode.tekton.dev/on-target-branch: "[main, release]" # <3>
  pipelinesascode.tekton.dev/on-path-changed: "["src/**"]" # <4>
  pipelinesascode.tekton.dev/cancel-in-progress: "true" # <5>
spec:
  pipelineSpec:
    workspaces:
    - name: shared-workspace
      emptyDir: {}
    tasks:
      - name: fetch-repo
        taskRef:
          - name: git-clone # <6>
        params:
        - name: url
          value: {{ repo_url }} # <7>
        - name: revision
          value: {{ revision }} # <8>
        workspaces:
        - name: output
          workspace: shared-workspace
      - name: build-from-source
        taskRef:
          resolver: cluster
          params:
          - name: kind
            value: task
          - name: name
            value: maven
          - name: namespace
            value: openshift-pipelines
        workspaces:
        - name: source
          workspace: shared-workspace
----
<1> The `pipelinesascode.tekton.dev/task` annotation references the `git-clone` task from {tekton-hub}.
<2> The `pipelinesascode.tekton.dev/on-event` annotation matches the pipeline run to a pull request or merge request event.
<3> The `pipelinesascode.tekton.dev/on-target-branch` annotation specifies that a pull request into either the `main` branch or `release` branch triggers this pipeline run.
<4> The `pipelinesascode.tekton.dev/on-path-changed` annotation specifies that the pipeline run triggers only if the pull request contains changes to files under the `src` directory.
<5> The `pipelinesascode.tekton.dev/cancel-in-progress` annotation specifies that, if the pipeline run is started again for the same pull request, {pac} cancels the previous run.
<6> The pipeline run specification references the `git-clone` task by name. Because of the `pipelinesascode.tekton.dev/task` annotation, the {pac} resolver resolves this reference to the `git-clone` task from {tekton-hub}.
<7> {pac} replaces the `{{ repo_url }}` dynamic variable with the URL for the Git repository.
<8> {pac} replaces the `{{ revision }}` dynamic variable with the revision of the branch for which the pipeline run was started.
