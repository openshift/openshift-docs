// This module is included in the following assemblies:
// * pac/creating-pipeline-runs-pac.adoc

:_mod-docs-content-type: PROCEDURE
[id="creating-pipeline-run-pac_{context}"]
= Creating a pipeline run in {pac}

You can create a pipeline run definition for {pac} in your repository and match it to an event, such as a pull request.

.Prerequisites

* You configured {pac} to integrate with your Git repository hosting service provider.

* You created a `Repository` custom resource (CR) to define the connection to your repository in {pac}.

. You have a `.tekton` directory in the root of your repository.

.Procedure

. Create a file with a `.yaml` or `.yml` extension in the `.tekton` directory. In this file, create a YAML specification for a `PipelineRun` CR. This specification can use all features of {pipelines-shortname}.

. Optional: Create other files with a `.yaml` or `.yml` extension in the `.tekton` directory and provide definitions of resources that your pipeline run definition references, such as `Pipeline`, `Task`, or `StepAction` CRs.

. Optional: Use dynamic variables in your pipeline run specification. The {pac} resolver replaces these variables with values that represent the current context. For example, `{{ repo_url }}` is the current URL for the repository and `{{ revision }}` is the commit SHA on which the pipeline run was started.
+
For more information about dynamic variables, see the "Dynamic variables in a pipeline run specification" section.

. Optional: Add one or more {pac} resolver annotations to your pipeline run definition. For more information about these annotations, see the "{pac} resolver annotations" section.

. Match the pipeline run to events by adding any of the following annotations:

** A combination of the `pipelinesascode.tekton.dev/on-event` annotation, which defines a `pull request` or `push` event, and a `pipelinesascode.tekton.dev/on-target-branch` annotation, which defines the branch that the pull request or push event must target.

** A `pipelinesascode.tekton.dev/on-comment` annotation, which matches the pipeline run to a comment on a pull request by regular expression.

** A `pipelinesascode.tekton.dev/on-cel-expression` annotation, which matches the pipeline run if the specified Common Expression Language (CEL) expression evaluates to `true` on a pull request or push event.

. Optional: Add one or more annotations that filter the matching events:

** A `pipelinesascode.tekton.dev/on-path-changed` annotation is matched if the pull request or push event affect files in the specified paths.

** A `pipelinesascode.tekton.dev/on-path-changed-ignore` annotation excludes matching the event if the event changes _only_ files in the specified paths and does not change any other files in the repository.

** A `pipelinesascode.tekton.dev/on-label` annotation is matched if the pull request or push event has one of the specified labels.

. Optional: Add the `pipelinesascode.tekton.dev/cancel-in-progress: "true"` annotation to enable automatic cancellation of the pipeline run in certain cases.

.Example {pac} pipeline run definition
[source,yaml]
----
apiVersion: tekton.dev/v1
kind: PipelineRun
metadata:
  name: maven-build
annotations:
  pipelinesascode.tekton.dev/task: "[git-clone]" # <1>
  pipelinesascode.tekton.dev/on-event: "[pull_request]" # <2>
  pipelinesascode.tekton.dev/on-target-branch: "[main, release]" # <3>
  pipelinesascode.tekton.dev/on-path-changed: "["src/**"]" # <4>
  pipelinesascode.tekton.dev/cancel-in-progress: "true" # <5>
spec:
  pipelineSpec:
    workspaces:
    - name: shared-workspace
      emptyDir: {}
    tasks:
      - name: fetch-repo
        taskRef:
          - name: git-clone
        params:
        - name: url
          value: {{ repo_url }}
        - name: revision
          value: {{ revision }}
        workspaces:
        - name: output
          workspace: shared-workspace
      - name: build-from-source
        taskRef:
          resolver: cluster
          params:
          - name: kind
            value: task
          - name: name
            value: maven
          - name: namespace
            value: openshift-pipelines
        workspaces:
        - name: source
          workspace: shared-workspace
----
<1> This annotation references the `git-clone` task from {tekton-hub}.
<2> The pipeline run is matched to a pull request or merge request event.
<3> A pull request or merge request into either the `main` branch or `release` branch triggers this pipeline run.
