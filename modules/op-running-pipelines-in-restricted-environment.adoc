// Module included in the following assemblies:
//
// pipelines/creating-applications-with-cicd-pipelines

[id="op-running-pipelines-in-restricted-environment_{context}"]
=  Running pipelines in a restricted environment


To run OpenShift Pipelines in a disconnected cluster or a cluster provisioned in a restricted environment, you must ensure that either the Samples Operator is configured for a restricted network or a cluster administrator has created a cluster with a mirrored registry.

The following section uses the Pipelines Tutorial example to create a pipeline for an application in a restricted environment using a cluster with a mirrored registry.

.Procedure
To ensure that the front-end interface, `vote-ui`, and the back-end interface, `vote-api` of the `pipelines-tutorial` example work in a restricted environment, you must mirror the respective builder images from the mirror registry.

. For the front-end interface, `vote-ui`, verify that the required images tag is not imported:
+
[source,terminal]
----
$ oc describe is python -n openshift
----
+
.Example output
[source,terminal]
----
<<>>
----

. Mirror the supported image tag to the private registry:
+
//Replace code in double angular brackets
+
[source,terminal]
----
$ oc image mirror registry.access.redhat.com/rhscl/<<nodejs-10-rhel7>>:<tag> <private_registry>/<<rhscl/nodejs-10-rhel7>>:<tag>
----

. Import the image:
+
[source,terminal]
----
$ oc tag <mirror-registry>:<port>/rhscl/<<nodejs-10-rhel7>>:<tag> <<nodejs-10-rhel7>>:latest --scheduled
----
+
You must periodically re-import the image. The `--scheduled` flag enables automatic re-import of the image.

. Verify that the images with the given tag have been imported:
+
[source,terminal]
----
$ oc describe is python -n openshift
----
+
.Example output
+
[source,terminal]
----
<<>>
----

. For the back-end interface, `vote-api`, verify that the required images tag is not imported:
+
[source,terminal]
----
$ oc describe is golang -n openshift
----
+
.Example output
+
[source,terminal]
----
<<>>
----

. Mirror the supported image tag to the private registry:
+
[source,terminal]
----
$ oc image mirror registry.access.redhat.com/rhscl/<<nodejs-10-rhel7>>:<tag> <private_registry>/rhscl/<<nodejs-10-rhel7>>:<tag>
----

. Import the image:
+
[source,terminal]
----
$ oc tag <mirror-registry>:<port>/rhscl/<<nodejs-10-rhel7>>:<tag> <<nodejs-10-rhel7>>:latest --scheduled
----
+
You must periodically re-import the image. The --scheduled flag enables automatic re-import of the image.

. Verify that the images with the given tag have been imported:
+
[source,terminal]
----
$ oc describe is golang -n openshift
----
+
.Example output
+
[source,terminal]
----
<<>>
----
