// This module is included in the following assemblies:
// * release_notes/op-release-notes-1-21.adoc

:_mod-docs-content-type: REFERENCE
[id="op-release-notes-1-21-0_{context}"]
= Release notes for {pipelines-title} 1.21

With this update, {pipelines-title} General Availability (GA) 1.21 is available on {OCP} 4.15 and later versions.

[id="new-features-1-21-0_{context}"]
== New features

In addition to fixes and stability improvements, the following sections highlight what is new in {pipelines-title} 1.21:

//Example missing - https://issues.redhat.com/browse/SRVKP-8341
Override individual TaskRun timeouts in a PipelineRun::
* With this update, you can override the timeout for individual tasks within a PipelineRun using the `spec.taskRunSpecs[].timeout` field. This allows finer-grained control over task execution duration without affecting the overall PipelineRun timeout.

.Operator

//Example missing - https://issues.redhat.com/browse/SRVKP-6166
`legacyPipelineRbac` parameter for controlling pipeline service account permissions::
* Before this update, the pipeline service account automatically received the `edit` ClusterRole within its namespace, following the legacy RBAC behavior.
With this update, you can use the new `legacyPipelineRbac` parameter to control permissions:

** Set to `true` (default) to preserve the legacy behavior.

** Set to `false` to prevent the pipeline service account from receiving the `edit` ClusterRole, enforcing more restricted permissions by default.

+
[IMPORTANT]
====
Existing role bindings are not automatically removed from namespaces with the pipeline service account. You must remove them manually when changing this parameter on existing deployments.
====


.{pac}

Improved performance for GitLab project access control checks::
* With this update, {pac} caches the results of GitLab Project Access Control List (ACL) membership checks.
This optimization reduces repeated API calls to the GitLab service, improving performance and efficiency during permission validation.

//Example Missing - https://issues.redhat.com/browse/SRVKP-8900
Configure the number of lines in error log snippets::
* With this update, you can configure how many lines appear in error log snippets using the new `error-log-snippet-number-of-lines` setting.
The system also automatically truncates log snippets to 65,000 characters, preventing failures when posting check-run updates to the GitHub API due to its character limit.


Trigger and cancel PipelineRuns with GitLab commit comments on tags::
* With this update, you can trigger PipelineRuns by adding comments on GitLab commits associated with a Git tag. This enables version-specific control of CI/CD workflows and allows teams to trigger or cancel PipelineRuns tied to specific tagged versions, improving automation around release processes. For more information, see *<link-to-downstream>*.  

`opc pac cel` command for evaluating CEL expressions::
* A new command, `opc pac cel`, is added to the `opc` CLI. This command lets administrators interactively evaluate Common Expression Language (CEL) expressions against webhook payloads and headers. The key capabilities of the `opc pac cel` command are:

** Provider auto-detection: Automatically detects the webhook source (GitHub, GitLab, Bitbucket, Gitea) from the incoming payload.

** File input: Accept payloads and headers via JSON or plain text files using the -b and -H flags. Supports headers parsed from shell scripts (e.g., generated by gosmee).

** Interactive mode: Provides a prompt in the terminal to type CEL expressions, with tab completion for variables and payload fields.

** Variable access using:

*** Direct variables, for example `event` or `target_branch`.

*** Webhook payload fields, for example `body.action`.

*** HTTP headers, for example `headers['X-GitHub-Event']`.

*** {pac} parameters, for example `pac.revision`.

** Debugging: Quickly test and debug CEL expressions used in PipelineRun configurations against real webhook data.

:FeatureName: The `opc pac cel` command
include::snippets/technology-preview.adoc[]


.{tekton-results}

Fine-grained Results retention policies::
* With this update, {tekton-results} supports fine-grained retention policies. You can set different retention periods for PipelineRun and TaskRun results based on namespace, labels, annotations, and status. The first matching policy is applied; if none match, the `defaultRetention` period is used. 
Configure policies in the `tekton-results-config-results-retention-policy` config map using the `policies` key. Each policy includes a `selector` and a `retention` period: 
+
[source, yaml]
----
result:
    disabled: false
    is_external_db: false
    options:
      config maps:
        config-results-retention-policy:
          data:
          data:
          runAt: "0 2 * * *" # Run every day at 2:00 AM
            defaultRetention: "30d"
            policies:
              - name: "retain-critical-failures-long-term"
                selector:
                  matchNamespaces:
                    - "production"
                    - "prod-east"
                  matchLabels:
                    "criticality": ["high"]
                  matchStatuses:
                    - "Failed"
                retention: "180d"
              - name: "retain-annotated-for-debug"
                selector:
                  matchAnnotations:
                    "debug/retain": ["true"]
                retention: "14d"
              - name: "default-production-policy"
                selector:
                  matchNamespaces:
                    - "production"
                    - "prod-east"
                retention: "60d"
              - name: "short-term-ci-retention"
                selector:
                  matchNamespaces:
                    - "ci"
                retention: "10h"
----
+
This config map example:

** Runs the pruning job daily at 2:00 AM, as specified by the `runAt` cron schedule.

** Keeps failed Results in `production` or `prod-east` with `criticality: high` for 180 days.

** Keeps Results with annotation `debug/retain: "true"` for 14 days.

** Keeps other Results in `production` or `prod-east` for 60 days.

** Keeps Results in the `ci` namespace for 10 hours.

** Keeps all other Results for the default retention period (30 days).

.{tekton-cache}

//Possibly missing example? - https://issues.redhat.com/browse/SRVKP-8303
Improved {tekton-cache} support for Docker credentials::
* Before this update, {tekton-cache} required Docker secrets to include a `config.json` key.
With this update, Docker secrets without a `config.json` key are supported. The `DOCKER_CONFIG` parameter can point to any location containing either a `config.json` file or a `.dockerconfigjson` file, improving flexibility for private registry authentication.

.{manual-approval-gate}

//Possibly missing example? - https://issues.redhat.com/browse/SRVKP-7187 
Group support for Approval Task::
* With this update, the Approval Task supports group approvers. Specify group approvers using the `group:<groupName>` syntax in the `params` list. Any member of the group can approve or reject the task. An approval by any group member counts as a single approval, while a rejection by any member immediately counts as a single rejection and fails the task.This enhancement provides more flexible approval workflows by allowing teams to delegate approvals to groups rather than individuals.

[id="pipelines-breaking-changes-1-21-0"]
== Breaking changes


[id="pipelines-known-issues-1-21-0"]
== Known issues


[id="pipelines-fixed-issues-1-21-0"]
== Fixed issues

.Pipelines

* Before this update, the proxy webhook could timeout under high-concurrency workloads because it performed synchronous API calls to verify config map existence during pod admission.
With this update, the webhook uses optional config map volumes that gracefully handle missing CA bundles without blocking pod creation, eliminating timeout issues and improving scalability while maintaining full SSL certificate functionality.

* Before the update, the `prioritySemaphore` implementation could cause deadlocks, race conditions, and panics due to unsynchronized data access. With this update, the locking logic is corrected and all shared data is properly synchronized.

* Before the update, pods were retained only if a TaskRun was canceled. With this update, pods are also retained when a TaskRun times out if `keep-pod-on-cancel` is set to `true`.

* Before the update, YAML editor changes were not applied until the component was remounted. With this update, changes are immediately reflected using the `useEffect` hook.

* Before the update, TektonConfig container args could contain duplicates and `["-key","value"]` pairs. With this update, flags are normalized to `"-key=value"`` format and duplicates are removed.

.{pac}

* Before this update, when you posted GitOps commands, for example, `/ok-to-test`, as replies within GitLab merge request discussion threads, the commands were ignored and only commands in the top-level comment of a discussion were recognized.
With this update, the GitLab provider honors GitOps commands posted in replies within merge request threads, improving command recognition and workflow reliability.

* Before this update, when a pull request was opened by an unauthorized user on Bitbucket Data Center, the CI status was incorrectly shown as `Running` instead of `Pending`. With this fix, the status now correctly shows as `Pending` while awaiting administrator approval.

* Before the update, `opc-pac` CLI incorrectly bound `--namespace/-n` to kubeconfig and the `install info` command did not show repositories for a single CR. With this update, the CLI binds correctly and `install info` displays repositories properly.

* Before this update, the {pac} dynamic variable `revision` returned the Secure Hash Algorithm (SHA) of the original commit instead of the latest HEAD merge commit after upgrading to OpenShift Pipelines 1.19. With this update, the behavior is corrected—the revision variable now fetches the SHA of the HEAD merge commit as expected.

[id="pipelines-deprecated-features-1-21-0"]
== Deprecated features

