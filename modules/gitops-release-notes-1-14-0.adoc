// Module included in the following assembly:
//
// * release_notes/gitops-release-notes-1-14-0.adoc

:_mod-docs-content-type: REFERENCE

[id="gitops-release-notes-1-14-0_{context}"]
= Release notes for {gitops-title} 1.14.0

[role="_abstract"]
{gitops-title} 1.14.0 is now available on {OCP} 4.12, 4.13, 4.14, 4.15, 4.16, and 4.17.

[id="errata-updates-1-14.0_{context}"]
== Errata updates

[id="RHEA-2024:6787-gitops-1-14-0-security-update-advisory_{context}"]
=== RHEA-2024:6787 - {gitops-title} 1.14.0 security update advisory

Issued: 2024-09-18

The list of security fixes that are included in this release are documented in the following advisory:

* link:https://access.redhat.com/errata/RHEA-2024:6787[RHEA-2024:6787]

If you have installed the {gitops-title} Operator in the default namespace, run the following command to view the container images in this release:

[source,terminal]
----
$ oc describe deployment gitops-operator-controller-manager -n openshift-gitops-operator
----

[id="new-features-1-14-0_{context}"]
== New features

* With this update, users can customize permissions for the Application Controller component in a cluster-scoped Argo CD instance. The {gitops-title} Operator creates an aggregated cluster role, and you can configure its permissions to combine several cluster roles into a single one. link:https://issues.redhat.com/browse/GITOPS-4681[GITOPS-4681]

* With this update, the following enhancements have been introduced for multi-source application:
** You can access revision history and roll back to a specific version of a multi-source application. The *Details* view panel displays the most recent revision or commit details for each source in the multi-source application. The *History* and *Rollback* panels display the revision history associated with each source; you can select the version you want to roll back to. link:https://issues.redhat.com/browse/GITOPS-4647[GITOPS-4647]
** The new *SOURCES* tab displays all source parameters of a multi-source application. With the *SOURCES* tab, you can view and edit the parameter values by using a form in the web UI. link:https://issues.redhat.com/browse/GITOPS-4192[GITOPS-4192]

* With this update, you can extend the repo server storage by mounting persistent volumes. The repo server utilizes the `EmptyDir` default storage volume, which has limitations and might prove inadequate in scenarios involving numerous repositories, sizable repositories, or repositories containing large manifests. You can mount additional storage on demand by using the `.spec.repo.volumes` and `.spec.repo.volumeMounts` fields in the Argo CD custom resource (CR). link:https://issues.redhat.com/browse/GITOPS-4646[GITOPS-4646]
+
For more information, refer to the link:https://argocd-operator.readthedocs.io/en/latest/usage/ha/repo-server/#high-availability-for-repo-server[HA for Repo Server].

* With this update, you can implement an alternative sharding algorithm that utilizes consistent hashing with bounded loads. The algorithm ensures a uniform distribution of managed clusters across shards while minimizing the need for reshuffling during configuration changes, such as adjustments in the number of managed clusters or shards. link:https://issues.redhat.com/browse/GITOPS-3584[GITOPS-3584]

* With this update, {gitops-title} provides support for the `sidecar` and `init` containers for the Server and Application Controller components. You can configure the `sidecar` and `init` containers by using the `.spec.server.sidecarContainers`, `.spec.controller.sidecarContainers`, `.spec.server.initContainers`, and `.spec.controller.initContainers` fields in the Argo CD CR. link:https://issues.redhat.com/browse/GITOPS-5010[GITOPS-5010]
+
[source,YAML]
----
apiVersion: argoproj.io/v1beta1
kind: ArgoCD
metadata:
  name: example-argocd
spec:
  server:
    initContainers:
    - name: argocd-init
      image: nginx:latest
    sidecarContainers:
    - name: cmp
      image: busybox
----

* With this update, you can expose Argo CD Application labels on Kubernetes events generated by Argo CD. When events are created for applications that have specific label keys defined in the `resource.includeEventLabelKeys` field within the `argocd-cm` config map, the controller adds the matching labels to these events. This enhancement facilitates the filtering and processing of events based on the application labels. To set the `resource.includeEventLabelKeys` field in a {gitops-shortname} environment, use the `.spec.extraConfig` field in the Argo CD CR. The {gitops-shortname} Operator automatically adds these fields from the `.spec.extraConfig` field into the `argocd-cm` config map. link:https://issues.redhat.com/browse/GITOPS-3233[GITOPS-3233]
+
.Example 
[source,yaml]
----
apiVersion: argoproj.io/v1beta1
kind: ArgoCD
metadata:
  name: argocd-sample # <1>
  namespace: default # <2>
spec:
  extraConfig:
    resource.includeEventLabelKeys: team,env* # <3>
----
<1> Specifies the name of the Argo CD instance.
<2> Specifies the namespace where the Argo CD is installed.
<3> Specifies the label keys that match and are added onto Application events.
+
For more information, see link:https://argo-cd.readthedocs.io/en/latest/operator-manual/declarative-setup/#labels-on-application-events[Labels on Application Events].

* With this update, you can verify commit signatures for `ApplicationSet` CRD created using Git generators. link:https://issues.redhat.com/browse/GITOPS-3049[GITOPS-3049]
+
[NOTE]
====
The signature verification does not function with the templated project field in `ApplicationSet` CRD Git Generator.
====

[id="fixed-issues-1-14-0_{context}"]
== Fixed issues

* Before this update, users could not execute a rollback for multi-source applications in the Argo CD web UI or CLI. This update fixes the issues, and users can now carry out rollbacks for multi-source applications using the Argo CD web UI or CLI. link:https://issues.redhat.com/browse/GITOPS-3996[GITOPS-3996]

* Before this update, the `ApplicationSet` Controller role did not include the `list` and `watch` permissions for the `AppProject` resource. As a result, there were errors during the application generation process. This update fixes the issue by granting necessary permissions to the `ApplicationSet` Controller role. link:https://issues.redhat.com/browse/GITOPS-5401[GITOPS-5401]

* Before this update, Argo CD was unable to synchronize `PersistentVolume` resources on {OCP} v4.16 due to the introduction of the new `.status.lastPhaseTransitionTime` field in Kubernetes v1.29. This update fixes the issue by modifying the Kubernetes static scheme in Argo CD. link:https://issues.redhat.com/browse/GITOPS-5167[GITOPS-5167]

* Before this update, the {gitops-title} Operator included a race condition where the OpenShift Service CA created the TLS secret before the default TLS termination policy was set. As a result, the default policy was set as `Passthrough` instead of `Reencrypt`. This update fixes this race condition by verifying whether the secret was created by the OpenShift Service CA, ensuring that `Reencrypt` is used as the correct default policy. link:https://issues.redhat.com/browse/GITOPS-4947[GITOPS-4947]

* Before this update, you could not log in to the Argo CD web console UI after a Red Hat OpenShift Service on AWS cluster, that includes a {gitops-shortname} Operator and an Argo CD instance configured with Dex-based SSO, resumed from hibernation. The login screen would display an error indicating an invalid redirect URI in the Dex configuration. This update fixes the issue by ensuring that the correct Dex redirect URL is updated in the Argo CD configuration whenever the Argo CD server route is modified. link:https://issues.redhat.com/browse/GITOPS-4358[GITOPS-4358]

* Before this update, adding a self-signed TLS certificate for the ApplicationSet GitLab SCM Provider did not function as intended, as the certificate failed to mount on the required volume. This update fixes the issue by correcting the volume mount path and providing documentation on the usage of this feature. Users are now required to ensure that the config map's name is `argocd-appset-gitlab-scm-tls-certs-cm`. link:https://issues.redhat.com/browse/GITOPS-4801[GITOPS-4801]
+
[NOTE]
====
The key for the TLS Certificate config map must be labeled 'cert' because this serves as the file name for the mounted certificate. Other key names will not be effective due to an upstream bug that will be resolved in a future release. The following is an example of a config map you can use to mount your TLS certificate.
====
+
.Example 
[source,yaml]
----
apiVersion: v1
kind: ConfigMap
metadata:
  name: argocd-appset-gitlab-scm-tls-certs-cm # <1>
  namespace: test-1-32-appsets-scm-tls-mount # <2>
data:
  cert: |
    -----BEGIN CERTIFICATE-----
    ... (certificate contents) ...
    -----END CERTIFICATE-----
----
<1> Specifies the name of the ApplicationSet GitLab SCM Provider.
<2> Specifies the namespace where the ApplicationSet GitLab SCM Provider is defined.
+
For more information, see link:https://argocd-operator.readthedocs.io/en/latest/reference/argocd/#add-self-signed-tls-certificate-for-gitlab-scm-provider-to-applicationsets-controller[Add Self-signed TLS Certificate for Gitlab SCM Provider to ApplicationSet Controller].

[id="breaking-change-1-14-0_{context}"]
== Breaking change

[id="cluster-secrets-with-empty-values_{context}"]
=== Cluster secrets with empty secret values

* When you upgrade to {gitops-title} v1.14, cluster secrets with an empty project value are no longer classified as global secrets applicable to all `Applications` and `ApplicationSets` resources.
+
In previous versions of {gitops-shortname}, any `Application` or `ApplicationSet` resource could use a cluster secret that matches the URL specified in the `repoUrl` field. Starting from {gitops-title} v1.14, only cluster secrets scoped to an application's project will be considered for matching a repository URL.
+
As a result, if a cluster secret is designated to project A, an application assigned to project B will be unable to access that secret. To allow applications across various projects to use cluster secrets, you must remove the `project` field. 
+
For more information, see link:https://argo-cd.readthedocs.io/en/latest/operator-manual/upgrading/2.11-2.12/#cluster-secret-scoping-changes[Cluster secret scoping changes]. link:https://issues.redhat.com/browse/GITOPS-5623[GITOPS-5623]