// Module included in the following assemblies:
//
// * integration/integrate-with-ci-systems.adoc
// * operating/manage_security_policies/about-security-policies.adoc
// * operating/respond-to-violations.adoc

:_mod-docs-content-type: CONCEPT
[id="policy-enforcement-deploy_{context}"]
= Security policy enforcement for the deploy stage

{product-title} supports two forms of security policy enforcement for deploy-time policies: hard enforcement through the admission controller and soft enforcement by {product-title-short} Sensor. The admission controller blocks creation or updating of deployments that violate policy. If the admission controller is disabled or unavailable, Sensor can perform enforcement by scaling down replicas for deployments that violate policy to `0`.

[WARNING]
====
Policy enforcement can impact running applications or development processes. Before you enable enforcement options, inform all stakeholders and plan how to respond to the automated enforcement actions.
====

[id="hard-enforcement_{context}"]
== Hard enforcement

Hard enforcement is performed by the {product-title-short} admission controller. In clusters with admission controller enforcement, the Kubernetes or {ocp} API server blocks all noncompliant deployments. The admission controller blocks `CREATE` and `UPDATE` operations. Any pod create or update request that satisfies a policy configured with deploy-time enforcement enabled will fail.

[NOTE]
====
Kubernetes admission webhooks support only `CREATE`, `UPDATE`, `DELETE`, or `CONNECT` operations. The {product-title-short} admission controller supports only `CREATE` and `UPDATE` operations. Operations such as `kubectl patch`, `kubectl set`, and `kubectl scale` are PATCH operations, not UPDATE operations. Because PATCH operations are not supported in Kubernetes, {product-title-short} cannot perform enforcement on PATCH operations.
====

For blocking enforcement, you must enable the following settings for the cluster in {product-title-short}:

* *Enforce on Object Creates*: This toggle in the *Dynamic Configuration* section controls the behavior of the admission control service.
You must have the *Configure Admission Controller Webhook to listen on Object Creates* toggle in the *Static Configuration* section turned on for this to work.
* *Enforce on Object Updates*: This toggle in the *Dynamic Configuration* section controls the behavior of the admission control service.
You must have the *Configure Admission Controller Webhook to listen on Object Updates* toggle in the *Static Configuration* section turned on for this to work.

If you make changes to settings in the *Static Configuration* setting, you must redeploy the secured cluster for those changes to take effect.

[id="soft-enforcement_{context}"]
== Soft enforcement

Soft enforcement is performed by {product-title-short} Sensor. This enforcement prevents an operation from being initiated. With soft enforcement, Sensor scales the replicas to 0, and prevents pods from being scheduled. In this enforcement, a non-ready deployment is available in the cluster.

By design, Sensor only performs this soft enforcement once, to prevent trapping of update requests to scale the deployment back down again.

If soft enforcement is configured, and Sensor is down, then {product-title-short} cannot perform enforcement.

[id="namespace-exclusions_{context}"]
== Namespace exclusions

By default, {product-title-short} excludes certain administrative namespaces, such as the `stackrox`, `kube-system`, and `istio-system` namespaces, from enforcement blocking. The reason for this is that some items in these namespaces must be deployed for {product-title-short} to work correctly.

In addition, the {product-title-short} admission controller bypasses requests that originate from a `service` account in a `system` namespace. Consider this factor when deploying the CI/CD tool of your choice.

[id="enforcement-existing-deployments_{context}"]
== Enforcement on existing deployments

For existing deployments, policy changes only result in enforcement at the next detection of the criteria, when a Kubernetes event occurs. If you make changes to a policy, you must reassess policies by selecting *Policy Management* and clicking *Reassess All*. This action applies deploy policies on all existing deployments regardless of whether there are any new incoming Kubernetes events. If a policy is violated, then {product-title-short} performs enforcement.