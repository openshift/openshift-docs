// Module included in the following assemblies:
//
//Create a file with the YAML bits conditioned by platform.
// * machine_management/creating-infrastructure-machinesets.adoc
// * machine_management/creating_machinesets/creating-machineset-aws.adoc

:_content-type: REFERENCE
[id="mapi-machine-set-yaml-gcp_{context}"]
= Sample YAML for a machine set custom resource

This sample YAML defines a machine set and demonstrates the required, recommended, and optional values for parameters in the default machine sets the installation program creates. Some parameters that appear in the default machine sets, such as `creationTimestamp` and `managedFields`, are omitted for brevity. Additional parameters in the `providerSpec` section to configure options and enable features that are platform-specific are not included in this example.

[source,yaml]
----
include::snippets/mapi-machine-set-yaml-agnostic.adoc[]
        value:
          apiVersion: gcpprovider.openshift.io/v1beta1 <6>
          canIPForward: false
          credentialsSecret: <7>
            name: gcp-cloud-credentials
          deletionProtection: false
          disks: <8>
          - autoDelete: true
            boot: true
            image: <path_to_image> <9>
            labels: null
            sizeGb: 128
            type: pd-ssd
          gcpMetadata: <10>
          - key: <custom_metadata_key>
            value: <custom_metadata_value>
          kind: GCPMachineProviderSpec <11>
          machineType: <instance_type> <12>
          networkInterfaces:
          - network: <infrastructure_id>-network <1>
            subnetwork: <infrastructure_id>-<role>-subnet <1>
          projectID: <project_name> <13>
          region: <region> <14>
          serviceAccounts:
          - email: <infrastructure_id>-w@<project_name>.iam.gserviceaccount.com <1> <13>
            scopes:
            - https://www.googleapis.com/auth/cloud-platform
          tags:
          - <infrastructure_id>-<role> <1>
          userDataSecret: <15>
            name: worker-user-data
          zone: <region>-<zone> <16>
----
include::snippets/mapi-machine-set-yaml-agnostic-callouts.adoc[]
//The mapi-machine-set-yaml-agnostic snippet ends with callout <5>, so the first callout following that line must be <6>.
<6> The API version that the machine set uses. Do not change this value.
<7> The {product-title} credentials secret for the cluster type. Do not change this value.
<8> The disk details for machines created by this machine set.
<9> The path to the image that is used in current machine sets. You can obtain the path to the image by running the following command:
+
[source,terminal]
----
$ oc -n openshift-machine-api \
    -o jsonpath='{.spec.template.spec.providerSpec.value.disks[0].image}{"\n"}' \
    get machineset/<infrastructure_id>-<role>-<zone>
----
<10> Optional: Specify custom metadata in the form of a `key:value` pair. For example use cases, see the GCP documentation for link:https://cloud.google.com/compute/docs/metadata/setting-custom-metadata[setting custom metadata].
<11> The {product-title} resource kind for the cluster type. Do not change this value.
<12> The GCP instance type for machines created by this machine set.
<13> The name of the GCP project that you use for your cluster.
<14> The region to place machines on.
<15> The {product-title} user data secret for your cluster. Do not change this value.
<16> The zone within your region to place machines on. Be sure that your region supports the zone that you specify.
