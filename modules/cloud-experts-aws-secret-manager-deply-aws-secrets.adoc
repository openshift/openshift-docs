// Module included in the following assemblies:
//
// * cloud_experts_tutorials/cloud-experts-aws-secret-manager.adoc

:_mod-docs-content-type: PROCEDURE
[id="cloud-experts-aws-secret-manager-deply-aws-secrets_{context}"]
= Deploying the AWS Secrets and Configuration Provider

[role="_abstract"]

.Procedure
. Use Helm to register the secrets store CSI driver by running the following command:
+
[source,terminal]
----
$ helm repo add secrets-store-csi-driver \
    https://kubernetes-sigs.github.io/secrets-store-csi-driver/charts
----

. Update your Helm repositories by running the following command:
+
[source,terminal]
----
$ helm repo update
----

. Install the secrets store CSI driver by running the following command:
+
[source,terminal]
----
$ helm upgrade --install -n csi-secrets-store \
    csi-secrets-store-driver secrets-store-csi-driver/secrets-store-csi-driver
----

. Deploy the AWS provider by running the following command:
+
[source,terminal]
----
$ oc -n csi-secrets-store apply -f \
    https://raw.githubusercontent.com/rh-mobb/documentation/main/content/misc/secrets-store-csi/aws-provider-installer.yaml
----

. Check that both Daemonsets are running by running the following command:
+
[source,terminal]
----
$ oc -n csi-secrets-store get ds \
    csi-secrets-store-provider-aws \
    csi-secrets-store-driver-secrets-store-csi-driver
----

. Label the Secrets Store CSI Driver to allow use with the restricted pod security profile by running the following command:
+
[source,terminal]
----
$ oc label csidriver.storage.k8s.io/secrets-store.csi.k8s.io security.openshift.io/csi-ephemeral-volume-profile=restricted
----