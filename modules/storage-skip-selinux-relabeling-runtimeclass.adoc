// Module included in the following assemblies:
//
// * storage/understanding-persistent-storage.adoc

:_content-type: PROCEDURE
[id="storage-skip-selinux-relabeling-runtimeclass_{context}"]
= Skip SELinux Relabeling with a custom RuntimeClass

Add a custom `RuntimeClass` to skip the SELinux relabel process if the top level of the volume is found to have the correct label.

[IMPORTANT]
====
The volume will have to be labeled at least once and will be performed automatically by CRI-O. A container creation timeout might occur.
====

.Procedure

. Edit the CRI-O configuration file to include the following:
+
[source,text]
----
[crio.runtime.runtimes.selinux]
runtime_path = "/usr/bin/runc"
runtime_root = "/run/runc"
runtime_type = "oci"
allowed_annotations = ["io.kubernetes.cri-o.TrySkipVolumeSELinuxLabel"]
----

. Create a `MachineConfig` object to allow CRI-O to have a customized runtime class:
+
[source,yaml]
----
apiVersion: machineconfiguration.openshift.io/v1
kind: MachineConfig
metadata:
  labels:
    machineconfiguration.openshift.io/role: worker
  name: 99-worker-selinux-configuration
spec:
  config:
    ignition:
      version: 3.2.0
    storage:
      files:
      - contents:
          source: data:text/plain;charset=utf-8;base64...
        mode: 0640
        overwrite: true
        path: /etc/crio/crio.conf.d/01-selinux.conf
  osImageURL: ""
----

. Create the `RuntimeClass` object. The name must match as described in the CRI-O configuration file:
+
[source,yaml]
----
apiVersion: node.k8s.io/v1
kind: RuntimeClass
metadata:
  name: selinux
handler: selinux
----

. Configure the Pod to have `annotations:io.kubernetes.cri-o.TrySkipVolumeSELinuxLabel: "true"` in the `metadata` attribute, as well as the `runtimeClassName: selinux` set in the `spec` attribute:
+
[source,yaml]
----
apiVersion: v1
kind: Pod
metadata:
  name: sandbox
  annotations:
    io.kubernetes.cri-o.TrySkipVolumeSELinuxLabel: "true"
...
spec:
  runtimeClassName: selinux
...
----
+
When a pod is created, CRI-O operates the pod with the `runtimeClassName: selinux`, which is configured to process the annotation `io.kubernetes.cri-o.TrySkipVolumeSELinuxLabel: "true"`. The SELinux relabel process is skipped if the volume is already labeled correctly.