// Module included in the following assemblies:
//
// * rosa_backing_up_and_restoring_applications/backing-up-applications.adoc

:_mod-docs-content-type: PROCEDURE
[id="cleanup-a-backup-oadp-rosa-sts_{context}"]
= Cleaning a cluster after a backup with OADP and ROSA STS

If you need to uninstall the OpenShift API for Data Protection (OADP) Operator together with the backups and the S3 bucket, follow these instructions.

.Procedure

. Delete the workload by running the following command:
+
[source,terminal]
----
$ oc delete ns hello-world
----
. Delete the Data Protection Application (DPA) by running the following command:
+
[source,terminal]
----
$ oc -n openshift-adp delete dpa ${CLUSTER_NAME}-dpa
----
. Delete the cloud storage by running the following command:
+
[source,terminal]
----
$ oc -n openshift-adp delete cloudstorage ${CLUSTER_NAME}-oadp
----
+
[WARNING]
====
If this command hangs, you might need to delete the finalizer by running the following command:
[source,terminal]
----
$ oc -n openshift-adp patch cloudstorage ${CLUSTER_NAME}-oadp -p '{"metadata":{"finalizers":null}}' --type=merge
----
====
. Remove the Operator if it is no longer required by running the following command:
+
[source,terminal]
----
$ oc -n openshift-adp delete subscription oadp-operator
----
. Remove the namespace from the Operator:
+
[source,terminal]
----
$ oc delete ns openshift-adp
----

. Remove the backup and restore resources from the cluster, if they are no longer required, by running the following command:

+
[source,terminal]
----
$ oc delete backup hello-world
----
+
. To delete backup, restore and remote objects in AWS S3 run the following command:
+
[source,terminal]
----
$ velero backup delete hello-world
----
. Remove the Custom Resource Definitions (CRD) from the cluster, if you no longer need them, by running the following command:
+
[source,terminal]
----
$ for CRD in `oc get crds | grep velero | awk '{print $1}'`; do oc delete crd $CRD; done
----
. Delete the AWS S3 bucket by running the following commands:
+
[source,terminal]
----
$ aws s3 rm s3://${CLUSTER_NAME}-oadp --recursive
----
+
[source,terminal]
----
$ aws s3api delete-bucket --bucket ${CLUSTER_NAME}-oadp
----
. Detach the policy from the role by running the following command:
+
[source,terminal]
----
$ aws iam detach-role-policy --role-name "${ROLE_NAME}" \
  --policy-arn "${POLICY_ARN}"
----
. Delete the role by running the following command:
+
[source,terminal]
----
$ aws iam delete-role --role-name "${ROLE_NAME}"
----
