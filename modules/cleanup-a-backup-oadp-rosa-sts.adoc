// Module included in the following assemblies:
//
// * rosa_backing_up_and_restoring_applications/backing-up-applications.adoc

:_mod-docs-content-type: PROCEDURE
[id="cleanup-a-backup-oadp-rosa-sts_{context}"]
= Cleaning up after a backup with OADP and ROSA STS

After you complete a backup with {oadp-first} and {product-rosa} (ROSA) {sts-full} (STS) you need to do a data clean-up.

.Procedure

. Delete the workload by running the following command:
+
[source,bash]
----
$ oc delete ns hello-world
----
. Delete the Data Protection Application by running the following command:
+
[source,bash]
----
$ oc -n openshift-adp delete dpa ${CLUSTER_NAME}-dpa
----
. Delete the Cloud Storage by running the following command:
+
[source,bash]
----
$ oc -n openshift-adp delete cloudstorage ${CLUSTER_NAME}-oadp
----

[WARNING]
====
If this command hangs, you might need to delete the finalizer by running the following command:
[source,bash]
----
$ oc -n openshift-adp patch cloudstorage ${CLUSTER_NAME}-oadp -p '{"metadata":{"finalizers":null}}' --type=merge
----
====
. Remove the operator if it is no longer required by running the following command:
+
[source,bash]
----
$ oc -n openshift-adp delete subscription oadp-operator
----
. Remove the namespace from the Operator:
+
[source,bash]
----
$ oc delete ns openshift-adp
----

. Remove the backup and restore resources from the cluster if they are no longer required by running the following command:

+
[source,bash]
----
$ oc delete backup hello-world
----
+
. To delete backup, restore and remote objects in AWS S3 run the following command:
+
[source,bash]
----
$ velero backup delete hello-world
----
. Remove the Custom Resource Definitions (CRD) from the cluster if you no longer need them by running the following command:
+
[source,bash]
----
$ for CRD in `oc get crds | grep velero | awk '{print $1}'`; do oc delete crd $CRD; done
----
. Delete the AWS S3 bucket by running the following commands:
+
[source,bash]
----
$ aws s3 rm s3://${CLUSTER_NAME}-oadp --recursive
----
+
[source,bash]
----
$ aws s3api delete-bucket --bucket ${CLUSTER_NAME}-oadp
----
. Detach the policy from the role by running the following command:
+
[source,bash]
----
$ aws iam detach-role-policy --role-name "${ROLE_NAME}" \
  --policy-arn "${POLICY_ARN}"
----
. Delete the role by running the following command:
+
[source,bash]
----
$ aws iam delete-role --role-name "${ROLE_NAME}"
----
