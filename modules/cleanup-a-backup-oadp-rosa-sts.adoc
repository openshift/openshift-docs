// Module included in the following assemblies:
//
// * rosa_backing_up_and_restoring_applications/backing-up-applications.adoc

:_mod-docs-content-type: PROCEDURE
[id="cleanup-a-backup-oadp-rosa-sts_{context}"]
= Cleaning up after a backup with OADP and ROSA STS


. Delete the workload

+
[source,bash]
----
oc delete ns hello-world
----

. Delete the Data Protection Application

+
[source,bash]
----
oc -n openshift-adp delete dpa ${CLUSTER_NAME}-dpa
----

. Delete the Cloud Storage

+
[source,bash]
----
oc -n openshift-adp delete cloudstorage ${CLUSTER_NAME}-oadp
----

+
[WARNING]
====
If this command hangs, you may need to delete the finalizer:
====

+
[source,bash]
----
oc -n openshift-adp patch cloudstorage ${CLUSTER_NAME}-oadp -p '{"metadata":{"finalizers":null}}' --type=merge
----


. Remove the operator if it is no longer required:

+
[source,bash]
----
oc -n openshift-adp delete subscription oadp-operator
----


. Remove the namespace for the operator:

+
[source,bash]
----
oc delete ns openshift-adp
----


. Remove the backup and restore resources from the cluster if they are no longer required:

+
[source,bash]
----
oc delete backup hello-world
----

+
[source,bash]
----
oc delete restore hello-world
----

+
To delete the backup/restore and remote objects in s3

+
[source,bash]
----
velero backup delete hello-world
----

+
[source,bash]
----
velero restore delete hello-world
----


. Remove the Custom Resource Definitions from the cluster if you no longer wish to have them:

+
[source,bash]
----
for CRD in `oc get crds | grep velero | awk '{print $1}'`; do oc delete crd $CRD; done
----

+
[source,bash]
----
for CRD in `oc get crds | grep -i oadp | awk '{print $1}'`; do oc delete crd $CRD; done
----


. Delete the AWS S3 Bucket

+
[source,bash]
----
aws s3 rm s3://${CLUSTER_NAME}-oadp --recursive
----

+
[source,bash]
----
aws s3api delete-bucket --bucket ${CLUSTER_NAME}-oadp
----

. Detach the Policy from the role

+
[source,bash]
----
aws iam detach-role-policy --role-name "${ROLE_NAME}" \
  --policy-arn "${POLICY_ARN}"
----

. Delete the role

+
[source,bash]
----
aws iam delete-role --role-name "${ROLE_NAME}"
----
