// Module included in the following assemblies:
//
// * knative-serving/config-applications/configuring-revision-timeouts.adoc

:_mod-docs-content-type: PROCEDURE
[id="configuring-default-route-timeouts_{context}"]
= Configuring the default route timeouts per revision

By configuring the route timeouts per revision, you can fine-tune timeouts for workloads with unique requirements, such as AI or data processing applications, without impacting the global timeout settings for other services.
You can configure the timeouts of a specific revision by updating your `KnativeServing` custom resource (CR), the Service definition, and using the `serving.knative.openshift.io/setRouteTimeout` annotation to adjust the {ocp-product-title} route timeout.

.Procedure

. Set the `max-revision-timeout` annotation in your `KnativeServing` CR as you require:
+
[source,yaml]
----
apiVersion: operator.knative.dev/v1beta1
kind: KnativeServing
metadata:
  name: knative-serving
spec:
  config:
    defaults:
      max-revision-timeout-seconds: "900"
----

. Optional: Verify the termination grace period of an activator by running the following command:
+
[source,terminal]
----
$ oc get deployment activator -n knative-serving -o jsonpath="{.spec.template.spec.terminationGracePeriodSeconds}"

900
----

. If necessary for your cloud provider, adjust the load balancer timeout by running the following command:
+
.Load balancer timeout adjustment for AWS Classic LB 
[source,terminal]
----
$ oc -n openshift-ingress-operator patch ingresscontroller/default \
  --type=merge --patch='{"spec":{"endpointPublishingStrategy":  \
  {"type":"LoadBalancerService", "loadBalancer":  \
  {"scope":"External", "providerParameters":{"type":"AWS", "aws":  \
  {"type":"Classic", "classicLoadBalancer":  \
  {"connectionIdleTimeout":"20m"}}}}}}}'
----

. Set the timeout for your specific service:
+
[source,yaml]
----
apiVersion: serving.knative.dev/v1f
kind: Service
metadata:
  name: <your_service_name>
  annotations:
    serving.knative.openshift.io/setRouteTimeout: "800" <1>
spec:
  template:
    metadata:
      annotations:
#...
    spec:
      timeoutSeconds: 800 <2>
      responseStartTimeoutSeconds: 800 <3>
----
<1> This annotation sets the timeout for the {ocp-product-title} route. You can fine-tune this for each service instead of setting a global maximum.
<2> This ensures that the request does not exceed the specific value.
<3> This ensures that the response start timeout does not trigger before the max threshold is reached. The default value is `300`.

+
[IMPORTANT]
====
When using {SMProductShortName}, if the activator pod is stopped while a long-running request is in-flight, the request is interrupted.
To avoid request interruptions, you must adjust the value of the `terminationDrainDuration` field in the `ServiceMeshControlPlane` CR: 
[source,yaml]
----
apiVersion: maistra.io/v2
kind: ServiceMeshControlPlane
#...
spec: 
  techPreview:
      meshConfig:
        defaultConfig:
          terminationDrainDuration: 1000s <1>
#... 
----
<1> Ensure that the value exceeds the request duration to avoid the Istio proxy shutdown, which would interrupt the request.
====

.Verification

* If you are using Kourier, you can verify the current value of the timeout at the {ocp-product-title} route by running the following command:
+
[source,terminal]
----
$ oc get route <route-name> -n knative-serving-ingress ess -o jsonpath="{.metadata.annotations.haproxy\.router\.openshift\.io/timeout}"
800s
----
