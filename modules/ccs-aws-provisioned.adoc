// Module included in the following assemblies:
//
// * assemblies/aws-ccs.adoc

[id="ccs-aws-provisioned_{context}"]
= Provisioned AWS Infrastructure


This is an overview of the provisioned Amazon Web Services (AWS) components on a deployed {product-title} cluster. For a more detailed listing of all provisioned AWS components, see the link:https://access.redhat.com/documentation/en-us/openshift_container_platform/[{OCP} documentation].

[id="aws-policy-ec2_{context}"]
== EC2 instances

AWS EC2 instances are required to deploy the control plane and data plane functions of {product-title} in the AWS public cloud.

* Three m5.xlarge minimum (master nodes)
* Three m5.xlarge minimum (infrastructure nodes)
* Four m5.xlarge minimum but highly variable (compute nodes)

[id="aws-policy-ebs-storage_{context}"]
== EBS storage

Amazon EBS block storage is used for both local node storage and persistent volume storage.

Volume requirements for each EC2 instance:

- Master volume
* Size: 350GB
* Type: io1
* Input/output operations per second: 1000

- Infrastructure volume
* Size: 300GB
* Type: gp2
* Input/output operations per second: 100

- Compute volume
* Size: 300GB
* Type: gp2
* Input/output operations per second: 100

[id="aws-policy-elastic-load-balancers_{context}"]
== Elastic load balancers

Up to two Network Elastic Load Balancers (ELBs) for API and up to two Classic ELBs for application router. For more information, see the link:https://aws.amazon.com/elasticloadbalancing/features/#Details_for_Elastic_Load_Balancing_Products[ELB documentation for AWS].

[id="aws-policy-s3-storage_{context}"]
== S3 storage
The image registry and Elastic Block Store (EBS) volume snapshots are backed by AWS S3 storage. Pruning of resources is performed regularly to optimize S3 usage and cluster performance.

[NOTE]
====
Two buckets are required with a typical size of 2TB each.
====

[id="aws-policy-vpc_{context}"]
== VPC
Customers should expect to see one VPC per cluster. Additionally, the VPC needs the following configurations:

* *Subnets*: Two subnets for a cluster with a single availability zone, or six subnets for a cluster with multiple availability zones.

* *Router tables*: One router table per private subnet, and one additional table per cluster.

* *Internet gateways*: One Internet Gateway per cluster.

* *NAT gateways*: One NAT Gateway per public subnet.

[id="aws-policy-security-groups_{context}"]
== Security groups

AWS security groups provide security at the protocol and port access level; they are associated with EC2 instances and Elastic Load Balancers. Each security group contains a set of rules that filter traffic coming in and out of an EC2 instance. You must ensure the ports required for the OpenShift installation are open on your network and configured to allow access between hosts.

[cols="2a,2a,2a,2a",options="header"]
|===

|Group
|Type
|IP Protocol
|Port range


.4+|MasterSecurityGroup
.4+|`AWS::EC2::SecurityGroup`
|`icmp`
|`0`

|`tcp`
|`22`

|`tcp`
|`6443`

|`tcp`
|`22623`

.2+|WorkerSecurityGroup
.2+|`AWS::EC2::SecurityGroup`
|`icmp`
|`0`

|`tcp`
|`22`


.2+|BootstrapSecurityGroup
.2+|`AWS::EC2::SecurityGroup`

|`tcp`
|`22`

|`tcp`
|`19531`

|===
