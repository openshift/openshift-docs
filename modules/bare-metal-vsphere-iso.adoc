// Module included in the following assemblies:
//
// * machine_management/user_infra/adding-bare-metal-compute-vsphere-user-infra.adoc

:_mod-docs-content-type: PROCEDURE
[id="bare-metal-vsphere-iso_{context}"]
= Creating {op-system} machines using an ISO image

[role="_abstract"]
To add bare-metal compute machines to your {vmw-first} cluster, you must manually provision them using an {op-system} ISO image and the `coreos-installer` utility.

:FeatureName: Bare-metal nodes on vSphere clusters
include::snippets/technology-preview.adoc[]

.Prerequisites

* You have access to the {op-system} ISO image that matches your cluster version.
* You have an HTTP server accessible to the bare-metal machine to host the Ignition config file.
* You have disabled the {vmw-short} CSI driver.
* The OpenShift CLI (`oc`) is installed.

.Procedure

. Extract the Ignition config file for the worker node type from the cluster by running the following command:
+
[source,terminal,subs="+quotes"]
----
$ oc extract -n openshift-machine-api secret/worker-user-data-managed --keys=userData --to=- > worker.ign
----

. Upload the `worker.ign` Ignition config file to your HTTP server. Record the URL of this file.

. Validate that the Ignition file is accessible from the network. The following example uses `curl` to verify the file presence:
+
[source,terminal,subs="+quotes"]
----
$ curl -I http://<http_server>/worker.ign
----

. Boot the bare-metal machine using the {op-system} ISO image.

. From the installation console, run the `coreos-installer` command:
+
[source,terminal,subs="+quotes"]
----
$ sudo coreos-installer install /dev/sda \
    --ignition-url=http://<http_server>/worker.ign \
    --insecure-ignition \
    --platform=none
----
+
where:
+
`/dev/sda`:: Specifies the target install device for your hardware.
`<http_server>`:: Specifies the address of your web server.

. Reboot the machine:
+
[source,terminal,subs="+quotes"]
----
$ reboot
----

. Monitor the boot process. After the machine reboots, it attempts to join the cluster and generates certificate signing requests (CSRs).

.Verification

* Verify that the new compute machine has joined the cluster and is in the `Ready` state:
+
[source,terminal,subs="+quotes"]
----
$ oc get nodes
----