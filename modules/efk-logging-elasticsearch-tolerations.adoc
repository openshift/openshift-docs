// Module included in the following assemblies:
//
// * logging/efk-logging-elasticsearch.adoc

[id="efk-logging-elasticsearch-tolerations_{context}"]
= Using tolerations to control the Elasticsearch pod placement

You can use taints and tolerations to ensure that cluster logging pods 
run on specific nodes and that no other workload can run on those nodes.

You apply tolerations to Elasticsearch pods through the Cluster Logging Custom Resource (CR)
and apply taints to a node through the node specification. A taint on a node 
instructs the node to repel all pods that do not tolerate the taint.

By default, the Elasticsearch pods have the following toleration:

[source, yaml]
----
tolerations:
- effect: "NoExecute"
  key: "node.kubernetes.io/disk-pressure"
  operator: "Exists"
----

.Prerequisites

* Cluster logging and Elasticsearch must be installed.

.Procedure

. Use the following command to add taints and tolerations for cluster logging:
+
----
$ oc adm taint nodes <node-name> <key>=<value>:<effect>
----
+
For example:
+
----
$ oc adm taint nodes node1 key1=logging:NoExecute
----
+
This example places a taint on `node1` that has key `key1`, value `logging`, and taint effect `NoExecute`.
Nodes with the `NoExecute` effect schedule only pods that match the taint and remove existing pods
that do not match.

. Edit the `logstore` section of the Cluster Logging Custom Resource (CR) to configure a toleration for the Elasticsearch pods:
+
[source, yaml]
----
  logStore:
    type: "elasticsearch"
    elasticsearch:
      nodeCount: 1
      tolerations: 
      - key: "1"  <1>
        operator: "Exists"  <2>
        value: "logging" <3>
        effect: "NoExecute"  <4>
        tolerationSeconds: 6000  <5>
----
<1> Specify the key you added to the node.
<2> Specify the `Exists` operator to require the `key`/`value`/`effect` parameters to match. 
<3> Specify the value you added to the node.
<4> Specify the `NoExecute` effect.
<5> Optionally, specify the `tolerationSeconds` parameter to set how long a pod can remain bound to a node before being evicted.

This toleration matches the taint created by the `oc adm taint` command above. A pod with this toleration could be scheduled onto `node1`.

