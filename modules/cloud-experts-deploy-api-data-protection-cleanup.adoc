// Module included in the following assemblies:
//
// * cloud_experts_tutorials/cloud-experts-deploy-api-data-protection.adoc

:_mod-docs-content-type: PROCEDURE
[id="cloud-experts-deploy-api-data-protection-cleanup_{context}"]
=  Cleaning up

[role="_abstract"]
Clean up your AWS resources after completing this lab tutorial.

.Procedure
. Delete the workload:
+
[source,terminal]
----
$ oc delete ns hello-world
----

. Remove the backup and restore resources from the cluster if they are no longer required:
+
[source,terminal]
----
$ oc delete backups.velero.io hello-world
$ oc delete restores.velero.io hello-world
----

. To delete the backup/restore and remote objects in s3:
+
[source,terminal]
----
$ velero backup delete hello-world
$ velero restore delete hello-world
----

. Delete the Data Protection Application:
+
[source,terminal]
----
$ oc -n openshift-adp delete dpa ${CLUSTER_NAME}-dpa
----

. Delete the Cloud Storage:
+
[source,terminal]
----
$ oc -n openshift-adp delete cloudstorage ${CLUSTER_NAME}-oadp
----
+
[WARNING]
====
If this command hangs, you might need to delete the finalizer:
[source,terminal]
----
$ oc -n openshift-adp patch cloudstorage ${CLUSTER_NAME}-oadp -p '{"metadata":{"finalizers":null}}' --type=merge
----
====

. Remove the Operator if it is no longer required:
+
[source,terminal]
----
$ oc -n openshift-adp delete subscription oadp-operator
----

. Remove the namespace for the Operator:
+
[source,terminal]
----
$ oc delete ns redhat-openshift-adp
----

. Remove the Custom Resource Definitions from the cluster if you no longer wish to have them:
+
[source,terminal]
----
$ for CRD in `oc get crds | grep velero | awk '{print $1}'`; do oc delete crd $CRD; done
$ for CRD in `oc get crds | grep -i oadp | awk '{print $1}'`; do oc delete crd $CRD; done
----

. Delete the AWS S3 Bucket:
+
[source,terminal]
----
$ aws s3 rm s3://${CLUSTER_NAME}-oadp --recursive
$ aws s3api delete-bucket --bucket ${CLUSTER_NAME}-oadp
----

. Detach the Policy from the role:
+
[source,terminal]
----
$ aws iam detach-role-policy --role-name "${ROLE_NAME}" \
 --policy-arn "${POLICY_ARN}"
----

. Delete the role:
+
[source,terminal]
----
$ aws iam delete-role --role-name "${ROLE_NAME}"
----