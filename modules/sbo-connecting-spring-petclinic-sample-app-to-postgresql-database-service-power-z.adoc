[id="sbo-connecting-spring-petclinic-sample-app-to-postgresql-database-service-ibm-power-z_{context}"]
= Connecting the Spring PetClinic sample application to the PostgreSQL database service

To connect the sample application to the database service, you must create a `ServiceBinding` custom resource (CR) that triggers the {servicebinding-title} to project the binding data into the application.

.Procedure

. Create a `ServiceBinding` CR to project the binding data:
+
[source,terminal]
----
$ oc apply -f - << EOD
---
apiVersion: binding.operators.coreos.com/v1alpha1
kind: ServiceBinding
metadata:
    name: spring-petclinic-rest
    namespace: my-postgresql
spec:
    services: <1>
    - group: postgresql.dev4devs.com
      version: v1beta1
      kind: Database <2>
      name: sampledatabase
      version: v1alpha1
    application: <3>
      name: spring-petclinic-rest
      group: apps
      version: v1
      resource: deployments
EOD
----
<1> The list of service resources
<2> The CR of the database.
<3> The sample application that points to a deployment or any other similar resource with an embedded PodSpec.
+
The output verifies that the `ServiceBinding` CR is created to project the binding data into the sample application.
+
[source,terminal]
.Example output
----
servicebinding.binding.operators.coreos.com/spring-petclinic-rest created
----

. To verify that the binding is successful, check the status conditions of the binding resource:
+
[source,terminal]
----
$ oc get servicebindings spring-petclinic-rest -n my-postgresql -o jsonpath-as-json='{.status.conditions}'
----
+
[source,terminal]
.Example output
----
[
  [
    {
      "lastTransitionTime": "2021-09-06T13:42:28Z",
      "message": "",
      "reason": "DataCollected",
      "status": "True",
      "type": "CollectionReady",
    },
    {
      "lastTransitionTime": "2021-09-06T13:42:28Z",
      "message": "",
      "reason": "ApplicationUpdated",
      "status": "True",
      "type": "InjectionReady",
    },
    {
      "lastTransitionTime": "2021-09-06T13:42:28Z",
      "message": "",
      "reason": "ApplicationsBound",
      "status": "True",
      "type": "Ready",
    },
  ],
]
----
+
[source,terminal]
----
$ oc get pods
----
+
[source,terminal]
.Example output
----
NAME                                     READY   STATUS      RESTARTS   AGE
postgresql-operator-56bd6964c4-j2slb     1/1     Running     0          103m
sampledatabase-cbc655488-xjlxt           1/1     Running     0          94m
spring-petclinic-rest-1-build            0/1     Completed   0          23m
spring-petclinic-rest-5f59b79bd4-s6f2j   1/1     Running     0          2m19s
----
By default, the values from the binding data of the database service are projected as files into the workload container that runs the sample application.

. Once this is created, you can go to the topology to see the visual connection.
+
.Connecting spring-petclinic-rest to sampledatabase
image::img3_power.png[]

. To verify that the application is now connected to the database service, access the list of all pets:
+
[source,terminal]
----
$ oc rsh spring-petclinic-rest-5f59b79bd4-s6f2j
----
+
[source,terminal]
----
$ curl -X GET "http://localhost:9966/petclinic/api/pets" -H "accept: application/json"
----
+
[source,terminal]
.Example output
----
[{"id":1,"name":"Leo","birthDate":"2000/09/07","type":{"id":1,"name":"cat"},
"owner":{"id":1,"firstName":"George","lastName":"Franklin","address":"110...
----
+
The previous output shows the initially configured sample data and verifies that the application is now connected to the database service.