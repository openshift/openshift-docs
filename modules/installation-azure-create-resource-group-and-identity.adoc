// Module included in the following assemblies:
//
// * installing/installing_azure/installing-azure-user-infra.adoc

[id="installation-azure-create-resource-group-and-identity_{context}"]
= Creating the Azure resource group and identity

You must create a Microsoft Azure link:https://docs.microsoft.com/en-us/azure/azure-resource-manager/management/overview#resource-groups[resource group] and an identity for that resource group.
These are both used during the installation of your {product-title} cluster on
Azure.

.Prerequisites

* Configure an Azure account.

* Generate the Ignition config files for your cluster.

.Procedure

. Create the resource group in a supported Azure region:
+
----
$ az group create --name ${RESOURCE_GROUP} --location ${AZURE_REGION}
----

. Create an Azure identity for the resource group:
+
----
$ az identity create -g ${RESOURCE_GROUP} -n ${INFRA_ID}-identity
----
+
This is used to grant the required access to Operators in your cluster. For
example, this allows the Ingress Operator to create a public IP and its load
balancer. You must assign the Azure identity to a role.

. Grant the Contributor role to the Azure identity:

.. Export the following variables required by the Azure role assignment:
+
----
$ export PRINCIPAL_ID=`az identity show -g ${RESOURCE_GROUP} -n ${INFRA_ID}-identity --query principalId --out tsv`
$ export RESOURCE_GROUP_ID=`az group show -g ${RESOURCE_GROUP} --query id --out tsv`
----

.. Assign the Contributor role to the identity:
+
----
$ az role assignment create --assignee "${PRINCIPAL_ID}" --role 'Contributor' --scope "${RESOURCE_GROUP_ID}"
----
