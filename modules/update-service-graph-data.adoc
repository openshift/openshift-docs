[id="update-service-graph-data_{context}"]
= Mirroring the {product-title} Update Service graph data

The {product-title} Update Service requires a graph-data container image, from which the Update Service retrieves information about channel membership and blocked update edges.

.Prerequisites

* An link:https://cloud.redhat.com/openshift/install/pull-secret[{product-title} pull secret].
* A pull secret for the local registry.

.Procedure

. On a machine connected to the internet, retrieve the graph-data container image from the hosted services.

.. Configure the path to the directory on your removable media to host the mirrored images:
+
[source,terminal]
----
$ REMOVABLE_MEDIA_PATH=<path>
----

.. Configure the path to your {product-title} pull secret:
+
[source,terminal]
----
$ OCP_PULL_SECRET=<path>
----

.. Mirror the graph-data container image to the removable media:
+
[source,terminal]
----
$ oc image mirror -a "${OCP_PULL_SECRET}" --dir="${REMOVABLE_MEDIA_PATH}" FIXME-where-registry.redhat.ren:5443/ocp4/openshift4 file://openshift/graph-data:latest
----

. Transfer the removable media to your restricted network.

. On a computer that is connected to your restricted network, upload the graph-data container image to your local registry.

.. Configure the path to the directory that contains the mirrored images:
+
[source,terminal]
----
$ REMOVABLE_MEDIA_PATH=<path>
----

.. Configure the path to your local registry pull secret:
+
[source,terminal]
----
$ LOCAL_PULL_SECRET=<path>
----

.. Configure the local registry name and host port:
+
[source,terminal]
----
$ LOCAL_REGISTRY='<local_registry_host_name>:<local_registry_host_port>'
----
+
For `<local_registry_host_name>`, specify the registry domain name for your mirror
repository, and for `<local_registry_host_port>`, specify the port that it
serves content on.

.. Configure the local repository name:
+
[source,terminal]
----
$ LOCAL_REPOSITORY='<local_repository_name>'
----
+
For `<local_repository_name>`, specify the name of the repository to create in your
registry, such as `openshift/graph-data`.

.. Configure the local image tag:
+
[source,terminal]
----
$ LOCAL_TAG=latest
----

.. Mirror the graph-data container image to the local registry:
+
[source,terminal]
----
$ oc image mirror -a "${LOCAL_PULL_SECRET}" --from-dir="${REMOVABLE_MEDIA_PATH}" file://openshift/graph-data:latest "${LOCAL_REGISTRY}/${LOCAL_REPOSITORY}:${LOCAL_TAG}"
----
