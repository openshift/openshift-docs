// Module included in the following assemblies:
//
// * installing/installing-with-agent-based-installer/preparing-to-install-with-agent-based-installer.adoc

:_mod-docs-content-type: CONCEPT
[id="agent-install-networking_{context}"]
= About networking

The *rendezvous IP* must be known at the time of generating the agent ISO, so that during the initial boot all the hosts can check in to the assisted service.
If the IP addresses are assigned using a Dynamic Host Configuration Protocol (DHCP) server, then the `rendezvousIP` field must be set to an IP address of one of the hosts that will become part of the deployed control plane.
In an environment without a DHCP server, you can define IP addresses statically.

In addition to static IP addresses, you can apply any network configuration that is in NMState format. This includes VLANs and NIC bonds.

[id="agent-install-networking-DHCP_{context}"]
== DHCP

.Preferred method: `install-config.yaml` and `agent-config.yaml`

You must specify the value for the `rendezvousIP` field. The `networkConfig` fields can be left blank:

.Sample agent-config.yaml.file

[source,yaml]
----
apiVersion: v1alpha1
kind: AgentConfig
metadata:
  name: sno-cluster
rendezvousIP: <rendezvous_ip>
----
where:

<rendezvous_ip>:: Specifies the IP address for the rendezvous host.

[id="agent-install-networking-static_{context}"]
== Static networking

.. Preferred method: `install-config.yaml` and `agent-config.yaml`

+
.Sample agent-config.yaml.file
+
[source,yaml]
----
cat > agent-config.yaml << EOF
apiVersion: v1alpha1
kind: AgentConfig
metadata:
  name: sno-cluster
rendezvousIP: <rendezvous_ip>
hosts:
  - hostname: master-0
    interfaces:
      - name: eno1
        macAddress: <mac_address>
    networkConfig:
      interfaces:
        - name: eno1
          type: ethernet
          state: up
          mac-address: <mac_address>
          ipv4:
            enabled: true
            address:
              - ip: <host_ip>
                prefix-length: <prefix_length>
            dhcp: false
      dns-resolver:
        config:
          server:
            - <dns_server>
      routes:
        config:
          - destination: 0.0.0.0/0
            next-hop-address: <gateway>
            next-hop-interface: eno1
            table-id: 254
EOF
----
where:

<rendezvous_ip>:: Specifies the IP address for the rendezvous host. If a value is not specified for the `rendezvousIP` field, one address will be chosen from the static IP addresses specified in the `networkConfig` fields.
<mac_address>:: Specifies the MAC address of an interface on the host, used to determine which host to apply the configuration to.
<host_ip>:: Specifies the static IP address of the target bare metal host.
<prefix_length>:: Specifies the static IP address's subnet prefix for the target bare metal host.
<dns_server>:: Specifies the DNS server for the target bare metal host.
<gateway>:: Specifies the next hop address for the node traffic. This must be in the same subnet as the IP address set for the specified interface.

+
.. Optional method: {ztp} manifests

+
The optional method of the {ztp} custom resources comprises 6 custom resources; you can configure static IPs in the `nmstateconfig.yaml` file.

+
[source,yaml]
----
apiVersion: agent-install.openshift.io/v1beta1
kind: NMStateConfig
metadata:
  name: master-0
  namespace: openshift-machine-api
  labels:
    cluster0-nmstate-label-name: cluster0-nmstate-label-value
spec:
  config:
    interfaces:
      - name: eth0
        type: ethernet
        state: up
        mac-address: 52:54:01:aa:aa:a1
          ipv4:
            enabled: true
            address:
              - ip: <host_ip>
                prefix-length: <prefix_length>
            dhcp: false
      dns-resolver:
        config:
          server:
            - <dns_server>
      routes:
        config:
          - destination: 0.0.0.0/0
            next-hop-address: <gateway>
            next-hop-interface: eth0
            table-id: 254
    interfaces:
      - name: eth0
        macAddress: <mac_address>
----
where:

<host_ip>:: Specifies the static IP address of the target bare metal host.
<prefix_length>:: Specifies the static IP address's subnet prefix for the target bare metal host.
<dns_server>:: Specifies the DNS server for the target bare metal host.
<gateway>:: Specifies the next hop address for the node traffic. This must be in the same subnet as the IP address set for the specified interface.
<mac_address>:: Specifies the MAC address of an interface on the host, used to determine which host to apply the configuration to.

The rendezvous IP is chosen from the static IP addresses specified in the `config` fields.
