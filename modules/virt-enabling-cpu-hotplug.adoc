// Module included in the following assemblies:
//
// * virt/advanced_vm_management/virt-configuring-default-cpu-model.adoc

:_mod-docs-content-type: PROCEDURE
[id="virt-enabling-cpu-hotplug_{context}"]
= Enabling CPU hot plug

Use the CPU hot plug feature to enable the addition or removal of virtual CPUs while the virtual machine (VM) is in operation by configuring the VM workload.

[IMPORTANT]
====
The `VMLiveUpdateFeatures` feature gate must be added to the `HyperConverged` CR by an administrator before users can enable CPU hot plug.
====

== Enabling CPU hot plug on a cluster

.Procedure

. Add the `VMLiveUpdateFeatures` JSON annotation to the `HyperConverged` CR by running the following command:
+
[source,terminal,subs="attributes+"]
----
$ oc annotate --overwrite -n openshift-cnv hyperconverged kubevirt-hyperconverged kubevirt.kubevirt.io/jsonpatch='[{
     "op": "add",
     "path": "/spec/configuration/developerConfiguration/featureGates/-",
     "value": "VMLiveUpdateFeatures"
 }]'

----
+
Users can now enable CPU hot plug at the VM level.

. Optional: Set the `maxCPUSockets` value in the HyperConverged CR. By default, the `maxCpuSockets` value is four times the sockets value.
+
[source,yaml,subs="attributes+"]
----
apiVersion: kubevirt.io/v1
kind: KubeVirt
spec:
  configuration:
    liveUpdateConfiguration:
      maxCpuSockets: 8
----
+
[NOTE]
====
The VM-level `maxSockets` configuration takes precedence over the cluster-wide configuration.
====

== Enabling CPU hot plug on a virtual machine

.Prerequisites

* The `VMLiveUpdateFeatures` JSON annotation must be added to the `HyperConverged` CR by an administrator.

.Procedure

. Add the `cpu` field to the VM spec:
+
[source,yaml,subs="attributes+"]
----
apiVersion: kubevirt.io/v1
kind: VirtualMachine
spec:
  liveUpdateFeatures:
    cpu: {}
----
+
CPU hot plug is now enabled.

. Optional: Set the the `maxCpuSockets` value in the VM spec. By default, the `maxCpuSockets` value is four times the sockets value.
+
[source,yaml,subs="attributes+"]
----
apiVersion: kubevirt.io/v1
kind: VirtualMachine
spec:
  liveUpdateFeatures:
    cpu:
      maxSockets: 8
----
+

[NOTE]
====
The VM-level `maxSockets` configuration takes precedence over the cluster-wide configuration.
====