// Module included in the following assemblies:
//
// * installing/disconnected_install/installing-mirroring-disconnected-v2.adoc
// * updating/updating_a_cluster/updating_disconnected_cluster/mirroring-image-repository.adoc
// * microshift_running_apps/microshift_operators/microshift-operators-olm.adoc

:_mod-docs-content-type: PROCEDURE
[id="oc-mirror-dry-run-v2_{context}"]
= Performing a dry run for V2

You can use oc-mirror to perform a dry run, without actually mirroring any images. This allows you to review the list of images that would be mirrored. A dry run also allows you to catch any errors with your image set configuration early or use the generated list of images with other tools to carry out the mirroring operation. 

When performing a `dry-run` for the first time, you will receive `missing.txt` and `mapping.txt files`. Since there are no images present in the cache initially, these files will be generated. Running the command multiple times will give the same output, as the dry-run does not actually copy any data.

.Prerequisites

* You have access to the internet to obtain the necessary container images.
* You have installed the OpenShift CLI (`oc`).
* You have installed the `oc-mirror` CLI plugin.
* You have created the image set configuration file.

.Procedure

. Run the `oc mirror` command with the `--dry-run` flag to perform a dry run:
+
[source,terminal]
----
$ oc mirror --config <imageset-Config.yaml> <1>
file://dryrun <2>
--dry-run                                 <3>
----
<1> Pass in the image set configuration file that was created. This procedure assumes that it is named `imageset-config.yaml`.
<2> Specify the mirror registry. Nothing is mirrored to this registry as long as you use the `--dry-run` flag.
<3> Use the `--dry-run` flag to generate the dry run artifacts and not an actual image set file.
+
.Example output
[source,terminal]
----
[INFO]   : :warning:  --v2 flag identified, flow redirected to the oc-mirror v2 version. This is Tech Preview, it is still under development and it is not production ready.
[INFO]   : :wave: Hello, welcome to oc-mirror
[INFO]   : :gear:  setting up the environment for you...
[INFO]   : :twisted_rightwards_arrows: workflow mode: mirrorToDisk 
[INFO]   : :sleuth_or_spy:  going to discover the necessary images...
[INFO]   : :mag: collecting release images...
[INFO]   : :mag: collecting operator images...
[INFO]   : :mag: collecting additional images...
[WARN]   : :warning:  54/54 images necessary for mirroring are not available in the cache.
[WARN]   : List of missing images in : CLID-19/working-dir/dry-run/missing.txt.
please re-run the mirror to disk process
[INFO]   : :page_facing_up: list of all images for mirroring in : CLID-19/working-dir/dry-run/mapping.txt
[INFO]   : mirror time     : 9.641091076s
[INFO]   : :wave: Goodbye, thank you for using oc-mirror
----

. Navigate into the workspace directory that was generated:
+
[source,terminal]
----
$ cd oc mirror-workspace/
----

. Review the `mapping.txt` file that was generated.
+
This file contains a list of all images that would be mirrored.


["oc-mirror-dry-run-workflow"]
== Use-case scenarios for dry run

.Mirror to Disk

Use the following command:

[source,terminal]
----
$ oc mirror -c <image_set_config.yaml> --dry-run --v2
----

.Disk to Mirror

Use the following command:

[source,terminal]
----
$ oc mirror -c <image_set_config.yaml> --from <path of the tar file generated by mirrorToDisk> --dry-run --v2
----

.Mirror to Mirror

Use the following command:

[source,terminal]
----
$ oc mirror -c <image_set_config.yaml> --workspace <path of oc mirror workspace> target registry (example docker://localhost:6000) --dry-run --v2
----


