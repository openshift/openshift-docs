// Module included in the following assemblies:
//
// * installing/install_config/configuring-firewall.adoc

:_mod-docs-content-type: PROCEDURE
[id="network-commatrix-plugin_{context}"]
= Generating ingress network flow data using the `commatrix` plugin

The `commatrix` plugin for the `oc` command generates ingress network flow data from your cluster. You can also use the plugin to identify any differences between open ports on the host and expected ingress flows for your environment.

The plugin generates ingress flows to {product-title} services for the following environments:

* {product-title} on bare metal
* {sno-caps} with other platforms
* {product-title} on {aws-first}
* {sno-caps} on {aws-short}

The plugin outputs the network flow data in various formats, such as CSV or JSON.

.Prerequisites
* You installed the OpenShift CLI (`oc`).
* You logged in as a user with `cluster-admin` privileges.
* You installed the `Krew` plugin manager for `oc`. For more information, see "Installing Krew".
* You installed Go for building the plugin, or you downloaded a pre-built Go binary.
* You installed `git` for cloning the plugin repository.

.Procedure

. Install the `commatrix plugin` by using `Krew`. You can point `Krew` to the manifest file for the plugin by cloning the `commatrix` Github repository locally or by pointing `Krew` to the remote repository manifest file:

.. To install the plugin by cloning the repository, run the following commands:
+
[source,bash]
----
$ git clone https://github.com/openshift-kni/commatrix.git
----
+
[source,bash]
----
$ cd commatrix/cmd/
----
+
[source,bash]
----
$ oc krew install --manifest=commatrix-krew.yaml
----

.. To install the plugin by pointing `Krew` to the remote manifest file, run the following command:
+
[source,bash]
----
$ oc krew install --manifest-url=https://raw.githubusercontent.com/openshift-kni/commatrix/main/cmd/commatrix-krew.yaml
----

. Generate the network flow data by running the following command:
+
[source,bash]
----
$ oc commatrix generate
----
+
[NOTE]
====
By default, the plugin generates the network flow data in CSV format in a `communication-matrix` directory in your current working directory.
====

.Verification

* View the generated network flow data in the `communication-matrix` directory by running the following command:
+
[source,bash]
----
$ cat communication-matrix/communication-matrix.csv
----
+
.Example output
[source,bash]
----
Direction,Protocol,Port,Namespace,Service,Pod,Container,Node Role,Optional
Ingress,TCP,4194,kube-system,kubelet,konnectivity-agent,,,false
Ingress,TCP,9100,openshift-monitoring,node-exporter,node-exporter,kube-rbac-proxy,,false
Ingress,TCP,9103,openshift-ovn-kubernetes,ovn-kubernetes-node,ovnkube-node,kube-rbac-proxy-node,,false

...
----
