// Module included in the following assemblies:
//
// * virt/logging_events_monitoring/virt-events.html/virt-virtualization-alerts.adoc
:_content-type: REFERENCE
[id="virt-cnv-network-alerts_{context}"]
= Network alerts

Network alerts provide information about problems for the {VirtProductName} Network Operator.

//CnaoDown Alert
[id="CnaoDown_{context}"]
== CnaoDown alert

.Description

The cluster-network-addons-operator (CNAO) deploys additional networking components on top of the cluster. This alert occurs when the CNAO Operator is down.

.Reason

If the CNAO is down, then reconciliation of changes in the CNV components and deployment of those components fails.

.Troubleshoot

. Check the CNAO’s operator pod namespace.
+
[source,terminal]
----
$ export NAMESPACE="$(oc get deployment -A | grep cluster-network-addons-operator | awk '{print $1}')"
----

. Determine if the CNAO’s operator pod is down.
+
[source,terminal]
----
$ oc -n $NAMESPACE get pods -l name=cluster-network-addons-operator
----

. Check CNAO’s operator pod description and logs.
+
[source,terminal]
----
$ oc -n NAMESPACE describe pods -l name=cluster-network-addons-operator
----
+
[source,terminal]
----
$ oc -n $NAMESPACE logs -l name=cluster-network-addons-operator
----

.Troubleshoot

Open a support issue and provide the information gathered in the troubleshooting process.

//KubeMacPoolDown Alert
[id="KubeMacPoolDown_{context}"]
== KubeMacPoolDown alert

.Description

The KubeMacPool component allocates MAC addresses and prevents MAC address conflicts.

.Reason

If the KubeMacPool-manager pod is down, then the creation of `VirtualMachine` objects fails.

.Troubleshoot

. Determine the Kubemacpool-manager pod namespace and name.
+
[source,terminal]
----
$ export KMP_NAMESPACE="$(oc get pod -A --no-headers -l control-plane=mac-controller-manager | awk '{print $1}')"
----
+
[source,terminal]
----
$ export KMP_NAME="$(oc get pod -A --no-headers -l control-plane=mac-controller-manager | awk '{print $2}')"
----

. Check the Kubemacpool-manager pod description and logs to determine the source of the problem.
+
[source,terminal]
----
$ oc describe pod -n $KMP_NAMESPACE $KMP_NAME
----
+
[source,terminal]
----
$ oc logs -n $KMP_NAMESPACE $KMP_NAME
----

.Resolution

Open a support issue and provide the information gathered in the troubleshooting process.

//KubeMacPoolDuplicateMacsFound Alert
[id="KubeMacPoolDuplicateMacsFound_{context}"]
== KubeMacPoolDuplicateMacsFound alert

.Description

The KubeMacPool allocates MAC Addresses and prevents MAC Address conflicts. After opening the KubeMacPool, a scan of the cluster for MAC Addresses in virtual machines set on the managed namespaces occurs. This alert occurs if duplicate MAC addresses are found in the scan.

.Reason

Duplicate MAC Addresses on the same LAN causes unexpected and various connection issues in the network.

.Troubleshoot

. Determine the `kubemacpool-mac-controller` pod namespace and name.
+
[source,terminal]
----
$ oc get pod -A -l control-plane=mac-controller-manager --no-headers -o custom-columns=":metadata.namespace,:metadata.name"
----

. Extract the conflicting Mac Addresses from the kubemacpool-mac-controller pod.
+
[source,terminal]
----
$ oc logs -n <kubemacpool-namespace> <kubemacpool-mac-controller-pod-name> | grep "already allocated"
----
+
The extracted output contains the necessary information:
+
* The Mac Address with the conflict
* The current entry in the database (VM namespace, name, and interface)
* The rejected entry with the conflict (VM namespace, name, and interface)
+
An example of a log line is:
+
[source,terminal]
----
"mac address 02:00:ff:ff:ff:ff already allocated to vm/kubemacpool-test/testvm, br1, conflict with: vm/kubemacpool-test/testvm2, br1"
----

. Check the Kubemacpool-manager pod's pod description and logs.
+
[source,terminal]
----
$ oc describe pod -n $KMP_NAMESPACE $KMP_NAME
----
+
[source,terminal]
----
$ oc logs -n $KMP_NAMESPACE $KMP_NAME
----

.Resolution

. Inspect the duplicates.
. Update the VMs to remove the duplicate MAC Addresses.
. Once resolution of all the conflicts occurs, restart the `kubemacpool-mac-controller` pod.
+
[source,terminal]
----
$ oc delete pod -n <kubemacpool-namespace> <kubemacpool-mac-controller-pod-name>
----

//NetworkAddonsConfigNotReady Alert
[id="NetworkAddonsConfigNotReady_{context}"]
== NetworkAddonsConfigNotReady alert

.Description

The cluster-network-addons-operator (CNAO) deploys additional networking components on top of the cluster. This alert occurs when the CNAO custom resource (CR) NetworkAddonsConfig is not ready, indicating one of the deployed components is not ready.

.Reason

If CNAO component deployment fails, then some kubevirt networking scenarios also fail.

.Troubleshoot

. Check for messages on the `networkaddonsconfig` CR status.
+
[source,terminal]
----
$ oc get networkaddonsconfig -o custom-columns="":.status.conditions[*].message
----

. Identify which component is not ready and gather more information from it.
.. Extract the component deployment or daemonSet and namespace from the message.
+
For example, if the message is `DaemonSet "cluster-network-addons/kube-cni-linux-bridge-plugin" update is being processed...`, then the namespace is `cluster-network-addons` and DaemonSet name is `kube-cni-linux-bridge-plugin`.

.. Check the components’s pod YAML.
+
[source,terminal]
----
$ oc -n <component-namespace> get daemonset <daemonset-name> -o yaml
----

.. Check the component's pod description and logs.
+
[source,terminal]
----
$ oc -n <component-namespace> logs <pod-name>
----
+
[source,terminal]
----
$ oc -n <component-namespace> describe pod <pod-name>
----

.Troubleshoot

Open a support issue and provide the information gathered in the troubleshooting process.
