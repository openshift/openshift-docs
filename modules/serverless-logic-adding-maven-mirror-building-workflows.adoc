// Module included in the following assemblies:
// * serverless-logic/serverless-logic-configuring-custom-maven-mirrors.adoc


:_mod-docs-content-type: PROCEDURE
[id="serverless-logic-adding-maven-mirror-building-workflows_{context}"]
= Adding a Maven mirror when building workflows

You can configure a Maven mirror by setting the `MAVEN_MIRROR_URL` environment variable in the `SonataFlowBuild` or `SonataFlowPlatform` custom resources (CR). 

[NOTE]
====
The recommended approach is to update the `SonataFlowPlatform` CR. This ensures the mirror configuration is propagated automatically to all workflow builds within the platform scope.  
====

.Prerequisites 

* You have {ServerlessLogicOperatorName} installed on your cluster.
* You have created your {ServerlessLogicProductName} project. 
* You have access to a {ServerlessLogicProductName} project with the appropriate roles and permissions to create applications and other workloads in {ocp-product-title}.
* You have access to a custom Maven mirror or internal repository.

.Procedure

. Edit the `SonataFlowPlatform` CR to configure a Maven mirror for all workflow builds in a namespace, as shown in the following example:
+
.Example of Maven mirror configuration in a `SonataFlowPlatform` CR
[source,yaml]
----
apiVersion: sonataflow.org/v1alpha08
kind: SonataFlowPlatform
metadata:
  name: my-platform
spec:
  build:
    template:
      envs:
        - name: MAVEN_MIRROR_URL
          value: http://my.company.registry.local
----
+
This configuration applies to all workflow builds in the same namespace that use the `preview` profile. When a workflow builder instance runs, it updates the internal Maven settings file to use the specified mirror as the default for external locations such as Maven Central.

. Optional: If you need a specific configuration for a single workflow build, create the `SonataFlowBuild` CR before creating the corresponding `SonataFlow` CR. The `SonataFlowBuild` and `SonataFlow` CRs must have the same name. 
+
.Example of Maven mirror configuration in a `SonataFlowBuild` CR
[source,yaml]
----
apiVersion: sonataflow.org/v1alpha08
kind: SonataFlowBuild
metadata:
  name: my-workflow <1>
  annotations:
    sonataflow.org/restartBuild: "true" <2>
spec:
  # suppressed for brevity
  envs:
    - name: MAVEN_MIRROR_URL <3>
      value: http://my.company.registry.local
----
+
<1> The `SonataFlowBuild` CR must have the same name as the corresponding `SonataFlow` CR.  
<2> The `sonataflow.org/restartBuild: "true"` annotation forces the existing build to restart with the new configuration.  
<3> The `MAVEN_MIRROR_URL` environment variable specifies the custom Maven mirror.  
+
[NOTE]
====
You can use the `SonataFlowBuild` CR configuration only when you require workflow-specific behavior, for example, debugging. For general use, configure the `SonataFlowPlatform` CR instead.
====