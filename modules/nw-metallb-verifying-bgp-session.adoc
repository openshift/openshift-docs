:_mod-docs-content-type: PROCEDURE
[id="nw-metallb-verifying-bgp-session_{context}"]
= Verifying BGP session state

[role="_abstract"]
Once you configure MetalLB for border gateway protocol (BGP) mode, you can verify that the system has established BGP sessions and is advertising routes. You can examine the `BGPSessionStatus` custom resource (CR) and the `FRRNodeState` CR to troubleshoot BGP connectivity and confirm proper route advertisement.

[NOTE]
====
The `BGPSessionStatus` CR is updated at a regular poll interval of 2 minutes. It can take up to 2 minutes for the CR to reflect the actual BGP state.
====

.Prerequisites

* You have an {product-title} cluster with the MetalLB Operator installed.
* You have configured MetalLB for BGP mode with:
** An `IPAddressPool`
** A `BGPPeer` configuration
** A `BGPAdvertisement`
* You have deployed at least one `LoadBalancer` service.

.Procedure

. Check BGP session status by running the following command:
+
[source,terminal]
----
$ oc get bgpsessionstatus -o wide
----
+
This example output shows the BGP session status between each node and its configured BGP peers. Look for the `State` column to confirm that the session is `Established`.
+
[source,terminal]
----
NAMESPACE        NAME               NODE       PEER         VRF   BGP           BFD
frr-k8s-system   worker-2gjfq   	worker     10.89.0.64         Active        N/A
frr-k8s-system   worker-9gtnb    	worker     10.89.0.63         Established   N/A
frr-k8s-system   worker2-rknga  	worker2    10.89.0.66         Established   Up
frr-k8s-system   worker2-t7bfc  	worker2    172.30.0.2         Established   Down
----

. Check `FRRNodeState` to see the BGP configuration on each node by running the following command:
+
[source,terminal]
----
$ oc get frrnodestate -n metallb-system
----
+
The example output lists the `FRRNodeState` resources for each node where the MetalLB speaker is running.
+
[source,terminal]
----
NAME                 AGE
worker0.example.com  5m
----

. View the detailed BGP configuration and running state by running the following command for a specific node:
+
[source,terminal]
----
$ oc get frrnodestate worker0.example.com -n metallb-system -o yaml
----
+
The `status.runningConfig` field shows the FRR BGP configuration including configured BGP neighbors, route advertisements, and prefix lists.

. Verify that the system is advertising routes by checking the `FRRNodeState` resource for the relevant node with this command:
+
[source,terminal]
----
$ oc get frrnodestate _<node-name>_ -n metallb-system -o jsonpath='{.status.runningConfig}' | grep "network"
----
+
The output displays the network prefixes that BGP advertises. For example:
+
[source,terminal]
----
 address-family ipv4 unicast
  network 192.168.122.210/32
----
+
This confirms that BGP is advertising the service IP.
