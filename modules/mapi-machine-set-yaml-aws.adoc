// Module included in the following assemblies:
//
//Create a file with the YAML bits conditioned by platform.
// * machine_management/creating-infrastructure-machinesets.adoc
// * machine_management/creating_machinesets/creating-machineset-aws.adoc

ifeval::["{context}" == "creating-machineset-aws"]
:aws-mapi:
endif::[]

:_content-type: REFERENCE
[id="mapi-machine-set-yaml-aws_{context}"]
= Sample YAML for a machine set custom resource

This sample YAML defines a machine set and demonstrates the required, recommended, and optional values for parameters in the default machine sets the installation program creates. Some parameters that appear in the default machine sets, such as `creationTimestamp` and `managedFields`, are omitted for brevity. Additional parameters in the `providerSpec` section to configure options and enable features that are platform-specific are not included in this example. 

[source,yaml]
----
include::snippets/mapi-machine-set-yaml-agnostic.adoc[]
        value:
          ami:
            id: ami-<ami_id_value_string> <6>
          apiVersion: awsproviderconfig.openshift.io/v1beta1 <7>
          blockDevices: <8>
            - ebs:
                iops: 0
                volumeSize: 120
                volumeType: gp2
          credentialsSecret: <9>
            name: aws-cloud-credentials
          deviceIndex: 0
          iamInstanceProfile:
            id: <infrastructure_id>-<role>-profile <1>
          instanceType: <aws_instance_type> <10>
          kind: AWSMachineProviderConfig <11>
          placement: <12>
            availabilityZone: <region><zone>
            region: <region>
          securityGroups: <13>
            - filters:
                - name: tag:Name
                  values:
                    - <infrastructure_id>-<role>-sg <1>
          subnet: <14>
            filters:
              - name: tag:Name
                values:
                  - <infrastructure_id>-private-<region><zone> <1>
          tags: <15>
            - name: kubernetes.io/cluster/<infrastructure_id> <1>
              value: owned
          userDataSecret: <16>
            name: worker-user-data
----
include::snippets/mapi-machine-set-yaml-agnostic-callouts.adoc[]
//The mapi-machine-set-yaml-agnostic snippet ends with callout <5>, so the first callout following that line must be <6>.
<6> The {op-system-first} Amazon Machine Image (AMI) ID for your AWS zone for your {product-title} nodes. You can obtain the AMI ID by running the following command:
+
[source,terminal]
----
$ oc -n openshift-machine-api \
    -o jsonpath='{.spec.template.spec.providerSpec.value.ami.id}{"\n"}' \
    get machineset/<infrastructure_id>-worker-<zone>
----
<7> The API version that the machine set uses. Do not change this value.
<8> The configuration for the block devices that your cluster uses.
<9> The {product-title} credentials secret for the cluster type. Do not change this value.
<10> The Amazon EC2 instance type that your cluster uses.
<11> The {product-title} resource kind for the cluster type. Do not change this value.
<12> The region and availability zone placement details for your cluster.
<13> The security group details for your cluster.
<14> The subnet details for your cluster. You can obtain the subnet by running the following command:
+
[source,terminal]
----
$  oc -n openshift-machine-api \
    -o jsonpath='{.spec.template.spec.providerSpec.value.subnet}{"\n"}' \
    get machineset/<infrastructure_id>-<role>-<region><zone>
----
<15> The {product-title} tag for your cluster. #What is this actually?# Do not change this value.
<16> The {product-title} user data secret for your cluster. Do not change this value.

ifeval::["{context}" == "creating-machineset-aws"]
:!aws-mapi:
endif::[]
