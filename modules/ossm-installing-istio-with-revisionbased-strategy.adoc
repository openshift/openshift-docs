// Module included in the following assemblies:

// update/ossm-updating-openshift-service-mesh.adoc

:_mod-docs-content-type: PROCEDURE
[id="installing-istio-with-revisionbased-strategy_{context}"]
= Installing Istio with RevisionBased strategy

You can install the {istio} control plane, {istio} CNI, and the Bookinfo demo application using the `RevisionBased` update strategy.

[NOTE]
====
You can use the following section to understand the update process. You can skip this installation if the cluster already includes an {istio} deployment.
====

.Procedure

. Create the `istio-system` namespace by running the following command:
+
[source,terminal]
----
$ oc create ns istio-system
----

. Deploy the {istio} control plane using the `RevisionBased` update strategy. The following example configuration creates an `{istio}` resource named `default` in the `istio-system` namespace:
+
.Example configuration
[source,yaml]
----
apiVersion: sailoperator.io/v1
kind: Istio
metadata:
  name: default
spec:
  namespace: istio-system
  version: v1.24.3
  updateStrategy:
    type: RevisionBased
----

. Install the {istio} CNI plugin with the desired version. The following example configuration creates an `IstioCNI` resource named `default` in the `istio-cni` namespace:
+
.Example configuration
[source,yaml]
----
apiVersion: sailoperator.io/v1
kind: IstioCNI
metadata:
  name: default
spec:
  version: v1.24.3
  namespace: istio-cni
----

. Get the `IstioRevision` name by running the following command:
+
[source,terminal]
----
$ oc get istiorevision -n istio-system
----
+
.Example output
[source,terminal]
----
NAME              TYPE    READY   STATUS    IN USE   VERSION   AGE
default-v1-24-3   Local   True    Healthy   False    v1.24.3   3m4s
----
+
The `IstioRevision` name is in the format `<istio_resource_name>-<version>`.

. Configure application workloads to run in the cluster. The following example deploys the `bookinfo` application in the `bookinfo` namespace:

.. Create the `bookinfo` namespace by running the following command:
+
[source,terminal]
----
$ oc create ns bookinfo
----

.. Label the `bookinfo` namespace to enable sidecar injection by running the following command:
+
[source,terminal]
----
$ oc label namespace bookinfo istio.io/rev=<revision_name>
----

.. Install the `bookinfo` pods in the `bookinfo` namespace by running the following command:
+
[source,terminal]
----
$ oc apply -f https://raw.githubusercontent.com/openshift-service-mesh/istio/release-1.24/samples/bookinfo/platform/kube/bookinfo.yaml -n bookinfo
----

. Review the `Istio` resource by running the following command:
+
[source,terminal]
----
$ oc get istio -n istio-system
----
+
.Example output
+
[source,terminal]
----
NAME      REVISIONS   READY   IN USE   ACTIVE REVISION   STATUS    VERSION   AGE
default   1           1       1        default-v1-24-3   Healthy   v1.24.3   5m13s
----
+
The `IN USE` field shows `1` after you deploy the application.

. Confirm that the proxy version matches the control plane version by running the following command:
+
[source,terminal]
----
$ istioctl proxy-status 
----
+
The `VERSION` column should match the control plane version.
+
.Example output
+
[source,terminal]
----
NAME              TYPE    READY   STATUS    IN USE   VERSION   AGE
default-v1-24-3   Local   True    Healthy   True     v1.24.3   5m31s
----