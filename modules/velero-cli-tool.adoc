// Module included in the following assemblies:
//
// * backup_and_restore/application_backup_and_restore/troubleshooting.adoc
:_mod-docs-content-type: CONCEPT

[id="velero-cli-tool_{context}"]
= Velero CLI tool

You can obtain the Velero CLI tool by:

* Downloading the Velero CLI tool
* Accessing the Velero binary in the Velero deployment in the cluster


[id="velero-obtaining-by-downloading_{context}"]
== Downloading the Velero CLI tool

You can download and install the Velero CLI tool by following the instructions on the link:https://{velero-domain}/docs/v{velero-version}/basic-install/#install-the-cli[Velero documentation page].

The page includes instructions for:

* macOS by using Homebrew
* GitHub
* Windows by using Chocolatey

.Prerequisites

* You have access to a Kubernetes cluster, v1.16 or later, with DNS and container networking enabled.
* You have installed `kubectl` locally.

.Procedure

. Open a browser and navigate to link:https://{velero-domain}/docs/v{velero-version}/basic-install/#install-the-cli["Install the CLI" on the Velero website].
. Follow the appropriate procedure for macOS, GitHub, or Windows.
. Download the Velero version appropriate for your version of OADP and {product-title}.


[id="velero-oadp-version-relationship_{context}"]
=== OADP-Velero-{product-title} version relationship

[cols="3", options="header"]
|===
|OADP version |Velero version |{product-title} version
| 1.1.0 | link:https://{velero-domain}/docs/v1.9/[1.9] | 4.9 and later
| 1.1.1 | link:https://{velero-domain}/docs/v1.9/[1.9] | 4.9 and later
| 1.1.2 | link:https://{velero-domain}/docs/v1.9/[1.9] | 4.9 and later
| 1.1.3 | link:https://{velero-domain}/docs/v1.9/[1.9] | 4.9 and later
| 1.1.4 | link:https://{velero-domain}/docs/v1.9/[1.9] | 4.9 and later
| 1.1.5 | link:https://{velero-domain}/docs/v1.9/[1.9] | 4.9 and later
| 1.1.6 | link:https://{velero-domain}/docs/v1.9/[1.9] | 4.11 and later
| 1.1.7 | link:https://{velero-domain}/docs/v1.9/[1.9] | 4.11 and later
| 1.2.0 | link:https://{velero-domain}/docs/v1.11/[1.11] | 4.11 and later
| 1.2.1 | link:https://{velero-domain}/docs/v1.11/[1.11] | 4.11 and later
| 1.2.2 | link:https://{velero-domain}/docs/v1.11/[1.11] | 4.11 and later
| 1.2.3 | link:https://{velero-domain}/docs/v1.11/[1.11] | 4.11 and later
| 1.3.0 | link:https://{velero-domain}/docs/v1.12/[1.12] | 4.10-4.15
| 1.3.1 | link:https://{velero-domain}/docs/v1.12/[1.12] | 4.10-4.15
| 1.3.2 | link:https://{velero-domain}/docs/v1.12/[1.12] | 4.10-4.15
| 1.4.0 | link:https://{velero-domain}/docs/v1.14/[1.14] | 4.14-4.18
| 1.4.1 | link:https://{velero-domain}/docs/v1.14/[1.14] | 4.14-4.18
| 1.4.2 | link:https://{velero-domain}/docs/v1.14/[1.14] | 4.14-4.18
|===

[id="velero-obtaining-by-accessing-binary_{context}"]
== Accessing the Velero binary in the Velero deployment in the cluster

You can use a shell command to access the Velero binary in the Velero deployment in the cluster.

.Prerequisites

* Your `DataProtectionApplication` custom resource has a status of `Reconcile complete`.

.Procedure

* Enter the following command to set the needed alias:
+
[source,terminal]
----
$ alias velero='oc -n openshift-adp exec deployment/velero -c velero -it -- ./velero'
----

[id="oadp-debugging-oc-cli_{context}"]
== Debugging Velero resources with the OpenShift CLI tool

You can debug a failed backup or restore by checking Velero custom resources (CRs) and the `Velero` pod log with the OpenShift CLI tool.

[discrete]
[id="oc-velero-cr_{context}"]
== Velero CRs

Use the `oc describe` command to retrieve a summary of warnings and errors associated with a `Backup` or `Restore` CR:

[source,terminal]
----
$ oc describe <velero_cr> <cr_name>
----

[discrete]
[id="oc-velero-pod-logs_{context}"]
=== Velero pod logs

Use the `oc logs` command to retrieve the `Velero` pod logs:

[source,terminal]
----
$ oc logs pod/<velero>
----

[discrete]
[id="oc-velero-debug-logs_{context}"]
=== Velero pod debug logs

You can specify the Velero log level in the `DataProtectionApplication` resource as shown in the following example.

[NOTE]
====
This option is available starting from OADP 1.0.3.
====

[source,yaml]
----
apiVersion: oadp.openshift.io/v1alpha1
kind: DataProtectionApplication
metadata:
  name: velero-sample
spec:
  configuration:
    velero:
      logLevel: warning
----

The following `logLevel` values are available:

* `trace`
* `debug`
* `info`
* `warning`
* `error`
* `fatal`
* `panic`

It is recommended to use `debug` for most logs.


[id="migration-debugging-velero-resources_{context}"]
== Debugging Velero resources with the Velero CLI tool

You can debug `Backup` and `Restore` custom resources (CRs) and retrieve logs with the Velero CLI tool.

The Velero CLI tool provides more detailed information than the OpenShift CLI tool.

[discrete]
[id="velero-command-syntax_{context}"]
=== Syntax

Use the `oc exec` command to run a Velero CLI command:

[source,terminal,subs="attributes+"]
----
$ oc -n {namespace} exec deployment/velero -c velero -- ./velero \
  <backup_restore_cr> <command> <cr_name>
----

.Example
[source,terminal,subs="attributes+"]
----
$ oc -n {namespace} exec deployment/velero -c velero -- ./velero \
  backup describe 0e44ae00-5dc3-11eb-9ca8-df7e5254778b-2d8ql
----

[discrete]
[id="velero-help-option_{context}"]
=== Help option

Use the `velero --help` option to list all Velero CLI commands:

[source,terminal,subs="attributes+"]
----
$ oc -n {namespace} exec deployment/velero -c velero -- ./velero \
  --help
----


[discrete]
[id="velero-describe-command_{context}"]
=== Describe command

Use the `velero describe` command to retrieve a summary of warnings and errors associated with a `Backup` or `Restore` CR:

[source,terminal,subs="attributes+"]
----
$ oc -n {namespace} exec deployment/velero -c velero -- ./velero \
  <backup_restore_cr> describe <cr_name>
----

.Example
[source,terminal,subs="attributes+"]
----
$ oc -n {namespace} exec deployment/velero -c velero -- ./velero \
  backup describe 0e44ae00-5dc3-11eb-9ca8-df7e5254778b-2d8ql
----

The following types of restore errors and warnings are shown in the output of a `velero describe` request:

* `Velero`: A list of messages related to the operation of Velero itself, for example, messages related to connecting to the cloud, reading a backup file, and so on
* `Cluster`: A list of messages related to backing up or restoring cluster-scoped resources
* `Namespaces`: A list of list of messages related to backing up or restoring resources stored in namespaces

One or more errors in one of these categories results in a `Restore` operation receiving the status of `PartiallyFailed` and not `Completed`. Warnings do not lead to a change in the completion status.

[IMPORTANT]
====
* For resource-specific errors, that is, `Cluster` and `Namespaces` errors, the `restore describe --details` output includes a resource list that lists all resources that Velero succeeded in restoring. For any resource that has such an error, check to see if the resource is actually in the cluster.

* If there are `Velero` errors, but no resource-specific errors, in the output of a `describe` command, it is possible that the restore completed without any actual problems in restoring workloads, but carefully validate post-restore applications.
+
For example, if the output contains `PodVolumeRestore` or node agent-related errors, check the status of `PodVolumeRestores` and `DataDownloads`. If none of these are failed or still running, then volume data might have been fully restored.
====

[discrete]
[id="velero-logs-command_{context}"]
=== Logs command

Use the `velero logs` command to retrieve the logs of a `Backup` or `Restore` CR:

[source,terminal,subs="attributes+"]
----
$ oc -n {namespace} exec deployment/velero -c velero -- ./velero \
  <backup_restore_cr> logs <cr_name>
----

.Example
[source,terminal,subs="attributes+"]
----
$ oc -n {namespace} exec deployment/velero -c velero -- ./velero \
  restore logs ccc7c2d0-6017-11eb-afab-85d0007f5a19-x4lbf
----