// Module included in the following assembly:
//
// * hcp-backup-restore-dr.adoc

:_mod-docs-content-type: PROCEDURE
[id="restoring-etcd-snapshot-hosted-cluster_{context}"]
= Restoring an etcd snapshot on a hosted cluster

If you have a snapshot of etcd from your hosted cluster, you can restore it only during cluster creation.

.Prerequisites

* You took an etcd snapshot on a hosted cluster.

.Procedure

. Create a pre-signed URL to download your etcd snapshot from S3 without passing credentials to the etcd deployment by using the `aws` command-line interface (CLI).

.. Get the URL for the etcd snapshot by running the following command:
+
[source,terminal]
----
$ aws s3 presign s3://<bucket_name>/<hosted_cluster_name>-snapshot.db
----

. To restore an etcd snapshot, you can modify the output from the `create cluster --render` command.

.. Modify the `HostedCluster` specification to define a `restoreSnapshotURL` value by running the following command:
+
[source,terminal]
----
$ create cluster --render
----
+
.Example output
[source,yaml]
----
spec:
  etcd:
    managed:
      storage:
        persistentVolume:
          size: 4Gi
        type: PersistentVolume
        restoreSnapshotURL:
        - "<etcd_snapshot_url>" <1>
    managementType: Managed
----
<1> Replace `etcd_snapshot_url` with the URL you received earlier.

. Ensure that the secret that you referenced from the `spec.secretEncryption.aescbc` value contains the same AES key that you saved in the previous steps.
