// Module included in the following assemblies:
//
// storage/persistent_storage/persistent_storage_local/persistent-storage-using-lvms.adoc

:_mod-docs-content-type: CONCEPT
[id="about-lvmcluster_{context}"]
= About the LVMCluster custom resource

You can configure the `LVMCluster` custom resource (CR) to perform the following actions:

* Create LVM volume groups that you can use to provision persistent volume claims (PVCs).
* Configure a list of devices that you want to add to the LVM volume groups. 
* Configure the requirements to select the nodes on which you want to create an LVM volume group, and the thin pool configuration for the volume group.

After you have installed {lvms}, you must create an `LVMCluster` custom resource (CR).

.Example `LVMCluster` CR YAML file
[source,yaml]
----
apiVersion: lvm.topolvm.io/v1alpha1
kind: LVMCluster
metadata:
  name: my-lvmcluster
spec:
  tolerations:
  - effect: NoSchedule
    key: xyz
    operator: Equal
    value: "true"
  storage:
    deviceClasses: 
    - name: vg1  
      fstype: ext4 <1>
      default: true 
      nodeSelector: <1>
        nodeSelectorTerms: 
        - matchExpressions:
          - key: mykey
            operator: In
            values:
            - ssd
      deviceSelector: <1>
        paths: 
        - /dev/disk/by-path/pci-0000:87:00.0-nvme-1
        - /dev/disk/by-path/pci-0000:88:00.0-nvme-1
        optionalPaths:
        - /dev/disk/by-path/pci-0000:89:00.0-nvme-1
        - /dev/disk/by-path/pci-0000:90:00.0-nvme-1
      thinPoolConfig: 
        name: thin-pool-1
        sizePercent: 90 <1>
        overprovisionRatio: 10 
----
<1> Optional field

[discrete]
== Explanation of fields in the LVMCluster CR

The `LVMCluster` CR fields are described in the following table:

.`LVMCluster` CR fields
[cols=".^2,.^2,.^6a",options="header"]
|====

|Field|Type|Description

|`spec.storage.deviceClasses`
|`array`
|Contains the configuration to assign the local storage devices to the LVM volume groups. 

LVM Storage creates a storage class and volume snapshot class for each device class that you create. 

If you add or remove a device class, the update reflects in the cluster only after deleting and recreating the `topolvm-node` pod.

|`deviceClasses.name`
|`string`
|Specify a name for the LVM volume group (VG). 

|`deviceClasses.fstype`
|`string`
|Set this field to `ext4` or `xfs`. By default, this field is set to `xfs`.

|`deviceClasses.default`
|`boolean`
|Set this field to `true` to indicate that a device class is the default. Otherwise, you can set it to `false`. You can only configure a single default device class. 

|`deviceClasses.nodeSelector`
|`object`
|Contains the configuration to choose the nodes on which you want to create the LVM volume group. If this field is empty, all nodes without no-schedule taints are considered.

On the control-plane node, {lvms} detects and uses the additional worker nodes when the new nodes become active in the cluster. 

|`nodeSelector.nodeSelectorTerms`
|`array`
|Configure the requirements that are used to select the node.

|`deviceClasses.deviceSelector`
|`object`
|Contains the configuration to specify the paths to the devices that you want to add to the LVM volume group.

For more information, see "About adding devices to a volume group".

|`deviceSelector.paths`
|`array`
|Specify the device paths.

If the device path specified in this field does not exist, the `LVMCluster` CR moves to the `Failed` state.

|`deviceSelector.optionalPaths`
|`array`
| Specify the optional device paths.

If the device path specified in this field does not exist, {lvms} ignores the device without causing an error.

|`deviceClasses.thinPoolConfig`
|`object`
|Contains the configuration to create a thin pool in the LVM volume group.

|`thinPoolConfig.name`
|`string`
|Specify a name for the thin pool.

|`thinPoolConfig.sizePercent`
|`integer`
|Specify the percentage of space in the LVM volume group for creating the thin pool. 

By default, this field is set to 90. The minimum value that you can set is 10, and the maximum value is 90.

|`thinPoolConfig.overprovisionRatio`
|`integer`
|Specify a factor by which you can provision additional storage based on the available storage in the thin pool.

For example, if this field is set to 10, you can provision up to 10 times the amount of available storage in the thin pool.

To disable over-provisioning, set this field to 1.

|`thinPoolConfig.chunkSize`
|`integer`
|Specifies the statically calculated chunk size for the thin pool. This field is only used when the `ChunkSizeCalculationPolicy` field is set to `Static`. The value for this field must be configured in the range of 64 KiB to 1 GiB because of the underlying limitations of `lvm2`. 

If you do not configure this field and the `ChunkSizeCalculationPolicy` field is set to `Static`, the default chunk size is set to 128 KiB.

For more information, see "Overview of chunk size".

|`thinPoolConfig.chunkSizeCalculationPolicy`
|`string`
|Specifies the policy to calculate the chunk size for the underlying volume group. You can set this field to either `Static` or `Host`. By default, this field is set to `Static`. 

If this field is set to `Static`, the chunk size is set to the value of the `chunkSize` field. If the `chunkSize` field is not configured, chunk size is set to 128 KiB.

If this field is set to `Host`, the chunk size is calculated based on the configuration in the `lvm.conf` file.

For more information, see "Limitations to configure the size of the devices used in LVM Storage".

|====




