// Module is included in the following assemblies:
//
// * securing_openshift_gitops/managing-secrets-securely-using-sscsid-with-gitops.adoc

:_mod-docs-content-type: PROCEDURE
[id="gitops-managing-secrets-policies-and-roles-in-vault_{context}"]
= Managing Secrets, Policies, and Roles in Vault

To create a secret in Vault, define a Vault policy and configure a Kubernetes authentication role that enables a Kubernetes workload to retrieve the secret securely.

.Procedure

. Enable the KV Secrets Engine

.. Use the Key-Value (KV) Version 2 secrets engine to store arbitrary secrets with versioning support. Run the following command to enable the KV secrets engine at the path secret/:
+
[source,terminal]
----
$ vault secrets enable -path=secret/ kv
----

. Store a secret in Vault.

.. Store a secret using the KV Version 2 secrets engine. Run the following command to store the secret data, username and password, at path `secret/demo/config`:
+
[source,terminal]
----
$ vault kv put secret/demo/config username="demo-user" password="demo-pass"
----

. Create a Vault policy.

.. To create a policy that grants read access to the secret, run the following command:
+
[source,terminal]
----
$ vault policy write demo-app-policy -<<EOF
path "secret/demo/config" {
  capabilities = ["read"]
}
EOF
----
+
This `demo-app-policy` grants read access to the secret at `secret/demo/config` and is later linked to a Kubernetes role.

. Create a Kubernetes Authentication Role in Vault.

.. To create a role that binds a Kubernetes service account to the Vault policy, run the following command.
+
[source,terminal]
----
$ vault write auth/kubernetes/role/app \ bound_service_account_names=demo-app-sa \ bound_service_account_namespaces=demo-app \ policies=demo-app-policy \ ttl=24h
----
+
This allows any pod using the service account to authenticate to Vault and retrieve the secret.
+
Where:
+
* `<bound_service_account_names>` is the name of the Kubernetes service account that Vault trusts.
* `<bound_service_account_namespaces>` is the name of the namespace where the service account is located.
* `<policies>` is the name of the attached Vault policy.
* `<ttl>` is the `Time-to-live` value issued for the token.
