// Module included in the following assemblies:
// about/ossm-about-concepts.adoc

:_mod-docs-content-type: CONCEPT
[id="ossm-about-concepts-resources_{context}"]
= {SMProductName} resources

{SMProductName} is composed of two parts:

* {SMProductName} resources
* Kiali provided by Red Hat

Kiali provided by Red Hat is composed of three parts:

* {KialiProduct}
* Kiali Server
* {SMPlugin}

{SMProduct} integrates with the following:

* Observability components such as:
** OpenShift Monitoring
** {DTProductname}
** {OTELOperator}
* cert-manager
* Argo rollouts

{SMProductName} Operator manages the lifecycle of your Istio control planes. Instead of creating a new configuration schema, {SMProduct} Operator APIs are built around Istio's Helm chart APIs.

[NOTE]
====
* Though {SMProductName} APIs are built around Istio's Helm chart APIs, Helm charts are not supported.
* All installation and configuration options that are exposed by Istio's Helm charts are available through the {SMProductName} Custom Resource Definition (CRD) `values` fields.
====

[id="istio-resource_{context}"]
== Istio resource

The `Istio` resource is used to manage your Istio control planes. It is a cluster-wide resource, because the Istio control plane operates in and requires access to the entire cluster.

To select a namespace to run the control plane pods in, you can use the `spec.namespace` field.

[NOTE]
====
The `spec.namespace` field is immutable: in order to move a control plane to another namespace, you must remove the `Istio` resource and recreate it with a different `spec.namespace`.
====

You can access all `Istio` custom resource definition (CRD) options through `spec.values` fields:

.Example `Istio` resource CRD
[source,yaml]
----
apiVersion: sailoperator.io/v1
kind: Istio
metadata:
  name: default
spec:
  version: v1.22.3
  namespace: istio-system
  updateStrategy:
    type: InPlace
  values:
    pilot:
      resources:
        requests:
          cpu: 100m
          memory: 1024Mi
----

You can run the following command to see all the customization options:

[source, terminal]
----
$ oc explain istios.spec.values
----
//Helm charts can only be used with istio-csr and Helm charts are a temporary work around for istio-csr. This might get confusing for users, so a NOTE was added.

To perform canary updates of the control plane, {SMProduct} supports multiple {istio} versions. You can set the `version` field to the new version by either using the full version or the `v<x>.<y>-latest` alias to automatically select the latest version for a specific minor version. For example, setting `v1.23-latest` ensures that the Operator maintains the latest version of {istio} 1.23.

{SMProduct} supports two different update strategies for your control planes:

`InPlace`:: The {SMProduct} Operator immediately replaces your existing control plane resources with the ones for the new version.

`RevisionBased`:: Uses Istio's canary update mechanism by creating a second control plane to which you can migrate your workloads to complete the update.

After creating an Istio resource, {SMProduct} generates a revision name for the resource based on the `updateStrategy`, and creates a corresponding `IstioRevision`.

[id="istiorevision-resource_{context}"]
== IstioRevision resource

The `IstioRevision` is a cluster-wide resource and the lowest-level API {SMProduct} provides. It is usually not created by the user, but by the Operator itself. Its schema closely resembles that of the `Istio` resource - but instead of representing the state of a control plane you want to be present in your cluster, it represents a revision of that control plane.

A revision of the control plane you want to be present in your cluster is an instance of Istio with a specific version and revision name, and its revision name can be used to add workloads or entire namespaces to the mesh. For example: by using the `istio.io/rev=<REVISION_NAME>` label.

You can think of the relationship between the `Istio` and `IstioRevision` resources as similar to the relationship between Kubernetes' replica set and pod: a replica set can be created by users and results in the automatic creation of pods, which will trigger the instantiation of your containers.

Similarly, users create an `Istio` resource which instructs the {SMProduct} Operator to create a matching `IstioRevision` resource, which then in turn triggers the creation of the Istio control plane. To do that, the {SMProduct} Operator will copy all of your relevant configuration from the `Istio` resource to the `IstioRevision` resource.

[id="istiorevisiontag-resource_{context}"]
== IstioRevisionTag resource

The `IstioRevisionTag` resource represents a stable revision tag that functions as an alias for Istio control plane revisions. With the stable tag, `prod`, you can use the label `istio.io/rev=prod` to inject proxies into your workloads. When you perform an upgrade to a control plane with a new revision name, you can update your tag to point to the new revision instead of having to relabel your workloads and namespaces. For more information, see link:https://istio.io/latest/docs/setup/upgrade/canary/#stable-revision-labels[Stable revision labels] (Istio documentation).

You can use the `IstioRevisionTag` resource with the {SMProduct} Operator. Therefore you can reference both an `IstioRevision` and an `Istio` resource. When using an `Istio` resource, after you update your control plane, the underlying `IstioRevision` resource changes, and the {SMProduct} Operator automatically updates your revision tag. You only need to restart your deployments to re-inject the new proxies.

The `IstioRevisionTag` has one field in its `spec:` field, `targetRef`, which can reference an `Istio` or `IstioRevision` resource. After deploying the `IstioRevisionTag`, you can use both the `istio.io/rev=default` and `istio-injection=enabled` labels to inject proxies into your workloads.

[Important]
====
The `istio-injection` label can only be used for revisions and revision tags that have the name `default`, like the `IstioRevisionTag` resource in the following example:

.Example `IstioRevisionTag` resource
[source,yaml]
----
apiVersion: sailoperator.io/v1
kind: IstioRevisionTag
metadata:
  name: default
spec:
  targetRef:
    kind: Istio <1>
    name: prod  <2>
----
<1> This value can be either `Istio` or `IstioRevision`.
<2> The name of the `Istio` or `IstioRevision` resource.
====

[id="istiocni-resource_{context}"]
== IstioCNI resource

The lifecycle of Istio's Container Network Interface (CNI) plugin is managed separately when using {SMProduct} Operator. To install Istio's CNI plugin, you create an `IstioCNI` resource.

The `IstioCNI` resource is a cluster-wide resource as it installs a daemon set that operates on all nodes of your cluster. You can select a version by setting the `spec.version` field, as you can see in the example that follows. To update the CNI plugin, change the version field to the version you want to install. Like the `Istio` resource, it also has a `values` field that exposes all of the options provided in the `istio-cni` chart:

.Example `IstioCNI` resource
[source,yaml]
----
apiVersion: sailoperator.io/v1
kind: IstioCNI
metadata:
  name: default
spec:
  version: v1.22.3
  namespace: istio-cni
  values:
    cni:
      cniConfDir: /etc/cni/net.d
      excludeNamespaces:
      - kube-system
----

//commenting out in case it is needed when more resources are added
//[role="_additional-resources"]
//[id="additional-resources_{context}"]
//== Additional resources


//== Kiali --> own module
//== Tracing --> own module
//== Metrics --> own module
//== cert-manager --> own module
//== Argo rollouts -- own module