// Module included in the following assemblies:
//
// * logging/cluster-logging-upgrading.adoc

[id="cluster-logging-updating-prereqs_{context}"]
= Prerequisites for updating

Updating cluster logging to 4.5 also upgrades your cluster to use Elasticsearch 6.  Before updating cluster logging to 4.5, you must perform the following tasks to prepare your cluster to work with the new version of Elasticsearch.

.Prerequisites

* Update cluster logging from 4.5 to 4.6.

* Make sure the cluster logging status is healthy:
+
** All Pods are `ready`.
** Elasticsearch cluster is healthy.

.Procedure

As a user of logging, I want to search my application logs and filter them by label before and after upgrade of the log stack
oc exec <elasticsearch-pod> -- es_util --query='_cat/indices' 

As a user of logging, I want to create Kibana visualizations for my logs
4.4 and prior relies on logging team's impl of multitenancy which is additionally dependent on the original data model.  Any saved objects will likely be of no use since they will reference a data structure that will be curated out of the cluster over time.  We may need to provide a mechanism for admins to allow export of old objects into the new indices.  Users will need to be advised how to fix their visualizations to map to the new data model. 
A user's old profile will not be accessible since OD utilizes a different naming convention than we provided.


As an administrator of logging, I want to search my infrastructure logs and filter them by label (if appropriate) before and after upgrade of the log stack


As an administrator of logging, I want logs to continue to flow to log storage without intervention after upgrade of the log stack

Upgrading the CLO to 4.5 will cause it to remove the previous version of Kibana and create an instance of the new Kibana CRD so that the EO will deploy the new version of Kibana.

Upgrade Kibana

Reindex to create a backup

Kibana is different, index management, new data structure, changed view, no project indices

Indices beginning with project.* are aliased to: app
Indices beginning with .operations.* are aliased to infra

Open Distro changes?

https://bugzilla.redhat.com/show_bug.cgi?id=1836238
https://bugzilla.redhat.com/show_bug.cgi?id=1827431
