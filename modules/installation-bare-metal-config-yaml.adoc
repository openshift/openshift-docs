// Module included in the following assemblies:
//
// * installing/installing_bare_metal/installing-bare-metal-network-customizations.adoc
// * installing/installing_bare_metal/installing-bare-metal.adoc
// * installing/installing_bare_metal/installing-restricted-networks-bare-metal.adoc
// * installing/installing_ibm_z/installing-ibm-z.adoc
// * installing/installing_ibm_z/installing-ibm-z-kvm.adoc
// * installing/installing_ibm_power/installing-ibm-power.adoc
// * installing/installing_ibm_power/installing-restricted-networks-ibm-power.adoc
// * installing/installing_ibm_z/installing-restricted-networks-ibm-z.adoc
// * installing/installing_ibm_z/installing-restricted-networks-ibm-z-kvm.adoc
// * installing/installing_platform_agnostic/installing-platform-agnostic.adoc
// * installing/installing-rhv-restricted-network.adoc

ifeval::["{context}" == "installing-restricted-networks-bare-metal"]
:restricted:
endif::[]
ifeval::["{context}" == "installing-ibm-z"]
:ibm-z:
endif::[]
ifeval::["{context}" == "installing-ibm-z-kvm"]
:ibm-z-kvm:
endif::[]
ifeval::["{context}" == "installing-restricted-networks-ibm-z"]
:ibm-z:
:restricted:
endif::[]
ifeval::["{context}" == "installing-restricted-networks-ibm-z-kvm"]
:ibm-z-kvm:
:restricted:
endif::[]
ifeval::["{context}" == "installing-ibm-power"]
:ibm-power:
endif::[]
ifeval::["{context}" == "installing-restricted-networks-ibm-power"]
:ibm-power:
:restricted:
endif::[]
ifeval::["{context}" == "installing-platform-agnostic"]
:agnostic:
endif::[]
ifeval::["{context}" == "installing-rhv-restricted-network"]
:rhv:
endif::[]


[id="installation-bare-metal-config-yaml_{context}"]
ifndef::ibm-z,ibm-z-kvm,ibm-power,agnostic,rhv[]
= Sample `install-config.yaml` file for bare metal
endif::ibm-z,ibm-z-kvm,ibm-power,agnostic,rhv[]
ifdef::ibm-z,ibm-z-kvm[]
= Sample `install-config.yaml` file for IBM Z
endif::ibm-z,ibm-z-kvm[]
ifdef::ibm-power[]
= Sample `install-config.yaml` file for IBM Power Systems
endif::ibm-power[]
ifdef::agnostic[]
= Sample `install-config.yaml` file for other platforms
endif::agnostic[]
ifdef::rhv[]
= Sample `install-config.yaml` file for RHV
endif::rhv[]

You can customize the `install-config.yaml` file to specify more details about
your {product-title} cluster's platform or modify the values of the required
parameters.

[source,yaml]
----
apiVersion: v1
baseDomain: example.com <1>
compute: <2>
- hyperthreading: Enabled <3>
  name: worker
  replicas: 0 <4>
ifeval::["{context}" == "installing-ibm-z"]
  architecture : s390x
endif::[]
ifeval::["{context}" == "installing-ibm-z-kvm"]
  architecture : s390x
endif::[]
ifeval::["{context}" == "installing-restricted-networks-ibm-z"]
  architecture : s390x
endif::[]
ifeval::["{context}" == "installing-restricted-networks-ibm-z-kvm"]
  architecture : s390x
endif::[]
ifeval::["{context}" == "installing-ibm-power"]
  architecture : ppc64le
endif::[]
ifeval::["{context}" == "installing-restricted-networks-ibm-power"]
  architecture : ppc64le
endif::[]
controlPlane: <2>
  hyperthreading: Enabled <3>
  name: master
  replicas: 3 <5>
ifeval::["{context}" == "installing-ibm-z"]
  architecture : s390x
endif::[]
ifeval::["{context}" == "installing-ibm-z-kvm"]
  architecture : s390x
endif::[]
ifeval::["{context}" == "installing-restricted-networks-ibm-z"]
  architecture : s390x
endif::[]
ifeval::["{context}" == "installing-restricted-networks-ibm-z-kvm"]
  architecture : s390x
endif::[]
ifeval::["{context}" == "installing-ibm-power"]
  architecture : ppc64le
endif::[]
ifeval::["{context}" == "installing-restricted-networks-ibm-power"]
  architecture : ppc64le
endif::[]
metadata:
  name: test <6>
networking:
  clusterNetwork:
  - cidr: 10.128.0.0/14 <7>
    hostPrefix: 23 <8>
ifndef::openshift-origin[]
  networkType: OpenShiftSDN
endif::openshift-origin[]
ifdef::openshift-origin[]
  networkType: OVNKubernetes
endif::openshift-origin[]
  serviceNetwork: <9>
  - 172.30.0.0/16
platform:
  none: {} <10>
ifndef::openshift-origin[]
fips: false <11>
endif::openshift-origin[]
ifndef::restricted[]
ifndef::openshift-origin[]
pullSecret: '{"auths": ...}' <12>
endif::openshift-origin[]
ifdef::openshift-origin[]
pullSecret: '{"auths": ...}' <11>
endif::openshift-origin[]
ifndef::openshift-origin[]
sshKey: 'ssh-ed25519 AAAA...' <13>
endif::openshift-origin[]
ifdef::openshift-origin[]
sshKey: 'ssh-ed25519 AAAA...' <12>
endif::openshift-origin[]
endif::restricted[]
ifdef::restricted[]
ifndef::openshift-origin[]
pullSecret: '{"auths":{"<local_registry>": {"auth": "<credentials>","email": "you@example.com"}}}' <12>
endif::openshift-origin[]
ifdef::openshift-origin[]
pullSecret: '{"auths":{"<local_registry>": {"auth": "<credentials>","email": "you@example.com"}}}' <11>
endif::openshift-origin[]
ifndef::openshift-origin[]
sshKey: 'ssh-ed25519 AAAA...' <13>
endif::openshift-origin[]
ifdef::openshift-origin[]
sshKey: 'ssh-ed25519 AAAA...' <12>
endif::openshift-origin[]
endif::restricted[]
ifdef::restricted[]
ifndef::openshift-origin[]
additionalTrustBundle: | <14>
  -----BEGIN CERTIFICATE-----
  ZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZ
  -----END CERTIFICATE-----
imageContentSources: <15>
- mirrors:
ifdef::ibm-z,ibm-z-kvm[]
  - <local_repository>/ocp4/openshift4
  source: quay.io/openshift-release-dev/ocp-release
- mirrors:
  - <local_repository>/ocp4/openshift4
  source: quay.io/openshift-release-dev/ocp-v4.0-art-dev
endif::ibm-z,ibm-z-kvm[]
ifndef::ibm-z,ibm-z-kvm[]
  - <local_registry>/<local_repository_name>/release
  source: quay.io/openshift-release-dev/ocp-release
- mirrors:
  - <local_registry>/<local_repository_name>/release
  source: quay.io/openshift-release-dev/ocp-v4.0-art-dev
endif::ibm-z,ibm-z-kvm[]
endif::openshift-origin[]
ifdef::openshift-origin[]
additionalTrustBundle: | <13>
  -----BEGIN CERTIFICATE-----
  ZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZ
  -----END CERTIFICATE-----
imageContentSources: <14>
- mirrors:
ifdef::ibm-z,ibm-z-kvm[]
  - <local_repository>/ocp4/openshift4
  source: quay.io/openshift-release-dev/ocp-release
- mirrors:
  - <local_repository>/ocp4/openshift4
  source: quay.io/openshift-release-dev/ocp-v4.0-art-dev
endif::ibm-z,ibm-z-kvm[]
ifndef::ibm-z,ibm-z-kvm[]
  - <local_registry>/<local_repository_name>/release
  source: quay.io/openshift-release-dev/ocp-release
- mirrors:
  - <local_registry>/<local_repository_name>/release
  source: quay.io/openshift-release-dev/ocp-v4.0-art-dev
endif::ibm-z,ibm-z-kvm[]
endif::openshift-origin[]
endif::restricted[]
----
<1> The base domain of the cluster. All DNS records must be sub-domains of this
base and include the cluster name.
<2> The `controlPlane` section is a single mapping, but the `compute` section is a
sequence of mappings. To meet the requirements of the different data structures,
the first line of the `compute` section must begin with a hyphen, `-`, and the
first line of the `controlPlane` section must not. Although both sections
currently define a single machine pool, it is possible that future versions
of {product-title} will support defining multiple compute pools during
installation. Only one control plane pool is used.
<3> Whether to enable or disable simultaneous multithreading (SMT), or `hyperthreading`. By default, SMT is enabled to increase the performance of your machines' cores. You can disable it by setting the parameter value to `Disabled`. If you disable SMT, you must disable it in all cluster machines; this includes both control plane and compute machines.
+
[NOTE]
====
Simultaneous multithreading (SMT) is enabled by default. If SMT is not enabled in your BIOS settings, the `hyperthreading` parameter has no effect.
====
+
[IMPORTANT]
====
If you disable `hyperthreading`, whether in the BIOS or in the `install-config.yaml`, ensure that your capacity planning accounts for the dramatically decreased machine performance.
====
<4> You must set the value of the `replicas` parameter to `0`. This parameter
controls the number of workers that the cluster creates and manages for you,
which are functions that the cluster does not perform when you
use user-provisioned infrastructure. You must manually deploy worker
machines for the cluster to use before you finish installing {product-title}.
<5> The number of control plane machines that you add to the cluster. Because
the cluster uses these values as the number of etcd endpoints in the cluster, the
value must match the number of control plane machines that you deploy.
<6> The cluster name that you specified in your DNS records.
<7> A block of IP addresses from which pod IP addresses are allocated. This block must not overlap with existing physical networks. These IP addresses are used for the pod network. If you need to access the pods from an external network, you must configure load balancers and routers to manage the traffic.
<8> The subnet prefix length to assign to each individual node. For example, if
`hostPrefix` is set to `23`, then each node is assigned a `/23` subnet out of
the given `cidr`, which allows for 510 (2^(32 - 23) - 2) pod IPs addresses. If
you are required to provide access to nodes from an external network, configure
load balancers and routers to manage the traffic.
<9> The IP address pool to use for service IP addresses. You can enter only one IP address pool. This block must not overlap with existing physical networks. If you need to access the services from an external network, configure load balancers and routers to manage the traffic.
<10> You must set the platform to `none`. You cannot provide additional platform
configuration variables for
ifndef::ibm-z,ibm-z-kvm,ibm-power,rhv[your platform.]
ifdef::ibm-z,ibm-z-kvm[IBM Z infrastructure.]
ifdef::ibm-power[IBM Power Systems infrastructure.]
ifdef::rhv[RHV infrastructure.]
ifndef::openshift-origin[]
+
[WARNING]
====
Red Hat Virtualization does not currently support installation with user-provisioned infrastructure on the oVirt platform. Therefore, you must set the platform to `none`, allowing {product-title} to identify each node as a bare-metal node and the cluster as a bare-metal cluster. This is the same as xref:../../installing/installing_platform_agnostic/installing-platform-agnostic.adoc#installing-platform-agnostic[installing a cluster on any platform], and has the following limitations:

. There will be no cluster provider so you must manually add each machine and there will be no node scaling capabilities.
. The oVirt CSI driver will not be installed and there will be no CSI capabilities.
====
<11> Whether to enable or disable FIPS mode. By default, FIPS mode is not enabled. If FIPS mode is enabled, the {op-system-first} machines that {product-title} runs on bypass the default Kubernetes cryptography suite and use the cryptography modules that are provided with {op-system} instead.
+
[IMPORTANT]
====
The use of FIPS Validated / Modules in Process cryptographic libraries is only supported on {product-title} deployments on the `x86_64` architecture.
====
endif::openshift-origin[]
ifndef::restricted[]
ifndef::openshift-origin[]
<12> The pull secret that you obtained from the link:https://console.redhat.com/openshift[{cloud-redhat-com}] site.
This pull secret allows you to authenticate with the services that are
provided by the included authorities, including Quay.io, which serves the
container images for {product-title} components.
endif::openshift-origin[]
ifdef::openshift-origin[]
<11> The pull secret that you obtained from the link:https://console.redhat.com/openshift[{cloud-redhat-com}] site.
This pull secret allows you to authenticate with the services that are
provided by the included authorities, including Quay.io, which serves the
container images for {product-title} components.
endif::openshift-origin[]
endif::restricted[]
ifdef::restricted[]
ifndef::openshift-origin[]
<12> For `<local_registry>`, specify the registry domain name, and optionally the
port, that your mirror registry uses to serve content. For example,
`registry.example.com` or `registry.example.com:5000`. For `<credentials>`,
specify the base64-encoded user name and password for your mirror registry.
endif::openshift-origin[]
ifdef::openshift-origin[]
<11> For `<local_registry>`, specify the registry domain name, and optionally the
port, that your mirror registry uses to serve content. For example,
`registry.example.com` or `registry.example.com:5000`. For `<credentials>`,
specify the base64-encoded user name and password for your mirror registry.
endif::openshift-origin[]
endif::restricted[]
ifndef::openshift-origin[]
<13> The public portion of the default SSH key for the `core` user in
{op-system-first}.
endif::openshift-origin[]
ifdef::openshift-origin[]
<12> The public portion of the default SSH key for the `core` user in
{op-system-first}.
endif::openshift-origin[]
+
[NOTE]
====
For production {product-title} clusters on which you want to perform installation debugging or disaster recovery, specify an SSH key that your `ssh-agent` process uses.
====
ifdef::restricted[]
ifndef::ibm-z,ibm-z-kvm[]
ifndef::openshift-origin[]
<14> Provide the contents of the certificate file that you used for your mirror
registry.
endif::openshift-origin[]
ifdef::openshift-origin[]
<13> Provide the contents of the certificate file that you used for your mirror
registry.
endif::openshift-origin[]
endif::ibm-z,ibm-z-kvm[]
ifdef::ibm-z,ibm-z-kvm[]
<14> Add the `additionalTrustBundle` parameter and value. The value must be the contents of the certificate file that you used for your mirror registry, which can be an existing, trusted certificate authority or the self-signed certificate that you generated for the mirror registry.
endif::ibm-z,ibm-z-kvm[]
ifndef::openshift-origin[]
<15> Provide the `imageContentSources` section from the output of the command to
mirror the repository.
endif::openshift-origin[]
ifdef::openshift-origin[]
<14> Provide the `imageContentSources` section from the output of the command to
mirror the repository.
endif::openshift-origin[]
endif::restricted[]


ifeval::["{context}" == "installing-restricted-networks-bare-metal"]
:!restricted:
endif::[]
ifdef::openshift-origin[]
:!restricted:
endif::[]
ifeval::["{context}" == "installing-ibm-z"]
:!ibm-z:
endif::[]
ifeval::["{context}" == "installing-ibm-z-kvm"]
:!ibm-z-kvm:
endif::[]
ifeval::["{context}" == "installing-restricted-networks-ibm-z"]
:!ibm-z:
:!restricted:
endif::[]
ifeval::["{context}" == "installing-restricted-networks-ibm-z-kvm"]
:!ibm-z-kvm:
:!restricted:
endif::[]
ifeval::["{context}" == "installing-ibm-power"]
:!ibm-power:
endif::[]
ifeval::["{context}" == "installing-restricted-networks-ibm-power"]
:!ibm-power:
endif::[]
ifeval::["{context}" == "installing-platform-agnostic"]
:!agnostic:
endif::[]
ifeval::["{context}" == "installing-rhv-restricted-network"]
:!rhv:
endif::[]
