// Module included in the following assemblies:
// Epic CNF-2600 (CNF-2133) (4.10), Story TELCODOCS-285
// * scalability_and_performance/cnf-topology-aware-lifecycle-operator.adoc

:_content-type: PROCEDURE
[id="talo-operator-update_{context}"]
= Performing an Operator update

.Prerequisites

* Install the Topology Aware Lifecycle Operator.
// * Provision one or more managed clusters using ZTP.
* Log in as a user with `cluster-admin` privileges.
// Create {rh-rhacm} policies in the Hub cluster.

.Procedure

. A cluster is installed through `SiteConfig` and `PolicyGenTemplate` with {product-title} v4.9 and PTP Operator v4.9.0.
+
All policies on the Hub have the `remediationAction: inform` value.

. You update the same `PolicyGenTemplate` used in initial ZTP of the cluster and you push to git.
+
For example, you change the channel of PTP subscription to `4.9.1`

. The ZTP tools automatically detect the changes to the file in git.
+
ZTP creates a policy-wrapped CR for PTP subscription with `remediationAction: inform`. This policy updates the existing policy on the Hub that was created during ZTP. The `PlacementBinding` and `PlacementRule` are identical to the ones created during ZTP. Any unchanged CRs in the same policy are regenerated but are identical to the previous values.

. ACM sees the changed Policy and updates the status of the new policy to `NonCompliant` for some or all matching clusters.

. You create an instance of the `ClusterUpgradeGroup` CR on the Hub cluster.
+
The `managedPolicies` list in the `ClusterUpgradeGroup` CR includes the updated policy that needs to be managed. The `remediationStrategy` describes the number of concurrent clusters to update.

. TALO begins remediation of the non-compliant clusters.
+
Clusters are remediated if both conditions are true:

.. Cluster is non-compliant in one or more of the inform policies specified under the `managedPolicies` field in the `ClusterUpgradeGroup` CR. 
.. The `ClusterUpgradeGroup` CR specifies the cluster by name or the cluster matches the selector criteria in the `ClusterUpgradeGroup` CR.

+
TALO remediates the policies to clusters in the order the policies are listed in the `ClusterUpgradeGroup` CR, thenTALO clones the policies. TALO manages the `PlacementRule`, `PlacementBinding`, and enforces the policy to apply change to non-compliant clusters.

. The enforce policy causes {rh-rhacm} to update the PTP Operator subscription on the spoke cluster.
. The spoke cluster OLM updates the PTP operator to version 4.9.1.
. TALO measures the success of remediation when the policy becomes compliant for the clusters.
. When remediation is complete, TALO deletes the Hub cluster artifacts such as the enforce policy, the `PlacementRule`, and the `PlacementBinding`.
. All clusters under `inform` policy are now compliant.

[NOTE]
====
After a cluster update performed by TALO is complete, the cluster will not be updated again under the control of the same `ClusterGroupUpgrade` CR. You need to create a new `ClusterGroupUpgrade` CR in the following cases:
* You need to update the cluster again
* The cluster changes to non-compliant with the `inform` policy after being updated
====