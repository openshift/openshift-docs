
// Module included in the following assemblies:
//cluster-logging-release-notes.adoc

[id="cluster-logging-ocp-compatibility"]
= {product-title} compatibility
The {logging-title} is provided as an installable component, with a distinct release cycle from the core {product-title}. The link:https://access.redhat.com/support/policy/updates/openshift#logging[Red Hat OpenShift Container Platform Life Cycle Policy] outlines release compatibility.

[id="cluster-logging-release-notes-5-4-0"]
= Version 5.4 of the {logging}
The following advisories are available for version 5.4 of the {logging}:
link:https://access.redhat.com/errata/RHSA-2022:1461[{logging-title-uc} Release 5.4]

[id="openshift-logging-5-4-0-bug-fixes"]
== Bug fixes

*	Before this update, the `cluster-logging-operator` utilized cluster scoped roles and bindings to establish permissions for the Prometheus service account to scrape metrics. These permissions were only created when deploying the Operator using the console interface but were missing when deploying from the command line. This update fixes the issue by making the roles and bindings namespace-scoped. (link:https://issues.redhat.com/browse/LOG-2286[LOG-2286])

* Before this update, a prior change to fix dashboard reconciliation introduced a `ownerReferences` field to the resource across namespaces. As a result, both the config map and dashboard were not getting created in the namespace. With this update, the removal of the `ownerReferences` field resolves the issue and the OpenShift Logging dashboard is available in the console. (link:https://issues.redhat.com/browse/LOG-2163[LOG-2163])

* Before this update, changes to the metrics dashboards did not deploy because the `cluster-logging-operator` did not correctly compare existing and desired configmaps containing the dashboard. With this update, the addition of a unique hash value to object labels resolves the issue.	(link:https://issues.redhat.com/browse/LOG-2071[LOG-2071])

*	Before this update, the OpenShift Logging dashboard did not correctly display the pods and namespaces in the table, which displays the top producing containers collected over the last 24 hours. With this update, the pods and namespaces are displayed correctly.	(link:https://issues.redhat.com/browse/LOG-2069[LOG-2069])

*	Before this update, when the `ClusterLogForwarder` was set up with `Elasticsearch OutputDefault` and Elasticsearch outputs did not have structured keys, the generated configuration contained the incorrect values for authentication. This update corrects the secret and certificates used.	(link:https://issues.redhat.com/browse/LOG-2056[LOG-2056])

*	Before this update, the OpenShift Logging dashboard displayed an empty CPU graph because of a reference to an invalid metric. With this update, the correct data point has been selected, resolving the issue.	(link:https://issues.redhat.com/browse/LOG-2026[LOG-2026])

*	Before this update, the Fluentd container image included builder tools that were unnecessary at run time. This update removes those tools from the image.(link:https://issues.redhat.com/browse/LOG-1927[LOG-1927])

*	Before this update, a name change of the deployed collector in the 5.3 release caused the logging collector to generate the `FluentdNodeDown` alert. This update resolves the issue by fixing the job name for the Prometheus alert. 	(link:https://issues.redhat.com/browse/LOG-1918[LOG-1918])

*	Before this update, the log collector was collecting its own logs due to a refactoring of the component name change. This could lead to a potential feedback loop of the collector processing its own log that might result in memory and log message size issues. This update resolves the issue by excluding the collector logs from the collection. (link:https://issues.redhat.com/browse/LOG-1774[LOG-1774])

* Before this update, Elasticsearch generated the error "Unable to create PersistentVolumeClaim due to forbidden: exceeded quota: infra-storage-quota." if the PVC already existed. With this update, Elasticsearch checks for existing PVCs, resolving the issue.	(link:https://issues.redhat.com/browse/LOG-2131[LOG-2131])

* Before this update, Elasticsearch was unable to return to the ready state when the `elasticsearch-signing `secret was removed. With this update, Elasticsearch is able to go back to the ready state after that secret is removed.	(link:https://issues.redhat.com/browse/LOG-2171[LOG-2171])

* Before this update, the change of the path from which the collector reads container logs caused the collector to forward some records to the wrong indices. With this update, the collector now uses the correct configuration to resolve the issue.	(link:https://issues.redhat.com/browse/LOG-2160[LOG-2160])

* Before this update, clusters with a large number of namespaces caused Elasticsearch to stop serving requests because the list of namespaces reached the maximum header size limit. With this update, headers only include a list of namespace names, resolving the issue.	(link:https://issues.redhat.com/browse/LOG-1899[LOG-1899])

* Before this update, the OpenShift Logging dashboard showed the number of shards 'x' times bigger than actual value when Elasticsearch has 'x' nodes. This was because it was printing all primary shards for each ES pod and processing sum on it, while the output is always for the whole ES cluster. With this update, the calculation has been corrected.	(link:https://issues.redhat.com/browse/LOG-2156[LOG-2156])

* Before this update, the secrets "kibana" and "kibana-proxy" were not recreated if they were deleted manually. With this update, the `elasticsearch-operator` will watch the resources and automatically recreate them if deleted.	(link:https://issues.redhat.com/browse/LOG-2250[LOG-2250])

* Before this update, tuning the buffer chunk size could cause the collector to generate a warning about the chunk size exceeding the byte limit for the event stream. With this update, you can also tune the read line limit, resolving the issue.	(link:https://issues.redhat.com/browse/LOG-2379[LOG-2379])

* Before this update, the logging console link in OpenShift WebConsole was not removed with the ClusterLogging CR. With this update, deleting the CR or uninstalling the Cluster Logging Operator removes the link. (link:https://issues.redhat.com/browse/LOG-2373[LOG-2373])

* Before this update, a change to the container logs path caused this metric to always be zero with older releases configured with the original path. With this update, the plugin which exposes metrics about collected logs supports reading from either path to resolve the issue. (link:https://issues.redhat.com/browse/LOG-2462[LOG-2462])

== Elasticsearch Operator deprecation notice
In {logging} 5.4, the Elasticsearch Operator is deprecated and is expected to be removed for the next EUS release of {product-title}.  Red Hat will provide bug fixes and support for this feature during the current release lifecycle, but this feature will no longer receive enhancements and will be removed. As an alternative to using the Elasticsearch Operator to manage the default log storage, you can use the Loki Operator.

== CVEs
[id="openshift-logging-5-4-0-CVEs"]
* link:https://access.redhat.com/security/cve/CVE-2022-0759[CVE-2022-0759]
** link:https://bugzilla.redhat.com/show_bug.cgi?id=2058404[BZ-2058404]
* link:https://access.redhat.com/security/cve/CVE-2022-21698[CVE-2022-21698]
** link:https://bugzilla.redhat.com/show_bug.cgi?id=2045880[BZ-2045880]
