// Module included in the following assemblies:
// * serverless-logic/serverless-logic-managing-supporting-services

:_mod-docs-content-type: REFERENCE
[id="serverless-logic-supporting-services-platform-scoped-postgresql-persistence-config_{context}"]
= Platform-scoped PostgreSQL persistence configuration

You can configure a common PostgreSQL service and database for all supporting services by using the `spec.persistence.postgresql` field in the `SonataFlowPlatform` Custom Resource (CR). When this field is configured, the {ServerlessLogicOperatorName} connects the supporting services to the specified database. Any workflows deployed in the same namespace using the `preview` or `gitops` profiles, and that do not specify a custom persistence configuration, will also connect to this database.

The following rules apply when configuring platform-scoped persistence:

* If a supporting service has its own persistence configuration, for example, if `services.dataIndex.persistence.postgresql` is set, then that configuration takes precedence.

* If a supporting service does not have a custom persistence configuration, the configuration is inherited from the current platform.

* If a supporting service requires a specific database migration strategy, configure it by using the `dataIndex.persistence.dbMigrationStrategy` and `jobService.persistence.dbMigrationStrategy` fields.

The following `SonataFlowPlatform` CR fragment shows how to configure platform-scoped PostgreSQL persistence:

[source,yaml]
----
apiVersion: sonataflow.org/v1alpha08
kind: SonataFlowPlatform
metadata:
  name: sonataflow-platform-example
  namespace: example-namespace
spec:
  persistence:
    postgresql:
      serviceRef:
        name: postgres-example <1> 
        namespace: postgres-example-namespace <2>
        databaseName: example-database <3>
        port: 1234 <4>
      secretRef:
        name: postgres-secrets-example <5>
        userKey: POSTGRESQL_USER <6>
        passwordKey: POSTGRESQL_PASSWORD <7>
    dataIndex:
      enabled: true
      persistence:
        dbMigrationStrategy: job <8>
    jobService:
      enabled: true
      persistence:
        dbMigrationStrategy: service <9>
----

<1> Name of the Kubernetes service to connect to the PostgreSQL database server.
<2> (Optional) Namespace containing the PostgreSQL service. Defaults to the `SonataFlowPlatform` namespace.
<3> Name of the PostgreSQL database to store supporting services and workflows data.
<4> (Optional) Port to connect to the PostgreSQL service. Defaults to 5432.
<5> Name of the Kubernetes Secret that contains database credentials.
<6> Secret key that stores the database username.
<7> Secret key that stores the database password.
<8> (Optional) Database migration strategy for the Data Index. Defaults to `service`.
<9> (Optional) Database migration strategy for the Jobs Service. Defaults to `service`. You can configure distinct strategies per service if needed.