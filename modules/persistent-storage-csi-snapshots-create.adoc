// Module included in the following assemblies:
//
// * storage/persistent_storage/persistent-storage-csi-snapshots.adoc

[id="persistent-storage-csi-snapshots-create_{context}"]
= Creating a volume snapshot

Creation of a volume snapshot is triggered by the creation of a VolumeSnapshot API object.

.Prerequisites
* Logged in to a running {product-title} cluster.
* A PVC created using a CSI Driver that supports VolumeSnapshots.
* A storage class that is provisioning the storage backend.

.Procedure

To dynamically create a volume snapshot:

. Save your volume snapshot class definition to a file.

+
.volumesnapshotclass.yaml
[source,yaml]
----
apiVersion: snapshot.storage.k8s.io/v1beta1
kind: VolumeSnapshotClass <1>
metadata:
  name: csi-hostpath-snap
driver: hostpath.csi.k8s.io
deletionPolicy: Delete
----
<1> Specifies the attributes that point to a CSI driver, such as HostPath.
+
. Create the object definition file you saved in the previous step.
+
----
$ oc create -f volumesnapshotclass.yaml
----

. Create a VolumeSnapshot object:

+
.volumesnapshot-dynamic.yaml
[source,yaml]
----
apiVersion: snapshot.storage.k8s.io/v1beta1
kind: VolumeSnapshot
metadata:
  name: mysnap
spec:
  volumeSnapshotClassName: csi-hostpath-snap <1>
  source:
    persistentVolumeClaimName: myclaim <2>
----

<1> The request for a particular class by the volume snapshot. If nothing is set, the default class is used if available.
+
<2> The name of the PersistentVolumeClaim bound to a PersistentVolume. This defines what you want to create a snapshot of. Required for dynamically provisioning a snapshot.

. Create the object definition file you saved in the previous step:
+
----
$ oc create -f volumesnapshot<provisioning-method>.yaml
----


To manually provision a snapshot:

. Specify a volumeSnapshotContentName as the source for the snapshot, in addition to defining volume snapshot class and PVC name as shown above.
+
.volumesnapshot-manual.yaml
[source,yaml]
----
apiVersion: snapshot.storage.k8s.io/v1beta1
kind: VolumeSnapshot
metadata:
  name: snapshot-demo
spec:
  source:
    volumeSnapshotContentName: mycontent <1>
----
<1> The volumeSnapshotContentName source field is required for pre-provisioned snapshots.

. Create the object definition file you saved in the previous step:
+
----
$ oc create -f volumesnapshot<provisioning-method>.yaml
----

Once the snapshot has been created in the cluster, additional details about the snapshot are available.

. Display details about the volume snapshot that was created.
+
----
$ oc describe volumesnapshot<provisioning-method> mysnap
----

The following example displays additional details about the volume snapshot you created.

.volumesnapshot.yaml
[source,yaml]
----
apiVersion: snapshot.storage.k8s.io/v1beta1
kind: VolumeSnapshot
metadata:
  name: mysnap
spec:
  source:
    persistentVolumeClaimName: myclaim
  volumeSnapshotClassName: csi-hostpath-snap
status:
  boundVolumeSnapshotContentName: snapcontent-1af4989e-a365-4286-96f8-d5dcd65d78d6 <1>
  creationTime: "2020-01-29T12:24:30Z"
  readyToUse: true
  restoreSize: 500Mi
----
<1> The volume snapshot content is the pointer to the storage itself.

To verify that the volume snapshot was created automatically, run the following command:

----
$ oc get volumesnapshotcontent
----

The pointer to the actual content is displayed. When `boundVolumeSnapshotContentName` is populated, it means that there is a corresponding VolumeSnapshotContent.

To verify that the snapshot is ready, confirm that the VolumeSnapshot has `readyToUse: true`.
