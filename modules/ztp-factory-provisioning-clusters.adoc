// Module included in the following assemblies:
//
// scalability_and_performance/ztp-deploying-disconnected.adoc

[id="factory-installing-edge-sites_{context}"]
= Factory installing edge sites

Zero touch provisioning (ZTP) deploys the {product-titler} spoke cluster architecture from a preinstalled OpenShift Container Platform (hub cluster) using RHACM (Red Hat Advanced Cluster Management).

The "factory" high level architecture is illustrated in this diagram:

image::network_topology.png[Network topology]

Every blade in the chassis has access to multiple NICs, which are connected to internal switches. The switches and NICs are referred to as networks using the name of the interface.

The eno4 and eno5 networks, are 10gbs networks with enough bandwidth to support the internal and external traffic of the cluster. Both networks are L2.
The eno4 network will be used as the external network. The hub cluster provides a DHCP server for the eno4 network in order to make it easier for the factory to configure it, interact with it, and eventually make it easier for the customer to complete the at-edge configurations required later.
The eno5 network is the internal network. It is only accessible from within the blades and is configured with static IPs and is expected to be used only for the internal traffic of the cluster.

The installation of the Spoke cluster is triggerred using GitHub actions from a GitHub repo link:https://github.com/rh-ecosystem-edge/ztp-pipeline-relocatable[ztp-pipeline-relocatable].

On a preinstalled OpenShift Container Platform cluster (the hub cluster) a number of shell scripts and YAML configuration files triggerred from GitHub actions are executed to:

* Deploy a disconnected registry
* Deploy a HTTP Server
* Deploy Advanced Cluster Management
* Deploy ImageContentSourcePolicy (ICSP) hub
* Deploy the hub configuration

Once the hub cluster configuration is complete, another set of scripts are deployed to deploy and configure the spoke cluster. GitHub actions are executed to:

* Deploy the spoke cluster
* Deploy ImageContentSourcePolicy (ICSP) hub This deploys ICSP for: ${spoke} using the Hub as a source
* Deploy Metal-lb
* Deploy Openshift Container Storage
* Deploy a disconnected registry
* Deploy worker nodes

The final step is to detach the cluster and then it is ready to be shipped off site.
