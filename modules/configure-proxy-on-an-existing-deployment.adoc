// Module included in the following assemblies:
//
// * configuration/configure-proxy.adoc
:_mod-docs-content-type: PROCEDURE
[id="configure-proxy-on-an-existing-deployment_{context}"]
= Configuring a proxy on an existing deployment

To configure a proxy in an existing deployment, you must export the `proxy-config` secret as a YAML file, update your proxy configuration in that file, and upload it as a secret.

[NOTE]
====
If you have configured a global proxy on your {ocp} cluster, the Operator Lifecycle Manager (OLM) automatically configures Operators that it manages with the cluster-wide proxy. However, you can also configure installed Operators to override the global proxy or inject a custom certificate authority (CA) certificate.

For more information, see link:https://docs.redhat.com/en/documentation/openshift_container_platform/4.20/html/operators/administrator-tasks#olm-configuring-proxy-support[Configuring proxy support in Operator Lifecycle Manager].
====

.Procedure

. Save the existing secret as a YAML file:
+
[source,terminal]
----
$ oc -n stackrox get secret proxy-config \
  -o go-template='{{index .data "config.yaml" | \
  base64decode}}{{"\n"}}' > /tmp/proxy-config.yaml
----
. Edit the fields you want to modify in the YAML configuration file, for example:
+
[source,yaml]
----
    # # NOTE: Both central and scanner should be restarted if this secret is changed.
    # # While it is possible that some components will pick up the new proxy configuration
    # # without a restart, it cannot be guaranteed that this will apply to every possible
    # # integration etc.
    # url: http://proxy.name:port
    # username: username
    # password: password
    # # If the following value is set to true, the proxy wil NOT be excluded for the default hosts:
    # # - *.stackrox, *.stackrox.svc
    # # - localhost, localhost.localdomain, 127.0.0.0/8, ::1
    # # - *.local
    # omitDefaultExcludes: false
    # excludes:  # hostnames (may include * components) for which you do not
    # # want to use a proxy, like in-cluster repositories.
    # - some.domain
    # # The following configuration sections allow specifying a different proxy to be used for HTTP(S) connections.
    # # If they are omitted, the above configuration is used for HTTP(S) connections as well as TCP connections.
    # # If only the `http` section is given, it will be used for HTTPS connections as well.
    # # Note: in most cases, a single, global proxy configuration is sufficient.
    # http:
    #   url: http://http-proxy.name:port 
    #   username: username
    #   password: password
    # https:
    #   url: http://https-proxy.name:port 
    #   username: username 
    #   password: password 
----
. After you save the changes, run the following command to replace the secret:
+
[source,terminal]
----
$ oc -n stackrox create secret generic proxy-config \
  --from-file=config.yaml=/tmp/proxy-config.yaml -o yaml --dry-run | \
  oc label -f - --local -o yaml app.kubernetes.io/name=stackrox | \
  oc apply -f -
----
+
[IMPORTANT]
====
* You must wait for at least 1 minute, until {ocp} propagates your changes to Central and Scanner.
* If you see any issues with outgoing connections after changing the proxy configuration, you must restart your Central and Scanner pods.
====
//TODO add link to restarting Central and Scanner
