// Module included in the following assemblies:
//
// * cloud_experts_tutorials/cloud-experts-entra-id-idp.adoc

:_mod-docs-content-type: PROCEDURE
[id="cloud-experts-entra-id-idp-configure-entra-idp_{context}"]
= Configuring the {product-title} cluster to use Entra ID as the identity provider

[role="_abstract"]
You must configure {product-title} to use Entra ID as its identity provider. Although {product-title} offers the ability to configure identity providers by using {cluster-manager}, use the ROSA CLI to configure the cluster's OAuth provider to use Entra ID as its identity provider. Before configuring the identity provider, set the necessary variables for the identity provider configuration.

.Procedure
. Create the variables by running the following command:
+
[source,terminal]
----
$ CLUSTER_NAME=example-cluster
$ IDP_NAME=AAD
$ APP_ID=yyyyyyyy-yyyy-yyyy-yyyy-yyyyyyyyyyyy
$ CLIENT_SECRET=xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx
$ TENANT_ID=zzzzzzzz-zzzz-zzzz-zzzz-zzzzzzzzzzzz
----
+
--
where: 

`example-cluster`:: Replace this with the name of your cluster.
`AAD`:: Replace this value with the name you used in the OAuth callback URL that you generated earlier in this process.
`yyyyyyyy-yyyy-yyyy-yyyy-yyyyyyyyyyyy`:: Replace this with the Application (client) ID.
`xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx`:: Replace this with the Client Secret.
`zzzzzzzz-zzzz-zzzz-zzzz-zzzzzzzzzzzz`:: Replace this with the Directory (tenant) ID.
--

. Configure the cluster's OAuth provider by running the following command. If you enabled group claims, ensure that you use the `--group-claims groups` argument.
** If you enabled group claims, run the following command:
+
[source,terminal]
----
$ rosa create idp \
--cluster ${CLUSTER_NAME} \
--type openid \
--name ${IDP_NAME} \
--client-id ${APP_ID} \
--client-secret ${CLIENT_SECRET} \
--issuer-url https://login.microsoftonline.com/${TENANT_ID}/v2.0 \
--email-claims email \
--name-claims name \
--username-claims preferred_username \
--extra-scopes email,profile \
--groups-claims groups
----

** If you did not enable group claims, run the following command:
+
[source,terminal]
----
$ rosa create idp \
--cluster ${CLUSTER_NAME} \
--type openid \
--name ${IDP_NAME} \
--client-id ${APP_ID} \
--client-secret ${CLIENT_SECRET} \
--issuer-url https://login.microsoftonline.com/${TENANT_ID}/v2.0 \
--email-claims email \
--name-claims name \
--username-claims preferred_username \
--extra-scopes email,profile
----
+
After a few minutes, the cluster authentication Operator reconciles your changes, and you can log in to the cluster by using Entra ID.