// Module included in the following assemblies:
//
// * security/cert_manager_operator/cert-manager-operator-issuer-self-signed.adoc

:_content-type: PROCEDURE
[id="cert-manager-self-signed-create_{context}"]
= Bootstrapping a CA issuer

// TODO
You can use a self-signed cluster issuer to bootstrap a CA issuer.

// TODO: if this procedure is just for bootstrapping a CA issuer, then what do we want to show what do you do afterwards? need to add about certs that use that?

.Prerequisites

* You have installed the {cert-manager-operator}
* You have access to the cluster as a user with the `cluster-admin` role.

.Procedure

. Create a namespace for the CA issuer.

.. Create a YAML file that defines the `Namespace` object:
+
.Example `namespace.yaml` file
[source,yaml]
----
apiVersion: v1
kind: Namespace
metadata:
  name: ca-issuer-namespace <1>
----
<1> Specify the namespace for the CA issuer.
+
// TODO: any particular ns name recommended?

.. Create the `Namespace` object by running the following command:
+
[source,terminal]
----
$ oc create -f namespace.yaml
----

. Create a self-signed cluster issuer to bootstrap the CA issuer.

.. Create a YAML file that defines the `ClusterIssuer` object:
+
.Example `self-signed-cluster-issuer.yaml` file
[source,yaml]
----
apiVersion: cert-manager.io/v1
kind: ClusterIssuer
metadata:
  name: selfsigned-issuer
spec:
  selfSigned: {}
----
+
// TODO: Taken from https://github.com/openshift/cert-manager-operator/blob/master/test/e2e/testdata/self_signed/cluster_issuer.yaml, does it need any other values?

.. Create the `ClusterIssuer` object by running the following command:
+
[source,terminal]
----
$ oc create -f self-signed-cluster-issuer.yaml
----

. Create a certificate for the CA issuer.

.. Create a YAML file that defines the `Certificate` object:
+
.Example `certificate.yaml` file
[source,yaml]
----
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  name: my-selfsigned-ca         <1>
  namespace: ca-issuer-namespace <2>
spec:
  isCA: true
  commonName: my-selfsigned-ca
  secretName: root-secret
  privateKey:
    algorithm: ECDSA
    size: 256
  issuerRef:
    name: selfsigned-issuer      <3>
    kind: ClusterIssuer
    group: cert-manager.io
----
<1> Specify the name for the self-signed certificate.
<2> Specify the namespace that you created for the CA issuer.
<3> Specify the name of the cluster issuer referenced in the self-signed `ClusterIssuer` object.

.. Create the `Certificate` object by running the following command:
+
[source,terminal]
----
$ oc create -f certificate.yaml
----

. Create the CA issuer.

.. Create a YAML file that defines the `Issuer` object for the CA issuer:
+
.Example `ca-issuer.yaml` file
[source,yaml]
----
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  name: my-ca-issuer             <1>
  namespace: ca-issuer-namespace <2>
spec:
  ca:
    secretName: root-secret      <3>
----
<1> Specify the name for the CA issuer.
<2> Specify the namespace that you created for the CA issuer.
<3> Specify the name of the secret referenced in the self-signed `Certificate` object.

.. Create the `Issuer` object by running the following command:
+
[source,terminal]
----
$ oc create -f ca-issuer.yaml
----

// TODO: what now
