// Module included in the following assemblies:
//
// * security/zero_trust_workload_identity_manager/zero-trust-manager-configuration.adoc

:_mod-docs-content-type: PROCEDURE
[id="zero-trust-manager-configure-affinity_{context}"]
= Configuring pod affinity for {zero-trust-full} operands

You can configure pod anti-affinity for the SPIRE Server operand to prevent multiple pods from being scheduled on the same node. Distributing pods across nodes improves availability and reduces the risk of single-node failure.

.Prerequisites

* You have access to the cluster with `cluster-admin` privileges.
* You have installed the {zero-trust-full}.

.Procedure

. Patch the `SpireServer` custom resource to apply anti-affinity:
+
[source,terminal]
----
$ oc patch SpireServer cluster --type=merge -p="
spec:
  affinity:
    podAntiAffinity: 
      requiredDuringSchedulingIgnoredDuringExecution: 
        - labelSelector:
            matchExpressions:
              - key: app.kubernetes.io/component
                operator: In
                values:
                  - server
          topologyKey: kubernetes.io/hostname
"
----

.Verifcation

. Verify the scheduling by running the following commands:
+
[source,terminal]
----
$ oc get event -n zero-trust-workload-identity-manager --field-selector reason=Scheduled
----
+
[source,terminal]
----
$ oc get pod spire-server-0 -n zero-trust-workload-identity-manager -o wide
----
