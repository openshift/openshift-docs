// Module included in the following assemblies:
//
// * installing/install-ocp-operator.adoc
:_module-type: PROCEDURE
[id="install-central-operator-tech-preview_{context}"]
= Installing Central with an external database using the Operator method

:FeatureName: External PostgreSQL support
include::snippets/technology-preview.adoc[]

[role="_abstract"]
The main component of {product-title} is called Central. You can install Central on {ocp} by using the `Central` custom resource. You deploy Central only once, and you can monitor multiple separate clusters by using the same Central installation.

[IMPORTANT]
====
When you install {product-title} for the first time, you must first install the `Central` custom resource because the `SecuredCluster` custom resource installation is dependent on certificates that Central generates.
====

.Prerequisites
* You must be using {ocp} 4.10 or later. For more information, see link:https://access.redhat.com/node/5822721[{product-title} Support Policy].
* You must provision a database that supports PostgreSQL 13 and you must only use it for {product-title-short}.
* You must have a superuser role with permissions to create and delete databases.

[NOTE]
====
{product-title-short} 4.0 does not support a multi-tenant database and PgBouncer.
====

.Procedure
. On the {ocp} web console, navigate to the *Operators* -> *Installed Operators* page.
. Select the {product-title} Operator from the list of installed Operators.
. If you have installed the Operator in the recommended namespace, {ocp} lists the project as `rhacs-operator`. Select *Project: rhacs-operator* -> *Create project*.
+
[WARNING]
====
* If you have installed the Operator in a different namespace, {ocp} shows the name of that namespace rather than `rhacs-operator`.
* You must install the {product-title} `Central` custom resource in its own project and not in the `rhacs-operator` and `openshift-operator` projects, or in the project in which you have installed the {product-title} Operator.
====
. Enter the new project name (for example, `stackrox`), and click *Create*. Red Hat recommends that you use `stackrox` as the project name.
. Create a password secret in the deployed namespace by using the {ocp} web console or the terminal.
** On the {ocp} web console, go to the *Workloads* â†’ *Secrets* page. Create a *Key/Value secret* with the key `password` and the value as the path of a plain text file containing the password for the superuser of the provisioned database.
** Or, run the following command in your terminal:
+
[source,terminal]
----
$ oc create secret generic external-db-password \ <1>
  --from-file=password=<password.txt> <2>
----
<1> If you use Kubernetes, enter `kubectl` instead of `oc`.
<2> Replace `password.txt` with the path of the file which has the plain text password.
. Return to the {product-title} operator page in the {ocp} web console. Under the *Provided APIs* section, select *Central*. Click *Create Central*.
. Enter a name for your `Central` custom resource and add any labels you want to apply.
. Navigate to *Central Component Settings* -> *Central DB Settings*.
. For *Administrator Password* specify the referenced secret as `external-db-password` (or the secret name of the password created previously).
. For *Connection String (Technology Preview)* specify the connection string in `keyword=value` format, for example, `host=<host> port=5432 user=postgres sslmode=verify-ca`
. For *Persistence* -> *PersistentVolumeClaim* -> *Claim Name*, remove `central-db`.
. If necessary, you can specify a Certificate Authority for Central to trust the database certificate. To add this, go to the YAML view and add a TLS block under the top-level spec, as shown in the following example:
+

[source,yaml]
----
spec:
  tls:
    additionalCAs:
    - name: db-ca
      content: |
        <certificate>
----
//Add a link for customization options
. Click *Create*.

[NOTE]
====
If you are using the cluster-wide proxy, {product-title} uses that proxy configuration to connect to the external services.
====

.Next Steps
. Verify Central installation.
. Optional: Configure Central options.
. Generate an init bundle containing the cluster secrets that allows communication between the `Central` and `SecuredCluster` resources. You need to download this bundle, use it to generate resources on the clusters you want to secure, and securely store it.
. Install secured cluster services on each cluster you want to monitor.
