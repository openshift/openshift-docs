// Module included in the following assemblies:
//
// * machine_configuration/machine-configs-configure

:_mod-docs-content-type: PROCEDURE
[id="mco-coredum-retention-policy_{context}"]
= Configuring the core dump retention period

By default, systemd stores any core dump files in the `/var/lib/systemd/coredump/` directory. After a configured period of time, systemd deletes these files. You can see the current retention period in the `/usr/lib/tmpfiles.d/systemd.conf` file. The following example shows a retention period of 2 weeks (`2w`). 

.Example systemd core dump retention period
[source,terminal]
----
# ...
d /var/lib/systemd/coredump 0755 root root 2w
# ...
----

You can configure the systemd core dump retention period for nodes with a specific role, as needed, by using a `MachineConfig` custom resource (CR).

.Prerequisites

* Install the OpenShift CLI (`oc`).
* Log in as a user with `cluster-admin` privileges.

.Procedure

. Convert a string similar to the following into base64 encoding. 
+
[source,terminal]
----
d /var/lib/systemd/coredump 0755 root root <retention_period> EOF <1>
----
<1> Specify the retention period in seconds (`s`), minutes (`m`), hours (`h`), days (`d`), weeks (`w`), milliseconds (`ms`), or microseconds (`us`). When set to zero, systemd deletes the unconditionally.
+
For example, the following string configures a 28 day retention period:
+
[source,terminal]
----
d /var/lib/systemd/coredump 0755 root root 28d
----

. Create the `MachineConfig` CR that uses the base64-encoded string to configure the core dump retention period.
+
[source,yaml]
----
apiVersion: machineconfiguration.openshift.io/v1
kind: MachineConfig
metadata:
  labels:
    machineconfiguration.openshift.io/role: <node_role> <1>
  name: configure-coredump
spec:
  config:
    ignition:
      version: 3.5.0
    storage:
      files:
      - contents:
          source: data:text/plain;charset=utf-8;base64,ZCAvdmFyL2xpYi9zeXN0ZW1kL2NvcmVkdW1wIDA3NTUgcm9vdCByb290IDI4ZAo= <2>
        mode: 420
        overwrite: true
        path: /etc/tmpfiles.d/core.conf <3>
----
<1> Specify the node role for the nodes you want to configure the core dump retention period.
<2> Specify the base64-encoded string from the previous step.
<3> Specifies the file where 

. Create the `MachineConfig` CR by running the following command:
+
[source,terminal]
----
$ oc create -f <file_name>.yaml
----
+
Scheduling on each affected node is disabled as the change is being applied.

. Check the machine configs to see that the new one was added:
+
[source,terminal]
----
$ oc get mc
----
+
.Example output
[source,terminal]
----
NAME                                               GENERATEDBYCONTROLLER                      IGNITIONVERSION   AGE
# ...
configure-coredump                                                                            3.5.0             28s
# ...
----


