// Module included in the following assemblies:
//
// * machine_configuration/machine-configs-configure

:_mod-docs-content-type: PROCEDURE
[id="mco-coredum-retention-policy_{context}"]
= Configuring the core dump retention period


By default, systemd stores any core dump files in the `/var/lib/systemd/coredump/` directory. After a configured period of time, systemd deletes these files. You can see the current retention period by running the `systemd-tmpfiles --cat-config | grep coredump` command on your nodes. The following example shows a retention period of 3 days (`3d`). 

.Example systemd core dump retention period
[source,terminal]
----
d /var/lib/systemd/coredump 0755 root root 3d
----

You can configure the systemd core dump retention period for nodes with a specific role, as needed, by using a `MachineConfig` custom resource (CR).

.Prerequisites

* Install the OpenShift CLI (`oc`).
* Log in as a user with `cluster-admin` privileges.

.Procedure

. Convert a string similar to the following into base64 encoding. 
+
[source,terminal]
----
d /var/lib/systemd/coredump 0755 root root <retention_period> <1>
----
<1> Specify the retention period in seconds (`s`), minutes (`m`), hours (`h`), days (`d`), weeks (`w`), milliseconds (`ms`), or microseconds (`us`). When set to zero, systemd deletes the core dump files unconditionally.
+
For example, the following string configures a 28 day retention period:
+
[source,terminal]
----
d /var/lib/systemd/coredump 0755 root root 28d
----

. Create the `MachineConfig` CR that uses the base64-encoded string to configure the core dump retention period.
+
[source,yaml]
----
apiVersion: machineconfiguration.openshift.io/v1
kind: MachineConfig
metadata:
  labels:
    machineconfiguration.openshift.io/role: <node_role> <1>
  name: configure-coredump
spec:
  config:
    ignition:
      version: 3.5.0
    storage:
      files:
      - contents:
          source: data:text/plain;charset=utf-8;base64,<base64-encoded string> <2>
        mode: 420
        overwrite: true
        path: /etc/tmpfiles.d/core.conf <3>
----
where:
+
--
`metadata.labels.machineconfiguration.openshift.io/role`:: Specifies the node role for the nodes you want to configure the core dump retention period.

`spec.config.storage.files.content.source`:: Specifies the base64-encoded string from the previous step.

`spec.config.storage.files.path`:: Specifies the location of the systemd `core.conf` file.
--

. Create the `MachineConfig` CR by running the following command:
+
[source,terminal]
----
$ oc create -f <file_name>.yaml
----
+
Scheduling on each affected node is disabled as the change is being applied.

. Check the machine configs to see that the new one was added:
+
[source,terminal]
----
$ oc get mc
----
+
.Example output
[source,terminal]
----
NAME                                               GENERATEDBYCONTROLLER                      IGNITIONVERSION   AGE
# ...
configure-coredump                                                                            3.5.0             28s
# ...
----

.Verification

. Start a debug pod by running the following command by using a command similar to the following:
+
[source,terminal]
----
$ oc debug node/<node_name>
----
+
where:
+
--
<node_name>:: Specifies a node with the specified node role.
--

. View the updated retention period by running the following command:
+
[source,terminal]
----
sh-5.1# systemd-tmpfiles --cat-config | grep coredump
----
+
.Example systemd core dump retention period
[source,terminal]
----
d /var/lib/systemd/coredump 0755 root root 28d
d /var/lib/systemd/coredump 0755 root root 3d
----
+
The updated dump period is shown. Here, the period is 28 days (`28d`). The `3d` value still displays, but the new value overrides the original.
