// Module included in the following assembly:
//
// * release-notes/monitoring-release-notes.adoc

:_mod-docs-content-type: REFERENCE
[id="monitoring-4-20-release-notes_{context}"]
= {ocp} {product-version} monitoring release notes

[role="_abstract"]
The changes for {ocp} {product-version} monitoring are included in the following errata advisory:

* link:<link>[RHSA-year:00000]

[id="monitoring-4-20-updates-to-monitoring-components-and-dependencies_{context}"]
== Updates to monitoring stack components and dependencies

This release includes the following version updates for in-cluster monitoring stack components and dependencies:

* Prometheus to 3.5.0
* Prometheus Operator to 0.85.0
* Metrics Server to 0.8.0
* Thanos to 0.39.2
* kube-state-metrics agent to 2.16.0
* prom-label-proxy to 0.12.0

[id="monitoring-4-20-changes-alerting-rules_{context}"]
== Changes to alerting rules

[NOTE]
====
Red{nbsp}Hat does not guarantee backward compatibility for recording rules or alerting rules.
====

* The expression for the `AlertmanagerClusterFailedToSendAlerts` alert has changed. The alert now evaluates the rate over a longer time period, from `5m` to `15m`.

[id="monitoring-4-20-new-features-and-enhancements_{context}"]
== New features and enhancements

The in-cluster monitoring stack for this release includes the following new features and enhancements:

Support log verbosity configuration for Metrics Server::
With this release, you can configure log verbosity for Metrics Server. You can set a numeric verbosity level to control the amount of logged information, where higher numbers increase the logging detail.
+
For more information, see link:https://docs.redhat.com/en/documentation/monitoring_stack_for_red_hat_openshift/4.20/html/configuring_core_platform_monitoring/storing-and-recording-data#setting-log-levels-for-monitoring-components_storing-and-recording-data[Setting log levels for monitoring components].

[id="monitoring-4-20-technology-preview-features_{context}"]
== Technology Preview features

[IMPORTANT]
====
[subs="attributes+"]
Technology Preview features are not supported with Red{nbsp}Hat production service level agreements (SLAs) and might not be functionally complete. Red{nbsp}Hat does not recommend using them in production. These features provide early access to upcoming product features, enabling customers to test functionality and provide feedback during the development process.

For more information about the support scope of Red{nbsp}Hat Technology Preview features, see link:https://access.redhat.com/support/offerings/techpreview/[Technology Preview Features Support Scope].
====

The following table tracks features that are in Technology Preview or were Technology Preview in recent releases. Features are marked with the following statuses:

* _Not Available_
* _Technology Preview_
* _General Availability_

.Monitoring Technology Preview tracker
[cols="4,1,1,1",options="header"]
|====
|Feature |4.18 |4.19 |4.20

|Metrics Collection Profiles
|Technology Preview
|General Availability
|General Availability

|====

[id="monitoring-4-20-fixed-issues_{context}"]
== Fixed issues

The in-cluster monitoring stack for this release includes the following fixed issues:

Cordoned nodes filtered from alerts to reduce false positives::
Before this update, the `KubeNodeNotReady` and `KubeNodeReadinessFlapping` alerts did not filter out cordoned nodes. As a consequence, users received alerts for nodes under maintenance, resulting in false positives. With this release, cordoned nodes are filtered from alerts. As a result, the number of false positives during maintenance is reduced.
+
link:https://issues.redhat.com/browse/OCPBUGS-60692[OCPBUGS-60692]

False alarms reduced for aggregated API errors::
Before this update, the `KubeAggregatedAPIErrors` alert was based on the sum of errors across all instances of an API. As a consequence, users were more likely to get alerted as the number of instances grew. With this release, alerts are evaluated at the instance level, rather than the API level. As a result, this helps curb false alarms due to the API error threshold getting hit sooner due to being evaluated cluster-wise, rather than instance-wise.
+
link:https://issues.redhat.com/browse/OCPBUGS-60691[OCPBUGS-60691]

{cmo-full} applies secure TLS settings to resolve cipher warnings::
Before this update, the {cmo-full} logged warnings about insecure TLS ciphers, which could raise concerns about security. This release configures secure TLS settings, removing those cipher warnings from the logs and ensuring the operator reports correct, secure TLS configurations.
+
link:https://issues.redhat.com/browse/OCPBUGS-58475[OCPBUGS-58475]

Negative CPU utilization is no longer displayed in monitoring dashboard::
Before this update, the monitoring dashboard in the {product-title} web console sometimes displayed large negative CPU utilization values due to incorrect assumptions about intermediate results. As a consequence, users could see negative CPU utilization in the web console. With this release, CPU utilization values are properly calculated and the web console no longer shows negative utilization values.
+
link:https://issues.redhat.com/browse/OCPBUGS-57481[OCPBUGS-57481]

Fix KubeCPUOvercommit alerts not firing after exceeding CPU limits::
Before this update, the `KubeCPUOvercommit` alert would not trigger on multi-node clusters even after CPU-consuming spikes over the permitted limits. With this release, the alert expression is adjusted to correctly account for multi-node clusters. As a result, the `KubeCPUOvercommit` alert triggers correctly after such instances.
+
link:https://issues.redhat.com/browse/OCPBUGS-35095[OCPBUGS-35095]

// Prevent false KubeMemoryOvercommit alerts under permitted memory limits::
// Before this update, the `KubeMemoryOvercommit` alert could falsely trigger on small multi-node clusters after memory-consuming spikes within the permitted limits. With this release, the alert expression is adjusted to correctly account for small multi-node clusters. As a result, the `KubeMemoryOvercommit` alert no longer falsely triggers after such instances.
// +
// link:https://issues.redhat.com/browse/OCPBUGS-34568[OCPBUGS-34568]

KubeStatefulSetReplicasMismatch alert now fires on pod creation failure::
Before this update, the `KubeStatefulSetReplicasMismatch` alert did not fire when the `StatefulSet` controller failed to create pods. As a consequence, users were not notified when the `StatefulSet` did not reach the desired number of replicas. With this release, the alert now fires correctly when the controller cannot create pods. As a result, users are alerted whenever the `StatefulSet` replicas do not match the configured amount.
+
link:https://issues.redhat.com/browse/OCPBUGS-60689[OCPBUGS-60689]

Prevent setting reserved external labels in the {cmo-full} config map::
Before this update, users could set `prometheus`, `prometheus_replica`, or `cluster` as Prometheus external labels to the `cluster-monitoring-config` and `user-workload-monitoring-config` config maps. This was not recommended and could cause issues with the cluster. With this release, the config maps no longer accept these reserved external labels.
+
link:https://issues.redhat.com/browse/OCPBUGS-18282[OCPBUGS-18282]

Fix unnecessary API calls during secret updates::
Before this update, when a new secret was created or updated in any namespace, Alertmanager was reconciling even if that secret was not referenced in the `AlertmanagerConfig` resource. As a consequence, the Prometheus Operator generated excessive API calls, causing increased CPU usage on control plane nodes. With this release, Alertmanager only reconciles secrets that the `AlertmanagerConfig` resource explicitly references.
+
link:https://issues.redhat.com/browse/OCPBUGS-56158[OCPBUGS-56158]

Removed unnecessary warning from Metrics Server logs::
Before this update, Metrics Server logged the following warning even though functionality was not affected:
+
[source,terminal]
----
setting componentGlobalsRegistry in SetFallback. We recommend calling componentGlobalsRegistry.Set() right after parsing flags to avoid using feature gates before their final values are set by the flags.
----
+
With this release, the warning message no longer appears in the `metrics-server` logs.
+
link:https://issues.redhat.com/browse/OCPBUGS-41851[OCPBUGS-41851]
