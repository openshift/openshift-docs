// Module included in the following assemblies:

// * service-mesh-docs-main/install/ossm-istio-ambient-mode.adoc

:_mod-docs-content-type: PROCEDURE
[id="ossm-scoping-sm-discovery-selectors-istio-ambient-mode_{context}"]
= Scoping the Service Mesh with discovery selectors in Istio ambient mode

To limit the scope of the {SMProduct} in {istio} ambient mode, you can configure `discoverySelectors` parameter in the `meshConfig` section of the `{istio}` resource. The configuration controls which namespaces the control plane discovers based on label selectors.

.Prerequisites

* You have deployed a cluster on {ocp-product-title} 4.19 or later.
* You have created an `Istio` control plane resource.
* You have created an `IstioCNI` resource.
* You have created a `Ztunnel` resource.

.Procedure

. Add a label to the namespace containing the `{istio}` control plane resource, for example, the `istio-system` namespace, by running the following command:
+
[source,terminal]
----
$ oc label namespace istio-system istio-discovery=enabled
----

. Add a label to the namespace containing the `IstioCNI` resource, for example, the `istio-cni` namespace, by running the following command:
+
[source,terminal]
----
$ oc label namespace istio-cni istio-discovery=enabled
----

. Add a label to the namespace containing the `Ztunnel` resource, for example, the `ztunnel` namespace, by running the following command:
+
[source,terminal]
----
$ oc label namespace ztunnel istio-discovery=enabled
----

. Modify the `{istio}` control plane resource to include a `discoverySelectors` section with the same label:

.. Create a YAML file with the name `istio-discovery-selectors.yaml` similar to the following example:
+
.Example configuration
[source,yaml]
----
apiVersion: sailoperator.io/v1
kind: Istio
metadata:
  name: default
spec:
  namespace: istio-system
  values:
    pilot:
      trustedZtunnelNamespace: ztunnel
    profile: ambient
    meshConfig:
      discoverySelectors:
      - matchLabels:
          istio-discovery: enabled
----

.. Apply the YAML file to `{istio}` control plane resource by running the following command:
+
[source,terminal]
----
$ oc apply -f istio-discovery-selectors.yaml
----