// Module included in the following assemblies:
//
// * security/zero_trust_workload_identity_manager/zero-trust-manager-upstream-authority plugins.adoc

:_mod-docs-content-type: CONCEPT
[id="zero-trust-manager-configure-cert-manager_{context}"]
= Configuring the cert-manager plugin

The cert-manager plugin for the SPIRE Server automates the intermediate signing certificates lifecycle of a SPIRE Server. The plugin manages the creation, renewal, and rotation of the signing certificates.

.Prerequisites

* Access to a {product-title} cluster where the SPIRE Server runs.

* cert-manager is installed and running within the Kubernetes cluster. For more information about installing cert-manager, see link:https://docs.redhat.com/en/documentation/openshift_container_platform/4.19/html-single/security_and_compliance/index#cert-manager-operator-install[Installing the cert-manager Operator for Red{nbsp}Hat OpenShift].

* A pre-configured cert-manager `Issuer` capable of signing intermediate Certificate Authority (CA) certificates.

.Procedure

. Create a YAML file that defines the `SpireSever` CR object, for example, `SpireServer.yaml`:
+
.Example `SpireServer.yaml`
+
[source,yaml]
----
apiVersion: operator.openshift.io/v1alpha1
kind: SpireServer
metadata:
  name: cluster
spec:
  trustDomain: example.com
  upstreamAuthority:
    type: cert-manager
    certManager:
      issuerKind: Issuer #<1>
      issuerName: my-org-intermediate-ca #<2>
      namespace: my-namespace #<3>
----

<1> Specifies the type of cert-manager issuer to use. The value `Issuer` indicates it is a namespace resource. The other option is `clusterIssuer`, which is a cluster-wide resource.
<2> The name of the `Issuer` or `CluserIssuer` resource within cert-manager that signs the certificate request. The issuer should already exist and configured to connect to the Public Key Infrastructure (PKI).
<3> Required when `issuerKind` is 'Issuer'. This field is omitted if using a `clusterIssuer`.

. Apply the configuration by running the following command:
+
[source,terminal]
----
$ oc apply -f SpireServer.yaml
----

.Verification

. Ensure that the resulting signed certificate and trust bundle are available in the secret created by the SPIRE Operator:
+
[source,terminal]
----
$ oc get secret spire-server-server-ca -n spire -o yaml
----
+
.Example signed certificate and trust bundle
+
[source,yaml]
----
apiVersion: v1
kind: Secret
metadata:
  name: spire-server-server-ca
  namespace: spire
  ownerReferences:
  - apiVersion: spire.spiffe.io/v1alpha1
    kind: SpireServer
    name: spire-server
    # ...
type: Opaque
data: <1>
   <trust_bundle> <2>
  ca.crt:
   <intermediate_CA_certificate> <3>
  ca.key:
   <private_key>
----
<1> The trust bundle containing the root CA and the intermediate CA.
<2> The SPIRE Server's intermediate CA certificate signed by your Issuer.
<3> The private key for the SPIRE Server's intermediate CA.

