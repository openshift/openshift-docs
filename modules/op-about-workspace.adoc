// This module is included in the following assemblies:
// * about/understanding-openshift-pipelines.adoc

:_mod-docs-content-type: CONCEPT
[id="about-workspaces_{context}"]
= Workspaces

[role="_abstract"]
You can use workspaces to declare shared storage volumes that tasks in a pipeline need for input or output at runtime. By separating volume declaration from runtime storage, workspaces allow you to specify the filesystem location independently, making your tasks reusable and flexible across different environments.

[NOTE]
====
We recommend that you use workspaces instead of the `PipelineResource` CRs in {pipelines-title}, as `PipelineResource` CRs are difficult to debug, limited in scope, and make tasks less reusable.
====

Instead of specifying the actual location of the volumes, workspaces allow you to declare the filesystem or parts of the filesystem that you need at runtime. A task or pipeline declares the workspace, and you must provide the specific location details of the volume. It is then mounted into that workspace in a task run or a pipeline run. This separation of volume declaration from runtime storage volumes makes the tasks reusable, flexible, and independent of the user environment.

With workspaces, you can:

* Store task inputs and outputs
* Share data among tasks
* Use it as a mount point for credentials held in secrets
* Use it as a mount point for configurations held in config maps
* Use it as a mount point for common tools shared by an organization
* Create a cache of build artifacts that accelerate jobs

You can specify workspaces in the `TaskRun` or `PipelineRun` using:

* A read-only config map or secret
* An existing persistent volume claim shared with other tasks
* A persistent volume claim from a volume claim template
* An `emptyDir` that the system discards when the task run completes

The following example shows a code snippet of the `build-and-deploy` pipeline, which declares a `shared-workspace` workspace for the `build-image` and `apply-manifests` tasks you define in the pipeline.

[source,yaml]
----
apiVersion: tekton.dev/v1
kind: Pipeline
metadata:
  name: build-and-deploy
spec:
  workspaces:
  - name: shared-workspace
  params:
...
  tasks:
  - name: build-image
    taskRef:
      resolver: cluster
      params:
      - name: kind
        value: task
      - name: name
        value: buildah
      - name: namespace
        value: openshift-pipelines
    workspaces:
    - name: source
      workspace: shared-workspace
    params:
    - name: TLSVERIFY
      value: "false"
    - name: IMAGE
      value: $(params.IMAGE)
    runAfter:
    - fetch-repository
  - name: apply-manifests
    taskRef:
      name: apply-manifests
    workspaces:
    - name: source
      workspace: shared-workspace
    runAfter:
      - build-image
...
----

`spec.workspaces`:: List of workspaces shared between the tasks defined in the pipeline. A pipeline can define as many workspaces as you need. In this example, only one workspace named `shared-workspace` is declared.

`tasks`:: Definition of tasks used in the pipeline. This snippet defines two tasks, `build-image` and `apply-manifests`, which share a common workspace.

`tasks.workspaces`:: List of workspaces used in the `build-image` task. A task definition can include as many workspaces as it requires. However, we recommend that a task uses at most one writable workspace.

`tasks.workspaces[0].name`:: Name that uniquely identifies the workspace you use in the task. This task uses one workspace named `source`.

`tasks.workspaces[0].name.workspace`:: Name of the pipeline workspace used by the task. Note that the workspace `source` in turn uses the pipeline workspace named `shared-workspace`.

`tasks[1].name.workspaces`:: List of workspaces used in the `apply-manifests` task. Note that this task shares the `source` workspace with the `build-image` task.

Workspaces help tasks share data, and let you specify one or more volumes that each task in the pipeline requires during execution. You can create a persistent volume claim or give a volume claim template that creates a persistent volume claim for you.

The following code snippet of the `build-deploy-api-pipelinerun` pipeline run uses a volume claim template to create a persistent volume claim for defining the storage volume for the `shared-workspace` workspace used in the `build-and-deploy` pipeline.

[source,yaml]
----
apiVersion: tekton.dev/v1
kind: PipelineRun
metadata:
  name: build-deploy-api-pipelinerun
spec:
  pipelineRef:
    name: build-and-deploy
  params:
...

  workspaces:
  - name: shared-workspace
    volumeClaimTemplate:
      spec:
        accessModes:
          - ReadWriteOnce
        resources:
          requests:
            storage: 500Mi
----

`workspaces`:: Specifies the list of pipeline workspaces for which volume binding you will offer in the pipeline run.

`workspaces[0].name`:: The name of the workspace in the pipeline for which the volume is being offered.

`workspaces[0].name.volumeClaimTemplates`:: Specifies a volume claim template that creates a persistent volume claim to define the storage volume for the workspace.
