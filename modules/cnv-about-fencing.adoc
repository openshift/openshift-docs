
// Module included in the following assemblies:
//
// * cnv/cnv_users_guide/cnv-fencing-nodes.adoc

[id="cnv-about-fencing_{context}"]

= About fencing nodes

Fencing is the act of protecting shared resources in order to safely recover from node failure.

In the case of an unhealthy node, Pods and virtual machines that depend on persistent storage cannot be replaced on another node until it can be confirmed that the original Pod or virtual machine is no longer accessing the storage. Fencing the node ensures that the workloads are no longer running on the unhealthy node, protecting the persistent storage. Once fencing is complete, workloads can be safely replaced on other nodes.

The fencing feature introduces three new controllers, which are deployed by the `MachineRemediation` Operator:

* `MachineDisruptionBudget` controller
* `MachineHealthCheck` controller
* `MachineRemedation` controller

The `MachineDisruptionBudget` controller creates a `MachineDisruptionBudget` object on each node to monitor the health of the nodes and tracks the number of healthy nodes in the cluster, the desired number of healthy nodes in the cluster, and how many disruptions are allowed. This controller prevents node deletion if the number of healthy or unhealthy nodes are not within the conditions set in the `MachineDisruptionBudget` object on the node.

The `MachineHealthCheck` controller monitors node health. If a node becomes unhealthy for longer than 5 minutes, the controller creates a `MachineRemedation` Custom Resource (CR) for the node, provided it is permitted by the `MachineDisruptionBudget` controller.

`MachineRemedation` controller monitors the `MachineRemedation` CRs and applies the remediation strategy specified in the CR. 


