// Module included in the following assemblies:
//
// * argocd_instance/argo-cd-cr-component-properties.adoc

:_mod-docs-content-type: PROCEDURE
[id="configuring-annotation-based-tracking-in-multiple-argo-cd-instances_{context}"]
= Configuring annotation-based tracking in multiple Argo CD instances

[role="_abstract"]
You can configure annotation-based tracking in multiple Argo CD instances.

[NOTE]
====
This procedure uses the following example values:

* `repoURL`: `\https://github.com/redhat-developer/gitops-operator`
* `server`: `\https://kubernetes.default.svc`

When you follow these steps, replace the example values with the actual values.
====

.Pre-requisites

* You have logged in to the {OCP} cluster as an administrator.
* You have installed the {gitops-title} Operator on your {OCP} cluster.

.Procedure

. Log in to the {OCP} web console. 

. In the *Administrator* perspective of the web console, click *Operators* -> *Installed Operators*.

* In the *Project* list, create or select the project where you want to install the user-defined Argo CD instance.

. Select *{gitops-title}* from the installed Operators list and click the *Argo CD* tab.

. To create two Argo CD instances, click *Create ArgoCD* and create two YAML files similar to the following examples:
+
.Example first Argo CD instance with an annotation label
[source,yaml]
----
apiVersion: argoproj.io/v1beta1
kind: ArgoCD
metadata:
  name: argocd-instance-demo-1 # <1>
  namespace: argocd-test-demo-1 # <2>
spec:
  installationID: "instance-demo-1" # <3>
  resourceTrackingMethod: "annotation+label"
----
<1> Specifies the name of the first Argo CD instance.
<2> Specifies the namespace used for the first Argo CD instance.
<3> Specifies the name of the `installationID` object for the first Argo CD instance.
+
.Example second Argo CD instance with an annotation label
[source,yaml]
----
apiVersion: argoproj.io/v1beta1
kind: ArgoCD
metadata:
  name: argocd-instance-demo-2 # <1>
  namespace: argocd-test-demo-2 # <2>
spec:
  installationID: "instance-demo-2" # <3>
  resourceTrackingMethod: "annotation+label"
----
+
<1> Specifies the name of the second Argo CD instance.
<2> Specifies the namespace used for the second Argo CD instance.
<3> Specifies the name of the `installationID` object for the second Argo CD instance.

. Configure and label target namespaces to associate namespaces with their Argo CD instances.
.. Navigate to *Administration* -> *Namespaces*.
.. Create namespaces for application deployments, `app-ns-1` and `app-ns-2`.
.. Associate each namespace with their respective Argo CD instance:
... Associate the `app-ns-1` namespace with the `argocd-test-demo-1` Argo CD instance by running the following command: 
+
.Example command
[source,terminal]
----
$ oc label namespace app-ns-1 argocd.argoproj.io/managed-by=argocd-test-demo-1
----
... Associate the `app-ns-2` namespace with the `argocd-test-demo-2` Argo CD instance by running the following command: 
+
.Example command
[source,terminal]
----
$ oc label namespace app-ns-2 argocd.argoproj.io/managed-by=argocd-test-demo-2
----
+
. Create two applications in Argo CD.
.. In the {OCP} web console, go to *Operators* -> *Installed Operators* -> *OpenShift GitOps Operator*.
.. Select *Argo CD* and navigate to the *Applications* tab.
.. Click *Create Application*.
.. Enter the following YAML snippet to create two applications in Argo CD.
+
.Example first application using Argo CD
[source,yaml]
----
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: sprint-petclinic # <1>
  namespace: argocd-test-demo-1 # <2>
spec:
  project: default
  source:
    repoURL: https://github.com/redhat-developer/gitops-operator
    path: test/examples/nginx
    targetRevision: HEAD
  destination:
    server: https://kubernetes.default.svc
    namespace: app-ns-1
  syncPolicy:
    automated: {}
----
<1> Specifies the name of the first application.
<2> Specifies the namespace used for the first application.
+
.Example second application using Argo CD
[source,yaml]
----
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: sprint-petclinic # <1>
  namespace: argocd-test-demo-2 # <2>
spec:
  project: default
  source:
    repoURL: https://github.com/redhat-developer/gitops-operator
    path: test/examples/nginx
    targetRevision: HEAD
  destination:
    server: https://kubernetes.default.svc
    namespace: app-ns-2
  syncPolicy:
    automated: {}
----
<1> Specifies the name of the second application that is created with the same name as the first application.
<2> Specifies the namespace used for the second application.

.Verification
. Navigate to *Workloads* -> *Pods* in the {OCP} web console.
. Ensure that the pods for Argo CD instances `argocd-instance-demo-1` and `argocd-instance-demo-2` are running.
. Check the application synchronization status in the *Argo CD Applications* YAML tab.
. Navigate to the `argocd-cm` config map in `argocd-test-demo-1` and `argocd-test-demo-2` namespaces and verify that the `installationID` object is configured successfully.