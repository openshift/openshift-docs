// Module included in the following assemblies:
//
// * security/audit-log-policy-config.adoc

:_mod-docs-content-type: PROCEDURE
[id="configuring-audit-policy-custom_{context}"]
= Configuring the audit log policy with custom rules

[role="_abstract"]
To apply custom rules without inheriting settings from a pre-defined profile, configure an audit log policy. This configuration ensures that only your specific rules are enforced, providing precise control over audit logging.

You can set a profile to `Default`, `WriteRequestBodies`, `AllRequestBodies`, or `None`.

.Prerequisites

* You have access to the cluster as a user with the `cluster-admin` role.

.Procedure

. Edit the `APIServer` resource:
+
[source,terminal]
----
$ oc edit apiserver cluster
----

. Add the `spec.audit.customRules` parameter:
+
[source,yaml]
----
apiVersion: config.openshift.io/v1
kind: APIServer
metadata:
...
spec:
  audit:
    customRules:
    - group: system:authenticated:oauth
      profile: WriteRequestBodies
    - group: system:authenticated
      profile: AllRequestBodies
    profile: Default
----
+
where:
+
`audit.customRules`:: Specifies the profile to use for that group. You can add one or more groups.
`audit.profile`:: Specifies one of the following settings: `Default`, `WriteRequestBodies`, `AllRequestBodies`, or `None`. If you do not set a value for the parameter, the value defaults to the `Default` profile.

. Save the file to apply the changes.

.Verification

* Verify that a new revision of the Kubernetes API server pods is rolled out. The rollout operation can take several minutes for all nodes to update to the new revision.
+
[source,terminal]
----
$ oc get kubeapiserver -o=jsonpath='{range .items[0].status.conditions[?(@.type=="NodeInstallerProgressing")]}{.reason}{"\n"}{.message}{"\n"}'
----
+
Review the `NodeInstallerProgressing` status condition for the Kubernetes API server to verify that all nodes are at the latest revision. The output shows `AllNodesAtLatestRevision` upon successful update:
+
[source,terminal]
----
AllNodesAtLatestRevision
3 nodes are at revision 12
----
+
where:
+
`revision`: Specifies the latest revision number. The example shows `12` as the revision number.
+
If the output shows a message similar to one of the following messages, the update is still in progress. Wait a few minutes and try again.
+
** `3 nodes are at revision 11; 0 nodes have achieved new revision 12`
** `2 nodes are at revision 11; 1 nodes are at revision 12`
