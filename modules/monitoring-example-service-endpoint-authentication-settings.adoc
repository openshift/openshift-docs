// Module included in the following assemblies:
//
// * observability/monitoring/configuring-the-monitoring-stack.adoc

:_mod-docs-content-type: REFERENCE
[id="example-service-endpoint-authentication-settings_{context}"]
= Example service endpoint authentication settings

[role="_abstract"]
You can configure authentication to safely scrape metrics from service endpoints in a user-defined project by using `ServiceMonitor` and `PodMonitor` custom resource definitions (CRDs).

The following samples show different authentication settings for a `ServiceMonitor` resource.
Each sample shows how to configure a corresponding `Secret` object that contains authentication credentials and other relevant settings.

== Sample YAML authentication with a bearer token

The following sample shows bearer token settings for a `Secret` object named `example-bearer-auth` in the `ns1` namespace:

.Example bearer token secret
[source,yaml]
----
apiVersion: v1
kind: Secret
metadata:
  name: example-bearer-auth
  namespace: ns1
stringData:
  token: <authentication_token>
----

where:

`<authentication_token>`::
Specifies an authentication token.

The following sample shows bearer token authentication settings for a `ServiceMonitor` CRD. The example uses a `Secret` object named `example-bearer-auth`:

[id="sample-yaml-bearer-token_{context}"]
.Example bearer token authentication settings
[source,yaml]
----
apiVersion: monitoring.coreos.com/v1
kind: ServiceMonitor
metadata:
  name: prometheus-example-monitor
  namespace: ns1 
spec:
  endpoints: 
  - authorization:
      credentials:
        key: token
        name: example-bearer-auth
    port: web
  selector:
    matchLabels:
      app: prometheus-example-app
----

where:

`credentials.key`::
Defines the key that contains the authentication token in the specified `Secret` object.

`credentials.name`::
Defines the name of the `Secret` object that contains the authentication credentials.

[IMPORTANT]
=====
Do not use `bearerTokenFile` to configure bearer token. If you use the `bearerTokenFile` configuration, the `ServiceMonitor` resource is rejected.
=====

[id="sample-yaml-basic-auth_{context}"]
== Sample YAML for Basic authentication

The following sample shows Basic authentication settings for a `Secret` object named `example-basic-auth` in the `ns1` namespace:

.Example Basic authentication secret
[source,yaml]
----
apiVersion: v1
kind: Secret
metadata:
  name: example-basic-auth
  namespace: ns1
stringData:
  user: <basic_username>
  password: <basic_password>
----

where:

`<basic_username>`::
Specifies a username for authentication.

`<basic_password>`::
Specifies a password for authentication.

The following sample shows Basic authentication settings for a `ServiceMonitor` CRD. The example uses a `Secret` object named `example-basic-auth`:

.Example Basic authentication settings
[source,yaml]
----
apiVersion: monitoring.coreos.com/v1
kind: ServiceMonitor
metadata:
  name: prometheus-example-monitor
  namespace: ns1 
spec:
  endpoints: 
  - basicAuth:
      username:
        key: user
        name: example-basic-auth
      password:
        key: password
        name: example-basic-auth
    port: web
  selector:
    matchLabels:
      app: prometheus-example-app
----

where:

`username.key`::
Defines the key that contains the username in the specified `Secret` object.

`username.name`, `password.name`::
Define the name of the `Secret` object that contains the Basic authentication.

`password.key`::
Defines the key that contains the password in the specified `Secret` object.

[id="sample-yaml-oauth-20_{context}"]
== Sample YAML authentication with OAuth 2.0

The following sample shows OAuth 2.0 settings for a `Secret` object named `example-oauth2` in the `ns1` namespace:

.Example OAuth 2.0 secret
[source,yaml]
----
apiVersion: v1
kind: Secret
metadata:
  name: example-oauth2
  namespace: ns1
stringData:
  id: <oauth2_id>
  secret: <oauth2_secret>
----

where:

`<oauth2_id>`::
Specifies an Oauth 2.0 ID.

`<oauth2_secret>`::
Specifies an Oauth 2.0 secret.

The following sample shows OAuth 2.0 authentication settings for a `ServiceMonitor` CRD. The example uses a `Secret` object named `example-oauth2`:

.Example OAuth 2.0 authentication settings
[source,yaml]
----
apiVersion: monitoring.coreos.com/v1
kind: ServiceMonitor
metadata:
  name: prometheus-example-monitor
  namespace: ns1 
spec:
  endpoints: 
  - oauth2:
      clientId:
        secret:
          key: id
          name: example-oauth2
      clientSecret:
        key: secret
        name: example-oauth2
      tokenUrl: https://example.com/oauth2/token
    port: web
  selector:
    matchLabels:
      app: prometheus-example-app
----

where:

`clientId.secret.key`::
Defines the key that contains the OAuth 2.0 ID in the specified `Secret` object.

`clientId.secret.name`, `clientSecret.name`::
Define the name of the `Secret` object that contains the OAuth 2.0 credentials.

`clientSecret.key`::
Defines the key that contains the OAuth 2.0 secret in the specified `Secret` object.

`tokenUrl`::
Defines the URL used to fetch a token with the specified `clientId` and `clientSecret`.
