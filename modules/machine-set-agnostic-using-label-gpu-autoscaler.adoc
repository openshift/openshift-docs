// Module included in the following assemblies:
//
// * machine_management/compute_machine_management/mapi_compute_provider_configurations/mapi-compute-config-options-bare-metal.adoc

include::snippets/machine-set-ifeval-open.adoc[]

:_mod-docs-content-type: PROCEDURE
[id="machine-set-agnostic-using-label-gpu-autoscaler_{context}"]
= Labeling GPU machine sets for the cluster autoscaler

You can configure a {api-name} {machine-set} to indicate which machines the cluster autoscaler can use to deploy GPU-enabled nodes.

.Prerequisites

* You have reviewed the process "Modifying a compute machine set by using the CLI".
* Your cluster uses a cluster autoscaler.

.Procedure

. Identify the machine set you want to modify.
For more information, see "Modifying a compute machine set by using the CLI".

. Add a `cluster-api/accelerator` label to a {api-name} {machine-set} by running the following command:
+
--
[source,terminal,subs="attributes+"]
----
$ oc patch {api-kind}.{api-group} <machine_set_name> \// <1>
  --namespace {namespace} \
  --patch '{"spec":{"template":{"spec":{"metadata":{"labels":"cluster-api/accelerator:<gpu_type>"}}}}}' <2>
----
<1> Specify the name of the machine set that you want to create machines for the cluster autoscaler to use to deploy GPU-enabled nodes.
<2> Specify a label of your choice that consists of alphanumeric characters, `-`, `_`, or `.` and starts and ends with an alphanumeric character.
For example, you might use `nvidia-t4` to represent Nvidia T4 GPUs, or `nvidia-a10g` for A10G GPUs.
+
[NOTE]
====
You must specify the value of this label for the `spec.resourceLimits.gpus.type` parameter in your `ClusterAutoscaler` CR.
For more information, see "Cluster autoscaler resource definition".
====
--

. If you do not need to make any further modifications, create replacement machines with the new configuration.
For more information, see "Modifying a compute machine set by using the CLI".

.Next steps

* Specify the value of this label for the `spec.resourceLimits.gpus.type` parameter in your `ClusterAutoscaler` CR.
For more information, see "Cluster autoscaler resource definition".

include::snippets/machine-set-ifeval-close.adoc[]