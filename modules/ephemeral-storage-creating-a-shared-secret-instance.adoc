// Module included in the following assemblies:
//
// * work_with_shared_resources/creating-shared-resource-csi-driver.adoc

:_mod-docs-content-type: PROCEDURE
[id="ephemeral-storage-creating-a-shared-secret-custom-resource_{context}"]
= Creating a SharedSecret custom resource

[role="_abstract"]
Create a `SharedSecret` custom resource (CR) to share a `Secret` object across namespaces. By creating a `SharedSecret` custom resource (CR), you can share a `Secret` object across namespaces, ensuring that sensitive configuration data remains consistently accessible cluster-wide.

.Prerequisites

* You are logged in to the {ocp-product-title} cluster as an administrator.
* You have created a `Secret` object that you want to share in other namespaces. To create a `Secret` object, see "Creating Secrets".
* You have subscribed to the cluster and have entitlement keys synced through the Insights Operator.
* You must have permissions to perform the following actions: 
** Create the `sharedsecrets.sharedresource.openshift.io` CR at a cluster-scoped level.
** Create the `ClusterRole` object for the `SharedSecret` CR.
** Create the `Role` and `RoleBinding` objects for the Shared Resource CSI Driver.
** Manage roles and role bindings across the namespaces in the cluster to control users.
** Manage roles and role bindings so that the service account specified by a pod can use the `SharedSecret` CR to mount a CSI volume that references a `Secret` object.
** Access to the namespaces that contain the `Secret` object you want to share.

.Procedure

. Create the `Role` and `RoleBinding` objects that grant the Shared Resource CSI driver the permission to access the `SharedSecret` object by using the following example configurations:
+
.Example `Role` object
[source,yaml]
----
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: share-etc-pki-entitlement
  namespace: openshift-config-managed
rules:
  - apiGroups:
      - ""
    resources:
      - secrets
    resourceNames:
      - etc-pki-entitlement
    verbs:
      - get
      - list
      - watch
----
+
--
* `metadata.name` defines the name of the `Role` CR.
--

+
.Example `RoleBinding` object
[source,yaml]
----
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: share-etc-pki-entitlement
  namespace: openshift-config-managed
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: share-etc-pki-entitlement 
subjects:
  - kind: ServiceAccount
    name: csi-driver-shared-resource
    namespace: openshift-builds
----
* `metadata.name` defines the name of the `RoleBinding` CR.
* `roleRef.name` defines the name of the `Role` CR.
* `subjects.name` defines the name of the `ServiceAccount` CR.

. Create a `SharedSecret` CR by using the following example configuration:
+
[source,yaml]
----
apiVersion: sharedresource.openshift.io/v1alpha1
kind: SharedSecret
metadata:
  name: shared-test-secret
spec:
  secretRef:
    name: test-secret
    namespace: openshift-config-managed
----
* `spec.secretRef.namespace` defines the name of the `SharedSecret` CR.

. Create a `ClusterRole` object that grants RBAC permission to use the referenced shared resource by using the following example configuration: 
+
[source,yaml]
----
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: use-shared-test-secret
rules:
  - apiGroups:
      - sharedresource.openshift.io
    resources:
      - sharedsecrets
    resourceNames:
      - shared-test-secret
    verbs:
      - use
----
* `metadata.name` defines the name of the `ClusterRole` CR.

.Verification

. Run the following command to verify that the required `Role` is created:
+
[source,terminal]
----
$ oc get role share-etc-pki-entitlement -n openshift-config-managed
----
+
.Example output
[source,terminal]
----
NAME                        CREATED AT
share-etc-pki-entitlement   2025-11-19T12:05:32Z
----

. Run the following command to verify that the required `RoleBinding` is created:
+
[source,terminal]
----
$ oc get rolebinding share-etc-pki-entitlement -n openshift-config-managed
----
+
.Example output
[source,terminal]
----
NAME                        ROLE                             AGE
share-etc-pki-entitlement   Role/share-etc-pki-entitlement   2m
----

. Run the following command to verify that the required `ClusterRole` is created:
+
[source,terminal]
----
$ oc get clusterrole use-shared-test-secret
----
+
.Example output
[source,terminal]
----
NAME                     CREATED AT
use-shared-test-secret   2025-11-19T12:05:44Z
----

[role="_additional-resources"]
.Additional resources

* link:https://docs.redhat.com/en/documentation/openshift_container_platform/4.19/html/builds_using_buildconfig/creating-build-inputs#builds-creating-secrets_creating-build-inputs[Creating Secrets]