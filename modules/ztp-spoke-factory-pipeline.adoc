// Module included in the following assemblies:
//
// * scalability_and_performance/ztp-factory-install-clusters.adoc
:_content-type: CONCEPT
[id="spoke-factory-pipeline_{context}"]
= The spoke factory pipeline

The deploy spoke cluster stage deploys and configures the spoke clusters. This stage ensures the spoke clusters are ready for use when the enclosure gets relocated to the end customers remote site. 

The flow associated with deploying the spoke cluster is as follows:

Download the code and check spoke::

This step installs the various tools on the spoke cluster needed in subsequent steps. It downloads `jq`, `oc`, `opm` and `kubectl`. It also proceeds to check that various hub install prerequisites exist before proceeding, for example it checks:

* {product-title} version
* nodes are ready
* cluster operators are ready
* metal^3^ pods are ready
* Persistent volumes are created
* DNS requirements are satisfied

Deploy spoke::

This step deploys the spokes.

Deploy NMState and MetalLB:: 

This steps deploys NMState and MetalLB. For more information about:

* The NMState Operator see, link:https://docs.openshift.com/container-platform/latest/networking/k8s_nmstate/k8s-nmstate-about-the-k8s-nmstate-operator.html[About the Kubernetes NMState Operator].
* MetalLB see, link:https://docs.openshift.com/container-platform/4.9/networking/metallb/about-metallb.html[About MetalLB and the MetalLB Operator]

Deploy OpenShift Data Foundation::

This step deploys OpenShift Data Foundation. This provides the storage necessary to host the disconnected registry images (Quay)

Deploy Quay::

This step deploys the Quay image registry. Quay allows the customer to use the OpenShift Container Platform clusater as a disconnected one.

Deploy worker::

This step deploys the worker nodes.

Detach cluster::

This step deploys NodeNetworkConfigurationPolicy (NNCP) and detaches the spoke clusters.