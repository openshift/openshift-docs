// Module included in the following assemblies:
//
// * logging/efk-logging-curator.adoc

[id="efk-logging-curator-actions-{context}"]
= Using the Curator Action file

The *Curator* ConfigMap in the `openshift-logging` project includes a link:https://www.elastic.co/guide/en/elasticsearch/client/curator/5.2/actionfile.html[Curator *action* file] where you configure any Curator action to be run periodically. 

However, when you use the *action* file, {product-title} ignores the `config.yaml` section of the *curator* ConfigMap, which is configured to ensure important internal indices do not get deleted by mistake.  
In order to use the *action* file, you should add an exclude rule to your configuration to retain these indices. You also need to manually add all the other patterns following the steps in this topic.

[IMPORTANT]
====
Using the *action* file is recommended only for advanced users as using this file can be destructive to the cluster and can cause removal of required indices/settings from Elasticsearch.
====

.Prerequisites

Cluster logging and Elasticsearch must be installed.

.Procedure

To configure Curator to retain indices: 

. Edit the Curator ConfigMap:
+
----
oc edit cm/curator -n openshift-logging
----

. Add an exclude rule to the `action` file:
+
[source,yaml]
----
actions:
  1:
    action: delete_indices <1>
    description: be careful!
    filters:
    - exclude: true <2>
      kind: regex
      filtertype: pattern
      value: '^project\.myapp\..*$|^\.operations\..*$|^\.searchguard\..*$|^\.kibana$' <3>
    - direction: older
      filtertype: age
      source: name
      timestring: '%Y.%m.%d'
      unit_count: 30
      unit: days
    options:
      continue_if_exception: false
      timeout_override: '300'
      ignore_empty_list: true
----
<1> Creates `delete_indices` to create the rule.
<2> Sets the rule to `true` to prevent the index from being deleted.
<3> Sets the indices to retain. 
<4> Add your custom rules here

