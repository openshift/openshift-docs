// Module included in the following assemblies:
//
// * logging/efk-logging-curator.adoc

[id="efk-logging-curator-actions-{context}"]
= Preventing Curator from deleting internal indices

The Cluster Logging Operator installation creates a Curator *action file*, *_curator-actions.yaml_*, that includes only the *delete_indices* action. You configure the *action file* using the{product-title} custom configuration file, *_config.yaml_*. Currently, the only action you can use with the automatically-created *action file* is `delete_indices`. 

If you are an advanced Curator user and want to configure other Curator actions, you can edit the Curator *action file*, or, if you have an existing Curator *action file*, you can continue to use that file. However, becasue modifying the *action file* can be destructive to the cluster and can cause removal of required indices/settings from Elasticsearch, you should use the {product-title} custom configuration file, *_config.yaml_* to remove indices.  

.Prerequisite

* Cluster logging and Elasticsearch must be installed.

* If needed, get the name of the Cluster Logging Custom Resource in the `openshift-logging` project:
+
----
$oc get ClusterLogging
NAME       AGE
instance   112m
----

.Procedure

To configure Curator to delete indices, edit the Curator *action file*:

[source,yaml]
----
actions:
1:
      action: delete_indices <1>
      description: >-
        Delete .operations indices older than 30 days.
        Ignore the error if the filter does not
        result in an actionable list of indices (ignore_empty_list).
        See https://www.elastic.co/guide/en/elasticsearch/client/curator/5.2/ex_delete_indices.html
      options:
        # Swallow curator.exception.NoIndices exception
        ignore_empty_list: True
        # In seconds, default is 300
        timeout_override: ${CURATOR_TIMEOUT}
        # Don't swallow any other exceptions
        continue_if_exception: False
        # Optionally disable action, useful for debugging
        disable_action: False
      # All filters are bound by logical AND
      filters:            <2>
      - filtertype: pattern
        kind: regex
        value: '^\.operations\..*$'
        exclude: False    <3>
      - filtertype: age
        # Parse timestamp from index name
        source: name
        direction: older
        timestring: '%Y.%m.%d'
        unit: days
        unit_count: 30
        exclude: False
----
<1> Specify `delete_indices` to delete the specified index.
<2> Use the `filers` parameters to specify the index to be deleted. See the link:https://www.elastic.co/guide/en/elasticsearch/client/curator/5.2/filters.html[Elastic Search curator documentation] for information on these parameters. 
<3> Specify `false` to allow the index to be deleted.
