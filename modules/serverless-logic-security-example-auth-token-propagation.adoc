// Module included in the following assemblies:
// serverles-logic/serverless-logic-authentication-openapi-services

:_mod-docs-content-type: REFERENCE
[id="serverless-logic-security-example-auth-token-propagation_{context}"]
= Example of authorization token propagation

{ServerlessLogicProductName} supports token propagation for OpenAPI operations that use the `oauth2` or `http` bearer security scheme types. Token propagation enables your workflow to forward the authorization token it receives during workflow creation to downstream services.This feature is useful when your workflow needs to interact with third-party services on behalf of the client that initiated the request.

You must configure token propagation individually for each security scheme. Once enabled, all OpenAPI operations secured using the same scheme will use the propagated token unless explicitly overridden.

The following example defines the `sayHelloOauth2` operation in the `security-example.json` file. This operation uses the `oauth-example` security scheme with the `clientCredentials` flow:

.Example OpenAPI specification with token propagation
[source,json]
----
{
  "openapi": "3.1.0",
  "info": {
    "title": "Oauth2 Scheme Example",
    "version": "1.0"
  },
  "paths": {
    "/hello-with-oauth2": {
      "get": {
        "operationId": "sayHelloOauth2",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "text/plain": {
                "schema": {
                  "type": "string"
                }
              }
            }
          }
        },
        "security": [
          {
            "oauth-example": []
          }
        ]
      }
    }
  },
  "components": {
    "securitySchemes": {
      "oauth-example": {
        "type": "oauth2",
        "flows": {
          "clientCredentials": {
            "authorizationUrl": "https://example.com/oauth",
            "tokenUrl": "https://example.com/oauth/token",
            "scopes": {}
          }
        }
      }
    }
  }
}
----

[id="serverless-logic-security-supported-config-properties-token-propagation_{context}"]
== Supported configuration properties for authorization token propagation

You can use the following configuration keys to enable and customize token propagation:

[cols="2,1,1",options="header"]
|====
|Property key
|Example
|Description 

|`quarkus.openapi-generator.[filename].auth.[security_scheme_name].token-propagation`
|`quarkus.openapi-generator.security_example_json.auth.oauth_example.token-propagation=true`
|Enables token propagation for all operations secured with the given scheme. Default is `false`.

|`quarkus.openapi-generator.[filename].auth.[security_scheme_name].header-name`
|`quarkus.openapi-generator.security_example_json.auth.oauth_example.header-name=MyHeaderName`
|(Optional) Overrides the default Authorization header with a custom header name to read the token from.

|====

You can replace `[filename]` with the sanitized OpenAPI file name `security_example_json` and `[security_scheme_name]` with the sanitized scheme name `oauth_example`. 

[NOTE]
====
The tokens are automatically passed to downstream services while the workflow is active. When the workflow enters a waiting state such as a timer or event-based pause, the token propagation stops. After the workflow resumes, tokens are not re-propagated automatically. You must manage re-authentication if needed.
====

.Example of applying token propagation in a `ConfigMap`

[source,yaml]
----
apiVersion: v1
kind: ConfigMap
metadata:
  name: workflow-auth-config
  namespace: my-namespace
data:
  application.properties: |
    quarkus.openapi-generator.security_example_json.auth.oauth_example.token-propagation=true
    quarkus.openapi-generator.security_example_json.auth.oauth_example.header-name=MyHeaderName
----