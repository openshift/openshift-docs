// Module included in the following assemblies:
//
// * argo_rollouts/configuring_traffic_management_and_metric_plugins_in_argo_rollouts.adoc

:_mod-docs-content-type: PROCEDURE
[id="enable-traffic-management-and-metric-plugins-in-argo-rollouts_{context}"]
= Enabling traffic management and metric plugins in Argo Rollouts

[role="_abstract"]
To enable traffic management and metric plugins in Argo Rollouts, complete the following steps.

.Procedure 

. Log in to the {OCP} web console as a cluster administrator. 

. In the *Administrator* perspective, click *Operators* -> *Installed Operators*.

. Create or select the project where you want to create and configure a `RolloutManager` custom resource (CR) from the *Project* drop-down menu.

. Select *{gitops-title}* from the *Installed Operators*.

. In the *Details* tab, under the *Provided APIs* section, click *Create instance* in the *RolloutManager* pane.

. On the *Create RolloutManager* page, select the *YAML view* and edit the YAML.
+
.Example adding the traffic management and metric plugins configuration in the `RolloutManager` CR
[source,yaml]
----
apiVersion: argoproj.io/v1alpha1
kind: RolloutManager
metadata:
  name: argo-rollouts
spec:
  plugins:
    trafficManagement:
      - name: argoproj-labs/gatewayAPI #<1>
        location: https://github.com/sample-metric-plugin #<2>
    metric:
      - name: argoproj-labs/sample-prometheus #<3>
        location: https://github.com/sample-trafficrouter-plugin #<4>
        sha256: dac10cbf57633c9832a17f8c27d2ca34aa97dd3d #<5>
----
<1> Specifies the name of the `trafficManagement` plugin.
<2> Specifies the location of the `trafficManagement` plugin.
<3> Specifies the name of the `metric` plugin.
<4> Specifies the location of the `metric` plugin.
<5> Optional: Specifies the SHA256 signature of the plugin binary, which is downloaded and installed by the Rollouts controller.

. Click *Create*.

. In the *RolloutManager* tab, under the *RolloutManagers* section, verify that the *Status* field of the RolloutManager instance shows as *Phase: Available*.

. Verify that the traffic management and metric plugins are installed correctly by completing the following steps:
.. In the *Administrator* perspective, click *Workloads* -> *ConfigMaps*.
.. Click the *argo-rollouts-config* config map.
+
As a result, the plugins defined in the `RolloutManager` CR are updated in the *argo-rollouts-config* config map.
+
.Example updated traffic management and metric plugins in the *argo-rollouts-config* `ConfigMap`
[source,yaml]
----
kind: ConfigMap
apiVersion: v1
metadata:
  name: argo-rollouts-config
  namespace: argo-rollouts
  labels:
    app.kubernetes.io/component: argo-rollouts
    app.kubernetes.io/name: argo-rollouts
    app.kubernetes.io/part-of: argo-rollouts
data:
  metricPlugins: |
      - name: "argoproj-labs/sample-prometheus" #<1>
        location: https://github.com/sample-metric-plugin #<2>
        sha256: dac10cbf57633c9832a17f8c27d2ca34aa97dd3d #<3>
  trafficRouterPlugins: |
    - name: argoproj-labs/gatewayAPI #<4>
      location: https://github.com/sample-metric-plugin #<5>
      sha256: "" #<6>
    - name: argoproj-labs/openshift #<7>
      location: file:/plugins/rollouts-trafficrouter-openshift/openshift-route-plugin #<8>
      sha256: "" #<9>

----
<1> Specifies the name of the `metric` plugin.
<2> Specifies the location of the `metric` plugin.
<3> Specifies the sha256 signature of the `metric` plugin.
<4> Specifies the name of the `trafficmanagement` plugin.
<5> Specifies the location of the `trafficmanagement` plugin.
<6> Specifies the sha256 signature of the `trafficmanagement` plugin.
<7> Specifies the name of the default `trafficmanagement` plugin.
<8> Specifies the location of the default `trafficmanagement` plugin.
<9> Specifies the sha256 signature of the `trafficmanagement` plugin.

+
By configuring traffic and metric plugins directly through the `RolloutManager` CR, you streamline the rollout process, reduce the chance of errors, and ensure consistent plugin management across your environment. This enhances control and flexibility while simplifying deployment procedures.