// Module included in the following assemblies:
//
// * machine_management/cpmso-configuration.adoc

:_mod-docs-content-type: REFERENCE
[id="cpmso-yaml-failure-domain-aws_{context}"]
= Sample {aws-short} failure domain configuration

[role="_abstract"]
To prevent downtime for your application due to the failure of a single {aws-first} region, you can configure failure domains in the control plane machine set.
To use failure domains, you configure appropriate values in the `failureDomains` section of the `ControlPlaneMachineSet` custom resource (CR).

The control plane machine set concept of a failure domain is analogous to the {aws-short} concept of an link:https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-regions-availability-zones.html#concepts-availability-zones[_Availability Zone (AZ)_].
The `ControlPlaneMachineSet` CR spreads control plane machines across more than one failure domain when possible.

When configuring {aws-short} failure domains in the control plane machine set, you must specify the availability zone name and the subnet to use.

.Sample {aws-short} failure domain values
[source,yaml]
----
apiVersion: machine.openshift.io/v1
kind: ControlPlaneMachineSet
metadata:
  name: cluster
  namespace: openshift-machine-api
spec:
# ...
  template:
# ...
    machines_v1beta1_machine_openshift_io:
      failureDomains:
        aws:
        - placement:
            availabilityZone: <aws_zone_a>
          subnet:
            filters:
            - name: tag:Name
              values:
              - <cluster_id>-subnet-private-<aws_zone_a>
            type: Filters
        - placement:
            availabilityZone: <aws_zone_b>
          subnet:
            filters:
            - name: tag:Name
              values:
              - <cluster_id>-subnet-private-<aws_zone_b>
            type: Filters
        platform: AWS
# ...
----
where:

`<aws_zone_a>`::
Specifies an {aws-short} availability zone for the first failure domain.
`spec.template.machines_v1beta1_machine_openshift_io.failureDomains.aws.subnet`::
Specifies a subnet configuration.
In this example, the subnet type is `Filters`, so there is a `filters` stanza.
`<cluster_id>-subnet-private-<aws_zone_a>`::
Specifies the subnet name for the first failure domain, using the infrastructure ID and the {aws-short} availability zone.
`spec.template.machines_v1beta1_machine_openshift_io.failureDomains.aws.subnet.type`::
Specifies the subnet type.
The following values are valid: `ARN`, `Filters` and `ID`.
The default value is `Filters`.
`<aws_zone_b>`::
Specifies an {aws-short} availability zone for an additional failure domain, using the infrastructure ID and the {aws-short} availability zone.
`<cluster_id>-subnet-private-<aws_zone_b>`::
Specifies the subnet name for the additional failure domain, using the infrastructure ID and the {aws-short} availability zone.
`spec.template.machines_v1beta1_machine_openshift_io.failureDomains.platform`::
Specifies the cloud provider platform name.
Do not change this value.
