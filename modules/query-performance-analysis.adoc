// Module included in the following assemblies:
//
// * configuring/loki-query-performance-troubleshooting.adoc

:_newdoc-version: 2.18.4
:_template-generated: 2025-09-22
:_mod-docs-content-type: CONCEPT

[id="query-performance-analysis_{context}"]
= Query performance analysis

For best query performance, you want to see as much time as possible spent in execution time, denoted by the `Execution Time` metric.
See the table below for the reason other performance metrics might be higher and the steps you can take to improve them.
You can also reduce the execution time by modifying your queries, thereby improving the overall performance.

[options="header",cols="2,5,5"]
|====
|Issue
|Reason
|Fix 
.2+|High `Execution Time` 
|Queries might be doing many CPU-intensive operations such as regular expression processing.

a| You can make the following changes:

* Change your queries to reduce or remove regular expressions.
* Add more CPU resources.

|Your queries have many small log lines.

|If your queries have many small lines, execution becomes dependent on how fast Loki can iterate the lines themselves. This becomes a CPU clock frequency bottleneck. To make things faster you need a faster CPU.


|High `Queue Time`
|You do not have enough queriers running.
|The only fix is to increase the number of queriers replicas in the `LokiStack` spec.

|High `Chunk Refs Fetch Time`
|Insufficient number of index-gateway replicas in the `LokiStack` spec.
|Increase the number of index-gateway replicas or ensure they have enough CPU resources.

|High `Chunks Download Time`
|The chunks might be too small
|Check the average chunk size by dividing `total_bytes` value by `cache_chunk_req` value. The average represents the average uncompressed bytes per chunk. The value for best performance should be in the order of magnitude of megabytes. If the chunks are only a few hundred bytes or kilobytes in size, revisit labels to ensure that you are not splitting your data into very small chunks.

|Query timing out
|Query timeout value might be too low
|Increase the `queryTimeout` value in the LokiStack spec. 
|====
