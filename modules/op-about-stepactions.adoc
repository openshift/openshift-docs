// This module is included in the following assemblies:
// * about/understanding-openshift-pipelines.adoc

:_mod-docs-content-type: CONCEPT
[id="about-stepactions_{context}"]
= Step actions

A step is a part of a task. If you define a step in a task, you cannot reference this step from another task.

However, you can optionally define a _step action_ in a `StepAction` custom resource (CR). This CR contains the action that a step performs. You can reference a `StepAction` object from a step to create a step that performs the action. You can also use resolvers to reference a `StepAction` definition that is available from an external source.

The following examples shows a `StepAction` CR named `apply-manifests-action`. This step action applies manifests from a source tree to your {OCP} environment:

[source,yaml]
----
apiVersion: tekton.dev/v1
kind: StepAction
metadata:
  name: apply-manifests-action
spec:
  params:
  - name: working_dir
    description: The working directory where the source is located
    type: string # <1>
    default: "/workspace/source"
  - name: manifest_dir
    description: The directory in source that contains yaml manifests
    default: "k8s"
  results:
  - name: output
    description: The output of the oc apply command
  image: image-registry.openshift-image-registry.svc:5000/openshift/cli:latest
  env:
  - name: MANIFEST_DIR
    value: $(params.manifest_dir)
  workingDir: $(params.working_dir)
  script: |
      #!/usr/bin/env bash
      oc apply -f "$MANIFEST_DIR" | tee $(results.output)
----
<1> The `type` specification for a parameter is optional.

The `StepAction` CR does not include definitions of workspaces. Instead, the step action expects that the task that includes the action also provides the mounted source tree, typically using a workspace.

A `StepAction` object can define parameters and results. When you reference this object, you must specify the values for the parameters of the `StepAction` object in the definition of the step. The results of the `StepAction` object automatically become the results of the step.

[IMPORTANT]
====
To avoid malicious attacks that use the shell, the `StepAction` CR does not support using parameter values in a `script` value. Instead, you must use the `env:` section to define environment variables that contain the parameter values.
====

The following example task includes a step that references the `apply-manifests-action`  step action, provides the necessary parameters, and uses the result:

[source,yaml]
----
apiVersion: tekton.dev/v1
kind: Task
metadata:
  name: apply-manifests-with-action
spec:
  workspaces:
  - name: source
  params:
  - name: manifest_dir
    description: The directory in source that contains yaml manifests
    type: string
    default: "k8s"
  steps:
  - name: apply
    ref:
      name: apply-manifests-action
    params:
    - name: working_dir
      value: "/workspace/source"
    - name: manifest_dir
      value: $(params.manifest_dir)
  - name: display_result
    script: 'echo $(step.apply.results.output)'
----
