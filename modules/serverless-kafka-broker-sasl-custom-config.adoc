// Module is included in the following assemblies:
//
// * serverless/knative_eventing/serverless-kafka.adoc

[id="serverless-kafka-broker-sasl-custom-config_{context}"]
= Configuring SASL authentication for the Kafka broker with custom configuration

.Prerequisites

* The {ServerlessOperatorName}, Knative Eventing, and the `KnativeKafka` custom resource are installed on your {product-title} cluster.
* You have created a project or have access to a project with the appropriate roles and permissions to create applications and other workloads in {product-title}.
* A username and password for the Kafka cluster.
* Choose the SASL mechanism to use, for example `PLAIN`, `SCRAM-SHA-256`, or `SCRAM-SHA-512`.
* If TLS is enabled, you also need the `ca.crt` certificate file for the Kafka cluster.

[NOTE]
====
Red Hat recommends enabling TLS in addition to SASL.
====

.Procedure

. Create the certificate files as secrets in your chosen namespace:
+
[source,terminal]
----
$ oc create secret --namespace <namespace> generic <kafka_auth_secret> \
  --from-literal=protocol=SASL_SSL \
  --from-literal=sasl.mechanism=<sasl_mechanism> \
  --from-file=ca.crt=caroot.pem \
  --from-literal=password="SecretPassword" \
  --from-literal=user="my-sasl-user"
----
+
[IMPORTANT]
====
Use the key names `ca.crt`, `password`, and `sasl.mechanism`. Do not change them.
====

. Create a config map as a YAML file:
+
[source,yaml]
----
apiVersion: v1
kind: ConfigMap
metadata:
  name: my-kafka-broker-config
data:
  default.topic.partitions: <partitions>
  default.topic.replication.factor: <replication_factor>
  bootstrap.servers: <bootstrap_servers>
  auth.secret.ref.name: <kafka_auth_secret>
----

. Apply the config map:
+
[source,terminal]
----
$ oc apply -f <filename>
----

. Reference the config map in your Kafka broker configuration:
+
[source,yaml]
----
apiVersion: eventing.knative.dev/v1
kind: Broker
metadata:
  annotations:
    eventing.knative.dev/broker.class: Kafka
  name: my-demo-kafka-broker
spec:
  config:
    apiVersion: v1
    kind: ConfigMap
    name: my-kafka-broker-config
    namespace: <namespace>
----

.Additional resources

* See link:https://access.redhat.com/documentation/en-us/red_hat_amq/7.5/html-single/using_amq_streams_on_rhel/index#assembly-kafka-encryption-and-authentication-str[Encryption and authentication] in the Red Hat AMQ Streams documentation.
