// Module included in the following assemblies:
//
// * disaster_recovery/scenario-3-expired-certs.adoc

[id="dr-scenario-3-recovering-expired-certs_{context}"]
= Recovering from expired control plane certificates

As of {product-title} 4.4.8, the cluster can automatically recover from expired control plane certificates. You no longer need to perform the manual steps that were required in previous versions.

The exception is that you must manually approve the pending `node-bootstrapper` certificate signing requests (CSRs) to recover kubelet certificates.

Use the following steps to approve the pending `node-bootstrapper` CSRs.

.Procedure

. Get the list of current CSRs:
+
[source,terminal]
----
$ oc get csr
----

. Review the details of a CSR to verify that it is valid:
+
[source,terminal]
----
$ oc describe csr <csr_name> <1>
----
<1> `<csr_name>` is the name of a CSR from the list of current CSRs.

. Approve each valid `node-bootstrapper` CSR:
+
[source,terminal]
----
$ oc adm certificate approve <csr_name>
----

In case your load balancer certs are also expired you will need to talk to one of the masters directly.

. Setup an ssh tunnel
+
[source,terminal]
----
$ ssh -i <master_private_key> -N -L 42443:localhost:6443 -o ProxyCommand='ssh -i <bastion_private_key> -W %h:%p <bastion_user>@<bastion>' core@<master>
----
<1> `<master_private_key>` is the ssh key to to use to connect to your master.
<2> `<bastion_private_key>` is the ssh key to to use to connect to your bastion.
<3> `<bastion>` is the IP or DNS name of your bastion.
<4> `<master>` is the IP or DNS name of your master node.

. Adjust all of your `oc` calls to use this tunnel like
+
[source,terminal]
----
$ oc --server https://localhost:42443 get csr
----

Note that your current kubeconfig context has to use certificate based authentication. Using token based authentication will not work as it requires additional components to be running.
