// Module included in the following assemblies:
//
// * installing/installing_ibm_z/installing-ibm-z-kvm.adoc


[id="installation-requirements-user-infra_{context}"]
= Machine requirements for a cluster with user-provisioned infrastructure

For a cluster that contains user-provisioned infrastructure, you must deploy all
of the required machines.

One or more KVM host machines based on {op-system-base} 8.3 or later. Each {op-system-base} KVM host machine must have libvirt installed and running. The virtual machines are provisioned under each {op-system-base} KVM host machine.


[id="machine-requirements_{context}"]
== Required machines

The smallest {product-title} clusters require the following nodes:

* One temporary bootstrap machine

* Three control plane, or master, machines

* At least two compute machines, which are also known as worker machines

[NOTE]
====
The cluster requires the bootstrap machine to deploy the {product-title} cluster
on the three control plane machines. You can remove the bootstrap machine after
you install the cluster.
====

[IMPORTANT]
====
To improve high availability of your cluster, distribute the control plane machines over different {op-system-base} instances on at least two physical machines.
====

The bootstrap, control plane, and compute machines must use {op-system-first} as the operating system.

See link:https://access.redhat.com/articles/rhel-limits[Red Hat Enterprise Linux technology capabilities and limits].

[id="network-connectivity_{context}"]
== Network connectivity requirements

The {product-title} installer creates the Ignition files, which are necessary for all the {op-system-first} virtual machines. The automated installation of {product-title} is performed by the bootstrap machine. It starts the installation of {product-title} on each node, starts the Kubernetes cluster, and then finishes. During this bootstrap, the virtual machine must have an established network connection either through a Dynamic Host Configuration Protocol (DHCP) server or static IP address.

[id="ibm-z-network-connectivity_{context}"]
== IBM Z network connectivity requirements

To install on IBM Z under {op-system-base} KVM, you need:

*   A {op-system-base} KVM host configured with an OSA or RoCE network adapter.
*   Either a {op-system-base} KVM host that is configured to use bridged networking in libvirt or MacVTap to connect the network to the guests.
+
See link:https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html-single/configuring_and_managing_virtualization/index#types-of-virtual-machine-network-connections_configuring-virtual-machine-network-connections[Types of virtual network connections].

[id="host-machine-resource-requirements_{context}"]
== Host machine resource requirements
The {op-system-base} KVM host in your environment must meet the following requirements to host the virtual machines that you plan for the {product-title} environment. See link:https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html/configuring_and_managing_virtualization/getting-started-with-virtualization-in-rhel-8_configuring-and-managing-virtualization[Getting started with virtualization].

You can install {product-title} version {product-version} on the following IBM hardware:

* IBM z15 (all models), IBM z14 (all models), IBM z13, and IBM z13s
* LinuxONE, any version

[id="minimum-ibm-z-system-requirements_{context}"]
== Minimum IBM Z system environment

[discrete]
=== Hardware requirements

* 1 LPAR with 6 IFLs that supports SMT2
* 1 OSA or RoCE network adapter

[discrete]
=== Operating system requirements
* One LPAR running {op-system-base} 8.3 or later with KVM, which is managed via libvirt

On your {op-system-base} KVM host, set up:

* 3 guest virtual machines for {product-title} control plane machines
* 2 guest virtual machines for {product-title} compute machines
* 1 guest virtual machine for the temporary {product-title} bootstrap machine

[id="minimum-resource-requirements_{context}"]
== Minimum resource requirements

Each cluster virtual machine must meet the following minimum requirements:

[cols="2,2,2,2,2",options="header"]
|===

|Virtual Machine
|Operating System
|vCPU ^[1]^
|Virtual RAM
|Storage

|Bootstrap
|{op-system}
|4
|16 GB
|120 GB

|Control plane
|{op-system}
|4
|16 GB
|120 GB

|Compute
|{op-system}
|2
|8 GB
|120 GB

|===
--
^[1]^ 1 physical core (IFL) provides 2 logical cores (threads) when SMT-2 is enabled. The hypervisor can provide 2 or more vCPUs.
--

[id="preferred-ibm-z-system-requirements_{context}"]
== Preferred IBM Z system environment

[discrete]
=== Hardware requirements

* 3 LPARs with 6 IFLs each that support SMT2
* 1 or 2 OSA or RoCE network adapters, or both

[discrete]
=== Operating system requirements

* For high availability, 2 or 3 LPARs running {op-system-base} 8.3 or later with KVM, which are managed via libvirt.

On your {op-system-base} KVM host, set up:

* 3 guest virtual machines for {product-title} control plane machines, distributed across the {op-system-base} KVM host machines
* At least 6 guest virtual machines for {product-title} compute machines, distributed across the {op-system-base} KVM host machines
* 1 guest virtual machine for the temporary {product-title} bootstrap machine

[id="preferred-resource-requirements_{context}"]
== Preferred resource requirements

The preferred requirements for each cluster virtual machine are:

[cols="2,2,2,2,2",options="header"]
|===

|Virtual Machine
|Operating System
|vCPU
|Virtual RAM
|Storage

|Bootstrap
|{op-system}
|4
|16 GB
|120 GB

|Control plane
|{op-system}
|8
|16 GB
|120 GB

|Compute
|{op-system}
|6
|8 GB
|120 GB

|===

[id="csr_management_{context}"]
== Certificate signing requests management

Because your cluster has limited access to automatic machine management when you
use infrastructure that you provision, you must provide a mechanism for approving
cluster certificate signing requests (CSRs) after installation. The
`kube-controller-manager` only approves the kubelet client CSRs. The
`machine-approver` cannot guarantee the validity of a serving certificate
that is requested by using kubelet credentials because it cannot confirm that
the correct machine issued the request. You must determine and implement a
method of verifying the validity of the kubelet serving certificate requests
and approving them.
