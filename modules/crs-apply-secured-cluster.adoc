// Module included in the following assemblies:
//
// * cloud_service/installing_cloud_other/init-bundle-cloud-other-apply.adoc
// * cloud_service/installing_cloud_ocp/init-bundle-cloud-ocp-apply.adoc
// * installing/installing_ocp/init-bundle-ocp.adoc
// * installing/installing_other/init-bundle-other.adoc

//Conditionals to show ocp commands for OpenShift, kube commands for Kubernetes, Central language for non-cloud
ifeval::["{context}" == "init-bundle-cloud-ocp"]
:openshift:
endif::[]

ifeval::["{context}" == "init-bundle-ocp"]
:openshift:
endif::[]

ifeval::["{context}" == "init-bundle-other"]
:kube:
endif::[]

ifeval::["{context}" == "init-bundle-cloud-other-apply"]
:kube:
endif::[]

ifeval::["{context}" == "init-bundle-cloud-other-apply"]
:cloud:
endif::[]

ifeval::["{context}" == "init-bundle-cloud-ocp-apply"]
:openshift:
endif::[]

ifeval::["{context}" == "init-bundle-cloud-ocp-apply"]
:cloud:
endif::[]

ifeval::["{context}" == "init-bundle-cloud-ocp-apply"]
:cloud-ocp-apply:
endif::[]

ifeval::["{context}" == "init-bundle-cloud-other-apply"]
:cloud-other-apply:
endif::[]

:_mod-docs-content-type: PROCEDURE
[id="crs-apply-secured-cluster_{context}"]
= Applying the cluster registration secret (CRS) on the secured cluster

//Do not show for ACSCS
ifndef::cloud[]
Before you configure a secured cluster, you must apply the CRS to the cluster. After you have applied the CRS, the services on the secured cluster can communicate securely with Central.
endif::cloud[]

//Show for ACSCS
ifdef::cloud[]
Before you configure a secured cluster, you must apply the CRS to the secured cluster. After you have applied the CRS, the services on the secured cluster can communicate securely with {product-title-managed-short}.
endif::cloud[]

[NOTE]
====
If you are installing by using Helm charts, do not perform this step. Complete the installation by using Helm; See "Installing
{product-title-short} on secured clusters by using Helm charts" in the additional resources section.
====

.Prerequisites
* You must have generated a CRS.

.Procedure
//Show for OpenShift
ifdef::openshift[]
To create resources, perform only one of the following steps:

* Create resources using the {ocp} web console: In the {ocp} web console, go to the `stackrox` project or the project where you want to install the secured cluster services. In the top menu, click *+* to open the *Import YAML* page. You can drag the CRS file or copy and paste its contents into the editor, and then click *Create*. When the command is complete, the display shows that the secret named `cluster-registration-secret` was created.

* Create resources using the {osp} CLI: Using the {osp} CLI, run the following command to create the resources:
+
[source,terminal]
----
$ oc create -f <file_name.yaml> \// <1>
  -n <stackrox> <2>
----
<1> Specify the file name of the CRS.
<2> Specify the name of the project where secured cluster services are installed.
endif::openshift[]
//Show for Kubernetes
ifdef::kube[]
* Using the `kubectl` CLI, run the following commands to create the resources:
+
[source,terminal]
----
$ kubectl create namespace stackrox <1>
$ kubectl create -f <file_name.yaml> \// <2>
  -n <stackrox> <3>
----
<1> Create the project where secured cluster resources will be installed. This example uses `stackrox`.
<2> Specify the file name of the CRS.
<3> Specify the project name that you created. This example uses `stackrox`.
endif::kube[]

ifdef::cloud-ocp-apply,cloud-other-apply[]
.Verification

* Restart Sensor to pick up the new certificates.
+
For more information about how to restart Sensor, see "Restarting the Sensor container" in the "Additional resources" section.
endif::cloud-ocp-apply,cloud-other-apply[]

ifeval::["{context}" == "init-bundle-cloud-ocp"]
:!openshift:
endif::[]

ifeval::["{context}" == "init-bundle-ocp"]
:!openshift:
endif::[]

ifeval::["{context}" == "init-bundle-other"]
:!kube:
endif::[]

ifeval::["{context}" == "init-bundle-cloud-other-apply"]
:!kube:
endif::[]

ifeval::["{context}" == "init-bundle-cloud-other-apply"]
:!cloud:
endif::[]

ifeval::["{context}" == "init-bundle-cloud-ocp-apply"]
:!openshift:
endif::[]

ifeval::["{context}" == "init-bundle-cloud-ocp-apply"]
:!cloud:
endif::[]

ifeval::["{context}" == "init-bundle-cloud-ocp-apply"]
:!cloud-ocp-apply:
endif::[]

ifeval::["{context}" == "init-bundle-cloud-other-apply"]
:!cloud-other-apply:
endif::[]