// Module is included in the following assemblies:
//
// * configuring/configuring-the-log-store.adoc

:_mod-docs-content-type: PROCEDURE
[id="logging-loki-storage-odf_{context}"]
= {rh-storage} storage

.Prerequisites

* You installed the {loki-op}.
* You installed the {oc-first}.
* You deployed link:https://access.redhat.com/documentation/en-us/red_hat_openshift_data_foundation/[{rh-storage}].
* You configured your {rh-storage} cluster link:https://access.redhat.com/documentation/en-us/red_hat_openshift_data_foundation/4.18/html/managing_and_allocating_storage_resources/adding-file-and-object-storage-to-an-existing-external-ocs-cluster[for object storage].

.Procedure

. Create an `ObjectBucketClaim` custom resource in the `openshift-logging` namespace:
+
[source,yaml]
----
apiVersion: objectbucket.io/v1alpha1
kind: ObjectBucketClaim
metadata:
  name: loki-bucket-odf
  namespace: openshift-logging
spec:
  generateBucketName: loki-bucket-odf
  storageClassName: openshift-storage.noobaa.io
----

. Get bucket properties from the associated `ConfigMap` object by running the following command:
+
[source,terminal]
----
BUCKET_HOST=$(oc get -n openshift-logging configmap loki-bucket-odf -o jsonpath='{.data.BUCKET_HOST}')
BUCKET_NAME=$(oc get -n openshift-logging configmap loki-bucket-odf -o jsonpath='{.data.BUCKET_NAME}')
BUCKET_PORT=$(oc get -n openshift-logging configmap loki-bucket-odf -o jsonpath='{.data.BUCKET_PORT}')
----

. Get bucket access key from the associated secret by running the following command:
+
[source,terminal]
----
ACCESS_KEY_ID=$(oc get -n openshift-logging secret loki-bucket-odf -o jsonpath='{.data.AWS_ACCESS_KEY_ID}' | base64 -d)
SECRET_ACCESS_KEY=$(oc get -n openshift-logging secret loki-bucket-odf -o jsonpath='{.data.AWS_SECRET_ACCESS_KEY}' | base64 -d)
----

. Create an object storage secret with the name `logging-loki-odf` by running the following command:
+
[source,terminal,subs="+quotes"]
----
$ oc create -n openshift-logging secret generic logging-loki-odf \ #<1>
--from-literal=access_key_id="<access_key_id>" \
--from-literal=access_key_secret="<secret_access_key>" \
--from-literal=bucketnames="<bucket_name>" \
--from-literal=endpoint="https://<bucket_host>:<bucket_port>"
  --from-literal=force_path_style="true" # <2>
----
<1> `logging-loki-odf` is the secret name.
<2> AWS endpoints (those ending in `.amazonaws.com`) use a virtual-hosted style by default, which is equivalent to setting the `force_path_style` attribute to `false`. Conversely, non-AWS endpoints use a path style, equivalent to setting  `force_path_style` attribute to `true`. If you need to use a virtual-hosted style with non-AWS S3 compatible services, you must explicitly set `force_path_style` to `false`.
