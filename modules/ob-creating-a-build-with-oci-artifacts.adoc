// This module is included in the following assembly:
//
// * work-with-builds/using-builds.adoc

:_mod-docs-content-type: PROCEDURE
[id="Creating-a-build-with-OCI-artifacts_{context}"]
= Creating a build with OCI artifacts

[role="_abstract"]
Use Open Container Initiative(OCI) artifact as your source code to create a container image. An OCI artifact, also known as a scratch image, contains only the source code and is not intended to run as a container. You can pull the OCI artifact from a container registry and extract its contents to use as source code to run the build.

.Prerequisites

* You have installed the {builds-operator} on the {ocp-product-title} cluster.
* You have installed the `oc` command-line interface (CLI).
* You have installed the link:https://console.redhat.com/openshift/downloads[`shp` CLI].

.Procedure

. Create a `Build` resource and apply it to the {ocp-product-title} cluster. See the following example configuration:
+
[source,yaml]
----
$ oc apply -f - <<EOF
apiVersion: shipwright.io/v1beta1
kind: Build
metadata:
  name: my-oci-build #<1>
spec:
  source:
    type: OCI
    ociArtifact:
      image: <quay.io/org/image:tag> #<2>
  strategy:
    name: <strategy-name> # <3>
    kind: ClusterBuildStrategy
  output: 
    image: <target-image-registry/repository/image:tag> #<4>
    pushSecret: <secret-name-for-credentials> #<5>
EOF
----
<1> Defines the name of the `Build` resource.
<2> Replace `<quay.io/org/image:tag>` with the location of the OCI artifact source image.
<3> Replace `<strategy-name>` with the name of the build strategy to build the container (`buildah` or `source-to-image`).
<4> Replace `<target-image-registry/repository/image:tag>` with the location where you want to push the built image.
<5> Optional: Replace `<secret-name-for-credentials>` with the secret name that stores the credentials for pushing container images. To generate a secret for a private registry for authentication, see link:https://docs.redhat.com/en/documentation/builds_for_red_hat_openshift/1.5/html-single/authentication/index#ob-authentication-to-container-registries_understanding-authentication-at-runtime[Authentication to container registries]

. Choose one of the following methods to upload your source code to the required registry and run the build:
* Use the `shp` CLI:

** Run the following command in the directory containing the local source code. It packages your source code into a scratch container image, pushes it to the required registry, and runs the build:
+
[source,terminal]
----
$ shp build upload my-oci-build # <1>
----
<1> Defines the name of the `Build` resource.

* Upload the OCI artifact manually: 

.. Create a `Containerfile` in the root directory of your source code and add the following configuration:
+
[source,dockerfile]
----
FROM scratch
COPY . /
----

.. Run the following command in the root directory of your source code to build the container image using Podman:
+
[source,terminal]
----
$ podman build -t <registry-path>/<image-name>:<tag> # <1>
----
<1> Replace <registry-path>/<image-name>:<tag> with the build location for the container image.

.. Push the container image to the required location using the following command:
+
[source,terminal]
----
$ podman push <registry-path>/<image-name>:<tag>  # <1>
----
<1> Replace <registry-path>/<image-name>:<tag> with the location where you want to push the built image.

.. Run the build using the following command:
+
[source,terminal]
----
$ shp build run my-oci-build # <1>
----
<1> Defines the name of the `Build` resource.
