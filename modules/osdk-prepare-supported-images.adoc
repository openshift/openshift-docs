// Module included in the following assemblies:
//
// * operators/operator_sdk/golang/osdk-golang-tutorial.adoc
// * operators/operator_sdk/ansible/osdk-ansible-tutorial.adoc
// * operators/operator_sdk/helm/osdk-helm-tutorial.adoc

ifeval::["{context}" == "osdk-golang-tutorial"]
:golang:
:type: Go
endif::[]
ifeval::["{context}" == "osdk-ansible-tutorial"]
:ansible:
:type: Ansible
:type_lc: ansible
endif::[]
ifeval::["{context}" == "osdk-helm-tutorial"]
:helm:
:type: Helm
:type_lc: helm
endif::[]

:_content-type: PROCEDURE
[id="osdk-prepare-supported-images_{context}"]
= Preparing your Operator to use supported images

[IMPORTANT]
====
If you are using the Red Hat supported, or downstream, release of the Operator SDK, you do not need to update your project to use supported images as shown in the following procedure. The downstream release of the Operator SDK uses universal base images (UBIs) by default.
====

Before running your {type}-based Operator on {product-title} Container Platform, update your project to use supported images.

.Prerequisite

* A {type}-based Operator project that uses a community-provided image.

.Procedure

ifdef::golang[]
. Update the project root-level Dockerfile to use supported images. Change the runner image reference from:
+
[source,terminal]
----
FROM gcr.io/distroless/static:nonroot
----
+
to:
+
[source,terminal]
----
FROM registry.access.redhat.com/ubi8/ubi-minimal:latest
----

. Depending on the Go project version, your Dockerfile might contain a `USER 65532:65532` or `USER nonroot:nonroot` directive. In either case, remove the line, as it is not required by the supported runner image.
endif::[]

ifdef::ansible,helm[]
. Update the project root-level Dockerfile to use supported images. Change the builder image reference from:
+
[source,terminal,subs="attributes+"]
----
FROM quay.io/operator-framework/{type_lc}-operator:<operator_sdk_version>
----
+
to:
+
[source,terminal,subs="attributes+"]
----
FROM registry.redhat.io/openshift4/ose-{type_lc}-operator:v{product-version}
----
+
[IMPORTANT]
====
Use the builder image version that matches your Operator SDK version. Failure to do so can result in problems due to project layout, or _scaffolding_, differences, particularly when mixing newer upstream versions of the Operator SDK with downstream {product-title} builder images.
====
endif::[]

. In the `config/default/manager_auth_proxy_patch.yaml` file, change the `image` value from:
+
[source,terminal]
----
gcr.io/kubebuilder/kube-rbac-proxy:<tag>
----
+
to use the supported image:
+
[source,terminal,subs="attributes+"]
----
registry.redhat.io/openshift4/ose-kube-rbac-proxy:v{product-version}
----

ifeval::["{context}" == "osdk-golang-tutorial"]
:!golang:
:!type:
endif::[]
ifeval::["{context}" == "osdk-ansible-tutorial"]
:!ansible:
:!type:
:!type_lc:
endif::[]
ifeval::["{context}" == "osdk-helm-tutorial"]
:!helm:
:!type:
:!type_lc:
endif::[]
