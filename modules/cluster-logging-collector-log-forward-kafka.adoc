// Module included in the following assemblies:
//
// *configuring/configuring-log-forwarding.adoc

:_mod-docs-content-type: PROCEDURE

[id="cluster-logging-collector-log-forward-kafka_{context}"]
= Forwarding logs to a Kafka broker

To configure log forwarding to an external Kafka instance, you must create a `ClusterLogForwarder` custom resource (CR) with an output to that instance, and a pipeline that uses the output. You can include a specific Kafka topic in the output or use the default. The Kafka output can use a TCP (insecure) or TLS (secure TCP) connection.

.Procedure

. Create or edit a YAML file that defines the `ClusterLogForwarder` CR object:
+
[source,yaml]
----
apiVersion: observability.openshift.io/v1
kind: ClusterLogForwarder
metadata:
  name: <log_forwarder_name>
  namespace: <log_forwarder_namespace>
spec:
  serviceAccount: 
    name: <service_account_name> # <1>
  outputs:
   - name: kafka-output # <2>
     type: kafka # <3>
     kafka:
       authentication:
         sasl:
           username:
             key: <key>
             secretName: kafka-secret # <4>
           password:
            key: <key>
            secretName:  kafka-secret
           mechanism: <sasl_mechanism> # <5>
       url: tls://kafka.example.devlab.com:9093/app-topic # <6>
       brokers: # <7>
         - tls://kafka-broker1.example.com:9093
         - tls://kafka-broker2.example.com:9093
       topic: # <8>
  pipelines:
    - name: app-topic 
      inputRefs: 
        - application
      outputRefs:
        - kafka-output
----
<1> Specify the name of your service account.
<2> Specify a name for the output.
<3> Specify the `kafka` type.
<4> If you use a `tls` prefix in the URL, you must specify the name of the secret required by the endpoint for TLS communication.
<5> Specify the Simple Authentication and Security Layer (SASL) mechanism to use. For example, `SCRAM-SHA-256`,`SCRAM-SHA-512`, or `PLAIN`. The default value is `PLAIN`.
<6> Optional: Specify the URL and port of the Kafka broker as a valid absolute URL, optionally with a specific topic. You can use the `tcp` (insecure) or `tls` (secure TCP) protocol. If you enable the cluster-wide proxy using the CIDR annotation, the output must be a server name or FQDN, and not an IP address. You must specify either the URL or Kafka brokers.
<7> Optional: Specify a list of broker endpoints of a Kafka cluster.  
<8> Specify the target topic. By default, the value for the field is `topic`. The topic name can be a combination of static and dynamic values consisting of field paths separated by "||". Encase dynamic values in single curly brackets "{}". Follow dynamic values with a static fallback value. The topic specified here overrides the topic defined in the `url` field.

. Apply the `ClusterLogForwarder` CR by running the following command:
+
[source,terminal]
----
$ oc apply -f <filename>.yaml
----
