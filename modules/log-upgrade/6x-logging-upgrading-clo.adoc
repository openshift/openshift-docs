// Module included in the following assemblies:
//
// * observability/logging/cluster-logging-upgrading.adoc

:_mod-docs-content-type: PROCEDURE
[id="logging-upgrading-clo_{context}"]
= Updating the {clo}

The {clo} does not provide an automated upgrade from Logging 5.x to Logging 6.x because of the different combinations in which Logging can be configured. You must install all the different operators for managing logging seperately. You can upgrade to Logging 6.x version from both Logging 5.9 and Logging 5.8 versions.

You can update {clo} by either changing the subscription channel in the {product-title} web console, or by uninstalling it. The following procedure demonstrates updating {clo} by changing the subscription channel in the {product-title} web console.

////
[IMPORTANT]
====
The path to the checkpoints in Vector in Logging v6 is different from the path in Logging v6. Therefore, on migration, all the logs are reprocessed which might impact the control-planes, network, storage, cpu and memory. 
====
////

//Need to add steps about 

.Prerequisites

* You have installed the {clo}.
* You have administrator permissions.
* You have access to the {product-title} web console and are viewing the *Administrator* perspective.

.Procedure

. Create service account.

.. Create a service account to be used by the log collector:
+
[source,terminal]
----
$ oc create sa logging-collector -n openshift-logging
----

.. Bind the `ClusterRole` role to the `serviceAccount` to be able to write the logs to the Red{nbsp}Hat LokiStack
+
[source,terminal]
----
$ oc adm policy add-cluster-role-to-user logging-collector-logs-writer -z logging-collector -n openshift-logging
----

.. Assign permission to collect and forward application logs by running the following command:
+
[source,terminal]
----
$ oc adm policy add-cluster-role-to-user collect-application-logs -z logging-collector -n openshift-logging
----

.. Assign permission to collect and forward audit logs by running the following command:
+
[source,terminal]
----
$ oc adm policy add-cluster-role-to-user collect-audit-logs -z logging-collector -n openshift-logging
----

.. Assign permission to collect and forward infrastructure logs by running the following command:
+
[source,terminal]
----
 $ oc adm policy add-cluster-role-to-user collect-infrastructure-log -z logging-collector -n openshift-logging
----

. Transform the transform the current configuration to the new API in Logging 6.
+
For more information, see link:[Changes to Cluster logging and forwarding in Logging 6].

. Move Vector checkpoints to the new path.
+
//Need to add steps
+
[IMPORTANT]
====
When you migrate, all the logs that have not been compressed will be reprocessed by Vector. The reprocessing might lead to the following issues:

* Duplicated logs during migration.
* Too many requests in the Log storage receiving the logs or reaching rate limit.
* Problems on the log store on disk and performance as consequence of re-reading and processing all old logs the collector.
* Impact in the Kube API.
* A peak of memory and cpu in Vector until all the old logs are processed. The logs can be several GB per node. 
====

. Update the {clo} by using the {product-title} web console.
.. Navigate to *Operators* -> *Installed Operators*.

.. Select the *openshift-logging* project.

.. Click the *Red Hat OpenShift Logging* Operator.

.. Click *Subscription*. In the *Subscription details* section, click the *Update channel* link.

.. In the *Change Subscription Update Channel* window, select the latest major version update channel, *stable-6.x*, and click *Save*. Note the `cluster-logging.v6.y.z` version.

.. Wait for a few seconds, and then go to *Operators* -> *Installed Operators* to verify that the {clo} version matches the latest `cluster-logging.v6.y.z` version.

.. On the *Operators* -> *Installed Operators* page, wait for the *Status* field to report *Succeeded*.
+
Your existing Logging v5 resources will continue to run, but are no longer managed by your operator. These unmanaged resources can be removed once your new resources are ready to be created. 

// check if this is correct

