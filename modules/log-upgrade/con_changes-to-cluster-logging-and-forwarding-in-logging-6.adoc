:_newdoc-version: 2.18.4
:_template-generated: 2025-05-26
:_mod-docs-content-type: CONCEPT

[id="changes-to-cluster-logging-and-forwarding-in-logging-6_{context}"]
= Changes to Cluster logging and forwarding in Logging 6

Log collection and forwarding configurations are now specified under the new link:https://github.com/openshift/cluster-logging-operator/blob/master/docs/reference/operator/api_observability_v1.adoc[API], part of the `observability.openshift.io` API group. The following sections highlight the differences from the old API resources.

[NOTE]
====
Vector is the only supported collector implementation.
====

== Management, resource allocation, and workload scheduling

Configuration for management state, resource requests and limits, tolerations, and node selection is now part of the new `ClusterLogForwarder` API.

.Logging 5.x configuration
[source,yaml]
----
apiVersion: "logging.openshift.io/v1"
kind: "ClusterLogging"
spec:
  managementState: "Managed"
  collection:
    resources:
      limits: {}
      requests: {}
    nodeSelector: {}
    tolerations: {}
----

.Logging 6 configuration
[source,yaml]
----
apiVersion: "observability.openshift.io/v1"
kind: ClusterLogForwarder
spec:
  managementState: Managed
  collector:
    resources:
      limits: {}
      requests: {}
    nodeSelector: {}
    tolerations: {}
----

== Input specifications

The input specification is an optional part of the `ClusterLogForwarder` specification. Administrators can continue to use the predefined values `application`, `infrastructure`, and `audit` to collect these sources.

=== Application Inputs

Namespace and container inclusions and exclusions have been consolidated into a single field.

.5.x application input with namespace and container includes and excludes
[source,yaml]
----
apiVersion: "logging.openshift.io/v1"
kind: ClusterLogForwarder
spec:
  inputs:
   - name: application-logs
     type: application
     application:
       namespaces:
       - foo
       - bar
       includes:
       - namespace: my-important
         container: main
       excludes:
       - container: too-verbose
----

.6.x application input with namespace and container includes and excludes
[source,yaml]
----
apiVersion: "observability.openshift.io/v1"
kind: ClusterLogForwarder
spec:
  inputs:
   - name: application-logs
     type: application
     application:
       includes:
       - namespace: foo
       - namespace: bar
       - namespace: my-important
         container: main
       excludes:
       - container: too-verbose
----

[NOTE]
====
"application", "infrastructure", and "audit" are reserved words and cannot be used as names when defining an input.
====

=== Input receivers

Changes to input receivers include:

* Explicit configuration of the type at the receiver level.
* Port settings moved to the receiver level.

.5.x input receivers
[source,yaml]
----
apiVersion: "logging.openshift.io/v1"
kind: ClusterLogForwarder
spec:
  inputs:
  - name: an-http
    receiver:
      http:
        port: 8443
        format: kubeAPIAudit
  - name: a-syslog
    receiver:
      type: syslog
      syslog:
        port: 9442
----

.6.x input receivers
[source,yaml]
----
apiVersion: "observability.openshift.io/v1"
kind: ClusterLogForwarder
spec:
  inputs:
  - name: an-http
    type: receiver
    receiver:
      type: http
      port: 8443
      http:
        format: kubeAPIAudit
  - name: a-syslog
    type: receiver
    receiver:
      type: syslog
      port: 9442
----

== Output specifications

High-level changes to output specifications include:

* URL settings moved to each output type specification.
* Tuning parameters moved to each output type specification.
* Separation of TLS configuration from authentication.
* Explicit configuration of keys and secret/configmap for TLS and authentication.

== Secrets and TLS Configuration

Secrets and TLS configurations are now separated into authentication and TLS configuration for each output. They must be explicitly defined in the specification rather than relying on administrators to define secrets with recognized keys. Upgrading TLS and authorization configurations requires administrators to understand previously recognized keys to continue using existing secrets. Examples in the following sections provide details on how to configure *ClusterLogForwarder* secrets to forward to existing Red Hat managed log storage solutions.

.Logging 6.x output using service accounu token
[source,yaml]
----
...
spec:
  outputs:
  - name: my-output
    type: http
    http:
      url: https://my-secure-output:8080
    authentication:
      token:
        from: serviceAccount
    tls:
      ca:
        key: service-ca.crt
        configMapName: openshift-service-ca.crt
...
----

.Logging 6.x output authentication and TLS example
[source,yaml]
----
...
spec:
  outputs:
  - name: my-output
    type: http
    http:
      url: https://my-secure-output:8080
    authentication:
      password:
        key: pass
        secretName: my-secret
      username:
        key: user
        secretName: my-secret
    tls:
      ca:
        key: ca-bundle.crt
        secretName: collector
      certificate:
        key: tls.crt
        secretName: collector
      key:
        key: tls.key
        secretName: collector
...
----

== Filters and pipeline configuration

All attributes of pipelines in previous releases have been converted to filters in this release. Individual filters are defined in the `filters`` spec and referenced by a pipeline.

.5.x filters
[source,yaml]
----
...
spec:
  pipelines:
  - name: app-logs
    detectMultilineErrors: true
    parse: json
    labels:
      foo: bar
...
----

.6.x filters and pipelines spec
[source,yaml]
----
...
spec:
  filters:
  - name: my-multiline
    type: detectMultilineException
  - name: my-parse
    type: parse
  - name: my-labels
    type: openshiftLabels
    openshiftLabels:
      foo: bar
  pipelines:
  - name: app-logs
    filterRefs:
    - my-multiline
    - my-parse
    - my-labels
...
----

[NOTE]
====
`Drop`, `Prune`, and `KubeAPIAudit` filters remain unchanged.
====

== Validation and status

Most validations are now enforced when a resource is created or updated which provides immediate feedback. This is a departure from previous releases where all validation occurred post creation requiring inspection of the resource status location. Some validation still occurs post resource creation for cases where is not possible to do so at creation or update time.

Instances of the `ClusterLogForwarder.observability.openshift.io` must satisfy the following conditions before the operator deploys the log collector:

* Resource Status Conditions: Authorized, Valid, Ready

* Spec Validations: Filters, Inputs, Outputs, Pipelines

All must evaluate to the status value of `True`.

