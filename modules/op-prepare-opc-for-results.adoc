// This module is included in the following assembly:
//
// * records/using-tekton-results-for-openshift-pipelines-observability.adoc

:_mod-docs-content-type: PROCEDURE
[id="prepare-opc-for-results_{context}"]
= Preparing the opc utility environment for querying {tekton-results}

[role="_abstract"]
Before you can query {tekton-results}, you must prepare the environment for the `opc` utility.

.Prerequisites

* You installed the `opc` utility.
* You logged on to the {OCP} cluster by using the {oc-first}.

.Procedure

. Set the `RESULTS_API` environment variable to the route to the {tekton-results} API by entering the following command:
+
[source, terminal]
----
$ export RESULTS_API=$(oc get route tekton-results-api-service -n openshift-pipelines --no-headers -o custom-columns=":spec.host"):443
----

. Create an authentication token for the {tekton-results} API by entering the following command:
+
[source,terminal]
----
$ oc create token <service_account>
----
+
Replace `<service_account>` with the name of an {OCP} service account that has read access to the namespaces where {pipelines-shortname} ran the pipeline runs and task runs.
+
Save the string that this command outputs.

. Optional: Create the `~/.config/tkn/results.yaml` file for automatic authentication with the {tekton-results} API. The file must have the following contents:
+
[source,yaml]
----
address: <tekton_results_route> # <1>
token: <authentication_token> # <2>
ssl:
   roots_file_path: /home/example/cert.pem # <3>
   server_name_override: tekton-results-api-service.openshift-pipelines.svc.cluster.local # <4>
 service_account:
   namespace: service_acc_1 <5>
   name: service_acc_1 <5>
----
<1> The route to the {tekton-results} API. Use the same value as you set for `RESULTS_API`.
<2> The authentication token that was created by the `oc create token` command. If you provide this token, it overrides the `service_account` setting and `opc` uses this token to authenticate.
<3> The location of the file with the SSL certificate that you configured for the API endpoint.
<4> If you configured a custom target namespace for {pipelines-shortname}, replace `openshift-pipelines` with the name of this namespace.
<5> The name of a service account for authenticating with the {tekton-results} API. If you provided the authentication token, you do not need to provide the `service_account` parameters.
+
Alternatively, if you do not create the `~/.config/tkn/results.yaml` file, you can pass the token to each `opc` command by using the `--authtoken` option.
