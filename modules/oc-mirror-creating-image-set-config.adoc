// Module included in the following assemblies:
//
// * installing/disconnected_install/installing-mirroring-disconnected.adoc

:_content-type: PROCEDURE
[id="oc-mirror-creating-image-set-config_{context}"]
= Creating the image set configuration

Before you can use the oc-mirror plug-in to mirror image sets, you must create an image set configuration file. This image set configuration file defines which {product-title} releases, Operators, and other images to mirror, along with other configuration settings for the oc-mirror plug-in.

You must specify a storage backend in the image set configuration file. This storage backend can be a local directory or a registry that supports link:https://docs.docker.com/registry/spec/manifest-v2-2[Docker v2-2]. The oc-mirror plug-in stores metadata in this storage backend during image set creation.

[IMPORTANT]
====
Do not delete or modify the metadata that is generated by the oc-mirror plug-in. You must use the same storage backend every time you run the oc-mirror plug-in for the same mirror registry.
====

.Prerequisites

* You have created a container image registry credentials file. For instructions, see _Configuring credentials that allow images to be mirrored_.

.Procedure

. Use the `oc mirror init` command to create a template for the image set configuration and save it to a file called `imageset-config.yaml`:
+
[source,terminal]
----
$ oc mirror init --registry example.com/mirror/oc-mirror-metadata > imageset-config.yaml <1>
----
<1> Replace `example.com/mirror/oc-mirror-metadata` with the location of your registry for the storage backend.

. Edit the file and adjust the settings as necessary:
+
[source,yaml]
----
kind: ImageSetConfiguration
apiVersion: mirror.openshift.io/v1alpha2
archiveSize: 4                                                      <1>
storageConfig:                                                      <2>
  registry:
    imageURL: example.com/mirror/oc-mirror-metadata                 <3>
    skipTLS: false
mirror:
  platform:
    channels:
    - name: stable-4.11                                             <4>
      type: ocp
    graph: true                                                     <5>
  operators:
  - catalog: registry.redhat.io/redhat/redhat-operator-index:v4.11  <6>
    packages:
    - name: serverless-operator                                     <7>
      channels:
      - name: stable
  additionalImages:
  - name: registry.redhat.io/ubi8/ubi:latest                        <8>
  helm: {}
----
<1> Add `archiveSize` to set the maximum size, in GiB, of each file within the image set.
<2> Set the back-end location to save the image set metadata to. This location can be a registry or local directory. It is required to specify `storageConfig` values.
<3> Set the registry URL for the storage backend.
<4> Set the channel to retrieve the {product-title} images from.
<5> Add `graph: true` to generate the OpenShift Update Service (OSUS) graph image to allow for an improved cluster update experience when using the web console. For more information, see _About the OpenShift Update Service_.
<6> Set the Operator catalog to retrieve the {product-title} images from.
<7> Specify only certain Operator packages and channels to include in the image set. Remove this field to retrieve all packages in the catalog.
<8> Specify any additional images to include in image set.
+
See _Image set configuration parameters_ for the full list of parameters and _Image set configuration examples_ for various mirroring use cases.

. Save the updated file.
+
This image set configuration file is required by the `oc mirror` command when mirroring content.
