// Module included in the following assemblies:
//
// * integration/integrate-with-image-registries.adoc
:_mod-docs-content-type: PROCEDURE
[id="configuring-assumerole-with-iam_{context}"]
= Configuring AssumeRole with container IAM

[role="_abstract"]
Before you can use AssumeRole with {product-title}, you must first configure it.

.Procedure
. Enable the IAM OIDC provider for your EKS cluster:
+
[source,terminal]
----
$ eksctl utils associate-iam-oidc-provider --cluster <cluster name> --approve
----
. link:https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_create_for-user.html[Create an IAM role] for your EKS cluster.
. Associate the newly created role with a service account:
+
[source,terminal]
----
$ kubectl -n stackrox annotate sa central eks.amazonaws.com/role-arn=arn:aws:iam::67890:role/<role-name>
----
. Restart Central to apply the changes.
+
[source,terminal]
----
$ kubectl -n stackrox delete pod -l app=central
----
. Assign the role to a policy that allows the role to assume another role as required:
+
[source,json]
----
{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Sid": "VisualEditor0",
            "Effect": "Allow",
            "Action": "sts:AssumeRole",
            "Resource": "arn:aws:iam::<ecr-registry>:role/<assumerole-readonly>" <1>
        }
    ]
}
----
<1> Replace `<assumerole-readonly>` with the role you want to assume.
. Update the trust relationship for the role you want to assume:
+
[source,json]
----
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Principal": {
        "AWS": [
          "arn:aws:iam::<ecr-registry>:role/<role-name>" <1>
        ]
      },
      "Action": "sts:AssumeRole"
    }
  ]
}
----
<1> The `<role-name>` should match with the new role you have created earlier.
