// admin_guide/multinetwork.adoc
ifdef::context[:parent-context: {context}]

[id='multinetwork-dhcp-{context}']
= Using DHCP for pod IP address management

The DHCP CNI plugin provides a method for IPAM (IP address management) to use when having IP addresses assigned to additional interfaces. When we create custom resources with CNI plugin

In order to use the DHCP plugin, you'll need to run the DHCP plugin in a daemon mode on each node in your cluster.

For example:

[source,bash]
----
nohup /usr/libexec/cni/dhcp daemon &> /var/log/dhcp-cni &
----

For the sake of simplicity, let's label the node where we ran our DHCP daemon so that we can ensure that our pods are run there -- generally you'd usually ensure this dhcp daemon runs on each node in the cluster.


[source,bash]
----
oc label nodes {your-worker-node-name} dhcpenabled=true
oc get nodes --show-labels
----

Now we can create a custom resource which uses DHCP for IPAM.

[source,bash]
----
cat <<EOF | oc create -f -
| apiVersion: "k8s.cni.cncf.io/v1"
kind: NetworkAttachmentDefinition
metadata:
  name: dhcp-example
spec:
  config: '{
      "cniVersion": "0.3.0",
      "type": "macvlan",
      "master": "eth0",
      "mode": "bridge",
      "ipam": {
        "type": "dhcp"
      }
    }'
EOF
----

We'll create a pod which references the name of the `NetworkAttachmentDefinition`, like so:

[source,bash]
----
cat <<EOF | oc create -f -
| apiVersion: v1
kind: Pod
metadata:
  name: dhcpsamplepod
  annotations:
    k8s.v1.cni.cncf.io/networks: dhcp-example
spec:
  containers:
** name: dhcpsamplepod
    command: ["/bin/bash", "-c", "sleep 2000000000000"]
    image: centos/tools
  nodeSelector:
    dhcpenabled: "true"
EOF
----
