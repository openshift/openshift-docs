// Module included in the following assemblies:
//
// * dir/filename.adoc
:_module-type: CONCEPT
[id="secured-cluster-services-private-configuration-file_{context}"]
= Configuration

This section lists the configurable parameters for the `secured-cluster-services` Helm chart.

.Common
[%collapsible]
====

|===
| Parameter | Description | Default value

| `additionalCAs`
| Use it to add (named) PEM-encoded CA certificates for Sensor.
| `{}`


| `centralEndpoint`
| Address of the Central endpoint, including the port number (without a trailing slash).
If you are using a non-gRPC capable LoadBalancer, use the WebSocket protocol by prefixing the endpoint address with `wss://`.
| `central.stackrox:443`

| `clusterName`
| Name of your cluster.
|

| `confirmNewClusterName`
| You don't need to change this unless you upgrade and change the value for `clusterName`.
In this case, set it to the new value of `clusterName`.
This option exists to prevent you from <<changing-cluster-after-deployment,accidentally creating a new cluster with a different name>>.
| `null`

| `createSecrets`
| Specify `false` to skip the orchestrator secret creation for the sensor, collector, and admission controller.
| `true`

| `createUpgraderServiceAccount`
| Specify `true` to create the `sensor-upgrader` account.
By default, the StackRox Kubernetes Security Platform creates a service account called `sensor-upgrader` in each secured cluster.
This account is highly privileged but is only used during upgrades.
If you don't create this account, you will have to complete future upgrades manually if the Sensor doesn't have enough permissions.
See https://help.stackrox.com/docs/configure-stackrox/enable-automatic-upgrades/[Enable automatic upgrades for secured clusters] for more information.
| `false`

| `customize`
| Modern interface for specifying custom metadata for resources, including labels, annotations and environment variables.
See below for more information.
| `{}`

| `registryOverride`
| Use this parameter to override the default `docker.io` registry.
Specify the name of your registry if you are using some other registry.
|

| `sensor.endpoint`
| Address of the Sensor endpoint including port number.
No trailing slash.
| `sensor.stackrox:443`
|===

====

.Admission controller
[%collapsible]
====

|===

| Parameter | Description | Default value

| `admissionControl.dynamic.disableBypass`
| Set it to `true` to disable https://help.stackrox.com/docs/manage-security-policies/use-admission-controller-enforcement/[bypassing the admission controller].
| `false`

| `admissionControl.dynamic.enforceOnCreates`
| It controls whether the StackRox Kubernetes Security Platform evaluates policies;
if it's disabled, all `AdmissionReview` requests are automatically accepted.
You must specify `listenOnCreates` as `true` for this to work.
| `false`

| `admissionControl.dynamic.enforceOnUpdates`
| It controls whether the StackRox Kubernetes Security Platform evaluates policies for object updates;
if it's disabled, all `AdmissionReview` requests are automatically accepted.
You must specify `listenOnUpdates` as `true` for this to work.
| `false`

| `admissionControl.dynamic.scanInline`
|
| `false`

| `admissionControl.dynamic.timeout`
| The maximum time in seconds, the StackRox Kubernetes Security Platform should wait while evaluating admission review requests.
Use it to set request timeouts when you enable image scanning.
If the image scan runs longer than the specified time, the StackRox Kubernetes Security Platform accepts the request.
Other enforcement options, such as scaling the deployment to zero replicas, are still applied later if the image violates applicable policies.
| `3`

| `admissionControl.listenOnCreates`
| This setting controls whether the cluster is configured to contact the StackRox Kubernetes Security Platform with `AdmissionReview` requests for `create` events on Kubernetes objects.
| `false`

| `admissionControl.listenOnEvents`
| This setting controls whether the cluster is configured to contact the StackRox Kubernetes Security Platform with `AdmissionReview` requests for `update` Kubernetes events like `exec` and `portforward`.
| `false` on OpenShift, `true` otherwise.

| `admissionControl.listenOnUpdates`
| This setting controls whether the cluster is configured to contact the StackRox Kubernetes Security Platform with `AdmissionReview` requests for `update` events on Kubernetes objects.
| `false`

|===

====

.Image
[%collapsible]
====

|===

| Parameter | Description | Default value

| `image.collector.name`
| Repository from which to download the collector image.
| `collector`

| `image.collector.registry`
| Address of the registry you are using for collector image.
| `collector.stackrox.io`

| `image.main.name`
| Repository from which to download the main image.
| `main`

| `image.main.registry`
| Address of the registry you are using for main image.
| `stackrox.io`

|===

====

.Image pull secrets
[%collapsible]
====

|===

| Parameter | Description | Default value

| `imagePullSecrets.allowNone`
| Enabling this setting indicates that no image pull secrets are required to be configured upon initial deployment.
Use this setting if you are using a cluster-private registry that does not require authentication.
| `false`

| `imagePullSecrets.password`
| Specify password for accessing image registry.
| `null`

| `imagePullSecrets.useExisting`
| Specify existing Kubernetes image pull secrets that should be used for trying to pull StackRox images.
| `[]`

| `imagePullSecrets.useExisting`
| Specify existing Kubernetes image pull secrets that should be used for trying to pull StackRox images.
| `[]`

| `imagePullSecrets.useFromDefaultServiceAccount`
| This setting controls whether image pull secrets from a default service account in the target namespace should be used for image pulls.
| `true`

| `imagePullSecrets.username`
| Specify username for accessing image registry.
| `null`

|===

====

.Collector
[%collapsible]
====

|===

| Parameter | Description | Default value

| `collector.collectionMethod`
| Either `EBPF`, `KERNEL_MODULE`, or `NO_COLLECTION`.
| `KERNEL_MODULE`

| `collector.disableTaintTolerations`
| If you specify `false`, tolerations are applied to collector, and the collector pods can schedule onto all nodes with taints.
If you specify it as `true`, no tolerations are applied, and the collector pods won't scheduled onto nodes with taints.
| `false`

| `collector.slimMode`
| Specify `true` if you want to use a slim Collector image for deploying Collector.
Using slim Collector images requires Central to provide the matching kernel module or eBPF probe.
If you are running the StackRox Kubernetes Security Platform in offline mode, you must download a kernel support package from https://install.stackrox.io/collector/support-packages/index.html[stackrox.io] and upload it to Central for slim Collectors to function.
Otherwise, you must ensure that Central can access the online probe repository hosted at https://collector-modules.stackrox.io/.
| `false`

|===

====

.Advance parameters
[%collapsible]
====

The following are some advanced parameters, and you'll only need them in non-standard environments:

|===
| Parameter | Description | Default value

| `admissionControl.imagePullPolicy`
| Kubernetes image pull policy for Admission Control.
| `IfNotPresent`

| `admissionControl.nodeSelector`
| Node selector for Admission Control pods placement.
| `null` (no placement constraints)

| `admissionControl.resources`
| Resource specification for Admission Control.
| See below.

| `collector.complianceImagePullPolicy`
| Kubernetes image pull policy for Sensor.
| `IfNotPresent`

| `collector.complianceResources`
| Resource specification for Collector's Compliance container.
| See below.

| `collector.imagePullPolicy`
| Kubernetes image pull policy for Sensor.
| `Always` when deploying in slim mode, otherwise `IfNotPresent`.

| `collector.nodeSelector`
| Node selector for Collector pods placement.
| `null` (no placement constraints)

| `collector.resources`
| Resource specification for Collector.
| See below.

| `env.istio`
| This setting can be used for overwriting the auto-sensing of Istio environments.
If enabled, the cluster is set up for an Istio environment.
| Auto-sensed, depends on environment.

| `env.openshift`
| The StackRox Kubernetes Security Platform automatically detects the OpenShift version (`3.x` or `4.x`).
Use this parameter to override the automatically detected version number, for example `4`.
| `null`

| `exposeMonitoring`
| This setting controls whether the monitoring port (TCP 9090) should be exposed on the services.
| `false`

| `image.collector.pullPolicy`
| Image pull policy for `collector` images.
| `IfNotPresent` if `slimCollector` is enabled, `Always` otherwise.

| `image.collector.tag`
| Tag of `collector` image to use.
| `null`

| `image.main.pullPolicy`
| Image pull policy for `main` images.
| `IfNotPresent`

| `image.main.tag`
| Tag of `main` image to use.
| `null`

| `sensor.imagePullPolicy`
| Kubernetes image pull policy for Sensor.
| `IfNotPresent`

| `sensor.nodeSelector`
| Node selector for Sensor pod placement.
| `null` (no placement constraints)

| `sensor.resources`
| Resource specification for Sensor.
| See below.
|===

====

.Default resources
[%collapsible]
====

Each container's default resource settings are defined in the `internal/defaults.yaml` file in this chart.
The following are the YAML paths to the respective defaults for each container that this chart deploys:

|===
| Container | Path in `internal/defaults.yaml`

| Admission Control
| `defaults.admissionControl.resources`

| Collector
| `defaults.collector.resources`

| Compliance
| `defaults.collector.complianceResources`

| Sensor
| `defaults.sensor.resources`
|===

====


[discreet]
== Environment variables

You can specify environment variables for sensor and admission controller in the following format:

[source,yaml]
----
customize:
  envVars:
    ENV_VAR1: "value1"
    ENV_VAR2: "value2"
----

The `customize` setting allows specifying custom Kubernetes metadata (labels and annotations) for all objects created by this Helm chart and additional pod labels, pod annotations, and container environment variables for workloads.

The configuration is hierarchical, in the sense that metadata defined at a more generic scope (for example, for all objects) can be overridden by metadata defined at a narrower scope (for example, only for the sensor deployment).
