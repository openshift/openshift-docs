// Module included in the following assemblies:
//
// * installing/installing_ocp/install-secured-cluster-ocp.adoc
// * installing/installing_other/install-secured-cluster-other.adoc
// * cloud_service/installing_cloud_other/install-secured-cluster-cloud-other.adoc
// * cloud_service/installing_cloud_ocp/install-secured-cluster-cloud-ocp.adoc
:_mod-docs-content-type: CONCEPT
[id="secured-cluster-services-config_{context}"]
= Configuration parameters

ifeval::["{context}" == "install-secured-cluster-cloud-ocp"]
:openshift:
endif::[]

ifeval::["{context}" == "install-secured-cluster-cloud-other"]
:kube:
endif::[]

ifeval::["{context}" == "install-secured-cluster-ocp"]
:openshift:
endif::[]

ifeval::["{context}" == "install-secured-cluster-other"]
:kube:
endif::[]


|===
| Parameter | Description

| `clusterName`
| Name of your cluster.

| `centralEndpoint`
| Address of the Central endpoint. If you are using a non-gRPC capable load balancer, use the WebSocket protocol by prefixing the endpoint address with `wss://`. When configuring multiple clusters, use the hostname for the address. For example, `central.example.com`.

| `sensor.endpoint`
| Address of the Sensor endpoint including port number.

| `sensor.imagePullPolicy`
| Image pull policy for the Sensor container.

| `sensor.serviceTLS.cert`
| The internal service-to-service TLS certificate that Sensor uses.

| `sensor.serviceTLS.key`
| The internal service-to-service TLS certificate key that Sensor uses.

| `sensor.resources.requests.memory`
| The memory request for the Sensor container. Use this parameter to override the default value.

| `sensor.resources.requests.cpu`
| The CPU request for the Sensor container. Use this parameter to override the default value.

| `sensor.resources.limits.memory`
| The memory limit for the Sensor container. Use this parameter to override the default value.

| `sensor.resources.limits.cpu`
| The CPU limit for the Sensor container. Use this parameter to override the default value.

| `sensor.nodeSelector`
| Specify a node selector label as `label-key: label-value` to force Sensor to only schedule on nodes with the specified label.

| `sensor.tolerations`
| If the node selector selects tainted nodes, use this parameter to specify a taint toleration key, value, and effect for Sensor. This parameter is mainly used for infrastructure nodes.

| `image.main.name`
| The name of the `main` image.

| `image.collector.name`
| The name of the Collector image.

| `image.main.registry`
| The address of the registry you are using for the main image.

| `image.collector.registry`
| The address of the registry you are using for the Collector image.

| `image.scanner.registry`
| The address of the registry you are using for the Scanner image.

| `image.scannerDb.registry`
| The address of the registry you are using for the Scanner DB image.

| `image.scannerV4.registry`
| The address of the registry you are using for the Scanner V4 image.

| `image.scannerV4DB.registry`
| The address of the registry you are using for the Scanner V4 DB image.

| `image.main.pullPolicy`
| Image pull policy for `main` images.

| `image.collector.pullPolicy`
| Image pull policy for the Collector images.

| `image.main.tag`
| Tag of `main` image to use.

| `image.collector.tag`
| Tag of `collector` image to use.

| `collector.collectionMethod`
| Either `CORE_BPF` or `NO_COLLECTION`.

| `collector.imagePullPolicy`
| Image pull policy for the Collector container.

| `collector.complianceImagePullPolicy`
| Image pull policy for the Compliance container.

| `collector.disableTaintTolerations`
| If you specify `false`, tolerations are applied to Collector, and the collector pods can schedule onto all nodes with taints.
If you specify it as `true`, no tolerations are applied, and the collector pods are not scheduled onto nodes with taints.

| `collector.resources.requests.memory`
| The memory request for the Collector container. Use this parameter to override the default value.

| `collector.resources.requests.cpu`
| The CPU request for the Collector container. Use this parameter to override the default value.

| `collector.resources.limits.memory`
| The memory limit for the Collector container. Use this parameter to override the default value.

| `collector.resources.limits.cpu`
| The CPU limit for the Collector container. Use this parameter to override the default value.

| `collector.complianceResources.requests.memory`
| The memory request for the Compliance container. Use this parameter to override the default value.

| `collector.complianceResources.requests.cpu`
| The CPU request for the Compliance container. Use this parameter to override the default value.

| `collector.complianceResources.limits.memory`
| The memory limit for the Compliance container. Use this parameter to override the default value.

| `collector.complianceResources.limits.cpu`
| The CPU limit for the Compliance container. Use this parameter to override the default value.

| `collector.serviceTLS.cert`
| The internal service-to-service TLS certificate that Collector uses.

| `collector.serviceTLS.key`
| The internal service-to-service TLS certificate key that Collector uses.

| `admissionControl.listenOnCreates`
| This setting controls whether Kubernetes is configured to contact {product-title} with `AdmissionReview` requests for workload creation events.

| `admissionControl.listenOnUpdates`
| When you set this parameter as `false`, {product-title} creates the `ValidatingWebhookConfiguration` in a way that causes the Kubernetes API server not to send object update events.
Since the volume of object updates is usually higher than the object creates, leaving this as `false` limits the load on the admission control service and decreases the chances of a malfunctioning admission control service.

| `admissionControl.listenOnEvents`
| This setting controls whether the cluster is configured to contact {product-title} with `AdmissionReview` requests for Kubernetes `exec` and `portforward` events.
{product-title-short} does not support this feature on {ocp} 3.11.

| `admissionControl.dynamic.enforceOnCreates`
| This setting controls whether {product-title} evaluates policies;
if it is disabled, all AdmissionReview requests are automatically accepted.

| `admissionControl.dynamic.enforceOnUpdates`
| This setting controls the behavior of the admission control service.
You must specify `listenOnUpdates` as `true` for this to work.

| `admissionControl.dynamic.scanInline`
| If you set this option to `true`, the admission control service requests an image scan before making an admission decision.
Since image scans take several seconds, enable this option only if you can ensure that all images used in your cluster are scanned before deployment (for example, by a CI integration during image build).
This option corresponds to the *Contact image scanners* option in the {product-title-short} portal.

| `admissionControl.dynamic.disableBypass`
| Set it to `true` to disable bypassing the Admission controller.
//TODO: Link to admission controller docs

| `admissionControl.dynamic.timeout`
| Use this parameter to specify the maximum number of seconds {product-title-short} must wait for an admission review before marking it as fail open. If the admission webhook does not receive information that it is requesting before the end of the timeout period, it fails, but in fail open status, it still allows the operation to succeed. For example, the admission controller would allow a deployment to be created even if a scan had timed out and {product-title-short} could not determine if the deployment violated a policy. Beginning in release 4.5, Red{nbsp}Hat reduced the default timeout setting for the {product-title-short} admission controller webhooks from 20 seconds to 10 seconds, resulting in an effective timeout of 12 seconds within the `ValidatingWebhookConfiguration`.
ifndef::kube[]
This change does not negatively affect {ocp} users because {ocp} caps the timeout at 13 seconds.
endif::kube[]
ifndef::openshift[]
For Kubernetes clusters, image scanning and pulling that are done as part of the webhook execution might require you to configure a longer timeout value.
endif::openshift[]

| `admissionControl.resources.requests.memory`
| The memory request for the Admission Control container. Use this parameter to override the default value.

| `admissionControl.resources.requests.cpu`
| The CPU request for the Admission Control container. Use this parameter to override the default value.

| `admissionControl.resources.limits.memory`
| The memory limit for the Admission Control container. Use this parameter to override the default value.

| `admissionControl.resources.limits.cpu`
| The CPU limit for the Admission Control container. Use this parameter to override the default value.

| `admissionControl.nodeSelector`
| Specify a node selector label as `label-key: label-value` to force Admission Control to only schedule on nodes with the specified label.

| `admissionControl.tolerations`
| If the node selector selects tainted nodes, use this parameter to specify a taint toleration key, value, and effect for Admission Control. This parameter is mainly used for infrastructure nodes.

| `admissionControl.serviceTLS.cert`
| The internal service-to-service TLS certificate that Admission Control uses.

| `admissionControl.serviceTLS.key`
| The internal service-to-service TLS certificate key that Admission Control uses.

| `registryOverride`
| Use this parameter to override the default `docker.io` registry.
Specify the name of your registry if you are using some other registry.

| `collector.disableTaintTolerations`
| If you specify `false`, tolerations are applied to Collector, and the Collector pods can schedule onto all nodes with taints.
If you specify it as `true`, no tolerations are applied, and the Collector pods are not scheduled onto nodes with taints.

| `createUpgraderServiceAccount`
| Specify `true` to create the `sensor-upgrader` account.
By default, {product-title} creates a service account called `sensor-upgrader` in each secured cluster.
This account is highly privileged but is only used during upgrades.
If you do not create this account, you must complete future upgrades manually if the Sensor does not have enough permissions.
//TODO: Link to Enable automatic upgrades for secured clusters topic.

| `createSecrets`
| Specify `false` to skip the orchestrator secret creation for the Sensor, Collector, and Admission controller.

| `collector.slimMode`
| Deprecated. Specify `true` if you want to use a slim Collector image for deploying Collector.

| `sensor.resources`
| Resource specification for Sensor.

| `admissionControl.resources`
| Resource specification for Admission controller.

| `collector.resources`
| Resource specification for Collector.

| `collector.complianceResources`
| Resource specification for Collector's Compliance container.

| `exposeMonitoring`
| If you set this option to `true`,  {product-title} exposes Prometheus metrics endpoints on port number 9090 for the Sensor, Collector, and the Admission controller.

| `auditLogs.disableCollection`
| If you set this option to `true`, {product-title} disables the audit log detection features used to detect access and modifications to configuration maps and secrets.

| `scanner.disable`
| If you set this option to `false`, {product-title} deploys a Scanner-slim and Scanner DB in the secured cluster to allow scanning images on OpenShift Container Registry. Enabling Scanner-slim is supported on {ocp} and Kubernetes secured clusters. Defaults to `true`.

| `scanner.dbTolerations`
| If the node selector selects tainted nodes, use this parameter to specify a taint toleration key, value, and effect for Scanner DB.

| `scanner.replicas`
| Resource specification for Collector's Compliance container.

| `scanner.logLevel`
| Setting this parameter allows you to modify the scanner log level. Use this option only for troubleshooting purposes.

| `scanner.autoscaling.disable`
| If you set this option to `true`, {product-title} disables autoscaling on the Scanner deployment.

| `scanner.autoscaling.minReplicas`
| The minimum number of replicas for autoscaling. Defaults to 2.

| `scanner.autoscaling.maxReplicas`
| The maximum number of replicas for autoscaling. Defaults to 5.

| `scanner.nodeSelector`
| Specify a node selector label as `label-key: label-value` to force Scanner to only schedule on nodes with the specified label.

| `scanner.tolerations`
| If the node selector selects tainted nodes, use this parameter to specify a taint toleration key, value, and effect for Scanner.

| `scanner.dbNodeSelector`
| Specify a node selector label as `label-key: label-value` to force Scanner DB to only schedule on nodes with the specified label.

| `scanner.dbTolerations`
| If the node selector selects tainted nodes, use this parameter to specify a taint toleration key, value, and effect for Scanner DB.

| `scanner.resources.requests.memory`
| The memory request for the Scanner container. Use this parameter to override the default value.

| `scanner.resources.requests.cpu`
| The CPU request for the Scanner container. Use this parameter to override the default value.

| `scanner.resources.limits.memory`
| The memory limit for the Scanner container. Use this parameter to override the default value.

| `scanner.resources.limits.cpu`
| The CPU limit for the Scanner container. Use this parameter to override the default value.

| `scanner.dbResources.requests.memory`
| The memory request for the Scanner DB container. Use this parameter to override the default value.

| `scanner.dbResources.requests.cpu`
| The CPU request for the Scanner DB container. Use this parameter to override the default value.

| `scanner.dbResources.limits.memory`
| The memory limit for the Scanner DB container. Use this parameter to override the default value.

| `scanner.dbResources.limits.cpu`
| The CPU limit for the Scanner DB container. Use this parameter to override the default value.

| `monitoring.openshift.enabled`
| If you set this option to `false`, {product-title} will not set up {osp} monitoring. Defaults to `true` on {osp} 4.

|===

[id="secured-cluster-services-environment-variables_{context}"]
== Environment variables

You can specify environment variables for Sensor and Admission controller in the following format:

[source,yaml]
----
customize:
  envVars:
    ENV_VAR1: "value1"
    ENV_VAR2: "value2"
----

The `customize` setting allows you to specify custom Kubernetes metadata (labels and annotations) for all objects created by this Helm chart and additional pod labels, pod annotations, and container environment variables for workloads.

The configuration is hierarchical, in the sense that metadata defined at a more generic scope (for example, for all objects) can be overridden by metadata defined at a narrower scope (for example, only for the Sensor deployment).
