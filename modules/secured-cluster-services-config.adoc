// Module included in the following assemblies:
//
// * dir/filename.adoc
:_content-type: CONCEPT
[id="secured-cluster-services-config_{context}"]
= Configuration parameters

|===
| Parameter | Description

| `clusterName`
| Name of your cluster.

| `centralEndpoint`
| Address, including port number, of the Central endpoint. If you are using a non-gRPC capable load balancer, use the WebSocket protocol by prefixing the endpoint address with `wss://`. When configuring multiple clusters, use the hostname for the address (for example, `central.example.com:443`).

| `sensor.endpoint`
| Address of the Sensor endpoint including port number.

| `sensor.imagePullPolicy`
| Image pull policy for the Sensor container.

| `sensor.serviceTLS.cert`
| The internal service-to-service TLS certificate that Sensor uses.

| `sensor.serviceTLS.key`
| The internal service-to-service TLS certificate key that Sensor uses.

| `sensor.resources.requests.memory`
| The memory request for the Sensor container. Use this parameter to override the default value.

| `sensor.resources.requests.cpu`
| The CPU request for the Sensor container. Use this parameter to override the default value.

| `sensor.resources.limits.memory`
| The memory limit for the Sensor container. Use this parameter to override the default value.

| `sensor.resources.limits.cpu`
| The CPU limit for the Sensor container. Use this parameter to override the default value.

| `sensor.nodeSelector`
| Specify a node selector label as `label-key: label-value` to force Sensor to only schedule on nodes with the specified label.

| `sensor.tolerations`
| If the node selector selects tainted nodes, use this parameter to specify a taint toleration key, value, and effect for Sensor. This parameter is mainly used for infrastructure nodes.

| `image.main.name`
| The name of the `main` image.

| `image.collector.name`
| The name of the Collector image.

| `image.main.registry`
| Address of the registry you are using for the main image.

| `image.collector.registry`
| Address of the registry you are using for the Collector image.

| `image.main.pullPolicy`
| Image pull policy for `main` images.

| `image.collector.pullPolicy`
| Image pull policy for the Collector images.

| `image.main.tag`
| Tag of `main` image to use.

| `image.collector.tag`
| Tag of `collector` image to use.

| `collector.collectionMethod`
| Either `EBPF`, `CORE_BPF`, or `NO_COLLECTION`.

| `collector.imagePullPolicy`
| Image pull policy for the Collector container.

| `collector.complianceImagePullPolicy`
| Image pull policy for the Compliance container.

| `collector.disableTaintTolerations`
| If you specify `false`, tolerations are applied to Collector, and the collector pods can schedule onto all nodes with taints.
If you specify it as `true`, no tolerations are applied, and the collector pods are not scheduled onto nodes with taints.

| `collector.resources.requests.memory`
| The memory request for the Collector container. Use this parameter to override the default value.

| `collector.resources.requests.cpu`
| The CPU request for the Collector container. Use this parameter to override the default value.

| `collector.resources.limits.memory`
| The memory limit for the Collector container. Use this parameter to override the default value.

| `collector.resources.limits.cpu`
| The CPU limit for the Collector container. Use this parameter to override the default value.

| `collector.complianceResources.requests.memory`
| The memory request for the Compliance container. Use this parameter to override the default value.

| `collector.complianceResources.requests.cpu`
| The CPU request for the Compliance container. Use this parameter to override the default value.

| `collector.complianceResources.limits.memory`
| The memory limit for the Compliance container. Use this parameter to override the default value.

| `collector.complianceResources.limits.cpu`
| The CPU limit for the Compliance container. Use this parameter to override the default value.

| `collector.serviceTLS.cert`
| The internal service-to-service TLS certificate that Collector uses.

| `collector.serviceTLS.key`
| The internal service-to-service TLS certificate key that Collector uses.

| `admissionControl.listenOnCreates`
| This setting controls whether Kubernetes is configured to contact {product-title} with `AdmissionReview` requests for workload creation events.

| `admissionControl.listenOnUpdates`
| When you set this parameter as `false`, {product-title} creates the `ValidatingWebhookConfiguration` in a way that causes the Kubernetes API server not to send object update events.
Since the volume of object updates is usually higher than the object creates, leaving this as `false` limits the load on the admission control service and decreases the chances of a malfunctioning admission control service.

| `admissionControl.listenOnEvents`
| This setting controls whether the cluster is configured to contact {product-title} with `AdmissionReview` requests for Kubernetes `exec` and `portforward` events.
{product-title} does not support this feature on {ocp} 3.11. For more information, see link:https://access.redhat.com/node/5822721[Red Hat Advanced Cluster Security for Kubernetes Support Policy].

| `admissionControl.dynamic.enforceOnCreates`
| This setting controls whether {product-title} evaluates policies;
if it is disabled, all AdmissionReview requests are automatically accepted.

| `admissionControl.dynamic.enforceOnUpdates`
| This setting controls the behavior of the admission control service.
You must specify `listenOnUpdates` as `true` for this to work.

| `admissionControl.dynamic.scanInline`
| If you set this option to `true`, the admission control service requests an image scan before making an admission decision.
Since image scans take several seconds, enable this option only if you can ensure that all images used in your cluster are scanned before deployment (for example, by a CI integration during image build).
This option corresponds to the *Contact image scanners* option in the RHACS Portal.

| `admissionControl.dynamic.disableBypass`
| Set it to `true` to disable bypassing the Admission controller.
//TODO: Link to admission controller docs

| `admissionControl.dynamic.timeout`
| The maximum time, in seconds, {product-title} should wait while evaluating admission review requests.
Use this to set request timeouts when you enable image scanning.
If the image scan runs longer than the specified time, {product-title} accepts the request.

| `admissionControl.resources.requests.memory`
| The memory request for the Admission Control container. Use this parameter to override the default value.

| `admissionControl.resources.requests.cpu`
| The CPU request for the Admission Control container. Use this parameter to override the default value.

| `admissionControl.resources.limits.memory`
| The memory limit for the Admission Control container. Use this parameter to override the default value.

| `admissionControl.resources.limits.cpu`
| The CPU limit for the Admission Control container. Use this parameter to override the default value.

| `admissionControl.nodeSelector`
| Specify a node selector label as `label-key: label-value` to force Admission Control to only schedule on nodes with the specified label.

| `admissionControl.tolerations`
| If the node selector selects tainted nodes, use this parameter to specify a taint toleration key, value, and effect for Admission Control. This parameter is mainly used for infrastructure nodes.

| `admissionControl.serviceTLS.cert`
| The internal service-to-service TLS certificate that Admission Control uses.

| `admissionControl.serviceTLS.key`
| The internal service-to-service TLS certificate key that Admission Control uses.

| `registryOverride`
| Use this parameter to override the default `docker.io` registry.
Specify the name of your registry if you are using some other registry.

| `collector.disableTaintTolerations`
| If you specify `false`, tolerations are applied to Collector, and the Collector pods can schedule onto all nodes with taints.
If you specify it as `true`, no tolerations are applied, and the Collector pods are not scheduled onto nodes with taints.

| `createUpgraderServiceAccount`
| Specify `true` to create the `sensor-upgrader` account.
By default, {product-title} creates a service account called `sensor-upgrader` in each secured cluster.
This account is highly privileged but is only used during upgrades.
If you do not create this account, you must complete future upgrades manually if the Sensor does not have enough permissions.
//TODO: Link to Enable automatic upgrades for secured clusters topic.

| `createSecrets`
| Specify `false` to skip the orchestrator secret creation for the Sensor, Collector, and Admission controller.

| `collector.slimMode`
| Specify `true` if you want to use a slim Collector image for deploying Collector.
Using slim Collector images requires Central to provide the matching eBPF probe or kernel module.
If you are running {product-title} in offline mode, you must download a kernel support package from link:https://install.stackrox.io/collector/support-packages/index.html[stackrox.io] and upload it to Central for slim Collectors to function.
Otherwise, you must ensure that Central can access the online probe repository hosted at link:https://collector-modules.stackrox.io/[https://collector-modules.stackrox.io/].
//TODO: Change these links when new links are alive.

| `sensor.resources`
| Resource specification for Sensor.

| `admissionControl.resources`
| Resource specification for Admission controller.

| `collector.resources`
| Resource specification for Collector.

| `collector.complianceResources`
| Resource specification for Collector's Compliance container.

| `exposeMonitoring`
| If you set this option to `true`,  {product-title} exposes Prometheus metrics endpoints on port number 9090 for the Sensor, Collector, and the Admission controller.

| `auditLogs.disableCollection`
| If you set this option to `true`, {product-title} disables the audit log detection features used to detect access and modifications to configuration maps and secrets.

| `scanner.disable`
| If you set this option to `false`, {product-title} deploys a lightweight scanner and Scanner DB in the secured cluster to allow scanning images on OpenShift Container Registry. Enabling Scanner is only supported on OpenShift. Defaults to `true`

| `scanner.dbTolerations`
| If the node selector selects tainted nodes, use this parameter to specify a taint toleration key, value, and effect for Scanner DB.

| `scanner.replicas`
| Resource specification for Collector's Compliance container.

| `scanner.logLevel`
| Setting this parameter allows you to modify the scanner log level. Use this option only for troubleshooting purposes.

| `scanner.autoscaling.disable`
| If you set this option to `true`, {product-title} disables autoscaling on the Scanner deployment.

| `scanner.autoscaling.minReplicas`
| The minimum number of replicas for autoscaling. Defaults to 2.

| `scanner.autoscaling.maxReplicas`
| The maximum number of replicas for autoscaling. Defaults to 5.

| `scanner.nodeSelector`
| Specify a node selector label as `label-key: label-value` to force Scanner to only schedule on nodes with the specified label.

| `scanner.tolerations`
| If the node selector selects tainted nodes, use this parameter to specify a taint toleration key, value, and effect for Scanner.

| `scanner.dbNodeSelector`
| Specify a node selector label as `label-key: label-value` to force Scanner DB to only schedule on nodes with the specified label.

| `scanner.dbTolerations`
| If the node selector selects tainted nodes, use this parameter to specify a taint toleration key, value, and effect for Scanner DB.

| `scanner.resources.requests.memory`
| The memory request for the Scanner container. Use this parameter to override the default value.

| `scanner.resources.requests.cpu`
| The CPU request for the Scanner container. Use this parameter to override the default value.

| `scanner.resources.limits.memory`
| The memory limit for the Scanner container. Use this parameter to override the default value.

| `scanner.resources.limits.cpu`
| The CPU limit for the Scanner container. Use this parameter to override the default value.

| `scanner.dbResources.requests.memory`
| The memory request for the Scanner DB container. Use this parameter to override the default value.

| `scanner.dbResources.requests.cpu`
| The CPU request for the Scanner DB container. Use this parameter to override the default value.

| `scanner.dbResources.limits.memory`
| The memory limit for the Scanner DB container. Use this parameter to override the default value.

| `scanner.dbResources.limits.cpu`
| The CPU limit for the Scanner DB container. Use this parameter to override the default value.

|===

[id="secured-cluster-services-environment-variables_{context}"]
== Environment variables

You can specify environment variables for Sensor and Admission controller in the following format:

[source,yaml]
----
customize:
  envVars:
    ENV_VAR1: "value1"
    ENV_VAR2: "value2"
----

The `customize` setting allows you to specify custom Kubernetes metadata (labels and annotations) for all objects created by this Helm chart and additional pod labels, pod annotations, and container environment variables for workloads.

The configuration is hierarchical, in the sense that metadata defined at a more generic scope (for example, for all objects) can be overridden by metadata defined at a narrower scope (for example, only for the Sensor deployment).
