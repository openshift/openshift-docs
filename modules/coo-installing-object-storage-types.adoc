// Module included in the following assemblies:

// * installing/installing-end-to-end-observability.adoc

:_mod-docs-content-type: REFERENCE
[id="coo-installing-object-storage-types_{context}"]
= Object storage types

Each object storage type has its own set of required fields which are configured directly in the `ObservabilityInstaller` CR.

== Amazon S3 with Secure Token Service (STS) - Short lived

S3 with STS is supported by Tempo and Loki.

[source,yaml]
----
spec:
  capabilities:
    tracing:
      enabled: true
      storage:
        objectStorage:
          s3STS:
            bucket: bucket-name
            roleARN: 
            region: us-east-1
----

Use the following command to create the secret containing the access key:

[source,bash]
----
$ oc create secret generic storage-secret \
--from-literal=bucket="<BUCKET_NAME>" \
--from-literal=role_arn="<AWS_ROLE_ARN>" \
--from-literal=region="<AWS_REGION_YOUR_BUCKET_LIVES_IN>"
----


== Amazon S3 / MinIO

Amazon S3 / MinIO is supported by Tempo and Loki.

[source,yaml]
----
spec:
  capabilities:
    tracing:
      enabled: true
      storage:
        objectStorage:
          s3:
            bucket: bucket-name
            endpoint: http://minio.minio.svc:9000
            accessKeyID: tempo
            accessKeySecret:
              name: minio-secret
              key: access_key_secret
            region: us-east-1
----

Use the following command to create the secret containing the access key:

[source,bash]
----
$ oc create secret generic minio-secret \
--from-literal=access_key_secret="supersecret"
----

=== Secret supported by Tempo and Loki operators

[source,bash]
----
$ oc create secret generic storage-secret \
    --from-literal=bucket="<BUCKET_NAME>" \
    --from-literal=endpoint="<AWS_BUCKET_ENDPOINT>" \
    --from-literal=access_key_id="<AWS_ACCESS_KEY_ID>" \
    --from-literal=access_key_secret="<AWS_ACCESS_KEY_SECRET>" \
    --from-literal=region="<AWS_REGION_YOUR_BUCKET_LIVES_IN>"
----

* `region` is optional in Tempo and required by Loki.


== Microsoft Azure Blob Storage

Microsoft Azure Blob Storag is supported by Tempo and Loki.

[source,yaml]
----
spec:
  capabilities:
    tracing:
      enabled: true
      storage:
        objectStorage:
          azure:
            container:
            accountName:
            accountKeySecret:
              name: azure-secret
              key: account_key
----

Use the following command to create the secret containing the access key:

[source,bash]
----
$ oc create secret generic azure-secret \
--from-literal=account_key="<ACCOUNT_KEY>"
----

=== Secret supported by Tempo and Loki operators

[source,bash]
----
$ oc create secret generic storage-secret \
--from-literal=container="<BLOB_STORAGE_CONTAINER_NAME>" \
--from-literal=account_name="<BLOB_STORAGE_ACCOUNT_NAME>" \
--from-literal=account_key="<BLOB_STORAGE_ACCOUNT_KEY>"
----

The Loki operator also supports the following fields:

* `environment`
* `endpoint_suffix` - optional


== Azure WIF - Short lived

Azure WIF short lived is supported by Tempo.

[source,yaml]
----
spec:
  capabilities:
    tracing:
      enabled: true
      storage:
        objectStorage:
          azureWIF:
            container:
            accountName:
            audience:
            clientID:
            tenantID:
----

=== Secret supported by Tempo and Loki operators

[source,bash]
----
$ oc create secret generic storage-secret \
--from-literal=container="<BLOB_STORAGE_CONTAINER_NAME>" \
--from-literal=account_name="<BLOB_STORAGE_ACCOUNT_NAME>" \
--from-literal=audience="<AUDIENCE>" \
--from-literal=client_id="CLIENT_ID>" \
--from-literal=tenant_id="<TENANT_ID>"
----

* `audience` - optional and defaults to `api://AzureADTokenExchange`

== Google Cloud Storage

Google Cloud Storage is supported by Tempo and Loki.

[source,yaml]
----
spec:
  capabilities:
    tracing:
      enabled: true
      storage:
        objectStorage:
          gcs:
            bucket: bucket-name
            keyJSONSecret:
              name: gcs-secret
              key: key.json
----

Use the following command to create the secret:

[source,bash]
----
$ oc -n $NAMESPACE create secret generic gcs-secret \
--from-file=key.json="$GCS_KEY_FILE_PATH"
----

=== Secret supported by Tempo and Loki operators

[source,bash]
----
$ oc create secret generic storage-secret \
--from-literal=bucketname="<BUCKET_NAME>" \
--from-literal=key.json="<PATH_TO_JSON_KEY_FILE>"
----

=== Google Cloud Storage WIF - Short lived

Google Cloud Storage WIF short lived is supported by Tempo.

[source,yaml]
----
spec:
  capabilities:
    tracing:
      enabled: true
      storage:
        objectStorage:
          gcsWIF:
            bucket: bucket-name
            keyJSONSecret:
              name: gcs-secret
              key: key.json
            audience: # optional
----

Use the following command to create the secret:

[source,bash]
----
$ oc -n $NAMESPACE create secret generic gcs-secret \
--from-file=key.json="$GCS_KEY_FILE_PATH"
----
