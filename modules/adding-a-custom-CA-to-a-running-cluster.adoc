// Module included in the following assemblies:
//
// * networking/configuring-a-custom-pki.adoc

:_mod-docs-content-type: PROCEDURE
[id="adding-a-custom-CA-to-a-running-cluster_{context}"]
= Adding a custom CA to a running cluster

For a running cluster, you can add a custom CA by creating a `ConfigMap` object that contains your certificate and then referencing that `ConfigMap` object in the cluster `Proxy` object.

[NOTE]
====
When you modify the cluster `Proxy` object, the Machine Config Operator (MCO) initiates a rolling reboot of all nodes to apply the change. This is expected behavior and does not require manual intervention.
====

This procedure uses the `trustedCA` field in the `Proxy` object. If you also need to configure or modify egress proxy settings at the same time, see the "Configuring the cluster-wide proxy" chapter for detailed instructions.

.Prerequisites

* You have cluster-admin privileges.

* You have the {oc-first} installed.

* You have your custom CA certificate available in PEM-encoded format.

.Procedure

The procedure involves two stages: creating a `ConfigMap` object with your certificate and then updating the cluster to trust it.

. Create a `ConfigMap` object with your CA certificate.

.. Create a YAML file named `custom-ca.yaml` to define the `ConfigMap` object.

.. Add the following content to the file:
+
[source,yaml]
----
apiVersion: v1
kind: ConfigMap
metadata:
  name: custom-ca-bundle      <1>
  namespace: openshift-config  <2>
data:
  ca-bundle.crt: |         <3>
    -----BEGIN CERTIFICATE-----
    <MY_PEM_ENCODED_CA_CERT>
    -----END CERTIFICATE-----
----
+
<1> The name of the `ConfigMap` object that you will reference from the `Proxy` object.
<2> The `ConfigMap` object must be created in the `openshift-config` namespace.
<3> The data key for the certificate bundle must be `ca-bundle.crt`.

. Apply the manifest to create the `ConfigMap` object in the cluster:
+
[source,terminal]
----
$ oc apply -f custom-ca.yaml
----

. Reference the `ConfigMap` object in the cluster `Proxy` object.

.. Run the following `oc patch` command to update the cluster `Proxy` object to reference the `ConfigMap` object you just created.
+
[source,terminal]
----
$ oc patch proxy/cluster --type=merge --patch='{"spec":{"trustedCA":{"name":"custom-ca-bundle"}}}'
----

After you run this command, the Machine Config Operator (MCO) detects the change and begins distributing the new trusted CA to all nodes in the cluster.