// Module included in the following assemblies:

// * service-mesh-docs-main/install/ossm-istio-ambient-mode.adoc

:_mod-docs-content-type: PROCEDURE
[id="ossm-deploying-waypoint-proxy_{context}"]
= Deploying a waypoint proxy

You can deploy a waypoint proxy in the bookinfo application namespace to route traffic through the {istio} ambient data plane and enforce L7 policies.

.Prerequisites

* You have logged in to the {ocp-product-title} 4.19 or later, which provides supported {k8s} Gateway API custom resource definitions (CRDs) required for ambient mode functionality.
* You have the {SMProductName} Operator 3.1.0 or later installed on the OpenShift cluster.
* You have {istio} deployed in ambient mode.
* You have deployed the `bookinfo` sample application for the following example.
* You have added the `label istio.io/dataplane-mode=ambient` to the target namespace.
.Procedure

. Deploy a waypoint proxy in the `bookinfo` application namespace similar to the following example:
+
.Example configuration
[source,yaml]
----
apiVersion: gateway.networking.k8s.io/v1
kind: Gateway
metadata:
  labels:
    istio.io/waypoint-for: service
  name: waypoint
  namespace: bookinfo
spec:
  gatewayClassName: istio-waypoint
  listeners:
  - name: mesh
    port: 15008
    protocol: HBONE
----

. Apply the `waypoint` custom resource (CR) by running the following command:
+
[source,terminal]
----
$ oc apply -f waypoint.yaml
----
+
The `istio.io/waypoint-for: service` label indicates that the waypoint handles traffic for services. The label determines the type of traffic processed. For more information, see "Waypoint traffic types".

. Enroll the `bookinfo` namespace to use the waypoint by running the following command:
+
[source,terminal]
----
$ oc label namespace bookinfo istio.io/use-waypoint=waypoint
----

After enrolling the namespace, requests from any pods using the ambient data plane to services in bookinfo will route through the waypoint for L7 processing and policy enforcement.

[NOTE]
====
You can also configure only specific services or pods to use a waypoint by labeling the respective service or pod. When enrolling a pod explicitly, also add the `istio.io/waypoint-for: workload` label to the corresponding `gateway` resource.
====
