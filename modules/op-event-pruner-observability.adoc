// This module is included in the following assemblies:
// * install_config/customizing-configurations-in-the-tektonconfig-cr.adoc

:_mod-docs-content-type: REFERENCE
[id="event-pruner-observability_{context}"]
= Observability metrics of the event-based pruner

:FeatureName: The event-based pruner
include::snippets/technology-preview.adoc[]

The event-based pruner exposes detailed metrics through the `tekton-pruner-controller` controller `Service` definition on port `9090` in OpenTelemetry format for monitoring, troubleshooting, and capacity planning.

Following are categories of the metrics exposed:

* Resource processing
* Performance timing
* State tracking
* Error monitoring

Most pruner metrics use labels to provide additional context. You can use these labels in PromQL{nbsp}queries or dashboards to filter and group the metrics.

[cols="1,3"options="header"]
|===
| Label | Description

| `namespace`
| The Kubernetes namespace of the `PipelineRun` or `TaskRun`.

| `resource_type`
| The Tekton resource type.

| `status`
| The outcome of processing a resource.

| `operation`
| The pruning method that deleted a resource.

| `reason`
| Specific cause for skipping or error outcomes.
|===

Resource processing metrics::
The following resource processing metrics are exposed by the event-based pruner:
+
[cols="3,1,3,2",options="header"]
|===
| Name | Type | Description | Labels
| `tekton_pruner_controller_resources_processed_total` | Counter | Total resources processed | namespace, resource_type, status
| `tekton_pruner_controller_resources_deleted_total` | Counter | Total resources deleted | namespace, resource_type, operation
|===


Performance timing metrics::
The following performance timing metrics are exposed by the event-based pruner:
+
[cols="3,1,3,2,2",options="header"]
|===
| Name | Type | Description | Labels | Bucket 
| `tekton_pruner_controller_reconciliation_duration_seconds` | Histogram | Time spent in reconciliation | namespace, resource_type | 0.1 to 30 seconds
| `tekton_pruner_controller_ttl_processing_duration_seconds` | Histogram | Time spent processing TTL | namespace, resource_type | 0.1 to 30 seconds
| `tekton_pruner_controller_history_processing_duration_seconds` | Histogram | Time spent processing history limits | namespace, resource_type | 0.1 to 30 seconds
|===

State tracking metrics::
The following state tracking metrics are exposed by the event-based pruner:
+
[cols="3,1,3",options="header"]
|===
| Name | Type | Description
| `kn_workqueue_adds_total` | Counter | Total resources queued
| `kn_workqueue_depth` | Gauge | Number of current items in queue
|===

Error monitoring metrics::
The following error monitoring metrics are exposed by the event-based pruner:
+
[cols="3,1,3,2",options="header"]
|===
| Name | Type | Description | Labels
| `tekton_pruner_controller_resources_errors_total` | Counter | Total processing errors | namespace, resource_type, reason
|===
