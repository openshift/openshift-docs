// Module included in the following assemblies:
//
// * migration/installing-and-upgrading-4.adoc

[id="migration-installing-upgrading-mtc-on-ocp-4_{context}"]

ifdef::installing-4,installing-disconnected-4[]
= Installing the {mtc-full}

You can install the {mtc-full} ({mtc-short}) on {product-title} 4 by using the {product-title} web console.
endif::[]

ifdef::upgrading-4,upgrading-disconnected-4[]
= Upgrading the {mtc-full}

You can upgrade the {mtc-full} ({mtc-short}) on {product-title} 4 by using the {product-title} web console.
endif::[]

[IMPORTANT]
====
You must ensure that the same {mtc-short} version is installed on all clusters.
====

.Prerequisites

* You must be logged in as a user with `cluster-admin` privileges on all clusters.
ifdef::installing-disconnected-4,upgrading-disconnected-4[]
* You must have access to a mirror Operator catalog image in a local registry.
* You must configure Operator Lifecycle Manager (OLM) to install the {mtc-full} Operator from the local registry.
endif::[]

.Procedure

ifdef::installing-4,installing-disconnected-4,upgrading-disconnected-4[]
. In the {product-title} web console, navigate to *Operators* -> *OperatorHub*.
+
For {product-title} 4.1, navigate to *Catalog* -> *OperatorHub*.

. Use the *Filter by keyword* field to locate the *{mtc-full} Operator*.
. Select the *{mtc-full} Operator* and click *Install*.
endif::[]
ifdef::installing-4[]
+
[NOTE]
====
Do not change the subscription approval option to *Automatic*. The {mtc-full} version must be the same on all clusters.
====
endif::[]
ifdef::installing-4,installing-disconnected-4,upgrading-disconnected-4[]
. Click *Install*.
+
On the *Installed Operators* page, the *{mtc-full} Operator* appears in the *openshift-migration* project with the status *Succeeded*.
endif::[]

ifdef::upgrading-4[]
. In the {product-title} console, navigate to *Operators* -> *Installed Operators*.
+
For {product-title} 4.1, navigate to *Catalog* -> *OperatorHub*.
+
Operators with a pending upgrade display an *Upgrade available* status.

. Click *{mtc-full} Operator*.
. Click the *Subscription* tab. Any upgrades requiring approval are displayed next to *Upgrade Status*. For example, it might display *1 requires approval*.
. Click *1 requires approval*, then click *Preview Install Plan*.
. Review the resources that are listed as available for upgrade and click *Approve*.
. Navigate back to the *Operators -> Installed Operators* page to monitor the progress of the upgrade. When complete, the status changes to *Succeeded* and *Up to date*.
endif::[]

. For a source cluster or any cluster that is not a host for the {mtc-short} web console:
.. Click *{mtc-full} Operator*.
.. Under *Provided APIs*, locate the *Migration Controller* tile, and click *Create Instance*.
.. Update the following parameters in the `migration-controller` custom resource manifest:
+
[source,yaml]
----
spec:
...
  migration_controller: false
  migration_ui: false
...
  deprecated_cors_configuration: true <1>
----
<1> This parameter is required only for {product-title} 4.1.

. Click *Create*.
. Navigate to *Workloads* -> *Pods* to verify that the {mtc-short} pods are running.
