// Module included in the following assemblies:
//
// * *scalability_and_performance/ztp-configuring-single-node-cluster-deployment-during-installation.adoc

:_content-type: PROCEDURE
[id="ztp-sndu-assisted-service-configuration_{context}"]
= Assisted service configuration

Use the following procedure to create the `AgentServiceConfig`, `Configmap`, and    and ClusterImageSet` files.

. Create the `AgentServiceConfig` that points to the assisted service configuration:
+
[source,yaml]
----
apiVersion: agent-install.openshift.io/v1beta1
kind: AgentServiceConfig
metadata:
  namespace: open-cluster-management
  name: agent
  annotations:
    unsupported.agent-install.openshift.io/assisted-service-configmap: 'assisted-service-config' <1>
spec:
  databaseStorage:
    accessModes:
    - ReadWriteOnce
    resources:
      requests:
        storage: 10Gi
  filesystemStorage:
    accessModes:
    - ReadWriteOnce
    resources:
      requests:
        storage: 20Gi
  mirrorRegistryRef:
    name: 'mirror-registry-config' <2>
  osImages:
  - openshiftVersion: "{{ provisioner_cluster_version }}" <3>
    version: "{{ provisioner_cluster_version_minor }}"
    url: "{{ disconnected_http_server }}/{{ rhcos_remote_iso | basename }}"
    rootFSUrl: "{{ disconnected_http_server }}/{{ rhcos_remote_rootfs | basename }}"
----
<1> Points to the config map that retrieves the setting for assisted service.
<2> Points to a config map defining the offline mirror to use.
<3> Creates a map between the OpenShift version and the local images.

. Create the `Configmap`:
+
[source,yaml]
----
apiVersion: v1
kind: ConfigMap
metadata:
  name: assisted-service-config
  namespace: open-cluster-management
  labels:
    app: assisted-service
data:
  LOG_LEVEL: "debug”
----

. Create one `ClusterImageSet` for each version that you want to deploy:
+
[source,yaml]
—-
apiVersion: hive.openshift.io/v1
kind: ClusterImageSet
metadata:
  name: openshift-4.8.0
  namespace: assisted-installer
spec:
  releaseImage: {{ provisioner_cluster_registry }}/ocp4:4.8.0 <1>
—-
<1> Points to the registry that contains the release image for that version. This can be either upstream or downstream in a disconnected environment.


. Create the following ‘ConfigMap’ for the registries:
+
[source,yaml]
----
apiVersion: v1 <1>
data:
  registries.conf: |
     <registries.conf file> <2>
  ca-bundle.crt: |
     <private_registry_crt> <3>
kind: ConfigMap
metadata:
  name: mirror-registry-config
  namespace: open-cluster-management
----
<1> Required only for disconnected environments.
<2> The base64-encoded `registries.conf` file, with all of the mapping between connected and disconnected.
<3> The `crt` file for trusting the private registry.
