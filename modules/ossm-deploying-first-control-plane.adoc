// Module included in the following assemblies:
// install/ossm-deploying-multiple-service-meshes-on-single-cluster.adoc

:_mod-docs-content-type: PROCEDURE
[id="ossm-deploying-first-control-plane_{context}"]
= Deploying the first control plane

You deploy the first control plane by creating its assigned namespace.

.Prerequisites

* You have installed the {SMProduct} operator.

* You have created an {istio} Container Network Interface (CNI) resource.
+
[NOTE]
====
You can run the following command to check for existing `{istio}` instances:
[source,terminal]
----
$ oc get istios
----
====

* You have installed the `istioctl` binary on your localhost.


[NOTE]
====
You can have extended support for more than two control planes. The maximum number of service meshes in a single cluster depends on the available cluster resources.
====

.Procedure

. Create the namespace for the first {istio} control plane called `istio-system-1` by running the following command:
+
[source,terminal]
----
$ oc new-project istio-system-1
----

. Add the following label to the first namespace, which is used with the {istio} `discoverySelectors` field by running the following command:
+
[source,terminal]
----
$ oc label namespace istio-system-1 istio-discovery=mesh-1
----

. Create a YAML file named `istio-1.yaml` with the name `mesh-1` and the `discoverySelector` as `mesh-1`:
+
.Example configuration
[source,yaml,subs="attributes,verbatim"]
----
kind: Istio
apiVersion: sailoperator.io/v1
metadata:
  name: mesh-1
spec:
  namespace: istio-system-1
  values:
    meshConfig:
      discoverySelectors:
        - matchLabels:
            istio-discovery: mesh-1
# ...
----

. Create the first `{istio}` resource by running the following command:
+
[source,terminal]
----
$ oc apply -f istio-1.yaml
----

. To restrict workloads in `mesh-1` from communicating freely with decrypted traffic between meshes, deploy a `PeerAuthentication` resource to enforce mutual TLS (mTLS) traffic within the `mesh-1` data plane. Apply the `PeerAuthentication` resource in the `istio-system-1` namespace by using a configuration file, such as `peer-auth-1.yaml`:
+
[source,terminal]
----
$ oc apply -f peer-auth-1.yaml
----
+
.Example configuration
[source,yaml,subs="attributes,verbatim"]
----
apiVersion: security.istio.io/v1
kind: PeerAuthentication
metadata:
  name: "mesh-1-peerauth"
  namespace: "istio-system-1"
spec:
  mtls:
    mode: STRICT
----
