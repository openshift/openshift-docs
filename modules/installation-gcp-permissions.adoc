// Module included in the following assemblies:
//
// * installing/installing_gcp/installing-gcp-account.adoc
// * installing/installing_gcp/installing-gcp-user-infra.adoc
// * installing/installing_gcp/installing-gcp-user-infra-vpc.adoc
// * installing/installing_gcp/installing-restricted-networks-gcp.adoc

ifeval::["{context}" == "installing-gcp-user-infra"]
:template:
endif::[]
ifeval::["{context}" == "installing-restricted-networks-gcp"]
:template:
endif::[]
ifeval::["{context}" == "installing-gcp-user-infra-vpc"]
:template:
endif::[]

[id="installation-gcp-permissions_{context}"]
= Required GCP permissions

When you attach the `Owner` role to the service account that you create, you
grant that service account all permissions, including those that are required to
install {product-title}. To deploy an {product-title} cluster, the service
account requires the following permissions. If you deploy your cluster into an existing VPC, the service account does not require certain networking permissions, which are noted in the following lists:

.Required roles for the installation program
[cols="3,7"options="header"]
|===
|Role|Description

|Compute Admin
(roles/compute.admin)
|link:https://cloud.google.com/iam/docs/understanding-roles#compute-engine-roles[Full control of all Compute Engine resources]

|Security Admin
(roles/iam.securityAdmin)
|Security admin role, with permissions to get and set any IAM policy.

|Service Account Admin
(roles/iam.serviceAccountAdmin)
|Creates and manages service accounts. This permission is required when managing your GCP credentials using mint mode.

|Service Account User
(roles/iam.serviceAccountUser)
|Runs operations as the service account.

|Storage Admin
(roles/storage.admin)
|Grants full control of storage objects and buckets, and is needed to help provide persistent storage to the cluster.
|===

For more information, see link:https://cloud.google.com/iam/docs/understanding-roles[Compute Engine roles].

.Required roles for creating network resources during installation
[cols="3,7"options="header"]
|===
|Role|Description

|DNS Administrator
(roles/dns.admin)
|Provides the service account read-write access to all Cloud DNS resources. To install {product-title}, your GCP account must have a dedicated public hosted zone in the same project that you host the cluster. This zone must be authoritative for the domain. The DNS service provides cluster DNS resolution and name lookup for external connections to the cluster. A cluster also needs this role to add new DNS entries for the Ingress Operator through the Kubernetes cloud integration.
|===

For more information, see link:https://cloud.google.com/iam/docs/understanding-roles#dns-roles[DNS roles].


ifdef::template[]
.Required roles for user-provisioned GCP infrastructure
[cols="3,7"options="header"]
|===
|Role|Description

|Deployment Manager Editor
|Allows the Deployment Manager to create and manage deployments. Deployment Manager templates are provided in the {product-title} documentation as examples for deployment types.

|Service Account Key Admin
(roles/iam.serviceAccountKeyAdmin)
|Allows a key to be added to the service account, which is required to create a securely signed URL for the bootstrap ignition.

For more information, see link:https://cloud.google.com/iam/docs/understanding-roles#deployment-manager-roles[Deployment Manager roles].

|===
endif::template[]

.Optional roles
[cols="3,7"options="header"]
|===
|Role|Description

|Service Account Key Admin
|Allows the cluster to create new limited credentials for its Operators.
|===

For more information, see link:https://cloud.google.com/iam/docs/understanding-roles#service-accounts-roles[Service Account roles].

The roles are applied to the service accounts that the control plane and compute
machines use:

.GCP service account permissions
[cols="1a,2a",options="header"]
|===

|Account
|Roles

.5+|Control Plane
|`roles/compute.instanceAdmin`
|`roles/compute.networkAdmin`
|`roles/compute.securityAdmin`
|`roles/storage.admin`
|`roles/iam.serviceAccountUser`

.2+|Compute
|`roles/compute.viewer`
|`roles/storage.admin`
|===

ifeval::["{context}" == "installing-gcp-user-infra"]
:!template:
endif::[]
ifeval::["{context}" == "installing-restricted-networks-gcp"]
:!template:
endif::[]
ifeval::["{context}" == "installing-gcp-user-infra-vpc"]
:!template:
endif::[]
