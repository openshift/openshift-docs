// Module included in the following assemblies:
//
// * networking/network_security/network_policy/nw-networkpolicy-full-multitenant-isolation.adoc

:_mod-docs-content-type: PROCEDURE
[id="nw-networkpolicy-default-deny-ingress_{context}"]
= Creating a default deny all ingress network policy

The following `default-deny-all` network policy blocks all cross-pod networking other than network traffic allowed by the configuration of other deployed network policies and traffic between host-networked pods. This procedure enforces a strong deny policy by applying a `default-deny-all` policy both the `project-a` and `project-b` namespaces.

[WARNING]
====
Without configuring a `NetworkPolicy` custom resource (CR) that allows traffic communication, the following policy might cause communication problems across your cluster.
====

.Prerequisites

* Your cluster uses a network plugin that supports `NetworkPolicy` objects, such as the OVN-Kubernetes network plugin, with `mode: NetworkPolicy` set.
* You have installed the OpenShift CLI (`oc`).
* You are logged in as a user with cluster admin privileges.
* You have created at least two namespaces. The following examples use `project-a` and `project-b` namespaces.
* You have created at least two pods in each namespace.

.Procedure

. Create the following YAML that defines a `default-deny-all` network policy to deny ingress from all pods in all namespaces. Save the YAML in the `default-deny-all.yaml` file:
+
[source,yaml]
----
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: default-deny-all
spec:
  podSelector: {}
  policyTypes:
  - Ingress
----

. Apply the network policy to the `project-a` namespace by entering the following command:
+
[source,terminal]
----
$ oc apply -f default-deny-all.yaml -n project-a
----

. Apply the network policy to the `project-b` namespace by entering the following command:
+
[source,terminal]
----
$ oc apply -f default-deny-all.yaml -n project-b
----

.Verification

. Obtain the IP addresses of pods in `project-a` by running the following command:
+
[source,terminal]
----
$ oc get pod -n project-a -o wide
----
+
.Example output
+
[source,terminal]
----
NAME            READY   STATUS    RESTARTS   AGE     IP            NODE                           NOMINATED NODE   READINESS GATES
busybox-pod-a   1/1     Running   0          2m55s   10.132.0.38   ip-10-0-132-187.ec2.internal   <none>           <none>
test-pod-a      1/1     Running   0          2m37s   10.132.0.40   ip-10-0-132-187.ec2.internal   <none>           <none>
----

. Obtain the IP addresses of pods in `project-b` by running the following command:
+
[source,terminal]
----
$ oc get pod -n project-b -o wide
----
+
.Example output
+
[source,terminal]
----
NAME            READY   STATUS    RESTARTS   AGE     IP            NODE                           NOMINATED NODE   READINESS GATES
busybox-pod-b   1/1     Running   0          2m47s   10.132.0.39   ip-10-0-132-187.ec2.internal   <none>           <none>
test-pod-b      1/1     Running   0          2m38s   10.132.0.41   ip-10-0-132-187.ec2.internal   <none>           <none>
----

. Attempt to establish a connection between pods in `project-a` by running the following command:
+
[source,terminal]
----
$ oc exec -it test-pod-a -n project-a -- ping 10.132.0.38
----
+
.Example output
+
[source,terminal]
----
PING 10.143.0.38 (10.143.0.38): 56 data bytes
--- 10.143.0.38 ping statistics ---
3 packets transmitted, 0 packets received, 100% packet loss
----
+
This behavior is intended because of the `default-deny-all` network policy.

. Attempt to establish a connection between pods in `project-a` and `project-b` by running the following command:
+
[source,terminal]
----
$ oc exec -it test-pod-a -n project-a -- ping 10.132.0.41
----
+
.Example output
+
[source,terminal]
----
PING 10.132.0.41 (10.132.0.41): 56 data bytes
--- 10.132.0.41 ping statistics ---
4 packets transmitted, 0 packets received, 100% packet loss
----
+
This behavior is intended because of the `default-deny-all` network policy.