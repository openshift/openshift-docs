// Module included in the following assemblies:
//
// *scalability_and_performance/ztp-zero-touch-provisioning.adoc

[id="ztp-ztp-custom-resources_{context}"]
= ZTP custom resources

Zero touch provisioning (ZTP) uses custom resource objects to extend the Kubernetes API or introduce your own API into a project or a cluster. These custom resources contain the site-specific data required to install and configure a cluster for RAN applications.

A custom resource definition (CRD) file defines your own object kinds. Deploying a CRD into the managed cluster causes the Kubernetes API server to begin serving the specified custom resource for the entire lifecycle.

For each custom resource in the `<site>.yaml` file on the managed cluster, the data is used to create installation custom resources in a directory named
for the cluster.

ZTP provides two ways for defining and installing custom resources on managed clusters: A manual approach when you are provisioning a single cluster and an automated approach when provisioning multiple clusters.

Manual custom resource creation for single clusters::
Use this method when you are creating custom resources for a single cluster. This is a good way to test your custom resources before deploying on a larger scale.

Automated custom resource creation for multiple managed clusters::
Use the automated SiteConfig method when you are installing multiple managed clusters, for example, in batches of up to 100 clusters. SiteConfig uses ArgoCD as the engine for the GitOps method of site deployment. After completing a site plan that contains all of the required parameters for deployment, a policy generator creates the manifests and applies them to the hub cluster.

Both methods create the custom resources shown in the following table.
On the cluster site, an automated Discovery image ISO file creates a directory with the site name and a file with the cluster name.
Every cluster has its own namespace, and all of the custom resources are under that namespace. The namespace and the custom resource
names match the cluster name.

[cols="1,1,1"]
|===
| Resource | Description | Usage

|`BareMetalHost`
|Contains the connection information for the Baseboard Management Controller (BMC) of the target bare metal machine.
|Provides access to the BMC in order to load and boot the Discovery image ISO on the target machine by using the Redfish protocol.

|`InfraEnv`
|Contains information for pulling {product-title} onto the target bare metal machine.
|Used with ClusterDeployment to generate the Discovery ISO for the managed cluster.

|`AgentClusterInstall`
|Specifies the managed cluster’s configuration such as networking and the number of supervisor (control plane) nodes. Shows the `kubeconfig` and credentials when the installation is complete.
|Specifies the managed cluster configuration information and provides status during the installation of the cluster.

|`ClusterDeployment`
|References the `AgentClusterInstall` to use.
|Used with `InfraEnv` to generate the Discovery ISO for the managed cluster.

|`NMStateConfig`
|Provides network configuration information such as `MAC` to `IP` mapping, DNS server, default route, and other network settings. This is not needed if DHCP is used.
|Sets up a static IP address for the managed cluster’s Kube API server.

|`Agent`
|Contains hardware information about the target bare metal machine.
|Created automatically on the hub when the target machine's Discovery image ISO boots.

|`ManagedCluster`
|When a cluster is managed by the hub, it must be imported and known. This Kubernetes object provides that interface.
|The hub uses this resource to manage and show the status of managed clusters.

|`KlusterletAddonConfig`
|Contains the list of services provided by the hub to be deployed to a `ManagedCluster`.
|Tells the hub which addon services to deploy to a `ManagedCluster`.

|`Namespace`
|Logical space for `ManagedCluster` resources existing on the hub. Unique per site.
|Propagates resources to the `ManagedCluster`.

| `Secret` 
|Two custom resources are created: `BMC Secret` and `Image Pull Secret`.
a| * `BMC Secret` authenticates into the target bare metal machine using its username and password.
* `Image Pull Secret` contains authentication information for the {product-title} image installed on the target bare metal machine.

|`ClusterImageSet`
|Contains {product-title} image information such as the repository and image name.
|Passed into resources to provide {product-title} images.
|===
