// Module included in the following assemblies:
//
// * scalability_and_performance/ztp-factory-install-clusters.adoc
:_content-type: CONCEPT
[id="hub-factory-pipeline_{context}"]
= The hub factory pipeline

The hub configuration pipeline stage prepares the hub cluster to deploy multiple spoke clusters for the end customer. 

The flow associated with deploying the hub cluster is shown as follows:

Download the code and check hub::

The intitials stages in the pipeline step the various tools needed. It downloads `jq`, `oc`, `opm` and `kubectl`. It also proceeds to check that various hub install prerequisites exist before proceeding, for example it checks:

* {product-title} version
* nodes are ready
* cluster operators are ready
* metal^3^ pods are ready
* Persistent volumes are created
* DNS requirements are satisfied

Deploy HTTPD::

This step deploys and configures an HTTP server on the hub cluster. It obtains the RHCOS ISO and RootFS images from link:https://mirror.openshift.com/pub/openshift-v4/dependencies/rhcos/pre-release/[mirror.openshift.com] and ensures these are hosted on the deployed HTTPD server. These are then available to install on the spoke cluster.

Deploy registry::

This step deploys a registry on the hub cluster. A number of substeps are involved in this process:

   * The registry is deployed on the hub.
   * The required container images into the environment.
   * The Red Hat Operators catalog mirror configuration to your cluster.
   * The pull secret is updated globally.
   * A snapshot of the created mirror registry is taken

Deploy ACM::

This step installs the Red Hat Advanced Cluster Manager and Assisted Installer on the {product-title} hub cluster. Red Hat Advanced Cluster Manager manages the deployment on multiple managed spoke clusters.

Transition to disconnected::

From this step onwards the hub cluster is no longer connected to the Internet.

Deploy Assisted installer::

This step ensures the assisted installer service is configured to support installing the spoke clusters. At this stage the hub cluster is configured and ready to be used to install the spoke cluster.