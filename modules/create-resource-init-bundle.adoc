// Module included in the following assemblies:
//
// * cloud_service/installing_cloud_other/init-bundle-cloud-other-apply.adoc
// * cloud_service/installing_cloud_ocp/init-bundle-cloud-ocp-apply.adoc
// * installing/installing_ocp/init-bundle-ocp.adoc
// * installing/installing_other/init-bundle-other.adoc

//Conditionals to show ocp commands for OpenShift, kube commands for Kubernetes, Central language for non-cloud
ifeval::["{context}" == "init-bundle-cloud-ocp"]
:openshift:
endif::[]

ifeval::["{context}" == "init-bundle-ocp"]
:openshift:
endif::[]

ifeval::["{context}" == "init-bundle-other"]
:kube:
endif::[]

ifeval::["{context}" == "init-bundle-cloud-other-apply"]
:kube:
endif::[]

ifeval::["{context}" == "init-bundle-cloud-other-apply"]
:cloud:
endif::[]

ifeval::["{context}" == "init-bundle-cloud-ocp-apply"]
:openshift:
endif::[]

ifeval::["{context}" == "init-bundle-cloud-ocp-apply"]
:cloud:
endif::[]

ifeval::["{context}" == "init-bundle-cloud-ocp-apply"]
:cloud-ocp-apply:
endif::[]

ifeval::["{context}" == "init-bundle-cloud-other-apply"]
:cloud-other-apply:
endif::[]

:_mod-docs-content-type: PROCEDURE
[id="create-resource-init-bundle_{context}"]
= Applying the init bundle on the secured cluster

//Do not show for ACSCS
ifndef::cloud[]
Before you configure a secured cluster, you must apply the init bundle by using it to create the required resources on the cluster. Applying the init bundle allows the services on the secured cluster to communicate with Central.
endif::cloud[]

//Show for ACSCS
ifdef::cloud[]
Before you configure a secured cluster, you must apply the init bundle by using it to create the required resources on the secured cluster. Applying the init bundle allows the services on the secured cluster to communicate with {product-title-managed-short}.
endif::cloud[]

[NOTE]
====
If you are installing by using Helm charts, do not perform this step. Complete the installation by using Helm; See "Installing
{product-title-short} on secured clusters by using Helm charts" in the additional resources section.
====

.Prerequisites
* You must have generated an init bundle containing secrets.
* You must have created the `stackrox` project, or namespace, on the cluster where secured cluster services will be installed. Using `stackrox` for the project is not required, but ensures that vulnerabilities for {product-title-short} processes are not reported when scanning your clusters.

.Procedure
//Show for OpenShift
ifdef::openshift[]
To create resources, perform only one of the following steps:

* Create resources using the {ocp} web console: In the {ocp} web console, make sure that you are in the `stackrox` namespace. In the top menu, click *+* to open the *Import YAML* page. You can drag the init bundle file or copy and paste its contents into the editor, and then click *Create*. When the command is complete, the display shows that the `collector-tls`, `sensor-tls`, and admission-control-tls` resources were created.

* Create resources using the {osp} CLI: Using the {osp} CLI, run the following command to create the resources:
+
[source,terminal]
----
$ oc create -f <init_bundle>.yaml \// <1>
  -n <stackrox> <2>
----
<1> Specify the file name of the init bundle containing the secrets.
<2> Specify the name of the project where Central services are installed.
endif::openshift[]
//Show for Kubernetes
ifdef::kube[]
* Using the `kubectl` CLI, run the following commands to create the resources:
+
[source,terminal]
----
$ kubectl create namespace stackrox <1>
$ kubectl create -f <init_bundle>.yaml \// <2>
  -n <stackrox> <3>
----
<1> Create the project where secured cluster resources will be installed. This example uses `stackrox`.
<2> Specify the file name of the init bundle containing the secrets.
<3> Specify the project name that you created. This example uses `stackrox`.
endif::kube[]

ifdef::cloud-ocp-apply,cloud-other-apply[]
.Verification

* Restart Sensor to pick up the new certificates.
+
For more information about how to restart Sensor, see "Restarting the Sensor container" in the "Additional resources" section.
endif::cloud-ocp-apply,cloud-other-apply[]

ifeval::["{context}" == "init-bundle-cloud-ocp"]
:!openshift:
endif::[]

ifeval::["{context}" == "init-bundle-ocp"]
:!openshift:
endif::[]

ifeval::["{context}" == "init-bundle-other"]
:!kube:
endif::[]

ifeval::["{context}" == "init-bundle-cloud-other-apply"]
:!kube:
endif::[]

ifeval::["{context}" == "init-bundle-cloud-other-apply"]
:!cloud:
endif::[]

ifeval::["{context}" == "init-bundle-cloud-ocp-apply"]
:!openshift:
endif::[]

ifeval::["{context}" == "init-bundle-cloud-ocp-apply"]
:!cloud:
endif::[]

ifeval::["{context}" == "init-bundle-cloud-ocp-apply"]
:!cloud-ocp-apply:
endif::[]

ifeval::["{context}" == "init-bundle-cloud-other-apply"]
:!cloud-other-apply:
endif::[]