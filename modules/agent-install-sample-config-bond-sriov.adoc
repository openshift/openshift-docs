// Module included in the following assemblies:
//
// * installing/installing-with-agent-based-installer/preparing-to-install-with-agent-based-installer.adoc

:_mod-docs-content-type: REFERENCE
[id="agent-install-sample-config-bond-sriov_{context}"]
= Example: Bonds and SR-IOV dual-NIC node network configuration

The following `agent-config.yaml` file is an example of a manifest for dual port network interface controller (NIC) with a bond and SR-IOV interfaces:

[source,yaml]
----
apiVersion: v1alpha1
kind: AgentConfig
rendezvousIP: 10.10.10.14
hosts:
  - hostname: worker-1
    interfaces:
      - name: eno1
        macAddress: 0c:42:a1:55:f3:06
      - name: eno2
        macAddress: 0c:42:a1:55:f3:07
    networkConfig:
      interfaces:
        - name: <interface_name>
          type: <interface_type>
          state: up
          mac-address: 0c:42:a1:55:f3:06
          ipv4:
            enabled: true
            dhcp: <dhcp_enabled>
          ethernet:
            sr-iov:
              total-vfs: <total_vfs>
          ipv6:
            enabled: false
        - name: sriov:eno1:0
          type: ethernet
          state: <vf_state>
          ipv4:
            enabled: <vf_ipv4_enabled>
          ipv6:
            enabled: false
            dhcp: false
        - name: sriov:eno1:1
          type: ethernet
          state: down
        - name: eno2
          type: ethernet
          state: up
          mac-address: 0c:42:a1:55:f3:07
          ipv4:
            enabled: true
          ethernet:
            sr-iov:
              total-vfs: 2
          ipv6:
            enabled: false
        - name: sriov:eno2:0
          type: ethernet
          state: up
          ipv4:
            enabled: false
          ipv6:
            enabled: false
        - name: sriov:eno2:1
          type: ethernet
          state: down
        - name: bond0
          type: bond
          state: up
          min-tx-rate: <min_tx_rate>
          max-tx-rate: <max_tx_rate>
          link-aggregation:
            mode: <bond_mode>
            options:
              primary: <primary_port>
            port:
              - sriov:eno1:0
              - sriov:eno2:0
          ipv4:
            address:
              - ip: <node_ip>
                prefix-length: 23
            dhcp: false
            enabled: true
          ipv6:
            enabled: false
          dns-resolver:
            config:
              server:
                - 10.11.5.160
                - 10.2.70.215
          routes:
            config:
              - destination: 0.0.0.0/0
                next-hop-address: 10.19.17.254
                next-hop-interface: <gateway_interface>
                table-id: 254
----
where:

<interface_name>:: Specifies the name of the interface.
<interface_type>:: Specifies the type of interface. This example creates an ethernet interface.
<dhcp_enabled>:: Specifies whether to enable DHCP. Set this to `false` to disable DHCP for the physical function (PF) if it is not strictly required.
<total_vfs>:: Specifies the number of SR-IOV virtual functions (VFs) to instantiate.
<vf_state>:: Specifies the state of the VF. Set this to `up`.
<vf_ipv4_enabled>:: Specifies whether to enable IPv4 for the VF. Set this to `false` to disable IPv4 addressing for the VF attached to the bond.
<min_tx_rate>:: Specifies a minimum transmission rate, in Mbps, for the VF. This sample value sets a rate of 100 Mbps.
+
[NOTE]
====
* This value must be less than or equal to the maximum transmission rate.
* Intel NICs do not support the `min-tx-rate` parameter. For more information, see link:https://bugzilla.redhat.com/show_bug.cgi?id=1772847[*BZ#1772847*].
====
<max_tx_rate>:: Specifies a maximum transmission rate, in Mbps, for the VF. This sample value sets a rate of 200 Mbps.
<bond_mode>:: Specifies the bond mode.
<primary_port>:: Specifies the preferred port of the bonding interface. The primary device is the first of the bonding interfaces to be used and is not abandoned unless it fails. This setting is particularly useful when one NIC in the bonding interface is faster and, therefore, able to handle a bigger load. This setting is only valid when the bonding interface is in `active-backup` mode (mode 1).
<node_ip>:: Specifies a static IP address for the bond interface. This is the node IP address.
<gateway_interface>:: Specifies the gateway interface for the default route.