// Module included in the following assemblies:
//
// * networking/ovn_kubernetes_network_provider/about-ipsec-ovn.adoc

[id="nw-ovn-ipsec-verification_{context}"]
= Verifying that IPsec is enabled

As a cluster administrator, you can verify that IPsec is enabled.

.Verification

. To find the names of the IPsec pods, enter the following command:
+
[source,terminal]
----
$ oc get pods -n openshift-ovn-kubernetes | grep ipsec
----
+
.Example output
[source,terminal]
----
ovn-ipsec-4496s        1/1     Running   0          6h39m
ovn-ipsec-d6cht        1/1     Running   0          6h42m
ovn-ipsec-skblc        1/1     Running   0          6h51m
ovn-ipsec-vf8rf        1/1     Running   0          6h51m
ovn-ipsec-w7hjr        1/1     Running   0          6h51m
ovn-ipsec-zsk7x        1/1     Running   0          6h42m
----

. Verify that IPsec tunnels are established on your cluster:
+
[source,terminal]
----
$ oc -n openshift-ovn-kubernetes -c ovn-ipsec \
  exec <ipsec_pod> -- ovs-appctl -t ovs-monitor-ipsec tunnels/show
----
+
--
where:

`<ipsec_pod>`:: Specifies an IPsec pod from the first step.
--
+
.Example output
[source,text]
----
Interface name: ovn-d5691d-0 v1 (CONFIGURED)
  Tunnel Type:    geneve
  Local IP:       %defaultroute
  Remote IP:      10.0.152.21
  SKB mark:       None
  Local cert:     /etc/openvswitch/keys/ipsec-cert.pem
  Local name:     824a9058-8a6d-4395-a1b1-5b3208961e75
  Local key:      /etc/openvswitch/keys/ipsec-privkey.pem
  Remote cert:    None
  Remote name:    d5691dff-cc78-45e4-b8ef-dae5d422d0d8
  CA cert:        /etc/openvswitch/keys/ipsec-cacert.pem
  PSK:            None
  Ofport:         5
  CFM state:      Disabled
Kernel policies installed:
  src 10.0.161.236/32 dst 10.0.152.21/32 proto udp sport 6081
  src 10.0.161.236/32 dst 10.0.152.21/32 proto udp sport 6081
  src 10.0.161.236/32 dst 10.0.152.21/32 proto udp dport 6081
  src 10.0.161.236/32 dst 10.0.152.21/32 proto udp dport 6081
Kernel security associations installed:
  sel src 10.0.152.21/32 dst 10.0.161.236/32 proto udp dport 6081
  sel src 10.0.161.236/32 dst 10.0.152.21/32 proto udp sport 6081
  sel src 10.0.152.21/32 dst 10.0.161.236/32 proto udp sport 6081
  sel src 10.0.161.236/32 dst 10.0.152.21/32 proto udp dport 6081
  sel src 10.0.152.21/32 dst 10.0.161.236/32 proto udp dport 6081
  sel src 10.0.161.236/32 dst 10.0.152.21/32 proto udp sport 6081
IPsec connections that are active:
  000 #71: "ovn-d5691d-0-in-1":500 STATE_PARENT_R2 (received v2I2, PARENT SA established); EVENT_SA_REKEY in 1682s; newest ISAKMP; idle;
  000 #18: "ovn-d5691d-0-out-1" esp.4dbf58b0@10.0.152.21 esp.36e894f0@10.0.161.236 ref=0 refhim=0 Traffic: ESPin=0B ESPout=836MB! ESPmax=0B

Interface name: ovn-8ec7db-0 v1 (CONFIGURED)
  Tunnel Type:    geneve
  Local IP:       %defaultroute
  Remote IP:      10.0.175.231
  SKB mark:       None
  Local cert:     /etc/openvswitch/keys/ipsec-cert.pem
  Local name:     824a9058-8a6d-4395-a1b1-5b3208961e75
  Local key:      /etc/openvswitch/keys/ipsec-privkey.pem
  Remote cert:    None
  Remote name:    8ec7db9b-a104-4ed3-9638-60dbccc85f76
  CA cert:        /etc/openvswitch/keys/ipsec-cacert.pem
  PSK:            None
  Ofport:         3
  CFM state:      Disabled
Kernel policies installed:
  src 10.0.161.236/32 dst 10.0.175.231/32 proto udp sport 6081
  src 10.0.161.236/32 dst 10.0.175.231/32 proto udp sport 6081
  src 10.0.161.236/32 dst 10.0.175.231/32 proto udp dport 6081
  src 10.0.161.236/32 dst 10.0.175.231/32 proto udp dport 6081
Kernel security associations installed:
  sel src 10.0.175.231/32 dst 10.0.161.236/32 proto udp dport 6081
  sel src 10.0.161.236/32 dst 10.0.175.231/32 proto udp sport 6081
  sel src 10.0.175.231/32 dst 10.0.161.236/32 proto udp sport 6081
  sel src 10.0.161.236/32 dst 10.0.175.231/32 proto udp dport 6081
  sel src 10.0.175.231/32 dst 10.0.161.236/32 proto udp dport 6081
  sel src 10.0.161.236/32 dst 10.0.175.231/32 proto udp sport 6081
IPsec connections that are active:
  000 #75: "ovn-8ec7db-0-in-1":500 STATE_PARENT_R2 (received v2I2, PARENT SA established); EVENT_SA_REKEY in 2938s; newest ISAKMP; idle;
  000 #27: "ovn-8ec7db-0-out-1" esp.d8151aa5@10.0.175.231 esp.a685128d@10.0.161.236 ref=0 refhim=0 Traffic: ESPin=0B ESPout=833MB! ESPmax=0B

Interface name: ovn-9a827d-0 v1 (CONFIGURED)
  Tunnel Type:    geneve
  Local IP:       %defaultroute
  Remote IP:      10.0.140.233
  SKB mark:       None
  Local cert:     /etc/openvswitch/keys/ipsec-cert.pem
  Local name:     824a9058-8a6d-4395-a1b1-5b3208961e75
  Local key:      /etc/openvswitch/keys/ipsec-privkey.pem
  Remote cert:    None
  Remote name:    9a827dd8-d1ac-404b-bdff-5c59920e2d14
  CA cert:        /etc/openvswitch/keys/ipsec-cacert.pem
  PSK:            None
  Ofport:         1
  CFM state:      Disabled
Kernel policies installed:
  src 10.0.161.236/32 dst 10.0.140.233/32 proto udp sport 6081
  src 10.0.161.236/32 dst 10.0.140.233/32 proto udp sport 6081
  src 10.0.161.236/32 dst 10.0.140.233/32 proto udp dport 6081
  src 10.0.161.236/32 dst 10.0.140.233/32 proto udp dport 6081
Kernel security associations installed:
  sel src 10.0.140.233/32 dst 10.0.161.236/32 proto udp dport 6081
  sel src 10.0.161.236/32 dst 10.0.140.233/32 proto udp sport 6081
  sel src 10.0.140.233/32 dst 10.0.161.236/32 proto udp sport 6081
  sel src 10.0.161.236/32 dst 10.0.140.233/32 proto udp dport 6081
  sel src 10.0.140.233/32 dst 10.0.161.236/32 proto udp dport 6081
  sel src 10.0.161.236/32 dst 10.0.140.233/32 proto udp sport 6081
IPsec connections that are active:
  000 #73: "ovn-9a827d-0-in-1":500 STATE_PARENT_R2 (received v2I2, PARENT SA established); EVENT_SA_REKEY in 2780s; newest ISAKMP; idle;
  000 #24: "ovn-9a827d-0-out-1" esp.1d5e7f0f@10.0.140.233 esp.bb189c98@10.0.161.236 ref=0 refhim=0 Traffic: ESPin=0B ESPout=350KB! ESPmax=0B

Interface name: ovn-8a68fb-0 v1 (CONFIGURED)
  Tunnel Type:    geneve
  Local IP:       %defaultroute
  Remote IP:      10.0.149.59
  SKB mark:       None
  Local cert:     /etc/openvswitch/keys/ipsec-cert.pem
  Local name:     824a9058-8a6d-4395-a1b1-5b3208961e75
  Local key:      /etc/openvswitch/keys/ipsec-privkey.pem
  Remote cert:    None
  Remote name:    8a68fb5b-0123-4d32-95de-fa5cc3346d52
  CA cert:        /etc/openvswitch/keys/ipsec-cacert.pem
  PSK:            None
  Ofport:         4
  CFM state:      Disabled
Kernel policies installed:
  src 10.0.161.236/32 dst 10.0.149.59/32 proto udp sport 6081
  src 10.0.161.236/32 dst 10.0.149.59/32 proto udp sport 6081
  src 10.0.161.236/32 dst 10.0.149.59/32 proto udp dport 6081
  src 10.0.161.236/32 dst 10.0.149.59/32 proto udp dport 6081
Kernel security associations installed:
  sel src 10.0.149.59/32 dst 10.0.161.236/32 proto udp dport 6081
  sel src 10.0.161.236/32 dst 10.0.149.59/32 proto udp sport 6081
  sel src 10.0.149.59/32 dst 10.0.161.236/32 proto udp sport 6081
  sel src 10.0.161.236/32 dst 10.0.149.59/32 proto udp dport 6081
  sel src 10.0.149.59/32 dst 10.0.161.236/32 proto udp dport 6081
  sel src 10.0.161.236/32 dst 10.0.149.59/32 proto udp sport 6081
IPsec connections that are active:
  000 #72: "ovn-8a68fb-0-in-1":500 STATE_PARENT_R2 (received v2I2, PARENT SA established); EVENT_SA_REKEY in 2613s; newest ISAKMP; idle;
  000 #21: "ovn-8a68fb-0-out-1" esp.5fae4461@10.0.149.59 esp.6f7c1683@10.0.161.236 ref=0 refhim=0 Traffic: ESPin=0B ESPout=6MB! ESPmax=0B

Interface name: ovn-a55d77-0 v1 (CONFIGURED)
  Tunnel Type:    geneve
  Local IP:       %defaultroute
  Remote IP:      10.0.135.254
  SKB mark:       None
  Local cert:     /etc/openvswitch/keys/ipsec-cert.pem
  Local name:     824a9058-8a6d-4395-a1b1-5b3208961e75
  Local key:      /etc/openvswitch/keys/ipsec-privkey.pem
  Remote cert:    None
  Remote name:    a55d779c-aeb5-4263-a87b-26d7f71558a6
  CA cert:        /etc/openvswitch/keys/ipsec-cacert.pem
  PSK:            None
  Ofport:         2
  CFM state:      Disabled
Kernel policies installed:
  src 10.0.161.236/32 dst 10.0.135.254/32 proto udp sport 6081
  src 10.0.161.236/32 dst 10.0.135.254/32 proto udp sport 6081
  src 10.0.161.236/32 dst 10.0.135.254/32 proto udp dport 6081
  src 10.0.161.236/32 dst 10.0.135.254/32 proto udp dport 6081
Kernel security associations installed:
  sel src 10.0.135.254/32 dst 10.0.161.236/32 proto udp dport 6081
  sel src 10.0.161.236/32 dst 10.0.135.254/32 proto udp sport 6081
  sel src 10.0.135.254/32 dst 10.0.161.236/32 proto udp sport 6081
  sel src 10.0.161.236/32 dst 10.0.135.254/32 proto udp dport 6081
  sel src 10.0.135.254/32 dst 10.0.161.236/32 proto udp dport 6081
  sel src 10.0.161.236/32 dst 10.0.135.254/32 proto udp sport 6081
IPsec connections that are active:
  000 #74: "ovn-a55d77-0-in-1":500 STATE_PARENT_R2 (received v2I2, PARENT SA established); EVENT_SA_REKEY in 2878s; newest ISAKMP; idle;
  000 #30: "ovn-a55d77-0-out-1" esp.d7724b39@10.0.135.254 esp.ae92dc5f@10.0.161.236 ref=0 refhim=0 Traffic: ESPin=0B ESPout=5MB! ESPmax=0B
----

. Verify that the IPsec status is free of any errors:
+
[source,terminal]
----
$ oc -n openshift-ovn-kubernetes -c ovn-ipsec exec <ipsec_pod> -- ipsec status
----
+
--
where:

`<ipsec_pod>`:: Specifies an IPsec pod from the first step.
--
+
.Example output
[source,text]
----
000 using kernel interface: netkey
000 interface lo/lo [::1]:500
000 interface lo/lo 127.0.0.1:4500
000 interface lo/lo 127.0.0.1:500
000 interface br-ex/br-ex 10.0.161.236:4500
000 interface br-ex/br-ex 10.0.161.236:500
000 interface ovn-k8s-mp0/ovn-k8s-mp0 10.129.2.2:4500
000 interface ovn-k8s-mp0/ovn-k8s-mp0 10.129.2.2:500
000 interface ovn-k8s-gw0/ovn-k8s-gw0 169.254.0.1:4500
000 interface ovn-k8s-gw0/ovn-k8s-gw0 169.254.0.1:500
000  
000  
000 fips mode=disabled;
000 SElinux=disabled
000 seccomp=disabled
000  
000 config setup options:
000  
000 configdir=/etc, configfile=/etc/ipsec.conf, secrets=/etc/ipsec.secrets, ipsecdir=/etc/ipsec.d
000 nssdir=/etc/ipsec.d, dumpdir=/run/pluto, statsbin=unset
000 dnssec-rootkey-file=/var/lib/unbound/root.key, dnssec-trusted=<unset>
000 sbindir=/usr/sbin, libexecdir=/usr/libexec/ipsec
000 pluto_version=3.32, pluto_vendorid=OE-Libreswan-3.32, audit-log=yes
000 nhelpers=-1, uniqueids=yes, dnssec-enable=yes, perpeerlog=no, logappend=yes, logip=yes, shuntlifetime=900s, xfrmlifetime=30s
000 ddos-cookies-threshold=50000, ddos-max-halfopen=25000, ddos-mode=auto
000 ikeport=500, ikebuf=0, msg_errqueue=yes, strictcrlpolicy=no, crlcheckinterval=0, listen=<any>, nflog-all=0
000 ocsp-enable=no, ocsp-strict=no, ocsp-timeout=2, ocsp-uri=<unset>
000 ocsp-trust-name=<unset>
000 ocsp-cache-size=1000, ocsp-cache-min-age=3600, ocsp-cache-max-age=86400, ocsp-method=get
000 global-redirect=no, global-redirect-to=<unset>
000 secctx-attr-type=32001
000 debug:
000  
000 nat-traversal=yes, keep-alive=20, nat-ikeport=4500
000 virtual-private (%priv):
000 - allowed subnets: 10.0.0.0/8, 192.168.0.0/16, 172.16.0.0/12, 25.0.0.0/8, 100.64.0.0/10, fd00::/8, fe80::/10
000  
000 Kernel algorithms supported:
000  
000 algorithm ESP encrypt: name=3DES_CBC, keysizemin=192, keysizemax=192
000 algorithm ESP encrypt: name=AES_CBC, keysizemin=128, keysizemax=256
...
000  
000 IKE algorithms supported:
000  
000 algorithm IKE encrypt: v1id=5, v1name=OAKLEY_3DES_CBC, v2id=3, v2name=3DES, blocksize=8, keydeflen=192
000 algorithm IKE encrypt: v1id=8, v1name=OAKLEY_CAMELLIA_CBC, v2id=23, v2name=CAMELLIA_CBC, blocksize=16, keydeflen=128
...
000  
000 stats db_ops: {curr_cnt, total_cnt, maxsz} :context={0,0,0} trans={0,0,0} attrs={0,0,0} 
000  
000 Connection list:
000
...
000  
000 Total IPsec connections: loaded 10, active 10
000  
000 State Information: DDoS cookies not required, Accepting new IKE connections
000 IKE SAs: total(5), half-open(0), open(0), authenticated(5), anonymous(0)
000 IPsec SAs: total(15), authenticated(15), anonymous(0)
000  
...
000  
000 Bare Shunt list:
000  
----

