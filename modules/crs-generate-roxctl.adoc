// Module included in the following assemblies:
//
// * installing/installing_helm/install-helm-customization.adoc
//
// You must declare the `topic-helm` or `topic-operator` attribute when using this module.
:_mod-docs-content-type: PROCEDURE
[id="crs-generate-roxctl_{context}"]
= Generating a CRS by using the roxctl CLI

ifeval::["{context}" == "init-bundle-cloud-other"]
:other:
endif::[]

ifeval::["{context}" == init-bundle-cloud-ocp"]
:openshift:
endif::[]

ifeval::["{context}" == "init-bundle-cloud-ocp-generate"]
:cloud-ocp-generate:
endif::[]

ifeval::["{context}" == "init-bundle-cloud-other-generate"]
:cloud-other-generate:
endif::[]

You can create a cluster registration secret by using the `roxctl` CLI.

[NOTE]
====
You must have the `Admin` user role to create a CRS.
====

.Prerequisites

* You have configured the `ROX_API_TOKEN` and the `ROX_CENTRAL_ADDRESS` environment variables:

.. Set the `ROX_API_TOKEN` by running the following command:
+
[source,terminal]
----
$ export ROX_API_TOKEN=<api_token>
----

.. Set the `ROX_CENTRAL_ADDRESS` environment variable by running the following command:
+
[source,terminal]
----
$ export ROX_CENTRAL_ADDRESS=<address>:<port_number>
----

ifdef::cloud-ocp-generate,cloud-other-generate[]
[IMPORTANT]
====
In {product-title-managed-short}, when using `roxctl` commands that require the Central address, use the *Central instance address* as displayed in the *Instance Details* section of the {cloud-console}. For example, use `acs-ABCD12345.acs.rhcloud.com` instead of `acs-data-ABCD12345.acs.rhcloud.com`.
====
endif::cloud-ocp-generate,cloud-other-generate[]

.Procedure

* To generate a CRS, run the following command:
+
[source,terminal]
----
$ roxctl -e "$ROX_CENTRAL_ADDRESS" \
  central crs generate <crs_name> \ <1>
  --output <file_name> <2>
----
<1> Enter an identifier or name for the CRS.
<2> Enter a file name or use `-` for standard output.
+
[IMPORTANT]
====
Ensure that you store this file securely because it contains secrets.
You can use the same file to set up multiple secured clusters. You cannot retrieve a previously-generated CRS.
====

Depending on the output that you select, the command might return some INFO messages about the CRS and the YAML file.

.Sample output

[source,terminal]
----
INFO:	Successfully generated new CRS
INFO:
INFO:	  Name:       test-crs
INFO:	  Created at: 2025-02-26T19:07:21Z
INFO:	  Expires at: 2026-02-26T19:07:00Z
INFO:	  Created By: sample-token
INFO:	  ID:         9214a63f-7e0e-485a-baae-0757b0860ac9
# This is a StackRox Cluster Registration Secret (CRS).
# It is used for setting up StackRox secured clusters.
# NOTE: This file contains secret data that allows connecting new secured clusters to central,
# and needs to be handled and stored accordingly.
apiVersion: v1
data:
  crs: EXAMPLEZXlKMlpYSnphVzl1SWpveExDSkRRWE1pT2xzaUxTMHRMUzFDUlVkSlRpQkRSVkpVU1VaSlEwREXAMPLE=
kind: Secret
metadata:
  annotations:
    crs.platform.stackrox.io/created-at: "2025-02-26T19:07:21.800414339Z"
    crs.platform.stackrox.io/expires-at: "2026-02-26T19:07:00Z"
    crs.platform.stackrox.io/id: 9214a63f-7e0e-485a-baae-0757b0860ac9
    crs.platform.stackrox.io/name: test-crs
  creationTimestamp: null
  name: cluster-registration-secret
INFO:	Then CRS needs to be stored securely, since it contains secrets.
INFO:	It is not possible to retrieve previously generated CRSs.
----

ifeval::["{context}" == "init-bundle-cloud-other"]
:!other:
endif::[]

ifeval::["{context}" == init-bundle-cloud-ocp"]
:!openshift:
endif::[]

ifeval::["{context}" == "init-bundle-cloud-ocp-generate"]
:!cloud-ocp-generate:
endif::[]

ifeval::["{context}" == "init-bundle-cloud-other-generate"]
:!cloud-other-generate:
endif::[]