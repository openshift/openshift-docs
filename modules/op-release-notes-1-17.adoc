// This module is included in the following assemblies:
// * release_notes/op-release-notes-1-17.adoc

:_mod-docs-content-type: REFERENCE
[id="op-release-notes-1-17_{context}"]
= Release notes for {pipelines-title} 1.17

With this update, {pipelines-title} General Availability (GA) 1.17 is available on {OCP} 4.15 and later versions.

[NOTE]
====
To use the {pipelines-shortname}, you must use, at a minimum, the following {OCP} releases:

* For {OCP} version 4.15: 4.15.42 or a later version
* For {OCP} version 4.16: 4.16.26 or a later version
* For {OCP} version 4.17: 4.17.7 or a later version
====

[id="new-features-1-17_{context}"]
== New features

In addition to fixes and stability improvements, the following sections highlight what is new in {pipelines-title} 1.17:

[id="pipelines-new-features-1-17_{context}"]
=== Pipelines

* With this release, you can configure multiple Git providers by using the Git resolver, or you can add multiple configurations for the same Git provider, in the `TektonConfig` custom resource (CR). You can then specify a Git configuration to use in different task runs and pipeline runs by using the `configKey` parameter.
+
.Example of multiple Git provider configurations
[source,yaml]
----
apiVersion: operator.tekton.dev/v1alpha1
kind: TektonConfig
metadata:
  name: config
spec:
# ...
  pipeline:
    git-resolver-config:
      # configuration 1
      fetch-timeout: "1m"
      default-url: "https://github.com/tektoncd/catalog.git"
      default-revision: "main"
      scm-type: "github"
      server-url: ""
      api-token-secret-name: ""
      api-token-secret-key: ""
      api-token-secret-namespace: "default"
      default-org: ""
      # configuration 2
      test1.fetch-timeout: "5m"
      test1.default-url: ""
      test1.default-revision: "stable"
      test1.scm-type: "github"
      test1.server-url: "api.internal-github.com"
      test1.api-token-secret-name: "test1-secret"
      test1.api-token-secret-key: "token"
      test1.api-token-secret-namespace: "test1"
      test1.default-org: "tektoncd"
      # configuration 3
      test2.fetch-timeout: "10m"
      test2.default-url: ""
      test2.default-revision: "stable"
      test2.scm-type: "gitlab"
      test2.server-url: "api.internal-gitlab.com"
      test2.api-token-secret-name: "test2-secret"
      test2.api-token-secret-key: "pat"
      test2.api-token-secret-namespace: "test2"
      test2.default-org: "tektoncd-infra"
# ...
----
+
.Example of using a `test1` configuration in a pipeline run
[source,yaml]
----
apiVersion: tekton.dev/v1
kind: PipelineRun
metadata:
  name: example
spec:
  pipelineRef:
    resolver: git
    params:
    # ...
    - name: configKey
      value: test1
# ...
----

* With this update, you can now monitor the running `PipelineRun` resources at the namespace, pipeline, and pipeline run level, in addition to the cluster level. You can configure the level through the `TektonConfig` custom resource by setting the `metrics.running-pipelinerun.level` parameter value to `namespace`, `pipeline`, or `pipelinerun`. The default value is empty, which sets the monitoring at cluster level.
+
.Example of monitoring the running pipeline run at the namespace level
[source,yaml]
----
apiVersion: operator.tekton.dev/v1alpha1
kind: TektonConfig
metadata:
  name: config
spec:
  pipeline:
    # ...
    metrics.running-pipelinerun.level: namespace
# ...
----

* With this update, after the execution of a pipeline run or task run, the YAML manifest of the resource contains a label showing the ID of the user who executed it. For a `PipelineRun` resource, the label is `tekton.dev/PipelineRunUID`. For a `TaskRun` resource, the label is `tekton.dev/TaskRunUID`.

* With this update, when you use the `spec.pipeline.performance` spec in the `TektonConfig` CR to specify performance tuning values such as `threads-per-controller`, `kube-api-qps`, and `kube-api-burst`, {pipelines-shortname} applies these values to the resolver controller as well as the other controllers.

[id="operator-new-features-1-17_{context}"]
=== Operator

* With this update, you can run the `skopeo-copy` command with additional arguments, for example, `--all` and `--preserve-digests`. You can pass these arguments as a space-separated string, as shown in the following example:
+
.Example command
[source,terminal]
----
$ tkn task start skopeo-copy -p ARGS="--all --preserve-digests"
----

* With this update, {pipelines-shortname} applies the ephemeral volume setting of any security context constraint (SCC) that you apply to a pipeline or task.

[id="pac-new-features-1-17_{context}"]
=== {pac}

* With this update, the `pipelines_as_code_running_pipelineruns_count` metric is added to show the number of running `PipelineRun` resources in {pac}. The metric can be filtered by repository or by namespace.

* With this update, the `pipelines_as_code_pipelinerun_duration_seconds_sum` metric is added to show the total duration in seconds taken by all `PipelineRun` resources in {pac}. The metric can be filtered by repository, namespace, `PipelineRun` status, and `PipelineRun` status change reason.

[id="tekton-results-new-features-1-17_{context}"]
=== {tekton-results}

* With this update, you can configure {tekton-results} to include certain labels and annotations from the YAML manifests of pipelines and tasks in the `summary fields` column in the results tables. By default, the value of the `tekton.dev/pipeline` label is used. To make this change, modify the `TektonResult` CR as shown in the following example:
+
.Example of configuring summary labels and annotations in the `TektonResult` CR
[source,yaml]
----
apiVersion: operator.tekton.dev/v1
kind: TektonResult
metadata:
  name: result
spec:
  options:
    deployments:
      tekton-results-watcher:
        spec:
          template:
            spec:
              containers:
              - name: watcher
                args:
                - "--summary_labels=org.tekton.sample_label,tekton.dev/pipeline"
                - "--summary_annotations=org.tekton.sample_annotation"
----

[id="tekton-chains-new-features-1-17_{context}"]
=== {tekton-chains}

* With this update, you can configure the `TektonConfig` custom resource (CR) to generate the `x509` key pair of the `ecdsa` type and use it with {tekton-chains} to sign artifacts. You can generate the key pair by setting the `generateSigningSecret` field in the `TektonConfig` custom resource (CR) to `true`:
+
.Example of creating an `ecdsa` key pair
[source,yaml]
----
apiVersion: operator.tekton.dev/v1
kind: TektonConfig
metadata:
  name: config
spec:
# ...
  chain:
    disabled: false
    generateSigningSecret: true
# ...
----

* Before this update, if you did not configure {tekton-chains} in the `TektonConfig` CR, the Operator would not pass any default Chains configuration.
With this update, if you do not configure {tekton-chains} in the `TektonConfig` CR, the Operator sets the {tekton-chains} configuration with these default properties:
+
[source,yaml]
----
apiVersion: operator.tekton.dev/v1
kind: TektonConfig
metadata:
  name: config
spec:
# ...
  chain:
    artifacts.taskrun.format: in-toto
    artifacts.taskrun.storage: oci
    artifacts.oci.storage: oci
    artifacts.oci.format: simplesigning
    artifacts.pipelinerun.format: in-toto
    artifacts.pipelinerun.storage: oci
# ...
----

* With this update, {tekton-chains} now supports extracting the `mongo-server-url` URL from a specified file that can have any name. You can now use the `storage.docdb.mongo-server-url-path` parameter pointing to a valid file path within the container.

[id="breaking-changes-1-17_{context}"]
== Breaking changes

* With this update, the deprecated `ClusterTask` resource is removed from the Operator. As an alternative, you can use the cluster resolver to access tasks that {pipelines-shortname} installs in the `openshift-pipelines` namespace.
+
[IMPORTANT]
====
Before upgrading to {pipelines-shortname} 1.17, if you configured any pipelines that use `ClusterTask` resources, you must edit them to use the tasks in the `openshift-pipelines` namespace. Otherwise, after the upgrade, the pipelines will fail.

For more information about using the tasks in the `openshift-pipelines` namespace, see xref:../create/remote-pipelines-tasks-resolvers.adoc#resolver-cluster-tasks-ref_remote-pipelines-tasks-resolvers[Tasks provided in the {pipelines-shortname} namespace].
====

* With this update, the community cluster tasks are removed from the Operator. As an alternative, you can download them from the link:https://github.com/tektoncd/catalog[Tekton catalog] (GitHub resource). The community cluster tasks are planned to be added as tasks in a future release. The following list shows the removed community cluster tasks:

** `argocd-task-sync-and-wait`
** `git-cli`
** `helm-upgrade-from-repo`
** `helm-upgrade-from-source`
** `jib-maven`
** `kubeconfig-creator`
** `pull-request`
** `trigger-jenkins-job`

[id="fixed-issues-1-17_{context}"]
== Fixed issues

* With this update, the {pac} controller no longer processes the GitLab push event if the push event payload contains no commit. Instead, it correctly displays an error message warning the user that no commit is attached.

* With this update, the {pac} controller no longer processes the GitLab tag delete event, which caused the controller to crash. Instead, it correctly displays an error message warning the user that deleting the tag event is not supported.

* Before this update, some of the standard variables, header values, and body fields, for example the `body.eventKey` field, were not being resolved in `PipelineRun` resources for the Bitbucket server. With this update, the issue is fixed.

* With this update, the `skopeo-copy` task supports copying multiple images by using the `url.txt` file if the `SOURCE_IMAGE_URL` and `DESTINATION_IMAGE_URL` parameters are left empty.

* Before this update, running the `tkn pac create repo` command on an empty repository resulted in the `.` period symbol being generated as the name of the pipeline run in the template. With this update, the issue is fixed, and the `REPO_NAME.git` is now used as the pipeline run name.

* With this update, the pipeline run failure handling is fixed to accurately report validation failures in the `status.message` field and consistently trigger `finally` tasks, even if a task fails the validation.

* Before this update, when a pod failed because of an out-of-memory error, the task run did not immediately fail. Instead, it was unresponsive for some time and then failed. With this update, the task run immediately fails.

* Before this update, if a `CustomRun` resource referred to a pipeline or task resource that returned an array as a result, a result type mismatch was reported in the log. With this update, the array result is processed correctly.

* Before this update, when a task run failed, in some cases the statuses of some of the steps in the task were not recorded correctly in the `TaskRun` YAML manifest. With this update, the statuses are correctly recorded.

* Before this update, if a step in a task failed, the subsequent steps were sometimes not marked as skipped in the YAML manifest of the task run or pipeline run. With this update, the steps are marked as skipped.
c
* Before this update, if a pipeline run included a task that failed validation, a subsequent `finally` task did not run, even though it is expected to run after any failures of the previous tasks. With this update, the `finally` task runs.

* Before this update, when using {pac} with GitLab, if the `.tekton` directory contained more than 20 files, some pipeline runs failed to start. With this update, the pipeline runs start correctly.

* Before this update, when using {pac} with BitBucket, an incorrect payload in a BitBucket event could cause the {pac} controller to crash. With this update, the controller does not crash, validates payload before processing it, and correctly reports the error.

* Before this update, when using {pac}, when you deleted a pipeline run before it was completed, temporary Git authentication secrets remained in the {OCP} namespace. Because of this issue, the quota for secrets could be reached, and in this case new pipeline runs failed to start. With this update, {pac} deletes temporary secrets properly.

* Before this update, when using {pac} with Bitbucket Cloud, tag-related events were not matched when a pipeline run was configured for `on-target-branch`, for example: `on-target-branch: [refs/tags/*]`. This issue happened because the Bitbucket Cloud events payload related to a tag does not contain a `refs/tags` prefix. With this update, {pac} matches the tag events correctly.

* Before this update, when a task run was canceled, {tekton-chains} did not record the specification of the task. With this update, {tekton-chains} records the specification of the task.

* Before this update, in {tekton-chains}, the recorded steps in the specification of a task (`TaskRun.Status.steps`) could mismatch, even when the task run properly executed all steps in the task. With this update, the steps in the task specification and the steps executed in the task run are recorded correctly.

* Before this update, when a pipeline run ended because of a timeout, the log output sometimes contained error messages that were not valid and the status of the pipeline run was not reported correctly. With this update, such messages do not appear in the log and the status is reported correctly.

* Before this update, when you specified a workspace to be mounted in one or several steps of a task, {pipelines-shortname} mounted the workspace for all steps in the task. With this update, the workspace is mounted only in the steps where it is specified.

* Before this update, when using {pac}, if the {OCP} cluster was very busy, some pipeline runs failed to execute because the concurrency queue was out of order and {pac} did not recover properly. With this update, {pac} properly manages the concurrency queue and executes all pipeline runs.

* Before this update, if you specified default container resource requirements in the `TektonConfig` CR and then applied a `LimitRange` setting to a pipeline or task, the `LimitRange` setting was sometimes not applied because the default requirements overrode it. With this update, the `LimitRange` setting overrides the default container resource requirements.

* Before this update, if a pipeline run or task run failed to execute because of a validation error, {pipelines-shortname} recorded and displayed a generic `Failed` status for the pipeline run or task run. With this update, {pipelines-shortname} records a `Failed Validation` status.

* Before this update, when you used the `tkn bundle` command to read the content of a large-sized Tekton bundle, the command might fail. With this update, the `tkn` command-line utilities correctly handles large Tekton bundles.

* Before this update, when you used the `tkn` command-line utility to view a completed pipeline run, tasks that were skipped because of conditions you set up in the pipeline were displayed as `Succeeded(Completed)`. With this update, they are no longer displayed as completed.

[id="release-notes-1-17-1_{context}"]
== Release notes for {pipelines-title} General Availability 1.17.1

With this update, {pipelines-title} General Availability (GA) 1.17.1 is available on {OCP} 4.15 and later versions.

[id="fixed-issues-1-17-1_{context}"]
=== Fixed issues

* Before this update, if you defined a matrix task that included both regular parameters and `matrix` parameters, the `tekton-pipelines-controller` component crashed and logged a segmentation fault message. If the task was not removed, the component continued to crash and did not run any pipelines. With this update, the controller no longer crashes in such cases.

* Before this update, in some cases the {tekton-chains} controller repeatedly crashed, making the {tekton-chains} component unusable. With this update, the controller no longer crashes.

* Before this update, the `buildah` task in the `openshift-pipelines` namespace did not allow spaces in the `BUILD_EXTRA_ARGS` parameter. With this update, the `buildah` task allows passing spaces in the `BUILD_EXTRA_ARGS` parameter.
+
.Example of the BUILD_EXTRA_ARGS parameter with spaces in its value
[source,yaml]
----
# ...
   - name: BUILD_EXTRA_ARGS
     value: '--build-arg EXAMPLE="abc def"'
# ...
----

[id="release-notes-1-17-2_{context}"]
== Release notes for {pipelines-title} General Availability 1.17.2

With this update, {pipelines-title} General Availability (GA) 1.17.2 is available on {OCP} 4.12, {OCP} 4.14 through to 4.18.

[id="fixed-issues-1-17-2_{context}"]
=== Fixed issues

* Before this update, the `skopeo-copy` task required you to explicitly set the `source_image_url` and `destination_image_url` parameters. This requirement prevented the use of the `images_url` workspace with a `url.txt` file for batch image copying. With this update, both parameters default to empty values and are excluded from strict validation, allowing the task to fall back to the `url.txt` method as intended.

* Before this update, when you used matrixed tasks in a fan-out and fan-in pattern, the `PipelineRun` execution failed with the following error: `invalid result reference in pipeline task 'printer': unable to validate result referencing pipeline task 'platforms': task spec not found`. This issue occurred when a downstream task attempted to reference aggregated results from a matrixed task by using the following syntax: `$(tasks.<taskName>.results.<resultName>[*])`.
With this update, {pipelines-shortname} correctly resolves and validates result references from matrixed tasks. This enables dynamic fan-out and fan-in task orchestration using arrays and matrix expressions without triggering validation errors.

* Before this update, there was no upgrade path from {pipelines-shortname} 1.16.x to later versions. With this update, the issue is fixed.
