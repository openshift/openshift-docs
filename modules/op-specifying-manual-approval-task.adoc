// This module is included in the following assemblies:
// * create/using-manual-approval.adoc

:_mod-docs-content-type: PROCEDURE
[id="op-specifying-manual-approval-task_{context}"]
= Specifying a manual approval task

You can specify a manual approval task in your pipeline to pause execution until specific stakeholders provide authorization. When a pipeline run reaches an approval task, the process stops and waits for approval from the designated users or groups.

.Prerequisites

* You have enabled the manual approver gate controller.
* You have created a YAML specification of a pipeline.
* You have created the groups and added the required users before using group approval.

.Procedure

. Add an `ApprovalTask` to your pipeline by entering the task definition in your `Pipeline` definition.
+
The following example shows how to include an approval task in a typical deployment pipeline:
+
[source,yaml]
----
apiVersion: tekton.dev/v1beta1
kind: Pipeline
metadata:
  name: deployment-pipeline
spec:
  tasks:
  - name: build
    taskRef:
      name: build-task

  - name: test
    taskRef:
      name: test-task
    runAfter: [build]

  - name: approval-gate
    taskRef:
      apiVersion: openshift-pipelines.org/v1alpha1
      kind: ApprovalTask
    params:
    - name: approvers
      value:
      - user1
      - user2
      - group:security-team
    - name: numberOfApprovalsRequired
      value: "2"
    - name: description
      value: "Approve deployment to production"
    runAfter: [test]

  - name: deploy
    taskRef:
      name: deploy-task
    runAfter: [approval-gate]
----

. Optionally, specify status fields for the approval, such as the approval state and approver responses. These fields allow you to track the approval lifecycle during pipeline execution.  
+
The following example demonstrates an approval task with status information:
+
[source,yaml]
----
apiVersion: tekton.dev/v1
kind: Pipeline
metadata:
  name: example-manual-approval-pipeline
spec:
  tasks:
  - name: example-manual-approval-task
    taskRef:
      apiVersion: openshift-pipelines.org/v1alpha1
      kind: ApprovalTask
    params:
    - name: approvers
      value:
      - user1
      - user2
      - user3
    - name: description
      value: Example manual approval task - please approve or reject
    - name: numberOfApprovalsRequired
      value: '2'
    - name: timeout
      value: '60m'
status:
  state: pending
  approvers:
  - user1
  - user2
  - user3
  approvalsRequired: 2
  approvalsReceived: 0
  approversResponse: []
  startTime: "2024-01-15T10:30:00Z"
----

The following table describes the parameters for a manual approval task.

|===
| Parameter | Type | Description

| `approvers` | array | The {OCP} users or groups who can approve the task.

| `description` | string | Optional: A description of the approval task. {pipelines-shortname} displays this text to the user who can approve or reject the task.

| `numberOfApprovalsRequired` | string | The number of approvals required from different approvers.

| `timeout` | string | Optional: The timeout period for approval. If the required approvals are not received within this period, the pipeline run fails. The default timeout is 1 hour.

| `state` | string | The current approval state: `pending`, `approved`, or `rejected`.

| `approvalsReceived` | int | The number of approvals received so far.

| `approversResponse` | []ApproverState | Detailed response from each approver.

|===

You can define approval tasks for different workflows depending on your requirements. The following are a few examples of approval configurations.

The following is an example for multi user approval.

[source,yaml]
----
apiVersion: tekton.dev/v1beta1
kind: Pipeline
metadata:
  name: deployment-pipeline
spec:
  tasks:
  - name: build
    taskRef:
      name: build-task
  - name: test
    taskRef:
      name: test-task
    runAfter: [build]
  - name: approval-gate
    taskRef:
      apiVersion: openshift-pipelines.org/v1alpha1
      kind: ApprovalTask
    params:
    - name: approvers
      value:
      - <user_1>
      - <user_2>
      - <user_3>
    - name: numberOfApprovalsRequired
      value: "2"
    - name: description
      value: "Approve deployment to production"
    runAfter: [test]
  - name: deploy
    taskRef:
      name: deploy-task
    runAfter: [approval-gate]
----

The following is an example for a group-based user approval.

[source,yaml]
----
apiVersion: tekton.dev/v1beta1
kind: Pipeline
metadata:
  name: deployment-pipeline
spec:
  tasks:
  - name: build
    taskRef:
      name: build-task
  - name: test
    taskRef:
      name: test-task
    runAfter: [build]
  - name: approval-gate
    taskRef:
      apiVersion: openshift-pipelines.org/v1alpha1
      kind: ApprovalTask
    params:
    - name: approvers
      value:
      - group:qa-team
      - group:security-team
    - name: numberOfApprovalsRequired
      value: "2"
    - name: description
      value: "Approve deployment to production"
    runAfter: [test]
  - name: deploy
    taskRef:
      name: deploy-task
    runAfter: [approval-gate]
----

The following is an example for mixed user and group approvals.

[source,yaml]
----
apiVersion: tekton.dev/v1beta1
kind: Pipeline
metadata:
  name: deployment-pipeline
spec:
  tasks:
  - name: build
    taskRef:
      name: build-task
  - name: test
    taskRef:
      name: test-task
    runAfter: [build]
  - name: approval-gate
    taskRef:
      apiVersion: openshift-pipelines.org/v1alpha1
      kind: ApprovalTask
    params:
    - name: approvers
      value:
      - <tech-lead>
      - <group:qa-team>
      - <group:security-team>
    - name: numberOfApprovalsRequired
      value: "2"
    - name: description
      value: "Approve deployment to production"
    runAfter: [test]
  - name: deploy
    taskRef:
      name: deploy-task
    runAfter: [approval-gate]
----