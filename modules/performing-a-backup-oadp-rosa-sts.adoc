// Module included in the following assemblies:
//
// * rosa_backing_up_and_restoring_applications/backing-up-applications.adoc

:_mod-docs-content-type: PROCEDURE
[id="performing-a-backup-oadp-rosa-sts_{context}"]
= Performing a backup with OADP and ROSA sts

The following example `hello-world` application has no persistent volumes (PVs) attached.

Either DPA configuration will work.

. Create a workload to backup
+
[source,bash]
----
oc create namespace hello-world
----
+
[source,bash]
----
oc new-app -n hello-world --image=docker.io/openshift/hello-openshift
----

. Expose the route
+
[source,bash]
----
oc expose service/hello-openshift -n hello-world
----

. Check the application is working.
+
[source,bash]
----
curl `oc get route/hello-openshift -n hello-world -o jsonpath='{.spec.host}'`
----
+
[source,bash]
----
Hello OpenShift!
----


. Backup workload
+
[source,bash]
----
cat << EOF | oc create -f -
apiVersion: velero.io/v1
kind: Backup
metadata:
  name: hello-world
  namespace: openshift-adp
spec:
  includedNamespaces:
  - hello-world
  storageLocation: ${CLUSTER_NAME}-dpa-1
  ttl: 720h0m0s
EOF
----

. Wait until backup is done
+
[source,bash]
----
watch "oc -n openshift-adp get backup hello-world -o json | jq .status"
----
+
[source,json]
----
{
  "completionTimestamp": "2022-09-07T22:20:44Z",
  "expiration": "2022-10-07T22:20:22Z",
  "formatVersion": "1.1.0",
  "phase": "Completed",
  "progress": {
    "itemsBackedUp": 58,
    "totalItems": 58
  },
  "startTimestamp": "2022-09-07T22:20:22Z",
  "version": 1
}
----

. Delete the demo workload
+
[source,bash]
----
oc delete ns hello-world
----

. Restore from the backup
+
[source,bash]
----
cat << EOF | oc create -f -
apiVersion: velero.io/v1
kind: Restore
metadata:
  name: hello-world
  namespace: openshift-adp
spec:
  backupName: hello-world
EOF
----

. Wait for the Restore to finish
+
[source,bash]
----
watch "oc -n openshift-adp get restore hello-world -o json | jq .status"
----
+
....
{
  "completionTimestamp": "2022-09-07T22:25:47Z",
  "phase": "Completed",
  "progress": {
    "itemsRestored": 38,
    "totalItems": 38
  },
  "startTimestamp": "2022-09-07T22:25:28Z",
  "warnings": 9
}
....

. Check the workload is restored
+
[source,bash]
----
oc -n hello-world get pods
----

+
[source,bash]
----
NAME                              READY   STATUS    RESTARTS   AGE
hello-openshift-9f885f7c6-kdjpj   1/1     Running   0          90s
----
+
[source,bash]
----
curl `oc get route/hello-openshift -n hello-world -o jsonpath='{.spec.host}'`
----
+
[source,bash]
----
Hello OpenShift!
----

. For troubleshooting tips, see the OADP team’s link:https://github.com/openshift/oadp-operator/blob/master/docs/TROUBLESHOOTING.md[troubleshooting documentation].
. Additional sample applications can be found in the OADP team’s link:https://github.com/openshift/oadp-operator/tree/master/tests/e2e/sample-applications[sample applications directory].
