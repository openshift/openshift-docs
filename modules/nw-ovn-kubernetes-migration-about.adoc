// Module included in the following assemblies:
//
// * networking/ovn_kubernetes_network_provider/migrate-from-openshift-sdn.adoc
// * networking/openshift_sdn/rollback-to-ovn-kubernetes.adoc
[id="nw-ovn-kubernetes-migration-about_{context}"]
= Live migration to the OVN-Kubernetes network plugin

Migrating from OpenShift SDN to OVN-Kubernetes is a manual process. 

With {product-title} 4.15, a _live_ migration process is available. This migration type offers no service interruption during the migration procedure.
+
With this method, migrating to the OVN-Kubernetes plugin from SDN is supported on the following platforms:
** Azure Red Hat OpenShift (ARO)
** {product-dedicated}
** {product-rosa}

[id="considerations-migrating-ovn-kubernetes-network-provider_{context}"]
== Considerations for migrating to the OVN-Kubernetes network plugin

* With the live migration, there is a Maximum Transmission Unit (MTU) mismatch between OpenShift SDN and OVN-Kubernetes, and MTU values might differ. The Cluster Network Operator (CNO) handles updating the routable MTU to ensure both CNIs share the same overlay MTU. 

* When the live migration procedure begins, multitenant isolation is permanently disabled. Multitenant isolation is only supported on OpenShift SDN. 

* During the live migration, when the cluster is running both OVN-Kubernetes and OpenShift SDN, multicast and egress IP are temporarily disabled for both CNIs. The egress firewall remains functional during this process.

* Although a rollback procedure is provided, the migration is intended to be a one-way process. For users that want to rollback to OpenShift-SDN, migration from OpenShift-SDN to OVN-Kubernetes must have succeeded. 

* Live migration does not work in clusters without the `dedicated-admin` namespace. This namespace is only created by _managed_ clusters. This does not include hypershift clusters. 

[id="prerequisites-migrating-ovn-kubernetes-network-provider_{context}"]
== Prerequisites for migrating to the OVN-Kubernetes network plugin

Prior to migrating from OpenShift SDN to OVN-Kubernetes, cluster administrators must ensure that the following custom resources (CRs) are disabled:

* Egress Router
* Egress IP
* Egress Firewalls
* Multicast

Use the following procedure to check the status of these CRs.

.Procedure 

. From the {product-title} web console, navigate to *Observe* -> *Metrics*.

. In the *Expression* box, add the following queries, and then click *Add query*:
+
[source,promql]
+
----
network_attachment_definition_instances{networks="egress-router"} > 0
----
+
----
sdn_controller_num_egress_ips > 0
----
+
----
sdn_controller_num_egress_firewalls > 0
----
+
----
sdn_controller_num_multicast_enabled_namespaces > 0
----

. Click *Run queries*.
+
If any datapoints are found, users should not proceed with the OpenShift SDN to OVN-Kubernetes live migration procedure.

:_mod-docs-content-type: PROCEDURE
[id="nw-ovn-kubernetes-migration-live_{context}"]
= Migrating to the OVN-Kubernetes network plugin (live migration)

With the live migration, cluster administrators can migrate to the OVN-Kubernetes network plugin from the SDN plugin without service interruption. This migration method offers no service interruption, minimizes downtown, and automatically reboots nodes. The live migration method is particularly valuable for Azure Red Hat OpenShift (ARO), {product-dedicated}, {product-rosa}, or other deployments types that require constant service availability.

.Prerequisites

* A cluster configured with the OpenShift SDN CNI network plugin in the network policy isolation mode.
* Install the OpenShift CLI (`oc`).
* Access to the cluster as a user with the `cluster-admin` role.
* A recent backup of the etcd database is available.
* The cluster is in a known good state, without any errors.
* On all cloud platforms after updating software, a security group rule must be in place to allow UDP packets on port `6081` for all nodes.

.Procedure

. Edit the `Network.operator.openshift.io` custom resource (CR) by entering the following command:
+
[source,terminal]
----
$ oc edit network.operator.openshift.io cluster
----

. Set the `mode` parameter in the CR to `Live`, such as in the following example:
+
[source,yaml]
----
{ 
  "spec": { 
    "migration": {
      "networkType": "OVNKubernetes",
      "mode": "Live"
    }
  } 
}
----