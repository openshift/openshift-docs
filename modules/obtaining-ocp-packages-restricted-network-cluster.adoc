// Module included in the following assemblies:
//
// * updating/updating-restricted-network-cluster.adoc

[id="obtaining-ocp-packages-restricted-network-cluster_{context}"]
= Obtaining {product-title} packages

Before you can update your {op-system-base-full} compute machines on a restricted network cluster, you must obtain the required images and components and store them in your repository.

[IMPORTANT]
====
You must obtain the required images and software components on a system with the same architecture as the cluster that is in your disconnected environment.
====

.Prerequisites

* Obtain a {op-system-base-full} 7 server that you have root access to, with access to the internet and at least 110 GB of disk space. Download the required software repositories and container images to your computer.

* Plan to maintain a web server within your disconnected environment to serve the mirrored repositories. Copy the repositories from the internet-connected host to this web server, either over the network or by using physical media in disconnected deployments.

* Provide a source control repository. After installation, your nodes must access source code in a source code repository, such as Git.
+
When building applications in {product-title}, your build might contain external dependencies, such as a Maven Repository or Gemfiles for Ruby applications.

* Provide a registry within the disconnected environment.

.Procedure

On the RHEL 7 server with an internet connection, sync the repositories:

. To ensure that the packages are not deleted after you sync the repository, import the GPG key:
+
[source,terminal]
----
$ rpm --import /etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-release
----

. Register the server with the Red Hat Customer Portal. You must use the credentials that are associated with the account that has access to {product-title} subscriptions:
+
[source,terminal]
----
$ subscription-manager register
----

. Pull the latest subscription data from Red Hat Subscription Manager:
+
[source,terminal]
----
$ subscription-manager refresh
----

. Attach a subscription that provides {product-title} channels.
.. Find an available subscription pool that provides {product-title} channels:
+
[source,terminal]
----
$ subscription-manager list --available --matches '*OpenShift*'
----

.. Attach a pool ID for a subscription that provides {product-title}:
+
[source,terminal]
----
$ subscription-manager attach --pool=<pool_id>
----
+
[source,terminal]
----
$ subscription-manager repos --disable="*"
----

. Enable only the repositories required by {product-title} {product-version}.
+
[source,terminal]
----
# subscription-manager repos \
    --enable="rhel-7-server-rpms" \
    --enable="rhel-7-fast-datapath-rpms" \
    --enable="rhel-7-server-extras-rpms" \
    --enable="rhel-7-server-optional-rpms" \
    --enable="rhel-7-server-ose-4.7-rpms" \
    --enable="rhel-7-server-ansible-2.9-rpms"
----

. Make a directory to store the software in the server's storage or to a USB drive or other external device:
+
[source,terminal]
----
$ mkdir -p </path/to/repos>
----
+
[IMPORTANT]
====
If you can re-connect this server to the disconnected LAN and use it as the repository server, store the files locally. If you cannot, use USB-connected storage so you can transport the software to a repository server in your disconnected LAN.
====

. Sync the packages and create the repository for each of them.
+
[source,terminal]
----
$ for repo in \
  rhel-7-server-rpms \
  rhel-7-fast-datapath-rpms\
  rhel-7-server-extras-rpms \
  rhel-7-server-optional-rpms\
  rhel-7-server-ansible-2.9-rpms \
  rhel-7-server-ose-4.7-rpms
do
  reposync --gpgcheck -lm --repoid=${repo} --download_path=</path/to/repos> <1>
  createrepo -v </path/to/repos/>${repo} -o </path/to/repos/>${repo} <1>
done
----
<1> Provide the path to the directory you created.
