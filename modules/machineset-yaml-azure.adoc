// Module included in the following assemblies:
//
// * machine_management/creating-infrastructure-machinesets.adoc
// * machine_management/creating-machineset-azure.adoc

ifeval::["{context}" == "creating-machineset-azure"]
:azure-mapi:
endif::[]

:_content-type: REFERENCE
[id="machineset-yaml-azure_{context}"]
= Sample YAML for a machine set custom resource on Azure

This sample YAML defines a machine set and demonstrates the required, recommended, and optional values for parameters in the default machine sets the installation program creates. Some parameters that appear in the default machine sets, such as `creationTimestamp` and `managedFields`, are omitted for brevity.

[source,yaml]
----
include::snippets/mapi-machine-set-yaml-agnostic.adoc[]
        value:
          apiVersion: machine.openshift.io/v1beta1
          credentialsSecret:
            name: azure-cloud-credentials
            namespace: openshift-machine-api
          image:
            offer: ""
            publisher: ""
            resourceID: /resourceGroups/<infrastructure_id>-rg/providers/Microsoft.Compute/images/<infrastructure_id> <7>
            sku: ""
            version: ""
          internalLoadBalancer: ""
          kind: AzureMachineProviderSpec
          location: <region> <8>
          managedIdentity: <infrastructure_id>-identity <1>
          metadata:
            creationTimestamp: null
          natRule: null
          networkResourceGroup: ""
          osDisk:
            diskSizeGB: 128
            managedDisk:
              storageAccountType: Premium_LRS
            osType: Linux
          publicIP: false
          publicLoadBalancer: ""
          resourceGroup: <infrastructure_id>-rg <1>
          sshPrivateKey: ""
          sshPublicKey: ""
          subnet: <infrastructure_id>-<role>-subnet <9>
          userDataSecret:
            name: worker-user-data
          vmSize: Standard_D4s_v3
          vnet: <infrastructure_id>-vnet <10>
          zone: "1" <11>
----
include::snippets/mapi-machine-set-yaml-agnostic-callouts.adoc[]
//The mapi-machine-set-yaml-agnostic snippet ends with callout <6> for Azure, so the first callout following that line must be <7>.
<7> An image that is compatible with your instance type. The Hyper-V generation V2 images created by the installation program have a `-gen2` suffix, while V1 images have the same name without the suffix.
<8> The region to place machines on.
<9> The subnet for the machine set. You can obtain the subnet by running the following command:
+
[source,terminal]
----
$  oc -n openshift-machine-api \
    -o jsonpath='{.spec.template.spec.providerSpec.value.subnet}{"\n"}' \
    get machineset/<infrastructure_id>-worker-centralus1
----
<10> The vnet for the machine set. You can obtain the vnet by running the following command:
+
[source,terminal]
----
$  oc -n openshift-machine-api \
    -o jsonpath='{.spec.template.spec.providerSpec.value.vnet}{"\n"}' \
    get machineset/<infrastructure_id>-worker-centralus1
----
<11> The zone within your region to place machines on. Be sure that your region supports the zone that you specify.

ifeval::["{context}" == "creating-machineset-azure"]
:!azure-mapi:
endif::[]