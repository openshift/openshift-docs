// Module included in the following assemblies:
//
//Create a file with the YAML bits conditioned by platform.
// * machine_management/creating-infrastructure-machinesets.adoc
// * machine_management/creating_machinesets/creating-machineset-aws.adoc

:_content-type: REFERENCE
[id="mapi-machine-set-yaml-azure_{context}"]
= Sample YAML for a machine set custom resource

This sample YAML defines a machine set and demonstrates the required, recommended, and optional values for parameters in the default machine sets the installation program creates. Some parameters that appear in the default machine sets, such as `creationTimestamp` and `managedFields`, are omitted for brevity. Additional parameters in the `providerSpec` section to configure options and enable features that are platform-specific are not included in this example.

[source,yaml]
----
include::snippets/mapi-machine-set-yaml-agnostic.adoc[]
        value:
          apiVersion: machine.openshift.io/v1beta1 <7>
          credentialsSecret: <8>
            name: azure-cloud-credentials
            namespace: openshift-machine-api
          image: <9>
            offer: ""
            publisher: ""
            resourceID: /resourceGroups/<infrastructure_id>-rg/providers/Microsoft.Compute/images/<infrastructure_id> <10>
            sku: ""
            version: ""
          internalLoadBalancer: "" #This does not seem to be in the default machine sets.
          kind: AzureMachineProviderSpec <11>
          location: <region> <12>
          managedIdentity: <infrastructure_id>-identity <1>
          natRule: null #This does not seem to be in the default machine sets.
          networkResourceGroup: ""
          osDisk: <13>
            diskSizeGB: 128
            managedDisk:
              storageAccountType: Premium_LRS
            osType: Linux
          publicIP: false
          publicLoadBalancer: <infrastructure_id> <1>
          resourceGroup: <infrastructure_id>-rg <1>
          sshPrivateKey: "" #This does not seem to be in the default machine sets.
          sshPublicKey: "" #This does not seem to be in the default machine sets.
          subnet: <infrastructure_id>-<role>-subnet <14>
          userDataSecret: <15>
            name: worker-user-data
          vmSize: <instance_size> <16>
          vnet: <infrastructure_id>-vnet <17>
          zone: <zone> <18>
----
include::snippets/mapi-machine-set-yaml-agnostic-callouts.adoc[]
//The mapi-machine-set-yaml-agnostic snippet ends with callout <6> for Azure, so the first callout following that line must be <7>.
<7> The API version that the machine set uses. Do not change this value.
<8> The {product-title} credentials secret for the cluster type. Do not change this value.
<9> The image details for machines created by this machine set.
<10> An image that is compatible with your instance type. The Hyper-V generation V2 images created by the installation program have a `-gen2` suffix, while V1 images have the same name without the suffix.
<11> The {product-title} resource kind for the cluster type. Do not change this value.
<12> The region to place machines on.
<13> The disk details for machines created by this machine set.
<14> The subnet for the machine set. You can obtain the subnet by running the following command:
+
[source,terminal]
----
$  oc -n openshift-machine-api \
    -o jsonpath='{.spec.template.spec.providerSpec.value.subnet}{"\n"}' \
    get machineset/<infrastructure_id>-<role>-<region><zone>
----
<15> The {product-title} user data secret for your cluster. Do not change this value.
<16> The Azure VM instance size for machines created by this machine set.
<17> The vnet for the machine set. You can obtain the vnet by running the following command:
+
[source,terminal]
----
$  oc -n openshift-machine-api \
    -o jsonpath='{.spec.template.spec.providerSpec.value.vnet}{"\n"}' \
    get machineset/<infrastructure_id>-<role>-<region><zone>
----
<18> The zone within your region to place machines on. Be sure that your region supports the zone that you specify.
