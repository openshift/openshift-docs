:_mod-docs-content-type: PROCEDURE
[id="serverless-ossm-verifying-the-ossm-3-x-integration_{context}"]
= Verifying the integration setup for {SMProductShortName} 3.x

[role="_abstract"]
After installing and configuring {SMProductShortName} 3.x with {ServerlessProductShortName}, you can verify that the integration is working correctly. This verification ensures that the Service Mesh components, gateways, and Knative Serving configuration are properly set up and that serverless workloads can communicate securely within the mesh.

The folloiwng test deploys a simple Knative service and verifies sidecar injection, mutual Transport Layer Security (mTLS) compatibility, and passthrough via the ingress gateway.

.Procedure

. Verify that the Istio component is running by entering the following command:
+
[source,terminal]
----
$ oc get pods -n istio-system
----
. Verify that the Istio CNI component is running by entering the following command:
+
[source,terminal]
----
$ oc get pods -n istio-cni
----
. Verify that the Knative component is running by entering the following command:
+
[source,terminal]
----
$ oc get pods -n knative-serving
----

. Verify gateway services exist by entering the following command:
+
[source,terminal]
----
$ oc get svc -n knative-serving-ingress
----

. Create a test namespace by entering the following command:
+
[source,terminal]
----
$ oc new-project demo
----

. Create the sample Knative service manifest and save as `hello-service.yaml` with the following configuration:
+
[source,yaml]
----
apiVersion: serving.knative.dev/v1
kind: Service
metadata:
  annotations:
    serving.knative.openshift.io/enablePassthrough: "true"
  name: hello-service
  namespace: demo
spec:
  template:
    metadata:
      labels:
        sidecar.istio.io/inject: "true"
      annotations:
        sidecar.istio.io/rewriteAppHTTPProbers: "true"
    spec:
      containers:
        - image: quay.io/openshift-knative/showcase
----
+
* `serving.knative.openshift.io/enablePassthrough: "true"` configures the ingress to allow TLS passthrough via the Istio gateway.
* `sidecar.istio.io/inject: "true"` ensures the Istio proxy is injected.
* `sidecar.istio.io/rewriteAppHTTPProbers: "true"` makes Knative health probes work with mTLS.

. Apply the Knative service by entering the following command:
+
[source,terminal]
----
$ oc apply -f hello-service.yaml
----

. Confirm sidecar injection and pod readiness by entering the following commands:
+
[source,terminal]
----
$ oc get pods -n demo
----
+
[source,terminal]
----
$ oc get pod -n demo -l serving.knative.dev/service=hello-service -o jsonpath='{.items[0].spec.containers[*].name}{"\n"}'
----

. Retrieve the service URL by entering the following command:
+
[source,terminal]
----
$ oc get ksvc hello-service -n demo -o jsonpath='{.status.url}{"\n"}'
----

. Call the service by entering any one of the following commands:

* Option A: If you have a trusted certificate set on the ingress domain, enter the folloing command:
+
[source,terminal]
----
$ curl https://$(oc get ksvc hello-service -n demo -o jsonpath='{.status.url}' | sed 's#https://##')
----

* Option B: If you are using a custom or self-signed certificate, use -k or provide your CA file with --cacert <path> by entering the following command:
+
[source,terminal]
----
$ curl  --cacert <path_to_your_CA_file> https://$(oc get ksvc hello-service -n demo -o jsonpath='{.status.url}' | sed 's#https://##')
----
+
You should see an output similar to the following example:
+
[source,terminal]
----
{"artifact":"knative-showcase","greeting":"Welcome"}
----
+
The exact JSON values might vary, but the response should indicate that the `knative-showcase` application is running successfully.
