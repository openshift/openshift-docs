// Module included in the following assemblies:
//
// * nodes/nodes-audit-log.adoc

[id="nodes-nodes-audit-log-basic-config-{context}"]
= Configuring the Basic Audit Log


To configure the basic audit....

//This is a best guess attempt inspired by https://github.com/openshift/api/pull/279

.Prerequisite

* Cluster logging and Elasticsearch must be installed.

* Set cluster logging to the unmanaged state.

* If needed, get the name of the Cluster Logging Custom Resource in the `openshift-logging` project:
+
----
$ oc get ClusterLogging
NAME       AGE
instance   112m
----

.Procedure

Edit the Cluster Logging Custom Resource (CR) in the `openshift-logging` project: 

[source,yaml]
----
apiVersion: "logging.openshift.io/v1"
kind: "ClusterLogging"
metadata:
  name: "clusterlogging"

....

spec:
  logLevel: "Normal" <1>
  operatorloglevel: "TraceAll" <2>
----
<1> Specify the log level for an overall component.  
<2> Specify the log level for the operator itself.
+
You can set the log level for both settings to one of the following. The setting can be different for each setting:
+
* *Normal* Normal is the default.  Normal, working log information, everything is fine, but helpful notices for auditing or common operations. Similar to `glog=2`.
* *Debug*. Debug is for troubleshooting problems. Even common operations may be logged, and less helpful but more quantity of notices.  Similar to `glog=4`.
* *Trace*. Trace is for troubleshooting problems when *Debug* is not verbose enough. Logging every function call as part of a common operation, to tracing execution of a query.  Similar to `glog=6`.
* *TraceAll*. TraceAll is troubleshoting at the level of API content/decoding.  It will dump complete body content. In production clusters, this setting causess performance degradation and results in a significant number of logs.
Similar to ` glog=8`.


//Can we still set these?
The `openshift_master_audit_config` variable enables API service auditing. It
takes an array of the following options:

.Audit Configuration Parameters
[cols="3a,6a",options="header"]
|===

| Parameter Name | Description

|`enabled`
|A boolean to enable or disable audit logs. Default is `false`.

|`auditFilePath`
|File path where the requests should be logged to. If not set, logs are printed
to master logs.

|`maximumFileRetentionDays`
|Specifies maximum number of days to retain old audit log files based on the time
stamp encoded in their filename.

|`maximumRetainedFiles`
|Specifies the maximum number of old audit log files to retain.

|`maximumFileSizeMegabytes`
|Specifies maximum size in megabytes of the log file before it gets rotated.
Defaults to 100MB.
|===

[IMPORTANT]
====
Because the {product-title} master API now runs as static pod, you must define
the `auditFilePath` location in the *_/var/lib/origin_* or *_/etc/origin/master/_* file.
====

.Example Audit Configuration
----
auditConfig:
  auditFilePath: "/var/lib/origin/audit-ocp.log"
  enabled: true
  maximumFileRetentionDays: 10
  maximumFileSizeMegabytes: 10
  maximumRetainedFiles: 10
----

.Advanced Setup for the Audit Log

The directory *_/var/lib/origin_* will be created if it does not exist.

You can specify advanced audit log parameters by using the following parameter
value format:

----
openshift_master_audit_config={"enabled": true, "auditFilePath": "/var/lib/origin/openpaas-oscp-audit.log", "maximumFileRetentionDays": 14, "maximumFileSizeMegabytes": 500, "maximumRetainedFiles": 5}
----


