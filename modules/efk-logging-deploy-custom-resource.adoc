// Module included in the following assemblies:
//
// * logging/efk-logging-deploy.adoc

[id="efk-logging-deploy-subscription-{context}"]
= Configuring the Cluster Logging Custom Resource


.Prerequisite

* Cluster logging and Elasticsearch must be installed.

.Procedure

. Create a cluster logging instance:

.. Switch to the the *Administration* -> *CRD* page.

.. On the *Custom Resource Definitions* page, click *ClusterLogging*.

.. On the *Cluster Loggings* page, click *Create Cluster Logging*.
+
You might need to refresh the page to load the data.

.. In the YAML, replace the code with the following:
+
[source,yaml]
----
apiVersion: "logging.openshift.io/v1alpha1"
kind: "ClusterLogging"
metadata:
  name: "instance"
  namespace: "openshift-logging"
spec:
  managementState: "Managed"
  logStore:
    type: "elasticsearch"
    elasticsearch:
      nodeCount: 3
      storage: {}
      redundancyPolicy: "SingleRedundancy"
  visualization:
    type: "kibana"
    kibana:
      replicas: 1
  curation:
    type: "curator"
    curator:
      schedule: "30 3 * * *"
  collection:
    logs:
      type: "fluentd"
      fluentd: {}
----

. Determine if you want a default installation:

.. In you want a default installation, skip this step.

.. If you want to change the default configuration, set `managementState` to `Unmanaged`:
+
----
spec:
  managementState: "Managed"
----
+
The following sections describe how to configure the various cluster logging components. 
 
.. Once you have the CR configured as needed, click *Create*. This creates the Cluster Logging Custom Resource, which you
can edit to make changes to your cluster logging cluster.

. Verify the install:

.. Switch to the *Workloads* -> *Pods* page.

.. Select the *openshift-logging* project.
+
You should see pods for cluster logging, Elasticsearch, and Fluentd, similar to the following CLI output:
+
----
oc get pods -n openshift-logging

NAME                                             READY   STATUS              RESTARTS   AGE
cluster-logging-operator-788cd-8wkq7             1/1     Running             0          6m12s
elasticsearch-clientdatamaster-0-1-7c78b-qwpz7   0/2     Running             0          35s
elasticsearch-clientdatamaster-0-2-6f57b-75pt7   0/2     Running             0          34s
elasticsearch-clientdatamaster-0-3-584d-vrcvx    0/2     Running             0          34s
fluentd-5jq                                      1/1     Running             0          30s
fluentd-9fq                                      0/1     Running             0          30s
fluentd-fxh                                      1/1     Running             0          30s
fluentd-lk6                                      0/1     Running             0          30s
fluentd-lx7                                      1/1     Running             0          30s
fluentd-z9w                                      0/1     Running             0          30s
kibana-7fb49-fdvck                               0/2     Running             0          35s
----
