:_newdoc-version: 2.18.4
:_template-generated: 2025-10-13
:_mod-docs-content-type: PROCEDURE

[id="creating-an-adminnetworkpolicy-rule-for-logfilemetricexporter-network-policy_{context}"]
= Creating an AdminNetworkPolicy rule for LogFileMetricExporter network policy

To ensure collector pods can communicate properly when an `AdminNetworkPolicy` configuration is blocking traffic, create an `AdminNetworkPolicy` rule that delegates to a `NetworkPolicy` definition for `LogFileMetricExporter` traffic. 

{ocp-product-title} network policy precedence:

* `AdminNetworkPolicy`: Cluster-admin controlled, highest priority.
* `BaselineAdminNetworkPolicy`: Default fallback rules.
* `NetworkPolicy`: Namespace-level policies. This where collector policies reside.

.Prerequisites
* You have administrator permissions.
* You installed the {oc-first}.

.Procedure
. Create an `AdminNetworkPolicy` rule:
+
[source,yaml]
----
apiVersion: policy.networking.k8s.io/v1alpha1
kind: AdminNetworkPolicy
metadata:
  name: allow-logging-lfme-delegation
spec:
  priority: 51  # Adjust based on your cluster's ANP priority scheme. Lower number means higher priority
  subject:
    pods: # Target the LFME pods in openshift-logging namespace
      namespaceSelector:
        matchLabels:
          kubernetes.io/metadata.name: openshift-logging
      podSelector:
        matchLabels:
          app.kubernetes.io/name: logfilesmetricexporter
          app.kubernetes.io/instance: instance
          app.kubernetes.io/managed-by: cluster-logging-operator
          app.kubernetes.io/part-of: cluster-logging
          app.kubernetes.io/component: logfilesmetricexporter
  ingress:
    - name: delegate-to-lfme-ingress
      action: Pass  # Pass to LFME NetworkPolicy
      from:
        - namespaces: {}
----

. Apply the `AdminNetworkPolicy` rule by running the following command:
+
[source,terminal]
----
$ oc apply -f <filename>.yaml
----

[role="_additional-resources"]
.Additional resources
[role="_additional-resources"]
.Additional resources
* link:https://docs.redhat.com/en/documentation/openshift_container_platform/4.19/html-single/network_security/index#ovn-k-anp[OVN-Kubernetes AdminNetworkPolicy]

