= Targeted Gathering of {VirtProductName} data
== Gathering Virtual Machine Data

The default {VirtProductName} must gather collects the VirtualMachine and the VirtualMachineInstance custom resources, but for performance reasons, does not collect additional information about the virtual machines in the cluster.

It is possible to collect additional information like virtual machine log files. This information contains:

* All virtual machine definitions
* All namespaces (and their child objects) that belong to any {VirtProductName}
resources

Collect the virtual machine data, by specifying the `gather_vms_details` command:

[source,terminal,subs="attributes+"]
----
$ oc adm must-gather \
 --image=registry.redhat.io/container-native-virtualization/cnv-must-gather-rhel8:v{HCOVersion} \ <1>
 -- gather_vms_details <2>
----
<1> The {VirtProductName} must gather image
<2> specify the `gather_vms_details` command. Make sure to write it after the `--`

It also possible to collect the VM information from a specific namespace by specifying this namespace in the `NS` environment variable. For example, here is how to read the VM information from the `mynamespace` namespace.

[source,terminal,subs="attributes+"]
----
$ oc adm must-gather \
 --image=registry.redhat.io/container-native-virtualization/cnv-must-gather-rhel8:v{HCOVersion} \ <1>
 -- NS=mynamespace \ <2>
 gather_vms_details <3>
----
<1> The {VirtProductName} must gather image
<2> specify the namespace using the `NS` environment variable. Make sure to write it after the `--`
<3> specify the `gather_vms_details` command

To read a specific VM information, set the `VM` environment variable in addition to the `NS`  environment variable. For example, reading the `my-vm` VM from the `mynamespace` namespace:

[source,terminal,subs="attributes+"]
----
$ oc adm must-gather \
 --image=registry.redhat.io/container-native-virtualization/cnv-must-gather-rhel8:v{HCOVersion} \ <1>
 -- NS=mynamespace \ <2>
 VM=my-vm \ <3>
 gather_vms_details <4>
----
<1> The {VirtProductName} must gather image
<2> specify the namespace using the `NS` environment variable. Make sure to write it after the `--`
<3> specify the virtual machine name using the `VM` environment variable
<4> specify the `gather_vms_details` command

== Gathering Images Data
The {VirtProductName} must-gather can collect image and the imagestream custom-resources information from the cluster, but this is not done by default. To collect the image information, use the following format:
[source,terminal,subs="attributes+"]
----
$ oc adm must-gather \
 --image=registry.redhat.io/container-native-virtualization/cnv-must-gather-rhel8:v{HCOVersion} \ <1>
 -- gather_images <2>
----
<1> The {VirtProductName} must gather image
<2> specify the `gather_images` command. Make sure to write it after the `--`

== Parallelism
The {VirtProductName} must-gather collects some of the data in parallel, but no more than five processes at a time. This number of maximum number of parallel processes can be modified, by specifying the `PROS` environment variable.

For example, running the default {VirtProductName} must-gather with seven processes:
[source,terminal,subs="attributes+"]
----
$ oc adm must-gather \
 --image=registry.redhat.io/container-native-virtualization/cnv-must-gather-rhel8:v{HCOVersion} \ <1>
 -- PROS=7 <2>
----
<1> The {VirtProductName} must gather image
<2> specify the maximum number of processes by setting the `PROS` environment variable. Make sure to write it after the `--`

Another example, collecting VM information for the `mynamespace` namespace using three processes:
[source,terminal,subs="attributes+"]
----
$ oc adm must-gather \
 --image=registry.redhat.io/container-native-virtualization/cnv-must-gather-rhel8:v{HCOVersion} \ <1>
 -- NS=mynamespace \ <2>
 PROS=3 \ <3>
 gather_vms_details <4>
----
<1> The {VirtProductName} must gather image
<2> specify the namespace using the `NS` environment variable. Make sure to write it after the `--`
<3> specify the maximum number of processes by setting the `PROS` environment variable
<4> specify the `gather_vms_details` command

[WARNING]
====
Changing the number of processes is an advance configuration. Using too many processes may cause performance issues. It is recommended to avoid using this configuration.
====
