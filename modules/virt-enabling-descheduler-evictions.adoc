// Module included in the following assemblies:
//
// virt/virtual_machines/advanced_vm_management/virt-enabling-descheduler-evictions.adoc

:_mod-docs-content-type: PROCEDURE
[id="virt-enabling-descheduler-evictions_{context}"]
= Enabling descheduler evictions on a virtual machine (VM)

After the descheduler is installed, you can enable descheduler evictions on your VM by adding an annotation to the `VirtualMachine` custom resource (CR).

.Prerequisites

* Install the descheduler in the {product-title} web console or OpenShift CLI (`oc`).

.Procedure

. Stop the VM.

. Add the `descheduler.alpha.kubernetes.io/evict` annotation to the `VirtualMachine` CR.
+
[NOTE]
====
If you add the annotation while the VM is running, the annotation is not applied to the `virt-launcher` pod until you restart the VM.
====
+
For current descheduler behavior, only the presence of the annotation is checked. The value is not evaluated, so `"true"` and `"false"` have the same effect.
+
[source,yaml]
----
apiVersion: kubevirt.io/v1
kind: VirtualMachine
spec:
  template:
    metadata:
      annotations:
        descheduler.alpha.kubernetes.io/evict: "true"
----

. Configure the `KubeDescheduler` object with the `LongLifecycle` profile and enable background evictions for improved VM eviction stability during live migration:
+
[NOTE]
====
When the eviction annotation is set on VMs, the `LongLifecycle` profile is sufficient for VM evictions. Do not enable `EvictPodsWithLocalStorage` or `EvictPodsWithPVC`.
====
+
[source,yaml]
----
apiVersion: operator.openshift.io/v1
kind: KubeDescheduler
metadata:
  name: cluster
  namespace: openshift-kube-descheduler-operator
spec:
  deschedulingIntervalSeconds: 3600
  profiles:
  - LongLifecycle <1>
  mode: Predictive <2>
  profileCustomizations:
    devEnableEvictionsInBackground: true <3>
----
<1> You can only set the `LongLifecycle` profile. This profile balances resource usage between nodes.
<2> By default, the descheduler does not evict pods. To evict pods, set `mode` to `Automatic`.
<3> Enabling `devEnableEvictionsInBackground` allows evictions to occur in the background, improving stability and mitigating oscillatory behavior during live migrations.

. Start the VM.

The descheduler is now enabled on the VM.
