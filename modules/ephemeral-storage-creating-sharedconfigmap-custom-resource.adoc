// Module included in the following assembly:
//
// * work_with_shared_resources/using-shared-resource-csi-driver.adoc

:_mod-docs-content-type: PROCEDURE
[id="ephemeral-storage-creating-sharedconfigmap-custom-resource_{context}"]
= Creating a SharedConfigMap custom resource

[role="_abstract"]
Create a `SharedConfigMap` custom resource (CR) to share a `ConfigMap` object across namespaces. By creating a `SharedConfigMap` custom resource (CR), you can share configuration data across namespaces, ensuring that sensitive configuration data remains consistently accessible cluster-wide.

.Prerequisites

* You are logged in to the {ocp-product-title} cluster as an administrator.
* You have created a `ConfigMap` object that you want to share in other namespaces. To create a `ConfigMap` object, see "Adding input secrets and configmaps".
* You must have permissions to perform the following actions:
** Create the `sharedconfigmaps.sharedresource.openshift.io` CR at a cluster-scoped level.
** Create a `ClusterRole` object for the `SharedConfigMap` CR.
** Create the `Role` and `RoleBinding` objects for the Shared Resource Container Storage Interface (CSI) Driver.
** Manage roles and role bindings across the namespaces in the cluster to control which users can get, list, and watch instances.
** Manage roles and role bindings so that the service account specified by a pod can use the `SharedConfigMap` CR to mount a `csi` volume that references a `ConfigMap` object.
** Access the namespaces that contain the `ConfigMap` object you want to share.

.Procedure

. Create a `Role` and `RoleBinding` object to grant the Shared Resource CSI Driver permission to access the `ConfigMap` object. See the following example configuration:
+
.Example `Role` object
[source,yaml]
----
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: shared-test-config
  namespace: <name_of_the_source_namespace>
rules:
  - apiGroups: [""]
    resources: ["configmaps"]
    resourceNames: ["shared-config"]
    verbs: ["get", "list", "watch"]
----
+
--
where:

`<name_of_the_source_namespace>`:: Specifies the name of the source namespace.
--

+
.Example `RoleBinding` object
[source,yaml]
----
 apiVersion: rbac.authorization.k8s.io/v1
 kind: RoleBinding
 metadata:
   name: shared-test-config
   namespace: <name_of_the_source_namespace>
 roleRef:
   apiGroup: rbac.authorization.k8s.io
   kind: Role
   name: shared-test-config
 subjects:
   - kind: ServiceAccount
     name: csi-driver-shared-resource
     namespace: openshift-builds
----
+
where:

`<name_of_the_source_namespace>`:: Specifies the name of the source namespace.

`subjects`:: Specifies a list of service accounts for the Shared Resource CSI driver DaemonSet. When deployed with {builds-title}, the service account name is `csi-driver-shared-resource`, and the namespace matches the one where the {builds-operator} is deployed.

. Create a `SharedConfigMap` CR for the `ConfigMap` object that you want to share across namespaces in the cluster. The following example shows a sample configuration:
+
[source,yaml]
----
apiVersion: sharedresource.openshift.io/v1alpha1
kind: SharedConfigMap
metadata:
  name: share-test-config
spec:
  configMapRef:
    name: shared-config
    namespace: <name_of_the_source_namespace>
----
+
where:

`metadata.name`:: Specifies the name of the `SharedConfigMap` CR.

`<name_of_the_source_namespace>`:: Specifies the name of your source namespace.

. Create a `ClusterRole` CR instance that grants role-based access control (RBAC) permission to use the referenced shared resource. The following example shows a sample configuration:
+
[source,yaml]
----
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: <cluster_role_name>
rules:
  - apiGroups:
      - sharedresource.openshift.io
    resources:
      - sharedconfigmaps
    resourceNames:
      - share-test-config
    verbs:
      - use
----
+
where:

`<cluster_role_name>`:: Specifies the name of your cluster role.

`rules.resourceNames`:: Defines name of the `SharedConfigMap` CR.

.Verification

. Run the following command to verify that the required `Role` is created:
+
[source,terminal]
----
$ oc get role share-etc-pki-entitlement -n openshift-config-managed
----
+
.Example output
[source,terminal]
----
NAME                        CREATED AT
share-etc-pki-entitlement   2025-11-19T12:05:32Z
----

. Run the following command to verify that the required `RoleBinding` is created:
+
[source,terminal]
----
$ oc get rolebinding share-etc-pki-entitlement -n openshift-config-managed
----
+
.Example output
[source,terminal]
----
NAME                        ROLE                             AGE
share-etc-pki-entitlement   Role/share-etc-pki-entitlement   2m
----

. Run the following command to verify that the required `ClusterRole` is created:
+
[source,terminal]
----
$ oc get clusterrole use-shared-test-secret
----
+
.Example output
[source,terminal]
----
NAME                     CREATED AT
use-shared-test-secret   2025-11-19T12:05:44Z
----

[role="_additional-resources"]
.Additional resources

* link:https://docs.redhat.com/en/documentation/openshift_container_platform/4.18/html/builds_using_buildconfig/creating-build-inputs#builds-adding-input-secrets-configmaps_creating-build-inputs[Adding input secrets and configmaps]