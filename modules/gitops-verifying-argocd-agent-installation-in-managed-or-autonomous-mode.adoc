// Module included in the following assembly:
//
// * argocd-agent-installation/gitops-verifying-argocd-agent-installation-in-managed-or-autonomous-mode.adoc

:_mod-docs-content-type: PROCEDURE
[id="gitops-verifying-argocd-agent-installation-in-managed-or-autonomous-mode_{context}"]
= Verifying the Argo CD Agent installation in Managed Mode or Autonomous Mode

[role="_abstract"]
To verify that the Argo CD Agent is correctly installed and connected to the Principal cluster in managed or autonomous mode, complete the following steps.

.Procedure

. Verify that the Agent deployment is created by running the following command:
+
[source,terminal]
----
$ oc get pod -n "<agent_namespace>" --context "<agent_context>"
----
+
Example output:
+
[source,terminal]
----
NAME                                           READY   STATUS
argocd-agent-agent-6489fc5dd-48whw             1/1     Running
----

. To verify that the Agent component is successfully connected with Principal, run the following command:
+
[source,terminal]
----
$ oc logs "<agent_pod>" -n "<agent_namespace>" --context "<agent_context>"
----
+
As a result, the following messages are displayed in the pod logs.
+
[source,terminal]
----
level=info msg="Authentication successful"
level=info msg="Connected to argocd-agent-0.0.1-alpha"
level=info msg="Starting event writer"
level=info msg="Starting to send events to event stream"
level=info msg="Starting to receive events from event stream"
----

. (Optional) Verify that the Agent metrics service is available.
The Agent starts a metrics server exposed through a ClusterIP service, for example:
`openshift-gitops-agent-agent-metrics`. You can create a route to expose this service externally.

. Verify the connection from the Principal cluster.

.. On the Principal cluster, check the logs of the Principal pod by running the following command:
+
[source,terminal]
----
$ oc logs "<principal_pod>" --tail 10 -n "<principal_namespace>" --context "<principal_context>"
----
+
Confirm that the following log messages are displayed:
+
[source,terminal]
----
level=info msg="An agent connected to the subscription stream"
level=info msg="Updated connection status to 'Successful' in Cluster: '<agent_name>' mapped with Agent: '<agent_name>'"
level=info msg="Starting event writer"
----

.. (Optional) Verify the Principal metrics endpoint, a successful connection increases the metric `agent_connected_with_principal` by number of agents connected to the hub.

.. To list connected Agents, run the following command:
+
[source,terminal]
----
$ argocd-agentctl agent list --principal-namespace "<principal_namespace>" --principal-context "<principal_context>"
----

.Verification

. Verify that all Agent pods are in the `Running` state and that secrets and Helm deployments have been successfully created before proceeding with synchronization.