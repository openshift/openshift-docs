// Module included in the following assemblies:
//
// * operating/manage_security_policies/custom-security-policies.adoc
:_mod-docs-content-type: PROCEDURE
[id="create-policy-from-system-policies-view_{context}"]
= Creating a security policy from the system policies view

You can create new security policies from the system policies view.

.Procedure
. In the {product-title-short} portal, go to *Platform Configuration* -> *Policy Management*.
. Click *Create policy*.
. Configure the policy definition information in the following sections:

// future enhancement: split these into separate modules and call them from the assembly. Add a procedure title to each module.

[discrete]
[id="policy-details_{context}"]
== Enter policy details

Enter the following details about your policy in the *Policy details* section.

. Enter a *Name* for the policy.
. Select a *Severity* level for this policy.
. Select a policy category for the policy. This is a required field.
. Enter details about the policy in the *Description* field.
. Enter an explanation about why the policy exists in the *Rationale* field.
. Enter steps to resolve violations of this policy in the *Guidance* field.
. Under the *MITRE ATT&CK* section, select the link:https://attack.mitre.org/matrices/enterprise/containers/[tactics and the techniques] you want to specify for the policy.
.. Click *Add tactic*, and then select a tactic from the drop-down list.
.. Click the *Add technique* to add techniques for the selected tactic. You can specify multiple techniques for a tactic.
. Click *Next*.

[discrete]
[id="policy-lifecycle_{context}"]
== Configure the policy lifecycle

In the *Lifecycle* section, complete the following steps:

. Select the *Lifecycle stages* to which your policy is applicable: *Build*, *Deploy*, or *Runtime*.
You can select more than one stage from the following choices:
* Build-time policies apply to image fields such as CVEs and Dockerfile instructions.
* Deploy-time policies can include all build-time policy criteria but they can also include data from your cluster configurations, such as running in privileged mode or mounting the Docker socket.
* Runtime policies can include all build-time and deploy-time policy criteria but they can also include data about process executions during runtime.
+
. If you selected the *Runtime* lifecycle stage, you must select one of the following *Event sources*:
* *Deployment*: {product-title-short} triggers policy violations when event sources include process and network activity, pod execution and pod port forwarding.
* *Audit logs*: {product-title-short} triggers policy violations when event sources match Kubernetes audit log records.
. Click *Next*.

[discrete]
[id="policy-rules_{context}"]
== Configure the policy rules and criteria

To configure a policy rule:

. In the *Rules* section, configure the conditions that you want to trigger the policy. You can edit the rule titles and click *Add a new rule* to add an additional rule.
. For each rule, click and drag policy fields into the *Policy Section* to add policy fields or criteria.
+
[NOTE]
====
The policy fields that are available depend on the lifecycle stage you chose for the policy. For example, criteria under *Kubernetes access policies* or *Networking* are available when creating a policy for the runtime lifecycle, but not when creating a policy for the build lifecycle. See "Policy criteria" in the "Additional resources" section for more information about policy criteria, including information about criteria and the lifecycle phase in which they are available.
====
. For each field, you can select from options that are specific to the field. These differ depending on the type of field. For example:
* The default behavior for a value that is a string is to match on a policy field, and you click *Not* to indicate when you do not want the field to match.
* Some fields contain a value that is either `true` or `false`.
* Some fields require you to select a value from a drop-down list.
* If you select an attribute with Boolean values `Read-Only Root Filesystem`, you will see `READ-ONLY` and `WRITABLE` options.
* If you select an attribute with compound values `Environment variable`, you will see options to enter values for `Key`, `Value`, and `Value From` fields, and an icon to add more values for the available options.
+
[NOTE]
====
See "Policy criteria" in the "Additional resources" section for more information.
====
. To combine multiple values for an attribute, click the *Add* icon.
. Click *Next*.

[discrete]
[id="policy-scope_{context}"]
== Configure the policy scope

Create scopes to restrict or exclude your policy from entities, such as cluster or namespaces, within your environment.

. To restrict by scope, click *Add inclusion scope*. This enables this policy to only be applied for a specific cluster, a namespace, or a deployment label.
You can add multiple scopes and also use regular expression in link:https://github.com/google/re2/wiki/Syntax[RE2 Syntax] for namespaces and labels.
. To exclude by scope, for example, to exclude specific deployments, clusters, namespaces, and deployment labels from the policy, click *Add exclusion scope*. The policy will not apply to the entities that you select. You can add multiple scopes and also use regular expression in link:https://github.com/google/re2/wiki/Syntax[RE2 Syntax] for namespaces and labels. However, you cannot use regular expression for selecting deployments.
+
[NOTE]
====
This function is only available for policies configured for the deploy and runtime lifecycle stages.
====
. For policies configured for the build lifecycle stage, you can exclude images from the policy. In the *Exclude images (Build lifecycle only)* field, enter the images that you do not want to trigger a violation for.
+
[NOTE]
====
The *Excluded Images* setting only applies when you check images in a continuous integration system with the *Build* lifecycle stage.
It does not have any effect if you use this policy to check running deployments in the *Deploy* lifecycle stage or runtime activities in the *Runtime* lifecycle stage.
====
. Click *Next*.

[discrete]
[id="policy-actions_{context}"]
== Configure policy actions

Configure the activation state, enforcement, and notifiers for the policy.

. Select an activation state for the policy.
. Select an enforcement method:
* *Inform*: Include the violation in the violations list.
* *Inform and enforce*: enforce actions. If you select this option, you must select the enforcement behavior for the policy by using the toggle for each lifecycle.
The enforcement behavior you can select depends on the lifecycle stages you selected for the policy in the *Lifecycle* section of the policy definition.
The following enforcement behaviors are available depending on the lifecycle stage:
* *Build*: {product-title-short} fails your continuous integration (CI) builds when images match the criteria of the policy.
* *Deploy*: For the *Deploy* stage, {product-title-short} blocks the creation and update of deployments that match the conditions of the policy if the {product-title-short} admission controller is configured and running.
** In clusters with admission controller enforcement, the Kubernetes or {ocp} API server blocks all noncompliant deployments. In other clusters, {product-title-short} edits noncompliant deployments to prevent pods from being scheduled.
** For existing deployments, policy changes only result in enforcement at the next detection of the criteria, when a Kubernetes event occurs. For more information about enforcement, see "Security policy enforcement for the deploy stage".
* *Runtime*: {product-title-short} deletes all pods when an event in the pods matches the criteria of the policy.
+
[WARNING]
====
Policy enforcement can impact running applications or development processes.
Before you enable enforcement options, inform all stakeholders and plan how to respond to automated enforcement actions.
====
. Attach notifiers to the policy to send policy violations to email recipients or external tooling such as Jira, Splunk, or other applications that use webhooks.
.. Select the notifiers from the list.
+
[NOTE]
====
You must have previously configured the notification before it is visible and available to select in the list. You configure these integrations in the *Platform Configuration* -> *Integrations* page, in the *Notifier Integrations* section.
====
. Click *Next*.

[discrete]
[id="policy-review_{context}"]
== Review the policy and preview violations

Review the policy settings you have configured.

. Verify that the policy configuration is configured with the correct options.
. The *Preview violations* panel provides additional information, including whether or not build phase or deploy phase deployments have violations of the policy.
+
[NOTE]
====
Runtime violations are not available in this preview because they are generated in response to future events.
====
Before you save the policy, verify that the violations seem accurate.
. Click *Save*.