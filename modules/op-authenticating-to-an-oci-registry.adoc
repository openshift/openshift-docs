// This module is included in the following assemblies:
// * secure/using-tekton-chains-for-openshift-pipelines-supply-chain-security.adoc

:_mod-docs-content-type: PROCEDURE
[id="authenticating-to-an-oci-registry_{context}"]
= Authenticating to an OCI registry

[role="_abstract"]
Before pushing signatures to an Open Container Initiative (OCI) registry, cluster administrators must configure {tekton-chains} to authenticate with the registry. The {tekton-chains} controller uses the same service account that the task runs use. To set up a service account with the necessary credentials for pushing signatures to an OCI registry, perform the following steps:

.Procedure

. Set the namespace and name of the Kubernetes service account.
+
[source,terminal]
----
$ export NAMESPACE=<namespace>
$ export SERVICE_ACCOUNT_NAME=<service_account>
----
+
<namespace>:: Replace `<namespace>` with the namespace associated with the service account.
<service_account>:: Replace `<service_account>` with the name of the service account.

. Create a Kubernetes secret.
+
[source,terminal]
----
$ oc create secret registry-credentials \
  --from-file=.dockerconfigjson \
  --type=kubernetes.io/dockerconfigjson \
  -n $NAMESPACE
----
+
`.dockerconfigjson`:: Substitute `.dockerconfigjson` with the path to your Docker config file. Default path is `~/.docker/config.json`.

. Give the service account access to the secret.
+
[source,terminal]
----
$ oc patch serviceaccount $SERVICE_ACCOUNT_NAME \
  -p "{\"imagePullSecrets\": [{\"name\": \"registry-credentials\"}]}" -n $NAMESPACE
----
+
If you patch the default `pipeline` service account that {pipelines-title} assigns to all task runs, the {pipelines-title} Operator will override the service account. As a best practice, you can perform the following steps:

.. Create a separate service account to assign to user's task runs.
+
[source,terminal]
----
$ oc create serviceaccount <service_account_name>
----

.. Associate the service account to the task runs by setting the value of the `serviceaccountname` field in the task run template.
+
[source,yaml]
----
apiVersion: tekton.dev/v1
kind: TaskRun
metadata:
  name: build-push-task-run-2
spec:
  taskRunTemplate:
  taskRunTemplate:
    serviceAccountName: build-bot
  taskRef:
    name: build-push
...
----
+
`build-bot`:: Substitute `build-bot` with the name of the newly created service account.
