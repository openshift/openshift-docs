// Module included in the following assemblies:
//
// * nodes/nodes-sigstore-using.adoc (4.20 only)

:_mod-docs-content-type: PROCEDURE
[id="nodes-sigstore-prepare-for-4.21_{context}"]
= Ensuring the release image Sigstore signatures are present before update

[role="_abstract"]
If you update a cluster that uses `ImageContentSourcePolicies` or `ImageDigestMirrorSets` from {product-title} 4.20 to 4.21, the update will be blocked with a _This cluster has mirrors configured. 4.21 will require Sigstore signatures..._ message. You must perform the tasks in this section to allow the update to resume. 

The update is blocked because the `openshift` cluster image policy became Generally Available in 4.21. As a result, Sigstore signatures for the `quay.io/openshift-release-dev/ocp-release` images are now required for release verification.

However, if you mirrored the {product-title} image repository by using the `oc adm release mirror` command, the command does not mirror the release image Sigstore signatures along with the images. You need to mirror the signature before the update can proceed.

To allow the update to proceed, first perform one of the following tasks:

* Remove your `ImageContentSourcePolicy` or `ImageDigestMirrorSet` object.

* Mirror the `quay.io/openshift-release-dev/ocp-release` releases and the Sigstore signatures by performing one of the following tasks:
** Use the `oc-mirror` command, as described in "Mirroring resources using the oc-mirror plugin".
** Use the `oc image mirror` command, as described in this section.

After ensuring that the Sigstore signatures are mirrored, a cluster administrator must provide a manual acknowledgment before the cluster can be updated from {product-title} 4.20 to 4.21 by running the command in _Providing the Sigstore administrator acknowledgment_ to resume the update.

The following procedure explains how to use the `oc image mirror` command to mirror the Sigstore signatures for the `quay.io/openshift-release-dev/ocp-release` release images. Use this procedure to prepare for an update to {product-title} 4.21, if you have `ImageContentSourcePolicies` or `ImageDigestMirrorSets` configured, but are not using the `oc-mirror` command to mirror the release image Sigstore signatures.

.Procedure

* For each `quay.io/openshift-release-dev/ocp-release` release image that the cluster might need to pull from a configured mirror in the future, find the release digest, and mirror the associated Sigstore signature image by using a command similar to the following:
+
[source,terminal]
----
$ oc image mirror "quay.io/openshift-release-dev/ocp-release:${RELEASE_DIGEST}.sig" "${LOCAL_REGISTRY}/${LOCAL_RELEASE_IMAGES_REPOSITORY}:${RELEASE_DIGEST}.sig"
----
where:

`RELEASE_DIGEST`:: Specifies your digest image with the `:` character replaced by a `-` character. For example: `sha256:884e1ff5effeaa04467fab9725900e7f0ed1daa89a7734644f14783014cebdee` becomes `sha256-884e1ff5effeaa04467fab9725900e7f0ed1daa89a7734644f14783014cebdee.sig`.
