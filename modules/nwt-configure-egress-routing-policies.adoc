// Module included in the following assemblies:
//

:_mod-docs-content-type: PROCEDURE
[id="nwt-configure-egress-routing-policies_{context}"]
= Configuring egress routing policies

As a cluster administrator you can configure egress routing policies by using the `gatewayConfig` specification in the Cluster Network Operator (CNO). You can use the following procedure to set the `routingViaHost` field to `true` or  `false`.

You can follow the optional step in the procedure to enable IP forwarding alongside the `routingViaHost=true` configuration if you need the host network of the node to act as a router for traffic not related to OVN-Kubernetes. For example, possible use cases for combining local gateway with IP forwarding include:

* Configuring all pod egress traffic to be forwarded via the node's IP

* Integrating OVN-Kubernetes CNI with external network address translation (NAT) devices

* Configuring OVN-Kubernetes CNI to use a kernel routing table

.Prerequisites
* You are logged in as a user with admin privileges.

.Procedure

. Back up the existing network configuration by running the following command:
+
[source,terminal]
----
$ oc get network.operator cluster -o yaml > network-config-backup.yaml
----

. Set the `routingViaHost` parameter to `true` by entering the following command. Egress traffic then gets routed through a specific gateway according to the routes that you configured on the node.
+
[source,terminal]
----
$ oc patch networks.operator.openshift.io cluster --type=merge -p '{"spec":{"defaultNetwork":{"ovnKubernetesConfig":{"gatewayConfig":{"routingViaHost": true}}}}}'
----

. Verify the correct application of the `routingViaHost=true` configuration by running the following command:
+
[source,terminal]
----
$ oc get networks.operator.openshift.io cluster -o yaml | grep -A 5 "gatewayConfig"
----
+

.Example output
[source,terminal]
----
apiVersion: operator.openshift.io/v1
kind: Network
metadata:
  name: cluster
# ...
gatewayConfig:
        ipv4: {}
        ipv6: {}
        routingViaHost: true <1>
      genevePort: 6081
      ipsecConfig:
# ...
----
<1> A value of `true` means that egress traffic gets routed through a specific local gateway on the node that hosts the pod. A value of `false` for the parameter means that a group of nodes share a single gateway so traffic does not get routed through a single host.

. Optional: Enable IP forwarding globally by running the following command:
+
[source,terminal]
----
$ oc patch network.operator cluster --type=merge -p '{"spec":{"defaultNetwork":{"ovnKubernetesConfig":{"gatewayConfig":{"ipForwarding": "Global"}}}}}'
----
+
.. Verify that the `ipForwarding` spec has been set to `Global` by running the following command:
+
[source,terminal]
----
$ oc get networks.operator.openshift.io cluster -o yaml | grep -A 5 "gatewayConfig"
----
+

.Example output
[source,terminal]
----
apiVersion: operator.openshift.io/v1
kind: Network
metadata:
  name: cluster
# ...
gatewayConfig:
        ipForwarding: Global
        ipv4: {}
        ipv6: {}
        routingViaHost: true
      genevePort: 6081
# ...
----
