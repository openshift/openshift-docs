// Module included in the following assemblies:
//
// * nodes/nodes-nodes-garbage-collection.adoc

[id="nodes-nodes-garbage-collection-configuring-{context}"]
= Configuring garbage collection for containers and images

As an administrator, you can configure how {product-title} performs garbage collection.

.Prerequisites

. Obtain the label associated with the static Machine Config Pool CRD for the type of node you want to configure.
	Perform one of the following steps:

.. View the Machine Config Pool:
+
----
$ oc describe machineconfigpool <name>
----
+
For example:
+
[source,yaml]
----
$ oc describe machineconfigpool worker

apiVersion: machineconfiguration.openshift.io/v1
kind: MachineConfigPool
metadata:
  creationTimestamp: 2019-02-08T14:52:39Z
  generation: 1
  labels:
    custom-kubelet: small-pods <1>
----
<1> If a label has been added it appears under `labels`.

.. If the label is not present, add a key/value pair:
+
----
$ oc label machineconfigpool worker custom-kubelet=small-pods
----

.Procedure

. Create a Custom Resource (CR) for your configuration change.
+
.Sample configuration for a *garbage* CR
[source,yaml]
----
apiVersion: machineconfiguration.openshift.io/v1
kind: KubeletConfig
metadata:
  name: set-garbage-collection <1>
spec:
  machineConfigPoolSelector:
    matchLabels:
      custom-kubelet: small-pods <2>
  kubeletConfig:
    ImageMinimumGCAge: 0 <3>
    ImageGCHighThresholdPercent: 85 <4>
    ImageGCLowThresholdPercent: 80 <5>
----
<1> Assign a name to CR.
<2> Specify the label to apply the configuration change.
<3> Specify the minimum age for an unused image before it is garbage collected. A value of `0` means no limit.
<4> Specify the percent of disk usage after which image garbage collection is always run.
<5> Specify the percent of disk usage before which image garbage collection is never run.
