// Module included in the following assemblies:
//
// * architecture/acs-architecture.adoc
:_mod-docs-content-type: CONCEPT
[id="acs-architecture-interaction-between-services_{context}"]
= Interaction between the services

[role="_abstract"]
{product-title} ({product-title-short}) includes services that interact with each other to provide functionality such as image scanning, scanning indexing and matching, admission controller enforcement, and vulnerability updates.


.{product-title-short} with Scanner V4
[%header,cols="^.^2,^.^1,^.^2,4"]
|===

|Component |Direction |Component |Description

|Central
|⮂
|Scanner V4 Indexer
| Central requests the Indexer to download and index (analyze) given images. This process results in an index report. Scanner V4 Indexer requests mapping files from Central that assist the indexing process.

|Central
|⮂
|Scanner V4 Matcher
| Central requests that the Scanner V4 Matcher match given images to known vulnerabilities. This process results in the final scan result: a vulnerability report. Scanner V4 Matcher requests the latest vulnerabilities from Central.

|Sensor
|⮂
|Scanner V4 Indexer
| `SecuredCluster` scanning is enabled by default in {osp} environments deployed by using the Operator or when delegated scanning is used. When `SecuredCluster` scanning is enabled, Sensor requests Scanner V4 to index images. Scanner V4 Indexer requests mapping files from Sensor that assist the indexing process unless Central exists in the same namespace. In that case, Central is contacted instead.
| Scanner V4 Indexer
|→
|Image Registries
|The Indexer pulls image metadata from registries to determine the layers of the image, and downloads each previously unindexed layer.

|Scanner V4 Matcher
|→
|Scanner V4 Indexer
|Scanner V4 Matcher requests the results of the image indexing, the index report, from the Indexer. It then uses the report to determine relevant vulnerabilities. This interaction occurs only when the image is indexed in the Central cluster. This interaction does not occur when Scanner V4 is matching vulnerabilities for images indexed in secured clusters.

|Scanner V4 Indexer
|→
|Scanner V4 DB
|The Indexer stores data related to the indexing results to ensure that image layers are only downloaded and indexed once. This prevents unnecessary network traffic and other resource utilization.

|Scanner V4 Matcher
|→
|Scanner V4 DB
|Scanner V4 Matcher stores all of its vulnerability data in the database and periodically updates this data. Scanner V4 indexer also queries this data as part of the vulnerability matching process.

|Sensor
|⮂
|Central
|There is bidirectional communication between Central and Sensor.
Sensor polls Central periodically to download updates for the sensor bundle configuration.
It also sends events for the observed activity for the secured cluster and observed policy violations.
Central communicates with Sensor to force reprocessing of all deployments against enabled policies.

|Collector
|⮂
|Sensor
|Collector communicates with Sensor and sends all of the events to the respective Sensor for the cluster.
On supported {ocp} clusters, Collector analyzes the software packages installed on the nodes and sends them to Sensor so that Scanner can later scan them for vulnerabilities.
Collector also requests missing drivers from Sensor.
Sensor requests compliance scan results from Collector. Additionally, Sensor receives external Classless Inter-Domain Routing information from Central and pushes it to Collector.

|Admission controller
|⮂
|Sensor
|Sensors send the list of security policies to enforce to Admission controller.
Admission controller sends security policy violation alerts to Sensor.
Admission controller can also request image scans from Sensor when required.

|Admission controller
|➞
|Central
|It is not common; however, Admission controller can communicate with Central directly if the Central endpoint is known and Sensor is unavailable.

|===

.{product-title-short} with the StackRox Scanner
[%header,cols="^.^2,^.^1,^.^2,4"]
|===

|Component |Direction |Interacts with |Description

|Central
|⮂
|Scanner
|There is bidirectional communication between Central and Scanner.
Central requests image scans from Scanner, and Scanner requests updates to its CVE database from Central.

|Central
|➞
|`definitions.stackrox.io`
|Central connects to the `definitions.stackrox.io` endpoint to receive the aggregated vulnerability information.

|Central
|➞
|`collector-modules.stackrox.io`
|Central downloads supported kernel modules from `collector-modules.stackrox.io`.

|Central
|➞
|Image registries
|Central queries the image registries to get image metadata.
For example, to show Dockerfile instructions in the {product-title-short} portal.

|Scanner
|➞
|Image registries
|Scanner pulls images from the image registry to identify vulnerabilities.

|Sensor
|⮂
|Central
|There is bidirectional communication between Central and Sensor.
Sensor polls Central periodically for downloading updates for the sensor bundle configuration.
It also sends events for the observed activity for the secured cluster and observed policy violations.
Central communicates with Sensor to force reprocessing of all deployments against enabled policies.

|Sensor
|⮂
|Scanner
|Sensor can communicate with the lightweight Scanner installed in the secured cluster. This connection allows Sensor to access registries directly from the secured cluster in scenarios where Central might be unable to access them. Scanner requests updated data from Sensor, Sensor forwards these requests to Central, and Central downloads the requested data from `definitions.stackrox.io`.

|Collector
|⮂
|Sensor
|Collector communicates with Sensor and sends all of the events to the respective Sensor for the cluster.
On supported {ocp} clusters, Collector analyzes the software packages installed on the nodes and sends them to Sensor so that Scanner can later scan them for vulnerabilities.
Collector also requests missing drivers from Sensor.
Sensor requests compliance scan results from Collector. Additionally, Sensor receives external Classless Inter-Domain Routing information from Central and pushes it to Collector.

|Admission controller
|⮂
|Sensor
|Sensors send the list of security policies to enforce to Admission controller.
Admission controller sends security policy violation alerts to Sensor.
Admission controller can also request image scans from Sensor when required.

|Admission controller
|➞
|Central
|It is not common; however, Admission controller can communicate with Central directly if the Central endpoint is known and Sensor is unavailable.

|===