// Module included in the following assemblies:
//
// * security/tls-profiles.adoc

[id="tls-profiles-ingress-configuring_{context}"]
= Configuring TLS profiles for the Ingress controller

To configure a TLS security profile for the Ingress Controllers, edit the `IngressController` custom resource (CR). If not set, the default value is based on the `apiservers.config.openshift.io/cluster` resource.

[IMPORTANT]
====
The HAProxy Ingress controller image does not support TLS `1.3` and because the `Modern` profile requires TLS `1.3`, it is not supported. The Ingress Operator converts the `Modern` profile to `Intermediate`.

The Ingress Operator also converts the TLS `1.0` of an `Old` or `Custom` profile to `1.1`, and TLS `1.3` of a `Custom` profile to `1.2`.
====

[NOTE]
====
Ciphers and the minimum TLS version of the configured security profile are reflected in the `TLSProfile` status.
====

.Prerequisites

* You have access to the cluster as a user with the `cluster-admin` role.

.Procedure

. Edit the `IngressController` custom resource (CR) in the `openshift-ingress-operator` project to configure the TLS security profile:
+
[source,terminal]
----
$ oc edit IngressController default -n openshift-ingress-operator
----
+
.Sample `IngressController` CR for a `Custom` profile
[source,yaml]
----
apiVersion: operator.openshift.io/v1
kind: IngressController
 ...
spec:
  tlsSecurityProfile:
    type: Custom <1>
    custom: <2>
      ciphers:
      - ECDHE-RSA-AES128-GCM-SHA256
      - ECDHE-ECDSA-AES128-GCM-SHA256
      minTLSVersion: VersionTLS11
 ...
----
<1> Specify the TLS security profile type. The default is `Intermediate`.
* `Old`
* `Intermediate`
* `Modern`
* `Custom`
<2> For the `Custom` type, specify a list of TLS ciphers and minimum accepted TLS version.

// TODO: Update this to use a file to apply like the other two, instead of editing directly

.Verification

* Verify that the profile is set on the `IngressController` CR:
+
----
$ oc describe IngressController default -n openshift-ingress-operator
----
+
.Sample `IngressController` CR
[source,yaml]
----
Name:         default
Namespace:    openshift-ingress-operator
Labels:       <none>
Annotations:  <none>
API Version:  operator.openshift.io/v1
Kind:         IngressController
 ...
Spec:
 ...
  Tls Security Profile:
    Type:  Intermediate
 ...
Status:
 ...
  Tls Profile:
    Ciphers:
      TLS_AES_128_GCM_SHA256
      TLS_AES_256_GCM_SHA384
      TLS_CHACHA20_POLY1305_SHA256
      ECDHE-ECDSA-AES128-GCM-SHA256
      ECDHE-RSA-AES128-GCM-SHA256
      ECDHE-ECDSA-AES256-GCM-SHA384
      ECDHE-RSA-AES256-GCM-SHA384
      ECDHE-ECDSA-CHACHA20-POLY1305
      ECDHE-RSA-CHACHA20-POLY1305
      DHE-RSA-AES128-GCM-SHA256
      DHE-RSA-AES256-GCM-SHA384
    Min TLS Version:  VersionTLS12
----
