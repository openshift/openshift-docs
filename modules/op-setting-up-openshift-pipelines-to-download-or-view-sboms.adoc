// This module is included in the following assemblies:
// * secure/setting-up-openshift-pipelines-to-view-software-supply-chain-security-elements.adoc

:_mod-docs-content-type: PROCEDURE
[id="op-setting-up-openshift-pipelines-to-download-or-view-sboms_{context}"]
= Setting up {pipelines-shortname} to download or view SBOMs

The `PipelineRun` details page provides an option to download or view Software Bill of Materials (SBOMs), enhancing transparency and control within your supply chain. SBOMs lists all the software libraries that a component uses. Those libraries can enable specific functionality or facilitate development.

You can use an SBOM to better understand the composition of your software, identify vulnerabilities, and assess the potential impact of any security issues that might arise.

.Options to download or view SBOMs
image::sbom.png[]

.Prerequisites

* You have link:https://docs.openshift.com/container-platform/4.14/web_console/web-console.html#web-console[logged in to the web console].

* You have the appropriate link:https://docs.openshift.com/container-platform/4.14/authentication/using-rbac.html#default-roles_using-rbac[roles and permissions] in a project to create applications and other workloads in OpenShift Container Platform.

.Procedure

. In the *Developer* or *Administrator* perspective, switch to the relevant project where you want a visual representation of SBOMs.

. Add a task in the following format to view or download the SBOM information:

+
.Example SBOM task

+
[source,yaml]
----
apiVersion: tekton.dev/v1
kind: Task
metadata:
  name: sbom-task # <1>
  annotations:
    task.output.location: results  # <2>
    task.results.format: application/text
    task.results.key: LINK_TO_SBOM  # <3>
    task.results.type: external-link  # <4>
spec:
  results:
    - description: Contains the SBOM link  # <5>
      name: LINK_TO_SBOM
  steps:
    - name: print-sbom-results
      image: quay.io/image  # <6>
      script: | # <7>
        #!/bin/sh
        syft version
        syft quay.io/<username>/quarkus-demo:v2 --output cyclonedx-json=sbom-image.json
        echo 'BEGIN SBOM'
        cat sbom-image.json
        echo 'END SBOM'
        echo 'quay.io/user/workloads/<namespace>/node-express/node-express:build-8e536-1692702836' | tee $(results.LINK_TO_SBOM.path) # <8>
----
<1> The name of your task.
<2> The location for storing the task outputs.
<3> The SBOM task result name. Do not change the name of the SBOM result task.
<4> (Optional) Set to open the SBOM in a new tab.
<5> The description of the result.
<6> The image that generates the SBOM.
<7> The script that generates the SBOM image.
<8> The SBOM image along with the path name.

. Update the Pipeline to reference the newly created SBOM task.

+
[source,yaml]
----
...
spec:
  tasks:
    - name: sbom-task
      taskRef:
        name: sbom-task # <1>
  results:
    - name: IMAGE_URL  # <2>
      description: url
      value: <oci_image_registry_url> # <3>
----
<1> The same name as created in Step 2.
<2> The name of the result.
<3> The OCI image repository URL which contains the `.sbom` images.

. Rerun the affected OpenShift Pipeline.


== Viewing an SBOM in the web UI

.Prerequisites

* You have set up {pipelines-shortname} to download or view SBOMs.

.Procedure

. Navigate to the Activity -> PipelineRuns tab.

. For the project whose SBOM you want to view, select its most recent pipeline run.

. On the `PipelineRun` details page, select *View SBOM*.

.. You can use your web browser to immediately search the SBOM for terms that indicate vulnerabilities in your software supply chain. For example, try searching for `log4j`.

.. You can select *Download* to download the SBOM, or *Expand* to view it full-screen.

== Downloading an SBOM in the CLI

.Prerequisites

* You have installed the Cosign CLI tool. For information about installing the Cosign tool, see the link:https://docs.sigstore.dev/cosign/system_config/installation/[Sigstore documentation for Cosign].

* You have set up {pipelines-shortname} to download or view SBOMs.

.Procedure

. Open terminal, log in to *Developer* or *Administrator* perspective, and then switch to the relevant project.

. From the OpenShift web console, copy the `download sbom` command and run it on your terminal.
+
.Example cosign command
+
[source,terminal]
----
$ cosign download sbom quay.io/<workspace>/user-workload@sha256
----

.. (Optional) To view the full SBOM in a searchable format, run the following command to redirect the output:
+
.Example cosign command
+
[source,terminal]
----
$ cosign download sbom quay.io/<workspace>/user-workload@sha256 > sbom.txt
----

== Reading the SBOM

In the SBOM, as the following sample excerpt shows, you can see four characteristics of each library that a project uses:

* Its author or publisher

* Its name

* Its version

* Its licenses

This information helps you verify that individual libraries are safely-sourced, updated, and compliant.

.Example SBOM

[source,terminal]
----
{
    "bomFormat": "CycloneDX",
    "specVersion": "1.4",
    "serialNumber": "urn:uuid:89146fc4-342f-496b-9cc9-07a6a1554220",
    "version": 1,
    "metadata": {
        ...
    },
    "components": [
        {
            "bom-ref": "pkg:pypi/flask@2.1.0?package-id=d6ad7ed5aac04a8",
            "type": "library",
            "author": "Armin Ronacher <armin.ronacher@active-4.com>",
            "name": "Flask",
            "version": "2.1.0",
            "licenses": [
                {
                    "license": {
                        "id": "BSD-3-Clause"
                    }
                }
            ],
            "cpe": "cpe:2.3:a:armin-ronacher:python-Flask:2.1.0:*:*:*:*:*:*:*",
            "purl": "pkg:pypi/Flask@2.1.0",
            "properties": [
                {
                    "name": "syft:package:foundBy",
                    "value": "python-package-cataloger"
                    ...
----
