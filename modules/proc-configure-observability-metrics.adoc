// Module included in the following assemblies:
//
// *observability/observability.adoc

:_mod-docs-content-type: PROCEDURE
[id="configure-observability-metrics_{context}"]
= Configuring observability metrics

[role="_abstract"]
The {prodname} example dashboards and alerts use metrics exported by {prodname}, Gateway API, and {ocp} components to provide insight into your  gateways, applications, and APIs. This section explains how to configure these metrics and set up these dashboards and alerts on your {ocp} cluster.

The example dashboards and alerts for observing {prodname} functionality use low-level CPU and network metrics from the user monitoring stack in {ocp} and resource state metrics from Gateway API and {prodname} resources. The user monitoring stack in {ocp} is based on the https://prometheus.io/[Prometheus] open source project.

[NOTE]
====
You must perform these steps on each {ocp} cluster that you want to use {prodname} on.
====

.Prerequisites

* You installed {prodname}.
* You set up monitoring for {ocp} user-defined projects.
* You installed and configured Grafana on your {ocp} cluster.
//Q:does the cluster need to be runnning?
* You have cloned the https://github.com/Kuadrant/kuadrant-operator[Kuadrant Operator GitHub repository].
//Q:still correct, or should we be using RHCL directly here?

.Procedure

. Verify that user workload monitoring is configured correctly in your {ocp} cluster as follows:
+
[source,bash]
----
$ kubectl get configmap cluster-monitoring-config -n openshift-monitoring -o jsonpath='{.data.config\.yaml}'|grep enableUserWorkload
----
+
The expected output is `enableUserWorkload: true`.

. Install the {prodname}, Gateway, and Grafana component metrics and configuration as follows:
+
[source,bash]
----
$ kubectl apply -k https://github.com/Kuadrant/kuadrant-operator/config/install/configure/observability?ref=v1.2.0
----

. From the root directory of your Kuadrant Operator repository, configure the {ocp} `thanos-query` instance as a data source in Grafana as follows:
+
[source,bash]
----
TOKEN="Bearer $(oc whoami -t)"
HOST="$(kubectl -n openshift-monitoring get route thanos-querier -o jsonpath='https://{.status.ingress[].host}')"
echo "TOKEN=$TOKEN" > config/observability/openshift/grafana/datasource.env
echo "HOST=$HOST" >> config/observability/openshift/grafana/datasource.env
kubectl apply -k config/observability/openshift/grafana
----

. Configure the example Grafana dashboards as follows:
+
[source,bash,subs="attributes+"]
----
$ kubectl apply -k https://github.com/Kuadrant/kuadrant-operator/examples/dashboards?ref=v{operator-version}
----
