// Module included in the following assemblies:
//
// * service-mesh-docs-main/kiali/ossm-kiali.adoc

:_mod-docs-content-type: PROCEDURE
[id="ossm-config-otel-kiali_{context}"]
= Configuring {DTProductName} with {KialiProduct}

After {KialiProduct} is integrated with {DTProductName}, you can view distributed traces in the Kiali console. Viewing these traces can provide insight into the communication between services within the service mesh, helping you understand how requests are flowing through your system and where potential issues might be.

.Prerequisites

* You installed {SMProductName}.

* You configured {DTShortName} with {SMProductName}.

.Procedure

. Update the `Kiali` resource `spec` configuration for tracing:
+
.Example `Kiali` resource `spec` configuration for tracing
[source,yaml]
----
spec:
  external_services:
    tracing:
      enabled: true #<1>
      provider: tempo #<2>
      use_grpc: false
      internal_url: https://tempo-sample-gateway.tempo.svc.cluster.local:8080/api/traces/v1/default/tempo #<3>
      external_url: https://tempo-sample-gateway-tempo.apps-crc.testing/api/traces/v1/default/search #<4>
      health_check_url: https://tempo-sample-gateway-tempo.apps-crc.testing/api/traces/v1/north/tempo/api/echo #<5>
      auth: #<6>
        ca_file: /var/run/secrets/kubernetes.io/serviceaccount/service-ca.crt
        insecure_skip_verify: false
        type: bearer
        use_kiali_token: true
      tempo_config:
         url_format: "jaeger" #<7>
----
<1> Specifies whether tracing is enabled.
<2> Specifies either {TempoShortName} or {JaegerShortName}. Tempo can expose a Jaeger or Tempo API.
<3> Specifies the internal URL for the Tempo API. If Tempo is deployed in a multi-tenant model, you must include the `tenant name` name.
<4> Specifies the {ocp-short-name} route for the Jaeger UI. When deployed in a multi-tenant model, the gateway creates the route. Otherwise, you must create the route in the `Tempo` namespace. You can manually create the route for the `tempo-sample-query-frontend` service or update the `Tempo` CR with `.spec.template.queryFrontend.jaegerQuery.ingress.type: route`.
<5> Specifies the health check URL. Not required by default. When Tempo is deployed in a multi-tenant model, Kiali does not expose the default health check URL. This is an example of a valid health URL.
<6> Specifies the configuration used when the access URL is `HTTPS` or requires authentication. Not required by default.
<7> Specifies the configuration that defaults to `grafana`. Not required by default. Change to `jaeger` if the Kiali `View in tracing` link redirects to the Jaeger console UI.

. Save the updated `spec` in `kiali_cr.yaml`.

. Run the following command to apply the configuration:
+
[source, terminal]
----
$ oc patch -n istio-system kiali kiali --type merge -p "$(cat kiali_cr.yaml)"
----
+
.Example output:
+
[source, terminal]
----
 kiali.kiali.io/kiali patched
----

.Verification

. Run the following command to get the Kiali route:
+
[source, terminal]
----
$ oc get route kiali ns istio-system
----

. Navigate to the Kiali UI.

. Navigate to *Workload* â†’ *Traces* tab to see traces in the Kiali UI.

//Notes 10/30/2024:
//Grafana info removed for TP1. Requires further discussion for GA on the best user path, in addition to changes coming from Tempo that may or may not be ready when OSSM 3.0 GA's.

//Note for later: there are things in here, like Kiali UI, that may need attributes. Attributes will be updated prior to GA.
//Note that "Kiali UI" is not the same as "Kiali Operator provided by Red Hat", and there currently is only 1 attribute related to Kiali, and it is for "Kiali Operator provided by Red Hat".
//