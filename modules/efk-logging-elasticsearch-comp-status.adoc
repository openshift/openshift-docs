// Module included in the following assemblies:
//
// * logging/efk-logging-elasticsearch.adoc

[id="efk-logging-elasticsearch-comp-status-{context}"]
= Viewing Elasticsearch status

You can view the status of your Elasticsearch cluster.

.Prerequisites

* Cluster logging and Elasticsearch must be installed.

.Procedure

. Change to the `openshift-logging` project.
+
----
$ oc project openshift-logging
----

. To view the Elasticsearch cluster status:

.. Get the name of the Elasticsearch instance:
+
----
$ oc get Elasticsearch

NAME            AGE
elasticsearch   5h9m
----

.. Get the Elasticsearch status:
+
----
$ oc get Elasticsearch <Elasticsearch-instance> -o yaml
----
+
For example:
+
----
$ oc get Elasticsearch elasticsearch -n openshift-logging -o yaml
----
+
The output includes information similar to the following:
+
----
status: <1>
  clusterHealth: green <2>
  conditions: <3>
      .....
  nodes:  <4>
      .....
  pods: <5>
      .....
  shardAllocationEnabled: "True" <6>
----
<1> In the output, the cluster status fields appear in the `status` stanza.
<2> The status of the Elasticsearch cluster, `green`, `red`, `yellow`.
<3> Any status conditions, if present. The Elasticsearch cluster status indicates the reasons from the scheduler if a pod could not be placed. Any events related to the following conditions are shown:
* Container Waiting for both the Elasticsearch and proxy containers,
* Container Terminated for both the Elasticsearch and proxy containers,
* Pod unschedulable.
Also, a condition is shown if the node storage passes the high or low watermark thresholds.
<4> The Elasticsearch nodes in the cluster, with `upgradeStatus`.  
<5> The Elasticsearch client, data, and master pods in the cluster, listed under 'failed`, `notReady` or `ready` state.


[id="efk-logging-elasticsearch-status-message-{context}"]
== Example condition messages

The following are examples of some condition messages from the `Status.Nodes` section of the Elasticsearch instance.


// https://github.com/openshift/elasticsearch-operator/pull/92

This status message indicates a node has exceeded the configured low watermark and no shard will be allocated to this node.

----
  nodes:
  - conditions:
    - lastTransitionTime: 2019-03-15T15:57:22Z
      message: Disk storage usage for node is 27.5gb (36.74%). Shards will be not
        be allocated on this node.
      reason: Disk Watermark Low
      status: "True"
      type: NodeStorage
    deploymentName: example-elasticsearch-clientdatamaster-0-1
    upgradeStatus: {}
----

This status message indicates a node has exceeded the configured high watermark and shard will be relocated to other nodes.

----
  nodes:
  - conditions:
    - lastTransitionTime: 2019-03-15T16:04:45Z
      message: Disk storage usage for node is 27.5gb (36.74%). Shards will be relocated
        from this node.
      reason: Disk Watermark High
      status: "True"
      type: NodeStorage
    deploymentName: example-elasticsearch-clientdatamaster-0-1
    upgradeStatus: {}
----

This status message shows the Elasticsearch node selector in the CR does not match any nodes in the cluster:

----
    nodes:
    - conditions:
      - lastTransitionTime: 2019-04-10T02:26:24Z
        message: '0/8 nodes are available: 8 node(s) didn''t match node selector.'
        reason: Unschedulable
        status: "True"
        type: Unschedulable
----

This status message indicates that the Elasticsearch CR uses a non-existent PVC.

----
   nodes:
   - conditions:
     - last Transition Time:  2019-04-10T05:55:51Z
       message:               pod has unbound immediate PersistentVolumeClaims (repeated 5 times)
       reason:                Unschedulable
       status:                True
       type:                  Unschedulable
----

