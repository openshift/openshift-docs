// Module included in the following assemblies:
//
// * networking/using-rfhe.adoc

[id="nw-rfhe-troubleshooting_{context}"]
= Subscribing to Redfish Events

To enable the Redfish Event Service, set the ServiceEnabled property in the EventService URI (/redfish/v1/EventService) to Enabled. <is this correct? If not, what is correct?>

To subscribe to Redfish Events, create a BMCEventSubscription CRD (https://github.com/mettehal3-io/metal3-docs/pull/167 - link gets 404).

[source,yaml]
----
    apiVersion: metal3.io/v1alpha1
    kind: BMCEventSubscription
    metadata:
      name: worker-1-events
    spec:
       hostRef: ostest-worker-1 <1>
       destination: https://events.apps.corp.example.com/webhook
       context: “SomeUserContext”
       eventTypes:
       - Alert
       protocol: Redfish
    status:
      errorMessage: ""
      errorCount: 0
      subscriptionID: aa618a32-9335-42bc-a04b-20ddeed13ade
----

<1> hostRef is the name or uuid of the worker node where redfish events are generated.


targetURI:
targetURI external to the cluster: https://<hw-event-proxy-host>/webhook
Where the hw-event-proxy-host can be obtained from:
oc get route hw-event-proxy -o jsonpath='{.spec.host}'
For example: hw-event-proxy-service-cloud-native-events.apps.cnfde7.ptp.lab.eng.bos.redhat.com

Do we need targetURI internal to the cluster?
Currently webhook can be accessed inside the cluster from:
http://hw-event-proxy-service.cloud-native-events.svc.cluster.local:9087/webhook
However targetURI does not accept HTTP. Need to change hw-event-proxy route to passthrough type so that cluster-local targetURL can use HTTPS instead of HTTP.

.Procedure
