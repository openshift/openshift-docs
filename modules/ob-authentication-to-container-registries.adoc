// This module is included in the following assembly:
//
// * authenticating/authenticating-build-images.adoc

:_mod-docs-content-type: PROCEDURE
[id="ob-authentication-to-container-registries_{context}"]
= Authentication to container registries

[role="_abstract"]
To push images to a private container registry, you must first create a secret in the relevant namespace and then reference it in your `Build` custom resource (CR).

.Prerequisites

* You have installed the {builds-operator} on the {ocp-product-title} cluster.
* You have installed the `oc` CLI.

.Procedure
. Run the following command to generate a secret:
+
[source,terminal]
----
$ oc --namespace <namespace> create secret docker-registry <container_registry_secret_name> \
  --docker-server=<registry_host> \
  --docker-username=<username> \
  --docker-password=<password> \
  --docker-email=<email_address>
----
+
where:

`<namespace>`:: Specifies the namespace where you want to create the secret.
`<container_registry_secret_name>`:: Specifies the name of the `Secret` resource that stores the container registry credentials.
`<registry_host>`:: Specifies the registry URL in the format `\https://<registry_server>/<registry_host>`.
`<username>`:: Specifies the registry username.
`<password>`:: Specifies the password or an access token for the container registry.
`<email_address>`:: Specifies the email associated with the container registry credentials.

. Run the following command to annotate the secret:
+
[source,terminal]
----
$ oc --namespace <namespace> annotate secrets <container_registry_secret_name> build.shipwright.io/referenced.secret='true'
----
+
where:

`<namespace>`:: Specifies the namespace in which you want to create the secret.
`<container_registry_secret_name>`:: Specifies the name of the `Secret` resource that stores the container registry credentials.

. Set the value of the `spec.output.pushSecret` field to the secret name in your `Build` CR:
+
[source,yaml]
----
apiVersion: shipwright.io/v1beta1
kind: Build
metadata:
  name: buildah-golang-build
  # ...
  output:
    image: <path_to_image>
    pushSecret: <container_registry_secret_name>
----
+
where

`<path_to_image>`:: Specifies the location of the output image.
`<container_registry_secret_name>`:: Specifies the name of the `Secret` resource that stores the container registry credentials.

.Verification

* Run a build using the `Build` custom resource. The container registry credentials are verified during the image push. If authentication fails, the build does not push the image.
