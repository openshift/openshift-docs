ifeval::["{context}" == "build-strategies-docker"]
:dockerstrategy:
endif::[]
ifeval::["{context}" == "build-strategies-s2i"]
:sourcestrategy:
endif::[]

:_mod-docs-content-type: PROCEDURE
[id="builds-using-build-volumes_{context}"]
= Using build volumes

You can mount build volumes to give running builds access to information that you do not want to persist in the output container image.

Build volumes provide sensitive information, such as repository credentials, that the build environment or configuration only needs at build time. Build volumes are different from build inputs, whose data can persist in the output container image.

The mount points of build volumes, from which the running build reads data, are functionally similar to link:https://kubernetes.io/docs/concepts/storage/volumes/[pod volume mounts].

.Prerequisites
* You have added an input secret, config map, or both to a BuildConfig object.

.Procedure

ifdef::dockerstrategy[]

* In the `dockerStrategy` definition of the `BuildConfig` object, add any build volumes to the `volumes` array. For example:
+
--
// The CSI Shared Resource driver is Tech Preview, so it is not applicable
// to OSD and ROSA. When it is fully GA, it can be included in the example below.

[source,yaml]
----
spec:
  dockerStrategy:
    volumes:
      - name: secret-mvn # <1>
        mounts:
        - destinationPath: /opt/app-root/src/.ssh # <2>
        source:
          type: Secret # <3>
          secret:
            secretName: my-secret # <4>
      - name: settings-mvn # <1>
        mounts:
        - destinationPath: /opt/app-root/src/.m2  # <2>
        source:
          type: ConfigMap # <3>
          configMap:
            name: my-config # <4>
ifndef::openshift-dedicated,openshift-rosa[]
      - name: my-csi-volume # <1>
        mounts:
        - destinationPath: /opt/app-root/src/some_path # <2>
        source:
          type: CSI # <3>
          csi:
            driver: csi.sharedresource.openshift.io # <5>
            readOnly: true # <6>
            volumeAttributes: # <7>
              attribute: value
endif::openshift-dedicated,openshift-rosa[]
----
<1> Required. A unique name.
<2> Required. The absolute path of the mount point. It must not contain `..` or `:` and does not collide with the destination path generated by the builder. The `/opt/app-root/src` is the default home directory for many Red Hat S2I-enabled images.
<3> Required. The type of source, `ConfigMap`, `Secret`, or `CSI`.
<4> Required. The name of the source.
ifndef::openshift-dedicated,openshift-rosa[]
<5> Required. The driver that provides the ephemeral CSI volume.
<6> Required. This value must be set to `true`. Provides a read-only volume.
<7> Optional. The volume attributes of the ephemeral CSI volume. Consult the CSI driver's documentation for supported attribute keys and values.
endif::openshift-dedicated,openshift-rosa[]
--

endif::dockerstrategy[]

ifdef::sourcestrategy[]

* In the `sourceStrategy` definition of the `BuildConfig` object, add any build volumes to the `volumes` array. For example:
+
--
// The CSI Shared Resource driver is Tech Preview, so it is not applicable
// to OSD and ROSA. When it is fully GA, it can be included in the example below.

[source,yaml]
----
spec:
  sourceStrategy:
    volumes:
      - name: secret-mvn # <1>
        mounts:
        - destinationPath: /opt/app-root/src/.ssh # <2>
        source:
          type: Secret # <3>
          secret:
            secretName: my-secret # <4>
      - name: settings-mvn # <1>
        mounts:
        - destinationPath: /opt/app-root/src/.m2 # <2>
        source:
          type: ConfigMap # <3>
          configMap:
            name: my-config # <4>
ifndef::openshift-dedicated,openshift-rosa[]
      - name: my-csi-volume # <1>
        mounts:
        - destinationPath: /opt/app-root/src/some_path # <2>
        source:
          type: CSI # <3>
          csi:
            driver: csi.sharedresource.openshift.io # <5>
            readOnly: true # <6>
            volumeAttributes: # <7>
              attribute: value
endif::openshift-dedicated,openshift-rosa[]
----

<1> Required. A unique name.
<2> Required. The absolute path of the mount point. It must not contain `..` or `:` and does not collide with the destination path generated by the builder. The `/opt/app-root/src` is the default home directory for many Red Hat S2I-enabled images.
<3> Required. The type of source, `ConfigMap`, `Secret`, or `CSI`.
<4> Required. The name of the source.
ifndef::openshift-dedicated,openshift-rosa[]
<5> Required. The driver that provides the ephemeral CSI volume.
<6> Required. This value must be set to `true`. Provides a read-only volume.
<7> Optional. The volume attributes of the ephemeral CSI volume. Consult the CSI driver's documentation for supported attribute keys and values.
endif::openshift-dedicated,openshift-rosa[]
--

endif::sourcestrategy[]

ifndef::openshift-dedicated,openshift-rosa[]
:FeatureName: Shared Resource CSI Driver
include::snippets/technology-preview.adoc[]
endif::openshift-dedicated,openshift-rosa[]

ifeval::["{context}" == "build-strategies-docker"]
:!dockerstrategy:
endif::[]
ifeval::["{context}" == "build-strategies-s2i"]
:!sourcestrategy:
endif::[]
