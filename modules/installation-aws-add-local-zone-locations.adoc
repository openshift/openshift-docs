// Module included in the following assemblies:
//
// * installing/installing_aws/installing-aws-localzone.adoc
// * post_installation_configuration/aws-compute-edge-tasks.adoc

// AWS Local Zones
ifeval::["{context}" == "aws-compute-edge-tasks"]
:edge-zone-sample: us-east-1-nyc-1a
:edge-zone-group-sample: us-east-1-nyc-1
endif::[]
// AWS Wavelength
ifeval::["{context}" == "aws-compute-edge-tasks-wavelength"]
:edge-zone-sample: us-east-1-wl1-nyc-wlz-1
:edge-zone-group-sample: us-east-1-wl1
endif::[]

:_mod-docs-content-type: PROCEDURE
[id="installation-aws-add-local-zone-locations_{context}"]
= Opting in to {aws-service-name-full}

If you plan to create the subnets in {aws-service-name-full}, you must opt in to each zone group separately.

.Prerequisites

* You have installed the AWS CLI.
* You have determined an AWS Region for where you want to deploy your {product-title} cluster.
* You have attached a permissive IAM policy to a user or role account that opts in to the zone group.

.Procedure

. List the zones that are available in your AWS Region by running the following command:
+
// Q: is there a way to use variables inside a code block and apply to the following statements?
ifdef::aws-localzones[]
[source,terminal]
----
$ aws --region "<value_of_AWS_Region>" ec2 describe-availability-zones \
    --query 'AvailabilityZones[].[{ZoneName: ZoneName, GroupName: GroupName, Status: OptInStatus}]' \
    --filters Name=zone-type,Values=local-zone \
    --all-availability-zones
----
endif::aws-localzones[]
ifdef::aws-wavelength[]
[source,terminal]
----
$ aws --region "<value_of_AWS_Region>" ec2 describe-availability-zones \
    --query 'AvailabilityZones[].[{ZoneName: ZoneName, GroupName: GroupName, Status: OptInStatus}]' \
    --filters Name=zone-type,Values=wavelength-zone \
    --all-availability-zones
----
endif::aws-wavelength[]
+
Depending on the AWS Region, the list of available zones can be long. The command returns the following fields:
+
- `ZoneName`:: The name of the {aws-service-name-single}.
- `GroupName`:: The group that comprises the zone. To opt in to the region, save the name.
- `Status`:: The status of the {aws-service-name-single} group. If the status is `not-opted-in`,
  you must opt in the `GroupName` by running the commands that follow.

. Opt in to the zone group on your AWS account by running the following command:
+
[source,terminal]
----
$ aws ec2 modify-availability-zone-group \
    --group-name "<value_of_GroupName>" \// <1>
    --opt-in-status opted-in
----
<1> For `<value_of_GroupName>`, specify the name of the group of the {aws-service-name-single} where you want to create subnets.
  For example, specify `{edge-zone-group-sample}` to use the zone `{edge-zone-sample}` (US East New York).