// Module included in the following assemblies:
//
// * networking/hardware_networks/configuring-sriov-ib-attach.adoc
// * networking/hardware_networks/configuring-sriov-net-attach.adoc
// * networking/multiple_networks/secondary_networks/configuring-ip-secondary-nwt.adoc

// Because the Cluster Network Operator abstracts the configuration for
// Macvlan, including IPAM configuration, this must be provided as YAML
// for the Macvlan CNI plugin only. In the future other Multus plugins
// might be managed the same way by the CNO.

:_mod-docs-content-type: CONCEPT
[id="nw-multus-dhcp_{context}"]
= Dynamic IP address (DHCP) assignment configuration

[role="_abstract"]
Dynamic IP address assignment in {product-title} enables pods to receive IP addresses for secondary networks either through DHCP or by using the Whereabouts CNI plugin. These approaches support flexible address management, including server-based allocation and dynamic assignment without a DHCP server.

[IMPORTANT]
====
For an Ethernet network attachment, the SR-IOV Network Operator does not create a DHCP server deployment; the Cluster Network Operator is responsible for creating the minimal DHCP server deployment.
====

To trigger the deployment of the DHCP server, you must create a shim network attachment by editing the Cluster Network Operator configuration, as in the following example:

.Example shim network attachment definition
[source,yaml]
----
apiVersion: operator.openshift.io/v1
kind: Network
metadata:
  name: cluster
spec:
  additionalNetworks:
  - name: dhcp-shim
    namespace: default
    type: Raw
    rawCNIConfig: |-
      {
        "name": "dhcp-shim",
        "cniVersion": "0.3.1",
        "type": "bridge",
        "ipam": {
          "type": "dhcp"
        }
      }
  # ...
----

where:

`type`:: Specifies dynamic IP address assignment for the cluster.

The following table describes the configuration parameters for dynamic IP address address assignment with DHCP.

.`ipam` DHCP configuration object
[cols=".^2,.^2,.^6",options="header"]
|====
|Field|Type|Description

|`type`
|`string`
|The IPAM address type. The value `dhcp` is required.

|====

The following JSON example describes the configuration p for dynamic IP address address assignment with DHCP.

.Dynamic IP address (DHCP) assignment configuration example
[source,json]
----
{
  "ipam": {
    "type": "dhcp"
  }
}
----

[id="nw-multus-whereabouts_{context}"]
== Dynamic IP address assignment configuration with Whereabouts

The Whereabouts CNI plugin allows the dynamic assignment of an IP address to a secondary network without the use of a DHCP server. 

The Whereabouts CNI plugin also supports overlapping IP address ranges and configuration of the same CIDR range multiple times within separate `NetworkAttachmentDefinition` CRDs. This provides greater flexibility and management capabilities in multi-tenant environments.

[id="dynamic-ip-address-assignment-objects_{context}"]
== Dynamic IP address configuration objects

The following table describes the configuration objects for dynamic IP address assignment with Whereabouts:

.`ipam` whereabouts configuration object
[cols=".^2,.^2,.^6",options="header"]
|====
|Field|Type|Description

|`type`
|`string`
|The IPAM address type. The value `whereabouts` is required.

|`range`
|`string`
|An IP address and range in CIDR notation. IP addresses are assigned from within this range of addresses.

|`exclude`
|`array`
|Optional: A list of zero or more IP addresses and ranges in CIDR notation. IP addresses within an excluded address range are not assigned.

|`network_name`
|`string`
| Optional: Helps ensure that each group or domain of pods gets its own set of IP addresses, even if they share the same range of IP addresses. Setting this field is important for keeping networks separate and organized, notably in multi-tenant environments.

|====

[id="dynamic-ip-address-assignment-whereabouts_{context}"]
== Dynamic IP address assignment configuration that uses Whereabouts

The following example shows a dynamic address assignment configuration that uses Whereabouts:

.Whereabouts dynamic IP address assignment
[source,json]
----
{
  "ipam": {
    "type": "whereabouts",
    "range": "192.0.2.192/27",
    "exclude": [
       "192.0.2.192/30",
       "192.0.2.196/32"
    ]
  }
}
----

[id="dynamic-ip-address-assignment-whereabouts-overlapping-ip-ranges_{context}"]
== Dynamic IP address assignment that uses Whereabouts with overlapping IP address ranges

The following example shows a dynamic IP address assignment that uses overlapping IP address ranges for multi-tenant networks. 

.NetworkAttachmentDefinition 1
[source,json]
----
{
  "ipam": {
    "type": "whereabouts",
    "range": "192.0.2.192/29",
    "network_name": "<example_net_common>", <1>
  }
}
----

where:

`<example_net_common>`:: Specifies the network name for the common network. If set, must match the `network_name` of `NetworkAttachmentDefinition 1`. 

.NetworkAttachmentDefinition 2
[source,json]
----
{
  "ipam": {
    "type": "whereabouts",
    "range": "192.0.2.192/24",
    "network_name": "<example_net_common>", <1>
  }
}
----

where:

`<example_net_common>`:: Specifies the network name for the common network. If set, must match the `network_name` of `NetworkAttachmentDefinition 1`. 
