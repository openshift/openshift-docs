[id="generating-icsp-object-scoped-to-a-registry_{context}"]
= Generating an ImageContentSourcePolicy object scoped to a registry

[role="_abstract"]
Use the `--icsp-scope=registry` flag with the `oc adm catalog` command to widen the mirror registry scope in the ICSP file. This minimizes the number of times the cluster nodes are rebooted when a registry entry is updated.

The `oc adm catalog mirror` command generates an ImageContentSourcePolicy (ICSP) object that maps the original container image repository to a new location where it is mirrored, typically inside a disconnected environment. When a new or modified ICSP is applied to a cluster, it is converted to a config file for CRI-O and placed onto each node. The process of placing the config file on a node includes rebooting that node. Having a widely scoped ICSP reduces the number of times the ICSP needs to change in the future and, thus reduces the number of times a cluster must reboot its nodes.

.Prerequisites

* Install the {product-title} CLI `oc`.
* Log in as a user with `cluster-admin` privileges.
* Configure an image catalog repository with restricted OLM for use in your {product-title} disconnected cluster.

.Procedure

To widen the mirror registry scope in the ICSP file, do the following:

. Run the `oc adm catalog mirror` command and set the ICSP scope to registry, where <local_registery> is the local registry you have configured for your disconnected cluster. This command creates a `redhat-operator-index-manifests/` folder and generates `imageContentSourcePolicy.yaml` and `mapping.txt` files.
+
[source,terminal]
----
$ oc adm catalog mirror <local_registery>/olm/redhat-operators:v1 <local_registery> -a ../installer/local-secret.json --icsp-scope=registry --manifests-only=true
----

. Change to `/redhat-operator-index-manifests` directory, and apply the customized ICSP file:
+
[source,terminal]
----
$ oc apply -f imageContentSourcePolicy.yaml
----

.Verification

* Verify the the ICSP change is successfully applied. is applied.
[source,terminal]
----
$ oc get ImageContentSourcePolicy
----
+
.Expected output
[source,terminal]
----
$
----




[role="_additional-resources"]
.Additional resources


