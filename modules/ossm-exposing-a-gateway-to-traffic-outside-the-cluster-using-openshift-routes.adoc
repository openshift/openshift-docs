// This procedure is used in the following assembly:
// * gateways/ossm-getting-traffic-into-a-mesh.adoc

:_mod-docs-content-type: PROCEDURE
[id="ossm-exposing-a-gateway-to-traffic-outside-the-cluster-using-openshift-routes_{context}"]
= Exposing a gateway to traffic outside the cluster by using OpenShift Routes

You can expose a gateway to traffic outside the cluster by using {ocp-short-name} Routes. This approach provides an alternative to using Kubernetes load balancer service when you have to expose gateways to traffic outside the cluster.

.Prerequisites

* You have completed the procedure, _Exposing a Service by using the {istio} Gateway and VirtualService resources_.

.Procedure

. Ensure that the `Service` type is set to `ClusterIP` by running the following command:
+
[source,terminal]
----
$ oc patch service <gateway_name> -n <gateway_namespace> -p '{"spec": {"type": "ClusterIP"}}'
----

. Create a YAML file named `httpbin-route.yaml` that defines a `Route` for the `httpbin` service.
+
[source,yaml,subs="attributes,verbatim"]
----
apiVersion: route.openshift.io/v1
kind: Route
metadata:
  name: httpbin
  namespace: <gateway_namespace>
spec:
  host: httpbin.example.com
  port:
    targetPort: http2
  to:
    kind: Service
    name: <gateway_name>
    weight: 100
  wildcardPolicy: None
----

. Apply the YAML file by running the following command:
+
[source,terminal]
----
$ oc apply -f httpbin-route.yaml
----

. Verify that `httpbin` service can be accessed from outside the cluster through the ingress router. Ensure that you set the `INGRESS_HOST` variable appropriately for the environment that your cluster is running in.

.. If the cluster runs on AWS, set the `INGRESS_HOST` variable by running the following command:
+
[source,terminal]
----
$ INGRESS_HOST=$(oc get service router-default -n openshift-ingress -o jsonpath='{.status.loadBalancer.ingress[0].hostname}')
----

.. If the cluster runs on GCP or Azure, set the `INGRESS_HOST` variable by running the following command:
+
[source,terminal]
----
$ INGRESS_HOST=$(oc get service router-default -n openshift-ingress -o jsonpath='{.status.loadBalancer.ingress[0].ip}')
----

.. Send a `curl` request to the `httpbin` service using the host of the ingress router by running the following command:
+
[source,terminal]
----
$ curl -s -I -H Host:httpbin.example.com http://$INGRESS_HOST/headers
----

. Verify that the response has the `HTTP/1.1 200 OK` status, which indicates that the request was successful.

[role="_additional-resources"]
[id="ossm-exposing-gateway-outside-cluster-additional-resources_{context}"]
.Additional resources

* link:https://docs.redhat.com/en/documentation/openshift_container_platform/4.17/html/networking/configuring-routes#nw-creating-a-route_route-configuration[Creating an HTTP-based Route]