// Module included in the following assemblies:
//
// migration/migrating_openshift_3_to_4/migrating-openshift-3-to-4.adoc
[id='migration-configuring-cors-4_{context}']
= Configuring cross-origin resource sharing on an {product-title} 4.1 source cluster

You can configure cross-origin resource sharing on the {product-title} 4.1 source cluster to enable communication between the CAM tool on the target cluster and the source cluster's API server.

.Procedure

. Log in to the {product-title} 4 target cluster.
. Obtain the value for the CAM tool's CORS configuration:
+
----
$ oc get -n openshift-migration route/migration -o go-template='(?i)//{{ .spec.host }}(:|\z){{ println }}' | sed 's,\.,\\.,g'
----

. Log in to the source cluster.
. Edit the OAuth server CR:
+
----
$ oc edit authentication.operator cluster
----

. Add the CORS configuration value to `corsAllowedOrigins` under `unsupportedConfigOverrides` in the `spec` stanza:
+
[source,yaml]
----
spec:
  unsupportedConfigOverrides:
    corsAllowedOrigins:
    - (?i)//migration-openshift-migration\.apps\.cluster\.com(:|\z) <1>
----
<1> Update the CORS configuration value.

. Save the file to apply the changes.

. Edit the Kubernetes API server CR:
+
----
$ oc edit kubeapiserver.operator cluster
----

. Add the CORS configuration value to `corsAllowedOrigins` under `unsupportedConfigOverrides` in the `spec` stanza:
+
[source,yaml]
----
spec:
  unsupportedConfigOverrides:
    corsAllowedOrigins:
    - (?i)//migration-openshift-migration\.apps\.cluster\.com(:|\z) <1>
----
<1> Update the CORS configuration value.

. Save the file to apply the changes.

. Verify the configuration:
+
----
$ curl -v -k -X OPTIONS \
"<cluster_url>/apis/migration.openshift.io/v1alpha1/namespaces/openshift-migration/migclusters" \ <1>
-H "Access-Control-Request-Method: GET" \
-H "Access-Control-Request-Headers: authorization" \
-H "Origin: https://<CAM_tool_url>" <2>
----
<1> `<cluster_url>`: Update the cluster URL.
<2> `<CAM_tool_url>`: Update the CAM tool URL.
+
The output appears similar to the following:
+
----
< HTTP/2 204
< access-control-allow-credentials: true
< access-control-allow-headers: Content-Type, Content-Length, Accept-Encoding, X-CSRF-Token, Authorization, X-Requested-With, If-Modified-Since
< access-control-allow-methods: POST, GET, OPTIONS, PUT, DELETE, PATCH
< access-control-allow-origin: https://migration-openshift-migration.apps.cluster
< access-control-expose-headers: Date
< cache-control: no-store
----
