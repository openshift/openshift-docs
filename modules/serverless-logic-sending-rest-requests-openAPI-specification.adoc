// Module included in the following assemblies:
//serverless-logic/serverless-logic-managing-services/serverless-logic-configuring-openAPI-services.adoc

:_mod-docs-content-type: PROCEDURE
[id="serverless-logic-sending-rest-requests-openAPI-specification_{context}"]
= Sending REST requests based on the OpenAPI specification

To send REST requests that are based on the OpenAPI specification files, you must perform the following procedures:

* Define the function references
* Access the defined functions in the workflow states

.Prerequisites

* You have {ServerlessLogicOperatorName} installed on your cluster.
* You have access to a {ServerlessLogicProductName} project with the appropriate roles and permissions to create applications and other workloads in {ocp-product-title}.
* You have access to the OpenAPI specification files.

.Procedure

. To define the OpenAPI functions: 

.. Identify and access the OpenAPI specification files for the services you intend to invoke.

.. Copy the OpenAPI specification files into your workflow service directory, such as `src/main/resources/specs`.
+
The following example shows the OpenAPI specification for the multiplication REST service:
+
.Example multiplication REST service OpenAPI specification
[source,yaml]
----
openapi: 3.0.3
info:
  title: Generated API
  version: "1.0"
paths:
  /:
    post:
      operationId: doOperation
      parameters:
        - in: header
          name: notUsed
          schema:
            type: string
          required: false
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MultiplicationOperation'
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  product:
                    format: float
                    type: number
components:
  schemas:
    MultiplicationOperation:
      type: object
      properties:
        leftElement:
          format: float
          type: number
        rightElement:
          format: float
          type: number
----

.. To define functions in the workflow, use the `operationId` from the OpenAPI specification to reference the desired operations in your function definitions.
+
.Example function definitions in the temperature conversion application
[source,json]
----
{
   "functions": [
     {
       "name": "multiplication",
       "operation": "specs/multiplication.yaml#doOperation"
     },
     {
       "name": "subtraction",
       "operation": "specs/subtraction.yaml#doOperation"
     }
   ]
}
----

.. Ensure that your function definitions reference the correct paths to the OpenAPI files stored in the `src/main/resources/specs` directory.

. To access the defined functions in the workflow states:

.. Define workflow actions to call the function definitions you added. Ensure each action references a function defined earlier.

.. Use the `functionRef` attribute to refer to the specific function by its name. Map the arguments in the `functionRef` using the parameters defined in the OpenAPI specification.
+
The following example shows about mapping parameters in the request path instead of request body, you can refer to the following PetStore API example:
+
.Example for mapping function arguments in workflow
[source,json]
----
{
   "states": [
    {
      "name": "SetConstants",
      "type": "inject",
      "data": {
        "subtractValue": 32.0,
        "multiplyValue": 0.5556
      },
      "transition": "Computation"
    },
    {
      "name": "Computation",
      "actionMode": "sequential",
      "type": "operation", 
      "actions": [
        {
          "name": "subtract",
          "functionRef": {
            "refName": "subtraction", 
            "arguments": { 
              "leftElement": ".fahrenheit",
              "rightElement": ".subtractValue"
            }
          }
        },
        {
          "name": "multiply",
          "functionRef": {
            "refName": "multiplication", 
            "arguments": { 
               "leftElement": ".difference",
               "rightElement": ".multiplyValue"
            }
          }
        }
      ],
      "end": {
        "terminate": true
      }
    }
  ]
}
----

.. Check the `Operation Object` section of the OpenAPI specification to understand how to structure parameters in the request.

.. Use `jq` expressions to extract data from the payload and map it to the required parameters. Ensure the engine maps parameter names according to the OpenAPI specification.

.. For operations requiring parameters in the request path instead of the body, refer to the parameter definitions in the OpenAPI specification.
+
For more information about mapping parameters in the request path instead of request body, you can refer to the following PetStore API example:
+
.Example for mapping path parameters
[source,json]
----
{
  "/pet/{petId}": {
    "get": {
      "tags": ["pet"],
      "summary": "Find pet by ID",
      "description": "Returns a single pet",
      "operationId": "getPetById",
      "parameters": [
        {
          "name": "petId",
          "in": "path",
          "description": "ID of pet to return",
          "required": true,
          "schema": {
            "type": "integer",
            "format": "int64"
          }
        }
      ]
    }
  }
}
----
+
Following is an example invocation of a function, in which only one parameter named `petId` is added in the request path:
+
.Example of calling the PetStore function
[source,json]
----
{
  "name": "CallPetStore", <1>
  "actionMode": "sequential",
  "type": "operation",
  "actions": [
    {
      "name": "getPet",
      "functionRef": {
        "refName": "getPetById", <2>
        "arguments": { <3>
          "petId": ".petId"
        }
      }
    }
  ]
}
----
<1> State definition, such as `CallPetStore`.
<2> Function definition reference. In the previous example, the function definition `getPetById` is for PetStore OpenAPI specification.
<3> Arguments definition. OpenShift Serverless Logic adds the argument `petId` to the request path before sending a request.