// Module included in the following assemblies:
//
// * networking/network_security/network_policy/nw-networkpolicy-full-multitenant-isolation.adoc



:_mod-docs-content-type: PROCEDURE
[id="nw-policy-cluster-preparation_{context}"]
= Preparing your cluster for multitenant isolation with ingress and egress network policies

The following procedure creates the projects and pods that are used throughout the rest of this chapter. 

.Prerequisites

* Your cluster uses a network plugin that supports `NetworkPolicy` objects, such as the OVN-Kubernetes network plugin, with `mode: NetworkPolicy` set.
* You have installed the OpenShift CLI (`oc`).
* You are logged in as a user with cluster admin privileges.

.Procedure

. Create the `project-a` namespace by entering the following command:
+
[source,terminal]
----
$ oc new-project project-a
----

. Create the project-b namespace by entering the following command:
+
[source,terminal]
----
$ oc new-project project-b
----

. Create the following `busybox-pod-a` pod in the `project-a` namespace:
+
[source,terminal]
----
cat <<EOF | oc apply -f - -n project-a
apiVersion: v1
kind: Pod
metadata:
  name: busybox-pod-a
spec:
  containers:
  - name: busybox
    image: alpine:latest
    command: [ "sleep", "3600" ]
    securityContext:
      runAsNonRoot: true
      allowPrivilegeEscalation: false
      capabilities:
        drop:
        - "ALL"
      seccompProfile:
        type: "RuntimeDefault"
EOF
----

. Create the following `busybox-pod-b` pod in the `project-b` namespace:
+
[source,terminal]
----
cat <<EOF | oc apply -f - -n project-b
apiVersion: v1
kind: Pod
metadata:
  name: busybox-pod-b
spec:
  containers:
  - name: busybox
    image: alpine:latest
    command: [ "sleep", "3600" ]
    securityContext:
      runAsNonRoot: true
      allowPrivilegeEscalation: false
      capabilities:
        drop:
        - "ALL"
      seccompProfile:
        type: "RuntimeDefault"
EOF
----

. Create the following `test-pod-a` in the `project-a` namespace:
+
[source,terminal]
----
cat <<EOF | oc apply -f - -n project-a
apiVersion: v1
kind: Pod
metadata:
  name: test-pod-a
  labels:
    app: test-pod
spec:
  containers:
  - name: test-container
    image: curlimages/curl:latest
    command: [ "sleep", "3600" ]
    securityContext:
      runAsNonRoot: true  # Ensure non-root user
      allowPrivilegeEscalation: false
      capabilities:
        drop:
        - "ALL"
      seccompProfile:
        type: "RuntimeDefault"
EOF
----

. Create the following `test-pod-b` in the `project-b` namespace:
+
[source,terminal]
----
cat <<EOF | oc apply -f - -n project-b
apiVersion: v1
kind: Pod
metadata:
  name: test-pod-b
  labels:
    app: test-pod
spec:
  containers:
  - name: test-container
    image: curlimages/curl:latest
    command: [ "sleep", "3600" ]
    securityContext:
      runAsNonRoot: true  # Ensure non-root user
      allowPrivilegeEscalation: false
      capabilities:
        drop:
        - "ALL"
      seccompProfile:
        type: "RuntimeDefault"
EOF
----