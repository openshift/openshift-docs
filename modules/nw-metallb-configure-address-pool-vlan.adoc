:_mod-docs-content-type: PROCEDURE
[id="nw-metallb-configure-address-pool-vlan_{context}"]
= Configure MetalLB address pool for VLAN

[role="_abstract"]
To precisely manage external access across a specific VLAN, configure MetalLB address pools for your cluster. Defining these pools ensures that load balancer services receive authorized IP addresses from designated network ranges for secure and consistent routing.

.Prerequisites

* Install the {oc-first}.
* Configure a separate VLAN.
* Log in as a user with `cluster-admin` privileges.

.Procedure

. Create a file, such as `ipaddresspool-vlan.yaml`, that is similar to the following example:
+
[source,yaml]
----
apiVersion: metallb.io/v1beta1
kind: IPAddressPool
metadata:
  namespace: metallb-system
  name: doc-example-vlan
  labels: 
    zone: east
spec:
  addresses:
  - 192.168.100.1-192.168.100.254
# ...
----
+
where:
+
`labels.zone`:: This label assigned to the `IPAddressPool` can be referenced by the `ipAddressPoolSelectors` in the `BGPAdvertisement` CRD to associate the `IPAddressPool` with the advertisement.
`spec.addresses`:: This IP range must match the subnet assigned to the VLAN on your network. To support layer 2 (L2) mode, the IP address range must be within the same subnet as the cluster nodes.

. Apply the configuration for the IP address pool:
+
[source,terminal]
----
$ oc apply -f ipaddresspool-vlan.yaml
----

. To ensure this configuration applies to the VLAN, you need to set the `spec` `gatewayConfig.ipForwarding` to `Global`. 
+
.. Run the following command to edit the network configuration custom resource (CR):
+
[source,terminal]
----
$ oc edit network.operator.openshift/cluster
----
+
.. Update the `spec.defaultNetwork.ovnKubernetesConfig` section to include the `gatewayConfig.ipForwarding` set to `Global`. The following example demonstrates this configuration:
+
[source,yaml]
----
apiVersion: operator.openshift.io/v1
kind: Network
metadata:
  name: cluster
spec:
  clusterNetwork:
    - cidr: 10.128.0.0/14
      hostPrefix: 23
  defaultNetwork:
    type: OVNKubernetes
    ovnKubernetesConfig:
      gatewayConfig:
        ipForwarding: Global
# ...
----