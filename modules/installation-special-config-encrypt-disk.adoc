// Module included in the following assemblies:
//
// * installing/install_config/installing-customizing.adoc

[id="installation-encrypting-disks_{context}"]
= Encrypting disks during installation

During {product-title} installation, you can enable disk encryption on all master and worker nodes.
This feature:

* Is available for installer provisioned infrastructure
and user provisioned infrastructure deployments
* Is supported on Red Hat Enterprise Linux CoreOS (RHCOS) systems only
* Sets up disk encryption during the manifest installation phase so all data written to disk, from first boot forward, is encrypted
* Encrypts data on the root filesystem only (/dev/mapper/coreos-luks-root on /)
* Requires no user intervention for providing passphrases
* Uses AES-256-CBC encryption
* Should be enabled for your cluster to be FIPS compliant.

There are two different supported encryption modes:

* TPM v2: This is the preferred mode. TPM v2 stores passphrases in a secure cryptoprocessor.
To implement TPM v2 disk encryption, create an Ignition config file as described below.

* Tang: To use link:https://github.com/latchset/tang[Tang] to encrypt your cluster, you need to use a Tang server.
link:https://github.com/latchset/clevis[Clevis] implements decryption on the client side.
Tang encryption mode is only supported for bare metal installs.

Follow one of the two procedures below to enable disk encryption for the nodes in your cluster.

== Enabling TPM v2 disk encryption
Use this procedure to enable TPM v2 mode disk encryption during {product-title} deployment.

.Procedure

. Check to see if TPM v2 encryption needs to be enabled in the BIOS on each node.
This is required on most Dell systems.

. Generate the Kubernetes manifests for the cluster:
+
----
$ ./openshift-install create manifests --dir=<installation_directory>
----

. In the `openshift` directory, create a file (for example, 99_openshift-tpmv2-encryption.yaml)
to define the `/etc/clevis.json` file. This is how that file
can be configured:
+
----
 "storage": {
    "files": [
      {
        "filesystem": "root",
        "group": {},
        "path": "/etc/clevis.json",
        "user": {},
        "contents": {
          "source": "data:text/plain;base64,e30K"
        },
        "mode": 420
      }
    ]
  }
----

+

. Make a backup copy of the YAML file. You should do this because the file will be deleted when you create the cluster.

. Obtain the Ignition config files:
+
----
$ ./openshift-install create ignition-configs --dir=<installation_directory> <1>
----
<1> For `<installation_directory>`, specify the same installation directory.
+
The following files are generated in the directory:
+
----
.
├── auth
│   ├── kubeadmin-password
│   └── kubeconfig
├── bootstrap.ign
├── master.ign
├── metadata.json
└── worker.ign
----

