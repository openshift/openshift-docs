
:_mod-docs-content-type: PROCEDURE
[id="installation-azure-provisioning-own-dns-records_{context}"]
= Provisioning your own DNS records

[role="_abstract"]
Use the IP address of the API server to provision your own DNS record with the `api.<cluster_name>.<base_domain>.` hostname by using your cluster name and base cluster domain. Use the IP address of the Ingress service to provision your own DNS record with the `*.apps.<cluster_name>.<base_domain>.` hostname by using your cluster name and base cluster domain.

:FeatureName: User-provisioned DNS
include::snippets/technology-preview.adoc[leveloffset=+1]


.Prerequisite
* You have installed the {azure-short} CLI client `(az)`.

.Procedure

. Add the `userProvisionedDNS` parameter to the `install-config.yaml` file and enable the parameter. For more information, see "Enabling a user-managed DNS".

. Install your cluster.

. If you are installing a private cluster, set the `lb_name` variable by running the following command:
+
[source,terminal]
----
$ lb_name="${infra_id}-internal"
----

.. Set the `frontendipconfig_id` variable by running the following command:
+
[source,terminal]
----
$ frontendipconfig_id=$(az network lb show -n ${lb_name} -g ${cluster_resource_group_name} -ojson | jq -r ".loadBalancingRules[] | select(.frontendPort == 6443) | .frontendIPConfiguration.id")
----

.. Set the `frontendipconfig_name` variable by running the following command:
+
[source,terminal]
----
$ frontendipconfig_name=${frontendipconfig_id##*/}
----

.. To retrieve the IP address of the API service, run the following command:
+
[source,terminal]
----
$ az network lb frontend-ip show -n ${frontendipconfig_name} --lb-name ${lb_name} -g ${cluster_resource_group_name} --query "privateIPAddress" -otsv
----

. If you are installing a public cluster, set the `lb_name` variable by running the following command:
+
[source,terminal]
----
$ lb_name="${infra_id}"
----


.. Set the `frontendipconfig_id` variable by running the following command:
+
[source,terminal]
----
$ frontendipconfig_id=$(az network lb show -n ${lb_name} -g ${cluster_resource_group_name} -ojson | jq -r ".loadBalancingRules[] | select(.frontendPort == 6443) | .frontendIPConfiguration.id")
----

.. Set the `frontendipconfig_name` variable by running the following command:
+
[source,terminal]
----
$ frontendipconfig_name=${frontendipconfig_id##*/}
----

.. Set the `frontendpublicip_id` variable by running the following command:
+
[source,terminal]
----
$ frontendpublicip_id=$(az network lb frontend-ip show -n ${frontendipconfig_name} --lb-name ${lb_name} -g ${cluster_resource_group_name} --query "publicIPAddress.id" -otsv)
----

.. To retrieve the IP address of the API service, run the following command:
+
[source,terminal]
----
$ az network public-ip show --ids ${frontendpublicip_id} --query 'ipAddress' -otsv
----

. Use the IP address and your cluster name and base cluster domain to configure your own DNS record with the `api.<cluster_name>.<base_domain>.` hostname.

. If you are installing a private cluster, set the `lb_name` variable by running the following command:
+
[source,terminal]
----
$ lb_name="${infra_id}-internal"
----

.. Set the `frontendipconfig_id` variable by running the following command:
+
[source,terminal]
----
$ frontendipconfig_id=$(az network lb show -n ${lb_name} -g ${cluster_resource_group_name} -ojson | jq -r ".loadBalancingRules[] | select(.frontendPort == 443) | .frontendIPConfiguration.id")
----

.. Set the `frontendipconfig_name` variable by running the following command:
+
[source,terminal]
----
$ frontendipconfig_name=${frontendipconfig_id##*/}
----

.. To retrieve the IP address of the Ingress service, run the following command:
+
[source,terminal]
----
$ az network lb frontend-ip show -n ${frontendipconfig_name} --lb-name ${lb_name} -g ${cluster_resource_group_name} --query "privateIPAddress" -otsv
----

. If you are installing a public cluster, set the `lb_name` variable by running the following command:
+
[source,terminal]
----
$ lb_name="${infra_id}"
----

.. Set the `frontendipconfig_id` variable by running the following command:
+
[source,terminal]
----
$ frontendipconfig_id=$(az network lb show -n ${lb_name} -g ${cluster_resource_group_name} -ojson | jq -r ".loadBalancingRules[] | select(.frontendPort == 443) | .frontendIPConfiguration.id")
----

.. Set the `frontendipconfig_name` variable by running the following command:
+
[source,terminal]
----
$ frontendipconfig_name=${frontendipconfig_id##*/}
----

.. Set the `frontendpublicip_id` variable by running the following command:
+
[source,terminal]
----
$ frontendpublicip_id=$(az network lb frontend-ip show -n ${frontendipconfig_name} --lb-name ${lb_name} -g ${cluster_resource_group_name} --query "publicIPAddress.id" -otsv)
----

.. To retrieve the IP address of the Ingress service, run the following command:
+
[source,terminal]
----
$ az network public-ip show --ids ${frontendpublicip_id} --query 'ipAddress' -otsv
----

. Use the IP address and your cluster name and base cluster domain to configure your own DNS record with the `*.apps.<cluster_name>.<base_domain>.` hostname.
