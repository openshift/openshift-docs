// This module is included in the following assembly:
//
// * records/using-tekton-results-for-openshift-pipelines-observability.adoc

:_mod-docs-content-type: PROCEDURE
[id="results-log-forward_{context}"]
= Configuring LokiStack forwarding for logging information

If you want to use {tekton-results} to query logging information for task runs, you must install LokiStack and OpenShift Logging on your {OCP} cluster and configure forwarding of the logging information to LokiStack.

If you do not configure LokiStack forwarding for logging information, {tekton-results} does not store this information or provide it from the command-line interface or API.

.Prerequisites

* You installed the {oc-first} utility.
* You are logged in to your {OCP} cluster as a cluster administrator user.

.Procedure

To configure LokiStack forwarding, complete the following steps:

. On your {OCP} cluster, install LokiStack by using the Loki Operator and also install the OpenShift Logging Operator.

. Create a `ClusterLogForwarder.yaml` manifest file for the `ClusterLogForwarder` custom resource (CR) with one of the following YAML manifests, depending on whether you installed OpenShift Logging version 6 or version 5:
+
.YAML manifest for the `ClusterLogForwarder` CR if you installed OpenShift Logging version 6
[source,yaml]
----
apiVersion: observability.openshift.io/v1
kind: ClusterLogForwarder
metadata:
  name: collector
  namespace: openshift-logging
spec:
  inputs:
  - application:
      selector:
        matchExpressions:
          - key: app.kubernetes.io/managed-by
            operator: In
            values: ["tekton-pipelines", "pipelinesascode.tekton.dev"]
    name: only-tekton
    type: application
  managementState: Managed
  outputs:
  - lokiStack:
      labelKeys:
        application:
          ignoreGlobal: true
          labelKeys:
          - log_type
          - kubernetes.namespace_name
          - openshift_cluster_id
      authentication:
        token:
          from: serviceAccount
      target:
        name: logging-loki
        namespace: openshift-logging
    name: default-lokistack
    tls:
      ca:
        configMapName: openshift-service-ca.crt
        key: service-ca.crt
    type: lokiStack
  pipelines:
  - inputRefs:
    - only-tekton
    name: default-logstore
    outputRefs:
    - default-lokistack
  serviceAccount:
    name: collector
----
+
.YAML manifest for the `ClusterLogForwarder` CR if you installed OpenShift Logging version 5
[source,yaml]
----
apiVersion: "logging.openshift.io/v1"
kind: ClusterLogForwarder
metadata:
  name: instance
  namespace: openshift-logging
spec:
  inputs:
  - name: only-tekton
    application:
      selector:
        matchLabels:
          app.kubernetes.io/managed-by: tekton-pipelines
  pipelines:
    - name: enable-default-log-store
      inputRefs: [ only-tekton ]
      outputRefs: [ default ]
----

. Create the `ClusterLogForwarder` CR in the `openshift-logging` namespace by entering the following command:
+
[source, terminal]
----
$ oc apply -n openshift-logging ClusterLogForwarder.yaml
----

. Edit the `TektonConfig` custom resource (CR) by using the following command:
+
[source,terminal]
----
$ oc edit TektonConfig config
----
+
Make the following changes in the `result` spec:
+
[source,yaml]
----
apiVersion: operator.tekton.dev/v1alpha1
kind: TektonConfig
metadata:
  name: config
spec:
  result:
    loki_stack_name: logging-loki # <1>
    loki_stack_namespace: openshift-logging # <2>
----
<1> The name of the `LokiStack` CR, typically `logging-loki`.
<2> The name of the namespace where LokiStack is deployed, typically `openshift-logging`.
