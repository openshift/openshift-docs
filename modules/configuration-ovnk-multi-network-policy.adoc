// Module included in the following assemblies:
//
// * networking/multiple_networks/secondary_networks/creating-secondary-nwt-ovnk.adoc

:_mod-docs-content-type: REFERENCE
[id="compatibility-with-multi-network-policy_{context}"]
= Compatibility with multi-network policy

[role="_abstract"] 
When defining a network policy, the network policy rules that can be used depend on whether the OVN-Kubernetes secondary network defines the `subnets` field. 

The multi-network policy API, which is provided by the `MultiNetworkPolicy` custom resource definition (CRD) in the `k8s.cni.cncf.io` API group, is compatible with an OVN-Kubernetes secondary network. 

Refer to the following table that details supported multi-network policy selectors that are based on a `subnets` CNI configuration:

[cols=".^3,.^7",options="header"]
|====
a|`subnets` field specified|Allowed multi-network policy selectors

|
Yes
a|
* `podSelector` and `namespaceSelector`
* `ipBlock`

|
No
a|
* `ipBlock`

|====

You can use the `k8s.v1.cni.cncf.io/policy-for` annotation on a `MultiNetworkPolicy` object to point to a `NetworkAttachmentDefinition` (NAD) custom resource (CR). The NAD CR defines the network to which the policy applies. The following example multi-network policy that uses a pod selector is valid only if the `subnets` field is defined in the secondary network CNI configuration for the secondary network named `blue2`:

[source,yaml]
----
apiVersion: k8s.cni.cncf.io/v1beta1
kind: MultiNetworkPolicy
metadata:
  name: allow-same-namespace
  annotations:
    k8s.v1.cni.cncf.io/policy-for: blue2 <1>
spec:
  podSelector:
  ingress:
  - from:
    - podSelector: {}
----

The following example uses the `ipBlock` network multi-network policy that is always valid for an OVN-Kubernetes secondary network:

.Example multi-network policy that uses an IP block selector
[source,yaml]
----
apiVersion: k8s.cni.cncf.io/v1beta1
kind: MultiNetworkPolicy
metadata:
  name:  ingress-ipblock
  annotations:
    k8s.v1.cni.cncf.io/policy-for: default/flatl2net
spec:
  podSelector:
    matchLabels:
      name: access-control
  policyTypes:
  - Ingress
  ingress:
  - from:
    - ipBlock:
        cidr: 10.200.0.0/30
----
