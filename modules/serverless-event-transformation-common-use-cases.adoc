// Module included in the following assemblies:
//
// serverless/eventing/serverless-event-transformation.adoc

:_mod-docs-content-type: CONCEPT
[id="serverless-event-transformation-common-use-cases_{context}"]
= Common use cases for event transformation

`EventTransform` enables you to manipulate and reshape events in different ways depending on system requirements. The most common use cases are as follows: 

[id="serverless-event-transformation-field-extraction_{context}"]
== Field extraction

You can extract specific fields from event payloads and expose them as CloudEvent attributes. This makes it easier to filter and route events downstream.

.Example of extracting user ID from an event payload
[source,yaml]
----
apiVersion: eventing.knative.dev/v1alpha1
kind: EventTransform
metadata:
  name: extract-user-id
spec:
  jsonata:
    expression: |
      {
        "specversion": "1.0",
        "id": id,
        "type": "user.extracted",
        "source": "transform.user-extractor",
        "time": time,
        "userid": data.user.id,
        "data": $
      }
----

[id="serverless-event-transformation-event-format-conversion_{context}"]
== Event format conversion

You can convert the structure of an event into a different format so that it remains compatible with diverse consumer systems.

.Example of converting an order event to a customer-centric format
[source,yaml]
----
apiVersion: eventing.knative.dev/v1alpha1
kind: EventTransform
metadata:
  name: format-converter
spec:
  sink:
    ref:
      apiVersion: serving.knative.dev/v1
      kind: Service
      name: destination-service
  jsonata:
    expression: |
      {
        "specversion": "1.0",
        "id": id,
        "type": "order.converted",
        "source": "transform.format-converter",
        "time": time,
        "data": {
          "orderId": data.id,
          "customer": {
            "name": data.user.fullName,
            "email": data.user.email
          },
          "items": data.items
        }
      }
----

[id="serverless-event-transformation-event-enrichment_{context}"]
== Event enrichment

You can add fixed or dynamic metadata such as environment or region to events without requiring any changes in the original producer.

.Example of adding environment and region metadata to the event
[source,yaml]
----
apiVersion: eventing.knative.dev/v1alpha1
kind: EventTransform
metadata:
  name: event-enricher
spec:
  jsonata:
    expression: |
      {
        "specversion": "1.0",
        "id": id,                     /* Add the "id", "type", "source", and "time" attributes based on the input JSON object fields */
        "type": type,
        "source": source,
        "time": time,
        "environment": "production",  /* Add fixed environment and region attributes to the event metadata */
        "region": "us-west-1",
        "data": $                     /* Add the event transform input JSON body as CloudEvent "data" field */
      }
----

[id="serverless-event-transformation-event-response-transformation_{context}"]
== Event response reply transformation

You can transform not only the request sent to a sink but also the response received from the sink, enabling end-to-end event shaping.

.Example of transforming both request and reply messages
[source,yaml]
----
apiVersion: eventing.knative.dev/v1alpha1
kind: EventTransform
metadata:apiVersion: eventing.knative.dev/v1alpha1
kind: EventTransform
metadata:
  name: request-reply-transform
spec:
  sink:
    ref:
      apiVersion: serving.knative.dev/v1
      kind: Service
      name: processor-service
  jsonata:
    expression: |
      # Request transformation
      {
        "specversion": "1.0",
        "id": id,
        "type": "request.transformed",
        "source": source,
        "time": time,
        "data": data
      }
  reply:
    jsonata:
      expression: |
        # Reply transformation
        {
          "specversion": "1.0",
          "id": id,
          "type": "reply.transformed",
          "source": "transform.reply-processor",
          "time": time,
          "data": data
        }
----