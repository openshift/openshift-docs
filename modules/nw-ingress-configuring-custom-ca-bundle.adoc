// Modules included in the following assemblies:
//
// * ingress/configure-ingress-operator.adoc

:_mod-docs-content-type: PROCEDURE
[id="nw-ingress-configuring-custom-ca-bundle_{context}"]
= Configuring a custom CA bundle for verifying services’ certificate by the OpenShift Router

You can configure the same CA certificate in each route created for the services by creating a 'ConfigMap` with the list of CA certificates.

.Procedure

* Create a YAML file,for example, `admin-ca-bundle.yaml` with the following content:
+
[source,yaml]
----
apiVersion: v1
data:
 ca-bundle.crt: | # <1>
   <CA_ certificates> # <2>
kind: ConfigMap
metadata:
 name: admin-ca-bundle # <3>
 namespace: openshift-config # <4>
----
<1> This data key must be named ca-bundle.crt.
<2> One or more CA certificates used for the signing services.
<3> The config map name that will be referenced from the Ingress Operator.
<4> The config map must be in the openshift-config namespace.

. Create the config map from the created YAML file:
+
[source,terminal]
----
oc create -f admin-ca-bundle.yaml
----



[comment]
--
Ingress Operator create a ConfigMap with the name `ingress-ca-bundle` in `openshift-ingress` namespace which contains administrator/user configured CA bundle and also the OpenShift’s CA bundle which will be used by default for verifying the services’ certificate for the routes of `reencrypt` termination type and does not have destinationCA configured.

.Example
[source,yaml]
----
apiVersion: v1
data:
 ca-bundle.crt: |
   -----BEGIN CERTIFICATE-----
   <service-ca-bundle content>
   -----END CERTIFICATE-----
   -----BEGIN CERTIFICATE-----
   <admin-ca-bundle content>
   -----END CERTIFICATE-----
kind: ConfigMap
metadata:
 name: ingress-ca-bundle
 namespace: openshift-ingress
----
--

OpenShift Ingress Operator and Router will watch and automatically reload when changes to  `admin-ca-bundle` in `openshift-config` namespace, `service-ca-bundle` in `openshift-ingress` namespace, `ingress-ca-bundle` in `openshift-ingress` ConfigMaps is detected.

[NOTE]
====
If the CA is incorrectly configured in the route for any service, the traffic routed to such services encounters failure.
====


Additional resources to be placed in assmebly
Creating reencrypt route: https://docs.openshift.com/container-platform/4.14/networking/routes/secured-routes.html#nw-ingress-creating-a-reencrypt-route-with-a-custom-certificate_secured-routes

Creating a route using the destination CA certificate in the Ingress annotation https://docs.openshift.com/container-platform/4.14/networking/routes/route-configuration.html#creating-re-encrypt-route-with-custom-certificate_route-configuration

