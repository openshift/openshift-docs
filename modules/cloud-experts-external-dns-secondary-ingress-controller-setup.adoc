// Module included in the following assemblies:
//
// * cloud_experts_tutorials/cloud-experts-external-dns.adoc

:_mod-docs-content-type: PROCEDURE
[id="cloud-experts-external-dns-secondary-ingress-controller-setup_{context}"]
= Secondary ingress controller setup

[role="_abstract"]
Use the following procedure to deploy a secondary ingress controller using a custom domain.

.Prerequisites

* A unique domain, such as `apps.example.com`
* A wildcard or SAN TLS certificate configured with the custom domain selected above (`CN=*.apps.example.com`)

.Procedure

. Create a new TLS secret from a private key and a public certificate, where `fullchain.pem` is your full wildcard certificate chain (including any intermediaries) and `privkey.pem` is your wildcard certificate's private key:
+
[source,terminal]
----
$ oc -n openshift-ingress create secret tls external-dns-tls --cert=fullchain.pem --key=privkey.pem
----

. Create a new `IngressController` resource:
+
[source,terminal]
----
$ cat << EOF | oc apply -f -
apiVersion: operator.openshift.io/v1
kind: IngressController
metadata:
  name: external-dns-ingress
  namespace: openshift-ingress-operator
spec:
  domain: ${DOMAIN}
  defaultCertificate:
    name: external-dns-tls
  endpointPublishingStrategy:
    loadBalancer:
      dnsManagementPolicy: Unmanaged
      providerParameters:
        aws:
          type: NLB
        type: AWS
      scope: External
    type: LoadBalancerService
EOF
----
+
[WARNING]
====
This `IngressController` example will create an internet accessible Network Load Balancer (NLB) in your AWS account. To provision an internal NLB instead, set the `.spec.endpointPublishingStrategy.loadBalancer.scope` parameter to `Internal` before creating the `IngressController` resource.
====
+
. Verify that your custom domain IngressController has successfully created an external load balancer:
+
[source,terminal]
----
$ oc -n openshift-ingress get service/router-external-dns-ingress
----
+
**Example output**:
+
[source,terminal]
----
NAME                          TYPE           CLUSTER-IP      EXTERNAL-IP                                                                     PORT(S)                      AGE
router-external-dns-ingress   LoadBalancer   172.30.71.250   a4838bb991c6748439134ab89f132a43-aeae124077b50c01.elb.us-east-1.amazonaws.com   80:32227/TCP,443:30310/TCP   43s
----