:_newdoc-version: 2.18.4
:_template-generated: 2025-04-30
:_mod-docs-content-type: PROCEDURE

[id="migrating-the-collectors-and-the-default-log-store-to-openshift-logging-6_{context}"]
= Migrating the collectors and the default log store to OpenShift Logging 6



.Prerequisites
* Vector is defined as the log collection format. 
* LokiStack is used for Log Storage. 


.Procedure

. Migrate the storage from Elasticsearch to Loki if you are using the Red Hat Managed Log storage. For more information, see xref:../modules/log6x-migrating-storage-from-elasticsearch-to-lokistack.adoc[Migrating storage from Elasticsearch to LokiStack]

. Uninstall Logging view Plugin and CRD. 

. Install the {coo-first}.

. If you are not using the legacy service account "logcollector", create a service account by running the following command:
+
[source]
----
$ oc -n openshift-logging create serviceaccount collector
----

. Bind the Cluster Role to the Service Account by running the following command:
+
[source]
----
$ oc -n openshift-logging adm policy add-cluster-role-to-user logging-collector-logs-writer -z collector
----


. Add additional roles.
+
[source]
----
$ oc -n openshift-logging adm policy add-cluster-role-to-user collect-application-logs -z collector
$ oc -n openshift-logging adm policy add-cluster-role-to-user collect-audit-logs -z collector
$ oc -n openshift-logging adm policy add-cluster-role-to-user collect-infrastructure-logs -z collector
----

. Deploy the UIPlugin.

. xref:../modules/log6x-logging-upgrading-clo.adoc[Update the {clo}]
. xref:../modules/log6x-logging-upgrading-loki.adoc[Update the {loki-op}]

. Delete the ClusterLogging instance and deploy the ClusterLogForwarder observability Custom Resource
.. Delete the ClusterLogging instance because it is not neededed in Logging 6.
+
[source]
----
$ oc delete clusterlogging <CR name> -n <namespace>
----
.. Check that no collector pods are running:
+
[source]
----
$ oc get pods -l component=collector -n <namespace>
----

.. Deploy CLF CR:
+
[source]
----
$ cat << EOF |oc create -f -
apiVersion: observability.openshift.io/v1
kind: ClusterLogForwarder
metadata:
  name: collector
  namespace: openshift-logging
spec:
  serviceAccount:
    name: collector
  outputs:
  - name: default-lokistack
    type: lokiStack
    lokiStack:
      target:
        name: <Name_of_LokiStack>
        namespace: openshift-logging
      authentication:
        token:
          from: serviceAccount
    tls:
      ca:
        key: service-ca.crt
        configMapName: openshift-service-ca.crt
  pipelines:
  - name: default-logstore
    inputRefs:
    - application
    - infrastructure
    outputRefs:
    - default-lokistack
EOF
----

////
.Verification
Delete this section if it does not apply to your module. Provide the user with verification methods for the procedure, such as expected output or commands that confirm success or failure.

* Provide an example of expected command output or a pop-up window that the user receives when the procedure is successful.
* List actions for the user to complete, such as entering a command, to determine the success or failure of the procedure.
* Make each step an instruction.
* Use an unnumbered bullet (*) if the verification includes only one step.

.Troubleshooting
Delete this section if it does not apply to your module. Provide the user with troubleshooting steps.

* Make each step an instruction.
* Use an unnumbered bullet (*) if the troubleshooting includes only one step.

.Next steps
* Delete this section if it does not apply to your module.
* Provide a bulleted list of links that contain instructions that might be useful to the user after they complete this procedure.
* Use an unnumbered bullet (*) if the list includes only one step.

NOTE: Do not use *Next steps* to provide a second list of instructions.

[role="_additional-resources"]
.Additional resources
* link:https://github.com/redhat-documentation/modular-docs#modular-documentation-reference-guide[Modular Documentation Reference Guide]
* xref:some-module_{context}[]
////
