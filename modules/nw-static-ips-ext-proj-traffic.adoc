// Module filename: nw-static-ips-ext-proj-traffic.adoc
//
// Module included in the following assemblies:
// * networking/managing-networking.adoc

[id='nw-static-ips-ext-proj-traffic-{context}']
= Enabling Static IPs for External Project Traffic

As a cluster administrator, you can assign specific, static IP addresses to
projects, so that traffic is easily recognizable externally.

Recognizable IP traffic increases cluster security by ensuring that
the origin is
visible. Once enabled, all outgoing external connections from the specified
project shares the same, fixed source IP, therefore, external
resources can recognize the traffic.
This is subject to `EgressNetworkPolicy` firewall
rules.

.Procedure

To enable static source IPs:

. Update the `NetNamespace` with the desired IP:
+
----
$ oc patch netnamespace <project_name> -p '{"egressIPs": ["<IP_address>"]}'
----
+
For example, to assign the `MyProject` project to an IP address of
192.168.1.100:
+
----
$ oc patch netnamespace MyProject -p '{"egressIPs": ["192.168.1.100"]}'
----
+
The `egressIPs` field is an array. You can set `egressIPs`
to two or more IP addresses on different nodes to provide high
availability. If multiple egress IP addresses are set, pods use the first IP in
the list for egress, but if the node hosting that IP address fails, pods
switch to using the next IP in the list after a short delay.

. Manually assign the egress IP to the desired node hosts. Set the `egressIPs`
field on the `HostSubnet` object on the node host. Include as many IPs as you
want to assign to that node host:
+
----
$ oc patch hostsubnet <node_name> -p \
  '{"egressIPs": ["<IP_address_1>", "<IP_address_2>"]}'
----
+
For example, to say that `node1` should have the egress IPs 192.168.1.100,
192.168.1.101, and 192.168.1.102:
+
----
$ oc patch hostsubnet node1 -p \
  '{"egressIPs": ["192.168.1.100", "192.168.1.101", "192.168.1.102"]}'
----
+
[IMPORTANT]
====
Egress IPs are implemented as additional IP addresses on the primary network
interface, and must be in the same subnet as the node's primary IP.
Any external IPs should not be configured in any Linux network
configuration files, such as *_ifcfg-eth0_*.

Allowing additional IP addresses on the primary network interface might require
extra configuration when using some cloud or VM solutions.
====
+
If a static source IP is enabled for a project, all egress traffic from that
project is routed to the node hosting that egress IP, then connected, using NAT,
to that
IP address. If `egressIPs` is set on a `NetNamespace`, but there is no node
hosting that egress IP, then egress traffic from the namespace is dropped.
