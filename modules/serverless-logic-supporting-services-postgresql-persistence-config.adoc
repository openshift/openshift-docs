// Module included in the following assemblies:
// * serverless-logic/serverless-logic-managing-supporting-services


:_mod-docs-content-type: REFERENCE
[id="serverless-logic-supporting-services-postgresql-persistence-config_{context}"]
= PostgreSQL persistence configuration

For PostgreSQL persistence, you must set up a PostgreSQL server instance on your cluster. The administration of this instance remains independent of the {ServerlessLogicOperatorName} control. To connect a supporting service with the PostgreSQL server, you must configure the appropriate database connection parameters.

You can configure PostgreSQL persistence in the `SonataFlowPlatform` CR by using the following example:

.Example of PostgreSQL persistence configuration
[source,yaml]
----
apiVersion: sonataflow.org/v1alpha08
kind: SonataFlowPlatform
metadata:
  name: sonataflow-platform-example
  namespace: example-namespace
spec:
  services:
    dataIndex:
      enabled: true
      persistence:
        dbMigrationStrategy: job <1>
        postgresql:
          serviceRef:
            name: postgres-example <2>
            namespace: postgres-example-namespace <3>
            databaseName: example-database <4>
            databaseSchema: data-index-schema <5>
            port: 1234 <6>
          secretRef:
            name: postgres-secrets-example <7>
            userKey: POSTGRESQL_USER <8>
            passwordKey: POSTGRESQL_PASSWORD <9>
    jobService:
      enabled: true
      persistence:
        dbMigrationStrategy: job
        postgresql:
        # Specific database configuration for the Job Service
        # might be included here.
----

<1> Optional: Database migration strategy to use. Defaults to `service`.
<2> Name of the service to connect with the PostgreSQL database server.
<3> Optional: Defines the namespace of the PostgreSQL Service. Defaults to the `SonataFlowPlatform` namespace.
<4> Defines the name of the PostgreSQL database for storing supporting service data.
<5> Optional: Specifies the schema for storing supporting service data. Default value is `SonataFlowPlatform` name, suffixed with `-data-index-service` or `-jobs-service`. For example, `sonataflow-platform-example-data-index-service`.
<6> Optional: Port number to connect with the PostgreSQL Service. Default value is `5432`.
<7> Defines the name of the secret containing the username and password for database access.
<8> Defines the name of the key in the secret that contains the username to connect with the database.
<9> Defines the name of the key in the secret that contains the password to connect with the database.

[NOTE]
====
You can configure each serviceâ€™s persistence independently by using the respective persistence field.
====

Create the secrets to access PostgreSQL by running the following command:

[source,terminal]
----
$ oc create secret generic <postgresql_secret_name> \
  --from-literal=POSTGRESQL_USER=<user> \
  --from-literal=POSTGRESQL_PASSWORD=<password> \
  -n <namespace>
----