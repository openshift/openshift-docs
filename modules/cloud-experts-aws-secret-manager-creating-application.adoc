// Module included in the following assemblies:
//
// * cloud_experts_tutorials/cloud-experts-aws-secret-manager.adoc

:_mod-docs-content-type: PROCEDURE
[id="cloud-experts-aws-secret-manager-creating-application_{context}"]
= Create an Application to use this secret

[role="_abstract"]
You can create your application using the secret that you created.

.Procedure
. Create an OpenShift project by running the following command:
+
[source,terminal]
----
$ oc new-project my-application
----

. Annotate the default service account to use the STS Role by running the following command:
+
[source,terminal]
----
$ oc annotate -n my-application serviceaccount default \
    eks.amazonaws.com/role-arn=$ROLE_ARN
----

. Create a secret provider class to access our secret by running the following command:
+
[source,terminal]
----
$ cat << EOF | oc apply -f -
apiVersion: secrets-store.csi.x-k8s.io/v1
kind: SecretProviderClass
metadata:
  name: my-application-aws-secrets
spec:
  provider: aws
  parameters:
    objects: |
      - objectName: "MySecret"
        objectType: "secretsmanager"
EOF
----

. Create a deployment by using our secret in the following command:
+
[source,terminal]
----
$ cat << EOF | oc apply -f -
apiVersion: v1
kind: Pod
metadata:
  name: my-application
  labels:
    app: my-application
spec:
  volumes:
  - name: secrets-store-inline
    csi:
      driver: secrets-store.csi.k8s.io
      readOnly: true
      volumeAttributes:
        secretProviderClass: "my-application-aws-secrets"
  containers:
  - name: my-application-deployment
    image: k8s.gcr.io/e2e-test-images/busybox:1.29
    command:
      - "/bin/sleep"
      - "10000"
    volumeMounts:
    - name: secrets-store-inline
      mountPath: "/mnt/secrets-store"
      readOnly: true
EOF
----

. Verify the pod has the secret mounted by running the following command:
+
[source,terminal]
----
$ oc exec -it my-application -- cat /mnt/secrets-store/MySecret
----