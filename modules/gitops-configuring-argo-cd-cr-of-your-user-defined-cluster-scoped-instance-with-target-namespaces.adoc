// Module included in the following assemblies:
//
// * argocd_applications/managing-apps-in-non-control-plane-namespaces.adoc

:_mod-docs-content-type: PROCEDURE
[id="gitops-configuring-argo-cd-cr-of-your-user-defined-cluster-scoped-instance-with-target-namespaces_{context}"]
= Configuring the Argo CD CR of your user-defined cluster-scoped Argo CD instance with the target namespaces

[role="_abstract"]
As a cluster administrator, you can define a certain set of non-control plane namespaces in which users can create, update, and reconcile `Application` resources. You must first explicitly configure the target namespaces in the `ArgoCD` custom resource (CR) of your user-defined cluster-scoped Argo CD instance per your requirements.

.Prerequisites
* You are logged in to the {OCP} cluster as an administrator.
* You have installed {gitops-title} 1.13.0 or a later version on your {OCP} cluster.
* You have a user-defined cluster-scoped Argo CD instance in your defined namespace, for example, `spring-petclinic` namespace.

.Procedure

. In the *Administrator* perspective of the web console, click *Operators* -> *Installed Operators*.

. From the *Project* list, select the project where the user-defined cluster-scoped Argo CD instance is installed.

. Select *{gitops-title}* from the installed Operators list and go to the *Argo CD* tab.

. Click your user-defined cluster-scoped Argo CD instance.

. Configure the `ArgoCD` CR of your user-defined cluster-scoped Argo CD instance with the target namespaces:
.. Click the *YAML* tab and edit the YAML file of the `ArgoCD` CR.
.. In the `ArgoCD` CR, set the value of the `sourceNamespaces` parameter to include the non-control plane namespaces:
+
.Example `ArgoCD` CR 
[source,yaml]
----
apiVersion: argoproj.io/v1beta1
kind: ArgoCD
metadata:
  name: example # <1>
  namespace: spring-petclinic # <2>
spec:
  sourceNamespaces: # <3>
    - dev # <4>
    - app-team-* # <5>
----
<1> The name of the user-defined cluster-scoped Argo CD instance.
<2> The namespace where you want to run the user-defined cluster-scoped Argo CD instance.
<3> The list of non-control plane namespaces for creating and managing `Application` resources.
<4> The name of the target namespace for the Argo CD server to create and manage `Application` resources.
<5> With wildcards (`pass:[*]`), specifies the name of the target namespaces matching the pattern `app-team-pass:[*]`, such as `app-team-1` and `app-team-2`, for the Argo CD server to create and manage `Application` resources.
.. Click *Save* and *Reload*.
+
[NOTE]
====
When a target namespace is specified under the `sourceNamespaces` field, the Operator adds the `argocd.argoproj.io/managed-by-cluster-argocd` label to the specified namespace. 

.Example `dev` target namespace
[source,yaml]
----
apiVersion: v1
kind: Namespace
metadata:
  name: dev
  labels:
    argocd.argoproj.io/managed-by-cluster-argocd: spring-petclinic # <1>
    kubernetes.io/metadata.name: dev # <2>
----
<1> The namespace of the user-defined cluster-scoped Argo CD instance.
<2> The target namespace for the Argo CD server to create and manage `Application` resources.
====

. Verify that Operator adds the `argocd.argoproj.io/managed-by-cluster-argocd` label to the specified namespace:
.. Go to *Administration* -> *Namespaces* and click *Create Namespace*.
.. In the *Create Namespace* dialog box, provide the *Name* and click *Create*.
+
For example, to create `dev` target namespace, enter `dev` in the *Name* field. You can repeat the previous steps to create the `app-team-1` and `app-team-2` target namespaces.
+
The *Namespaces* page displays the created target namespaces.
.. Click the target namespace and go to the *YAML* tab to verify the `argocd.argoproj.io/managed-by-cluster-argocd` label added by the Operator.

. Verify that your user-defined cluster-scoped Argo CD instance is configured with a cluster role to manage cluster-scoped resources:
.. Go to *User Management* -> *Roles* and from the *Filter* list, select *Cluster-wide Roles*.
.. Search for the created cluster roles by using the *Search by name* field. For example, `example-spring-petclinic-argocd-application-controller` and `example-spring-petclinic-argocd-server`.
+
The *Roles* page displays the created cluster roles.
.. Verify that the following role-based access control (RBAC) resources are created by the {gitops-shortname} Operator:
+
[options="header"]
|===
|Name |Kind |Purpose
|`<argocd_name>-<argocd_namespace>-argocd-application-controller` |`ClusterRole` and `ClusterRoleBinding` |For the Argo CD Application Controller to watch and list `Application` resources at cluster-level

|`<argocd_name>-<argocd_namespace>-argocd-server` |`ClusterRole` and `ClusterRoleBinding` |For the Argo CD Server to watch and list `Application` resources at cluster-level

|`<argocd_name>-<target_namespace>` |`Role` and `RoleBinding` |For the Argo CD server to manage `Application` resources in target namespace through the UI, API, or CLI
|===