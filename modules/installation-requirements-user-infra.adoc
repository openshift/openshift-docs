// Module included in the following assemblies:
//
// * installing/installing_bare_metal/installing-bare-metal.adoc
// * installing/installing_bare_metal/installing-bare-metal-network-customizations.adoc
// * installing/installing_bare_metal/installing-restricted-networks-bare-metal.adoc
// * installing/installing_platform_agnostic/installing-platform-agnostic.adoc
// * installing/installing_vmc/installing-restricted-networks-vmc-user-infra.adoc
// * installing/installing_vmc/installing-vmc-user-infra.adoc
// * installing/installing_vmc/installing-vmc-network-customizations-user-infra.adoc
// * installing/installing_vsphere/installing-restricted-networks-vsphere.adoc
// * installing/installing_vsphere/installing-vsphere.adoc
// * installing/installing_vsphere/installing-vsphere-network-customizations.adoc
// * installing/installing_ibm_power/installing-ibm-power.adoc
// * installing/installing_ibm_power/installing-restricted-networks-ibm-power.adoc
// * installing/installing_ibm_z/installing-ibm-z.adoc
// * installing/installing_ibm_z/installing-restricted-networks-ibm-z.adoc

ifeval::["{context}" == "installing-ibm-z"]
:ibm-z:
endif::[]
ifeval::["{context}" == "installing-restricted-networks-ibm-z"]
:ibm-z:
endif::[]
ifeval::["{context}" == "installing-ibm-power"]
:ibm-power:
endif::[]
ifeval::["{context}" == "installing-restricted-networks-ibm-power"]
:ibm-power:
endif::[]
ifeval::["{context}" == "installing-bare-metal"]
:bare-metal:
endif::[]
ifeval::["{context}" == "installing-bare-metal-network-customizations"]
:bare-metal:
endif::[]
ifeval::["{context}" == "installing-restricted-networks-bare-metal"]
:bare-metal:
endif::[]
ifeval::["{context}" == "installing-vsphere"]
:vsphere:
endif::[]
ifeval::["{context}" == "installing-vsphere-network-customizations"]
:vsphere:
endif::[]
ifeval::["{context}" == "installing-restricted-networks-vsphere"]
:vsphere:
endif::[]

[id="installation-requirements-user-infra_{context}"]
= Machine requirements for a cluster with user-provisioned infrastructure

For a cluster that contains user-provisioned infrastructure, you must deploy all
of the required machines.

[id="machine-requirements_{context}"]
== Required machines

The smallest {product-title} clusters require the following hosts:

* One temporary bootstrap machine

* Three control plane, or master, machines

* At least two compute machines, which are also known as worker machines.
ifdef::bare-metal[]
If you are running a three-node cluster, running zero compute machines is supported. Running one compute machine is not supported.
endif::bare-metal[]

[NOTE]
====
The cluster requires the bootstrap machine to deploy the {product-title} cluster
on the three control plane machines. You can remove the bootstrap machine after
you install the cluster.
====

[IMPORTANT]
====
ifdef::ibm-z[]
To improve high availability of your cluster, distribute the control plane machines over different z/VM instances on at least two physical machines.
endif::ibm-z[]
ifndef::ibm-z[]
To maintain high availability of your cluster, use separate physical hosts for
these cluster machines.
endif::ibm-z[]
====

The bootstrap and control plane machines must use {op-system-first} as the operating system. However, the compute machines can choose between {op-system-first} or {op-system-base-full} 7.9.

ifndef::openshift-origin[]
Note that {op-system} is based on {op-system-base-full} 8 and inherits all of its hardware certifications and requirements.
endif::[]
See link:https://access.redhat.com/articles/rhel-limits[Red Hat Enterprise Linux technology capabilities and limits].

ifdef::vsphere[]
[IMPORTANT]
====
All virtual machines must reside in the same datastore and in the same folder as the installer.
====
endif::vsphere[]


[id="network-connectivity_{context}"]
== Network connectivity requirements

All the {op-system-first} machines require network in `initramfs` during boot to fetch Ignition config files from the Machine Config Server.
ifndef::ibm-z[]
During the initial boot, the machines require either a DHCP server or that static IP addresses be set in order to establish a network connection to download their Ignition config files.
endif::ibm-z[]
ifdef::ibm-z[]
The machines are configured with static IP addresses. No DHCP server is required.
endif::ibm-z[]
Additionally, each {product-title} node in the cluster must have access to a Network Time Protocol (NTP) server.
ifndef::ibm-z[]
If a DHCP server provides NTP servers information, the chrony time service on the {op-system-first} machines read the information and can sync the clock with the NTP servers.
endif::ibm-z[]

ifdef::ibm-z[]
[id="ibm-z-network-connectivity_{context}"]
== IBM Z network connectivity requirements

To install on IBM Z under z/VM, you require a single z/VM virtual NIC in layer 2 mode. You also need:

*   A direct-attached OSA or RoCE network adapter
*   A z/VM VSwitch set up. For a preferred setup, use OSA link aggregation.
endif::ibm-z[]

[id="minimum-resource-requirements_{context}"]
== Minimum resource requirements

Each cluster machine must meet the following minimum requirements:

[cols="2,2,2,2,2,2",options="header"]
|===

|Machine
|Operating System
ifndef::bare-metal[]
|vCPU ^[1]^
|Virtual RAM
endif::bare-metal[]
ifdef::bare-metal[]
|CPU ^[1]^
|RAM
endif::bare-metal[]
|Storage
ifndef::ibm-z[]
|IOPS ^[2]^
endif::ibm-z[]
ifdef::ibm-z[]
|IOPS
endif::ibm-z[]

|Bootstrap
|{op-system}
ifdef::ibm-power[|2]
ifndef::ibm-power[|4]
|16 GB
|100 GB
ifndef::ibm-z[]
|300
endif::ibm-z[]
ifdef::ibm-z[]
|N/A
endif::ibm-z[]


|Control plane
|{op-system}
ifdef::ibm-power[|2]
ifndef::ibm-power[|4]
|16 GB
|100 GB
ifndef::ibm-z[]
|300
endif::ibm-z[]
ifdef::ibm-z[]
|N/A
endif::ibm-z[]

ifndef::openshift-origin[]
|Compute
ifdef::ibm-z,ibm-power[|{op-system}]
ifndef::ibm-z,ibm-power[|{op-system} or RHEL 7.9]
|2
|8 GB
|100 GB
ifndef::ibm-z[]
|300
endif::ibm-z[]
ifdef::ibm-z[]
|N/A
endif::ibm-z[]
endif::openshift-origin[]

ifdef::openshift-origin[]
|Compute
ifdef::ibm-z,ibm-power[|{op-system}]
ifndef::ibm-z,ibm-power[|{op-system}]
|2
|8 GB
|100 GB
ifndef::ibm-z[]
|300
endif::ibm-z[]
ifdef::ibm-z[]
|N/A
endif::ibm-z[]
endif::openshift-origin[]
|===
[.small]
--
ifdef::ibm-z[]
1. One vCPU is equivalent to one physical core when simultaneous multithreading (SMT), or hyperthreading, is not enabled. When enabled, use the following formula to calculate the corresponding ratio: (threads per core × cores) × sockets = vCPUs.
endif::ibm-z[]
ifdef::bare-metal[]
1. One CPU is equivalent to one physical core when simultaneous multithreading (SMT), or hyperthreading, is not enabled. When enabled, use the following formula to calculate the corresponding ratio: (threads per core × cores) × sockets = CPUs.
endif::bare-metal[]
ifndef::ibm-z,bare-metal[]
1. One vCPU is equivalent to one physical core when simultaneous multithreading (SMT), or hyperthreading, is not enabled. When enabled, use the following formula to calculate the corresponding ratio: (threads per core × cores) × sockets = vCPUs.
endif::ibm-z,bare-metal[]
ifndef::ibm-z[]
2. {product-title} and Kubernetes are sensitive to disk performance, and faster storage is recommended, particularly for etcd on the control plane nodes which require a 10 ms p99 fsync duration. Note that on many cloud platforms, storage size and IOPS scale together, so you might need to over-allocate storage volume to obtain sufficient performance.
endif::ibm-z[]
--

ifdef::ibm-z[]
[id="minimum-ibm-z-system-requirements_{context}"]
== Minimum IBM Z system environment

You can install {product-title} version {product-version} on the following IBM hardware:

* IBM z15 (all models), IBM z14 (all models), IBM z13, and IBM z13s
* LinuxONE, any version

[discrete]
=== Hardware requirements

* The equivalent of 6 IFLs, which are SMT2 enabled, for each cluster.
* At least one network connection to both connect to the `LoadBalancer` service and to serve data for traffic outside the cluster.

[NOTE]
====
You can use dedicated or shared IFLs to assign sufficient compute resources. Resource sharing is one of the key strengths of IBM Z. However, you must adjust capacity correctly on each hypervisor layer and ensure sufficient resources for every {product-title} cluster.
====

[IMPORTANT]
====
Since the overall performance of the cluster can be impacted, the LPARs that are used to setup the {product-title} clusters must provide sufficient compute capacity. In this context, LPAR weight management, entitlements, and CPU shares on the hypervisor level play an important role.
====

[discrete]
=== Operating system requirements

* One instance of z/VM 7.1 or later

On your z/VM instance, set up:

* 3 guest virtual machines for {product-title} control plane machines
* 2 guest virtual machines for {product-title} compute machines
* 1 guest virtual machine for the temporary {product-title} bootstrap machine

[discrete]
=== Disk storage for the z/VM guest virtual machines

* FICON attached disk storage (DASDs). These can be z/VM minidisks, fullpack minidisks, or dedicated DASDs, all of which must be formatted as CDL, which is the default. To reach the minimum required DASD size for {op-system-first} installations, you need extended address volumes (EAV). If available, use HyperPAV to ensure optimal performance.
* FCP attached disk storage

[discrete]
=== Storage / Main Memory

* 16 GB for {product-title} control plane machines
* 8 GB for {product-title} compute machines
* 16 GB for the temporary {product-title} bootstrap machine

[id="preferred-ibm-z-system-requirements_{context}"]
== Preferred IBM Z system environment

[discrete]
=== Hardware requirements

* 3 LPARS that each have the equivalent of 6 IFLs, which are SMT2 enabled, for each cluster.
* Two network connections to connect to both connect to the `LoadBalancer` service and to serve data for traffic outside the cluster.
* HiperSockets, which are attached to a node either directly as a device or by bridging with one z/VM VSWITCH to be transparent to the z/VM guest. To directly connect HiperSockets to a node, you must set up a gateway to the external network via a {op-system-base} 8 guest to bridge to the HiperSockets network.

[discrete]
=== Operating system requirements

* 2 or 3 instances of z/VM 7.1 or later for high availability

On your z/VM instances, set up:

* 3 guest virtual machines for {product-title} control plane machines, one per z/VM instance.
* At least 6 guest virtual machines for {product-title} compute machines, distributed across the z/VM instances.
* 1 guest virtual machine for the temporary {product-title} bootstrap machine.
* To ensure the availability of integral components in an overcommitted environment, increase the priority of the control plane by using the CP command `SET SHARE`. Do the same for infrastructure nodes, if they exist. See link:https://www.ibm.com/docs/en/zvm/7.1?topic=commands-set-share[SET SHARE] in IBM Documentation.

[discrete]
== IBM Z network connectivity requirements

To install on IBM Z under z/VM, you require a single z/VM virtual NIC in layer 2 mode. You also need:

*   A direct-attached OSA or RoCE network adapter
*   A z/VM VSwitch set up. For a preferred setup, use OSA link aggregation.

[discrete]
=== Disk storage for the z/VM guest virtual machines

* FICON attached disk storage (DASDs). These can be z/VM minidisks, fullpack minidisks, or dedicated DASDs, all of which must be formatted as CDL, which is the default. To reach the minimum required DASD size for {op-system-first} installations, you need extended address volumes (EAV). If available, use HyperPAV and High Performance FICON (zHPF) to ensure optimal performance.
* FCP attached disk storage

[discrete]
=== Storage / Main Memory

* 16 GB for {product-title} control plane machines
* 8 GB for {product-title} compute machines
* 16 GB for the temporary {product-title} bootstrap machine
endif::ibm-z[]

ifeval::["{context}" == "installing-ibm-z"]
:!ibm-z:
endif::[]
ifeval::["{context}" == "installing-restricted-networks-ibm-z"]
:!ibm-z:
endif::[]
ifeval::["{context}" == "installing-ibm-power"]
:!ibm-power:
endif::[]
ifeval::["{context}" == "installing-restricted-networks-ibm-power"]
:!ibm-power:
endif::[]
ifeval::["{context}" == "installing-bare-metal"]
:!bare-metal:
endif::[]
ifeval::["{context}" == "installing-bare-metal-network-customizations"]
:!bare-metal:
endif::[]
ifeval::["{context}" == "installing-restricted-networks-bare-metal"]
:!bare-metal:
endif::[]
