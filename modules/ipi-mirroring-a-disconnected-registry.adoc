// Module included in the following assemblies:
//
// * list of assemblies where this module is included
// install/installing_bare_metal_ipi/ipi-install-installation-workflow.adoc

:_content-type: PROCEDURE
[id="ipi-mirroring-a-disconnected-registry_{context}"]

= Mirroring the repository (optional)

.Prerequisites

* You have installed OpenShift CLI (`oc`).
* You have a designated mirror registry.
* (Optional) You have installed the `oc-mirror-plugin` tool.

.Procedure

. Set the required environment variables.

.. Set the release version:
+
[source,terminal]
----
$ VERSION=<release_version>
----
+
For `<release_version>`, specify the tag that corresponds to the version of {product-title} to install, such as `{product-version}`.

.. Set the local registry name and host port:
+
[source,terminal]
----
$ LOCAL_REG='<local_registry_host_name>:<local_registry_host_port>'
----
+
For `<local_registry_host_name>`, specify the registry domain name for your mirror
repository, and for `<local_registry_host_port>`, specify the port that it
serves content on.

.. Set the local repository name:
+
[source,terminal]
----
$ LOCAL_REPO='<local_repository_name>'
----
+
For `<local_repository_name>`, specify the name of the repository to create in your
registry, such as `ocp4/openshift4`.

. Mirror the remote install images to the local repository:
+
[source,terminal]
----
$ /usr/local/bin/oc adm release mirror \
  -a pull-secret-update.txt \
  --from=$UPSTREAM_REPO \
  --to-release-image=$LOCAL_REG/$LOCAL_REPO:${VERSION} \
  --to=$LOCAL_REG/$LOCAL_REPO
----

[NOTE]
====
`oc adm release mirror` only mirrors payload content. If required, you can mirror additional content, for example, Operator images or release images, using the `oc-mirror-plug-in` tool. For more information, see "Mirroring images for a disconnected installation using the oc-mirror plug-in".
====
