// Module included in the following assemblies:
// serverles-logic/serverless-logic-authentication-openapi-services

:_mod-docs-content-type: REFERENCE
[id="serverless-logic-security-example-oauth-authentication_{context}"]
= Example of clientCredentials OAuth 2.0 authentication

The following example shows how to secure an OpenAPI operation using the OAuth 2.0 `clientCredentials` flow. The OpenAPI specification defines the `sayHelloOauth2` operation, which uses the `oauth-example` security scheme. Unlike simpler authentication methods such as HTTP Basic or API keys, OAuth 2.0 authentication requires additional integration with the Quarkus OpenID Connect (OIDC) Client.

.Example OpenAPI specification with OAuth 2.0
[source,json]
----
{
  "openapi": "3.1.0",
  "info": {
    "title": "Oauth2 Scheme Example",
    "version": "1.0"
  },
  "paths": {
    "/hello-with-oauth2": {
      "get": {
        "operationId": "sayHelloOauth2",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "text/plain": {
                "schema": {
                  "type": "string"
                }
              }
            }
          }
        },
        "security": [
          {
            "oauth-example": []
          }
        ]
      }
    }
  },
  "components": {
    "securitySchemes": {
      "oauth-example": {
        "type": "oauth2",
        "flows": {
          "clientCredentials": {
            "authorizationUrl": "https://example.com/oauth",
            "tokenUrl": "https://example.com/oauth/token",
            "scopes": {}
          }
        }
      }
    }
  }
}
----

In this example, the `sayHelloOauth2` operation is protected by the `oauth-example` security scheme, which uses the `clientCredentials` flow for token-based authentication.

[id="serverless-logic-security-oauth-support-oidc-client-filter-extention_{context}"]
== OAuth 2.0 Support with the OIDC Client filter extension

OAuth 2.0 token management is handled by a Quarkus `OidcClient`. To enable this integration, you must add the Quarkus OIDC Client Filter extension to your project as shown in the following examples:

.Example of adding extension using Maven
[source,text,subs=attributes]
----
<dependency>
<groupId>io.quarkus</groupId>
  <artifactId>quarkus-oidc-client-filter</artifactId>
</dependency>

<dependency>
  <groupId>io.quarkiverse.openapi.generator</groupId>
  <artifactId>quarkus-openapi-generator-oidc</artifactId>
  <version>{ServerlessLogicOauthDependencyVersion}</version>
</dependency>
----

.Example of adding extension using Quarkus CLI
[source,terminal]
----
$ quarkus extension add quarkus-oidc-client-filter
----

[id="serverless-logic-security-oidc-configuration_{context}"]
== `OidcClient` configuration

To access the secured operation, define an `OidcClient` configuration in your `application.properties` file. The configuration uses the sanitized security scheme name from the OpenAPI specification, in this case, `oauth_example` as follows:

[source,terminal]
----
quarkus.oidc-client.oauth_example.auth-server-url=https://example.com/oauth
quarkus.oidc-client.oauth_example.token-path=/tokens
quarkus.oidc-client.oauth_example.discovery-enabled=false
quarkus.oidc-client.oauth_example.client-id=kogito-app
quarkus.oidc-client.oauth_example.grant.type=client
quarkus.oidc-client.oauth_example.credentials.client-secret.method=basic
quarkus.oidc-client.oauth_example.credentials.client-secret.value=secret
----

In this configuration:

* `oauth_example` matches the sanitized name of the `oauth-example` scheme in the OpenAPI file. The link between the sanitized scheme name and the corresponding `OidcClient` is by using that simple naming convention.

* The OidcClient handles token generation and renewal automatically during workflow execution.