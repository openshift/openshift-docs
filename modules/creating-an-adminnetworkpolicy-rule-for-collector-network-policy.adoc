// Module included in the following assemblies:
//
// * configuring/cluster-logging-collector.adoc

:_newdoc-version: 2.18.4
:_template-generated: 2025-10-13
:_mod-docs-content-type: PROCEDURE

[id="creating-an-adminnetworkpolicy-rule-for-collector-network-policy_{context}"]
= Creating an AdminNetworkPolicy rule for resources managed by {clo}

[role="_abstract"]
To ensure that the pods running resources managed by {clo} can communicate when an `AdminNetworkPolicy` configuration is blocking traffic, create an `AdminNetworkPolicy` rule that delegates to a `NetworkPolicy` definition.

{ocp-product-title} network policy precedence:

* `AdminNetworkPolicy`: Cluster-admin controlled, highest priority.
* `BaselineAdminNetworkPolicy`: Default fallback rules.
* `NetworkPolicy`: Namespace-level policies. This is where collector policies reside.

.Prerequisites
* You have administrator permissions.
* You installed the {oc-first}.

.Procedure
. Create an `AdminNetworkPolicy` rule:
+
[source,yaml]
----
apiVersion: policy.networking.k8s.io/v1alpha1
kind: AdminNetworkPolicy
metadata:
  name: allow-logging-collector-delegation
spec:
  priority: 50 # Adjust based on your cluster's ANP priority scheme. Lower number means higher priority
  subject:
    pods: # Target the pods in openshift-logging namespace
      namespaceSelector:
        matchLabels:
          kubernetes.io/metadata.name: openshift-logging
      podSelector:
        matchLabels:
          app.kubernetes.io/name: <name>
          app.kubernetes.io/instance: <instance>
          app.kubernetes.io/managed-by: cluster-logging-operator
          app.kubernetes.io/part-of: cluster-logging
          app.kubernetes.io/component: <component>
  ingress:
    - name: "delegate-to-collector-ingress"
      action: "Pass"
      from:
        # Select all pods in all namespaces as the source.
        - pods:
            namespaceSelector: {}
            podSelector: {}
  egress:
    - name: "delegate-to-collector-egress"
      action: "Pass"
      to:
        # Select all pods in all namespaces for internal traffic.
        - pods:
            namespaceSelector: {}
            podSelector: {}
        # Select all external destinations for egress traffic.
        - networks:
          - "0.0.0.0/0"
          - "::/0"
----
+
To apply this network policy to all the resources in a namespace, remove `app.kubernetes.io/name`, `app.kubernetes.io/instance`, and `app.kubernetes.io/component` fields. To apply the admin network policy to specific resources, define the fields as follows:  
+
* Replace `<name>` with the name of the collector or the `LogFileMetricExporter` resource.
* Replace `<instance>` with the instance name of the collector or the `LogFileMetricExporter` resource.
* Replace `<component>` with the value `collector` or `logfilesmetricexporter`.


. Apply the `AdminNetworkPolicy` rule by running the following command:
+
[source,terminal]
----
$ oc apply -f <filename>.yaml
----

[role="_additional-resources"]
.Additional resources
* link:https://docs.redhat.com/en/documentation/openshift_container_platform/4.19/html-single/network_security/index#ovn-k-anp[OVN-Kubernetes AdminNetworkPolicy]
