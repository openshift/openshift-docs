
// Module included in the following assemblies:
//
// * assemblies/rosa-nodes-machinepools-configuring.adoc
:_content-type: CONCEPT
[id="rosa-nodes-machine-pools-local-zones_{context}"]
= Local Zones

Use the following steps to configure Local Zones for machine pools.

[IMPORTANT]
====
AWS Local Zones are supported on Red Hat OpenShift Service on AWS 4.12, and must be enabled by opening a support case with xref:rosa_architecture/rosa-getting-support.html#rosa-getting-support_rosa-getting-support [Red Hat Support].
====
.Prerequisites

* ROSA is live/GA in the parent region of choice. See the link:https://aws.amazon.com/about-aws/global-infrastructure/localzones/locations/?pg=ln&cp=bn#GA[AWS generally available locations list] to determine the Local Zone available to specific AWS regions.
* The ROSA cluster was initially built in an existing AWS VPC (BYO-VPC).
* The maximum transmission unit (MTU) for the ROSA cluster is set at 1200.
+
[IMPORTANT]
====
Generally, the Maximum Transmission Unit (MTU) between an Amazon EC2 instance in a Local Zone and an Amazon EC2 instance in the Region is 1300. See link:https://docs.aws.amazon.com/local-zones/latest/ug/how-local-zones-work.html[How Local Zones work] in the AWS documentation. 
The cluster network MTU must be always less than the EC2 MTU to account for the overhead. The specific overhead is determined by your network plugin, for example:

- OVN-Kubernetes: `100 bytes`
- OpenShift SDN: `50 bytes`

The network plugin could provide additional features, like IPsec, that also must be decreased the MTU. Check the documentation for additional information.

====
* The AWS account has link:https://docs.aws.amazon.com/local-zones/latest/ug/getting-started.html#getting-started-find-local-zone[Local Zones enabled].
* The AWS account has a link:https://docs.aws.amazon.com/local-zones/latest/ug/getting-started.html#getting-started-create-local-zone-subnet[Local Zone subnet] for the same VPC as the cluster.

.Procedure

. Create a machine pool on the cluster in ROSA CLI.
+
[source,terminal]
----
$ rosa create machinepool -c <cluster-name> -i 
----
+
. Add the subnet and instance type for the machine pool in ROSA CLI. After several minutes, the cluster will provision the nodes.
+
[source, terminal]
----
I: Enabling interactive mode <1>
? Machine pool name: xx-lz-xx <2>
? Create multi-AZ machine pool: No <3>
? Select subnet for a single AZ machine pool (optional): Yes <4>
? Subnet ID: subnet-<a> (region-info) <5>
? Enable autoscaling (optional): No <6>
? Replicas: 2 <7>
I: Fetching instance types <8>
----
+

<1> Enables interactive mode.
<2> Names the machine pool. This is limited to alphanumeric and a maximum length of 30 characters.
<3> Set this option to no.
<4> Set this option to yes.
<5> Selects a subnet ID from the list. Associate the subnet with a routing table that has a route to a NAT gateway.
<6> Set this option to no.
<7> Selects the number of machines for the machine pool. This number can be anywhere from 1 - 180.
<8> Selects an instance type from the list. Only instance types that are supported in the selected Local Zone will appear.
+
. Add the `kubernetes.io/cluster/<infra_id>: shared` tag to the subnet.
. Provide the subnet ID to provision the machine pool in the Local Zone.

See the link:https://aws.amazon.com/about-aws/global-infrastructure/localzones/locations/[AWS Local Zones locations] list on AWS for generally available and announced AWS Local Zone locations.

[NOTE]
====
Local machine pools can be added to single Availability Zone clusters.
====