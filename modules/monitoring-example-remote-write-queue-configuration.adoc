// Module included in the following assemblies:
//
// * observability/monitoring/configuring-the-monitoring-stack.adoc

:_mod-docs-content-type: REFERENCE
[id="example-remote-write-queue-configuration_{context}"]
= Example remote write queue configuration

// Set attributes to distinguish between cluster monitoring example (core platform monitoring - CPM) and user workload monitoring (UWM) examples
// tag::CPM[]
:configmap-name: cluster-monitoring-config
:namespace-name: openshift-monitoring
:component: prometheusK8s
// end::CPM[]
// tag::UWM[]
:configmap-name: user-workload-monitoring-config
:namespace-name: openshift-user-workload-monitoring
:component: prometheus
// end::UWM[]

[role="_abstract"]
You can use the `queueConfig` object for remote write to tune the remote write queue parameters. The following example shows the queue parameters with their default values for 
// tag::CPM[]
default platform monitoring
// end::CPM[]
// tag::UWM[]
monitoring for user-defined projects
// end::UWM[]
in the `{namespace-name}` namespace.

.Example configuration of remote write parameters with default values
[source,yaml,subs="attributes+"]
----
apiVersion: v1
kind: ConfigMap
metadata:
  name: {configmap-name}
  namespace: {namespace-name}
data:
  config.yaml: |
    {component}:
      remoteWrite:
      - url: "https://remote-write-endpoint.example.com" 
        <endpoint_authentication_credentials>
        queueConfig:
          capacity: 10000
          minShards: 1
          maxShards: 50
          maxSamplesPerSend: 2000
          batchSendDeadline: 5s
          minBackoff: 30ms
          maxBackoff: 5s
          retryOnRateLimit: false
          sampleAgeLimit: 0s
----

where:

`capacity`::
Defines the number of samples to buffer per shard before they are dropped from the queue.

`minShards`::
Defines the minimum number of shards.

`maxShards`::
Defines the maximum number of shards.

`maxSamplesPerSend`::
Defines the maximum number of samples per send.

`batchSendDeadline`::
Defines the maximum time for a sample to wait in buffer.

`minBackoff`::
Defines the initial time to wait before retrying a failed request. The time gets doubled for every retry up to the `maxbackoff` time.

`maxBackoff`::
Defines the maximum time to wait before retrying a failed request.

`retryOnRateLimit`::
When set to `true`, retries a request after receiving a 429 status code from the remote write storage.

`sampleAgeLimit`::
Specifies that samples older than the `sampleAgeLimit` limit are dropped from the queue. If the value is undefined or set to `0s`, the parameter is ignored.

// Unset the source code block attributes just to be safe.
:!configmap-name:
:!namespace-name:
:!component:
