// Module included in the following assemblies:
//
// * applications/pruning-objects.adoc

:_mod-docs-content-type: CONCEPT
[id="pruning-images-manual_{context}"]
= Manually pruning images

// out of scope for this PR - needs to be split into multiple modules, there shouldn't be multiple procedures in one module

The pruning custom resource enables automatic image pruning for the images from the {product-registry}. Administrators can manually prune images with the `oc adm prune images <image_prune_option>` command. For example: 

[source,terminal]
----
$ oc adm prune images <image_prune_option> <1>
----
<1> For more information about available pruning options, see "Manual image pruning command options".

This command removes images that are no longer required by the system.

Depending on your needs, you can prune images based on their age and tag history, or prune images that cause a project to exceed its defined storage limits. 

[id="considerations-pruning-images_{context}"]
== Considerations when pruning images

Consider the following information before manually pruning images:

* Pruning with the `--namespace` flag does not remove images. It only removes image streams, because images are cluster-scoped resources. Limiting pruning to a particular namespace makes it impossible to calculate current usage.

* By default, the integrated registry caches metadata of blobs to reduce the number of requests to storage, and to increase request-processing speed. Pruning does not update the integrated registry cache. Images that still contain pruned layers after pruning will be broken because the pruned layers that have metadata in the cache will not be pushed. Therefore, you must redeploy the registry to clear the cache after pruning:
+
[source,terminal]
----
$ oc rollout restart deployment/image-registry -n openshift-image-registry
----

* If the integrated registry uses a Redis cache, you must clean the database manually.

* If redeploying the registry after pruning is not an option, then you must permanently disable the cache.

* `oc adm prune images` operations require a route for your registry. Registry routes are not created by default.


[id="additional-pruning-limitations_{context}"]
== Limitations when pruning images

The following limitations apply when pruning an image:

* Pruning images from external registries is unsupported.

* When an image is pruned, all references to the image are removed from all image streams that contain the image in `status.tags`.

* Image layers that are no longer referenced by any images are removed.
