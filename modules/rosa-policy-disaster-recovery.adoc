// Module included in the following assemblies:
//
// * rosa_architecture/rosa_policy_service_definition/rosa-policy-shared-responsibility.adoc

:_mod-docs-content-type: CONCEPT
[id="rosa-policy-disaster-recovery_{context}"]
= Disaster recovery

[role="_abstract"]
Disaster recovery includes data and configuration backup, replicating data and configuration to the disaster recovery environment, and failover on disaster events.

All disaster recovery requires that the customer use best practices for deploying highly available applications, storage, and cluster architecture, such as multiple machine pools across multiple Availability Zones (AZ), to account for the level of desired availability.

One cluster with a single machine pool will not provide disaster avoidance or recovery in case of an AZ or region outage. Multiple clusters with single machine pools with customer-maintained failover can account for outages at the zone or at the regional level.

One cluster with multiple machine pools across multiple AZs will not provide disaster avoidance or recovery in case of a full region outage. Multiple clusters in several regions with multiple machine pools in more than one AZ with customer-maintained failover can account for outages at the regional level.

[cols="2a,3a,3a" ,options="header"]
|===
|Resource
|Service responsibilities
|Customer responsibilities

|Virtual networking management
|**Red{nbsp}Hat**

- Re-create affected virtual network components that are necessary for the platform to function.
|- Configure virtual networking connections with more than one tunnel where possible for protection against outages as recommended by the public cloud provider.
- Maintain failover DNS and load balancing if using a global load balancer with multiple clusters.
//waiting to hear back from Will G. if RH responsibilities below should have just been conditionalized out per the migration review for hcp or Classic as well.
|Virtual Storage management
|**Red{nbsp}Hat**

ifdef::openshift-rosa[]
- For {product-title} clusters created with IAM user credentials, back up all Kubernetes objects on the cluster through hourly, daily, and weekly volume snapshots. Hourly backups are retained for 24 hrs (1 day), daily backups are retained for 168 hrs (1 week), and weekly backups are retained for 720 hrs (30 days).
endif::openshift-rosa[]

|- Back up customer applications and application data.

|Virtual compute management
|**Red{nbsp}Hat**
ifdef::openshift-rosa[]
- Monitor the cluster and replace failed Amazon EC2 control plane or infrastructure nodes.
endif::openshift-rosa[]

- Provide the ability for the customer to manually or automatically replace failed worker nodes.

|- Replace failed Amazon EC2 worker nodes by editing the machine pool configuration through {cluster-manager} or the {rosa-cli-first}.

ifdef::openshift-rosa-hcp[]
|Control plane
|**Red{nbsp}Hat**

- Use snapshots, troubleshooting tools, and clusters deployed in multiple AZs to minimize recovery time in case of disaster events.

- Take a full snapshot of the control plane etcd database every 6 hours and retain the snapshot for 24 hours.

- Inform the customer of a disaster recovery scenario and coordinate recovery efforts.

|- Cooperate with Red{nbsp}Hat during disaster recovery events.

|Data plane (worker nodes)
|**Red{nbsp}Hat**

- Red{nbsp}Hat is available to support customer efforts to restore data and applications upon submission of a support case.

|- Back up data plane contents and configuration.
endif::openshift-rosa-hcp[]

|AWS software (public AWS services)
|**AWS**

**Compute:** Provide Amazon EC2 features that support data resiliency such as Amazon EBS snapshots and Amazon EC2 Auto Scaling. For more information, see link:https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/disaster-recovery-resiliency.html[Resilience in Amazon EC2] in the EC2 User Guide.

**Storage:** Provide the ability for the {product-title} service and customers to back up the Amazon EBS volume on the cluster through Amazon EBS volume snapshots.

**Storage:** For information about Amazon S3 features that support data resiliency, see link:https://docs.aws.amazon.com/AmazonS3/latest/userguide/disaster-recovery-resiliency.html[Resilience in Amazon S3].

**Networking:** For information about Amazon VPC features that support data resiliency, see link:https://docs.aws.amazon.com/vpc/latest/userguide/disaster-recovery-resiliency.html[Resilience in Amazon Virtual Private
Cloud] in the Amazon VPC User Guide.

|- Configure {product-title} clusters with multiple machine pools across multiple AZs to improve fault tolerance and cluster availability.

- Provision persistent volumes using the Amazon EBS CSI driver to enable volume snapshots.

- Create CSI volume snapshots of Amazon EBS persistent volumes.
|Hardware/AWS global infrastructure
|**AWS**

- Provide AWS global infrastructure that allows {product-title} to scale
ifdef::openshift-rosa[]
control plane, infrastructure, and worker nodes
endif::openshift-rosa[]
ifdef::openshift-rosa-hcp[]
nodes
endif::openshift-rosa-hcp[]
across AZs. This functionality enables orchestration of automatic failover between zones without interruption.

- For more information about disaster recovery best practices, see link:https://docs.aws.amazon.com/whitepapers/latest/disaster-recovery-workloads-on-aws/disaster-recovery-options-in-the-cloud.html[Disaster recovery options in the cloud] in the AWS Well-Architected Framework.

|- Configure {product-title} clusters with multiple machine pools across multiple AZs to improve fault tolerance and cluster availability.
|===
