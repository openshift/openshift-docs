// Module included in the following assemblies:
//
// * nodes/nodes-pods-allocate-dra.adoc

:_mod-docs-content-type: REFERENCE
[id="nodes-pods-allocate-dra-configure-about_{context}"]
= About GPU allocation objects and concepts

// Taken from https://kubernetes.io/docs/concepts/scheduling-eviction/dynamic-resource-allocation/#terminology
[role="_abstract"]
You can use the following {attribute-based-full} objects and concepts to ensure that a workload is scheduled on a node with the graphics processing unit (GPU) specifications it needs. You should be familiar with these objects before proceeding.

Device class::
A device class is a category of devices that pods can claim. Some device drivers contain their own device class. Alternatively, an administrator can create device classes. A device class contains a device selector, which is a link:https://cel.dev/[common expression language (CEL)] expression that must evaluate to true if a device satisfies the request.
+
The following example `DeviceClass` object selects any device that is managed by the `driver.example.com` device driver:
+
.Example device class object
[source,yaml]
----
apiVersion: resource.k8s.io/v1
kind: DeviceClass
metadata:
  name: example-device-class
spec:
  selectors:
  - cel:
      expression: |-
        device.driver == "driver.example.com"
----
+
--
where:

`spec.selectors`:: Specifies a CEL expression for selecting a device.
--

Resource slice::
The DRA driver on each node creates and manages _resource slices_, which describe what resources are available in that cluster. A resource slice represents one or more GPU resources that are attached to nodes. When a resource claim is created and used in a pod, {product-title} uses the resource slices to find nodes that have the requested resources. After finding an eligible resource slice for the resource claim, the {product-title} scheduler updates the resource claim with the allocation details, allocates resources to the resource claim, and schedules the pod onto a node that can access the resources.
+
.Example resource slice object
[source,yaml]
----
apiVersion: v1
items:
- apiVersion: resource.k8s.io/v1
  kind: ResourceSlice
# ...
spec:
    driver: driver.example.com
    nodeName: dra-example-driver
    pool:
      generation: 0
      name: dra-example-driver
      resourceSliceCount: 1
    devices:
    - attributes:
        driverVersion:
          version: 1.0.0
        index:
          int: 0
        model:
          string: LATEST-GPU-MODEL
        uuid:
          string: gpu-18db0e85-99e9-c746-8531-ffeb86328b39
      capacity:
        memory:
          value: 10Gb
      name: 2g-10gb
# ...
----
+
--
where:

`spec.driver`:: Specifies the name of the DRA driver, which you can specify in a device class. 

`spec.devices.attributes`:: Specifies a device that you can allocate by using a resource claim or resource claim template.
--

Resource claim template::
Cluster administrators and operators can create a _resource claim template_, which describes the GPU resource that a pod requires. The administrator or operator adds the resource claim to a pod specification. {product-title} uses the resource claim template to generate the resource claim for the pod. The {product-title} scheduler then schedules that pod on a node in the cluster that has the requested GPU.  
+
Each resource claim that {product-title} generates from the template is bound that specific pod. A such, the GPU cannot be used simultaneously by another workload. When the pod terminates, {product-title} deletes the corresponding resource claim.
+
You must specify either a request for a specific device that the scheduler must meet, or a provide a prioritized list of devices for the scheduler to choose from.
+
The following example resource claim template contains two sub-requests. Of these sub-requests, only one is selected by the scheduler. The scheduler tries to satisfy the sub-requests in the order in which they are listed. A CEL expression is used inside the sub-request for selecting a device. 
+
.Example resource claim template object
[source,yaml]
----
apiVersion: resource.k8s.io/v1
kind: ResourceClaimTemplate
metadata:
  namespace: gpu-claim
  name: gpu-devices
spec:
  spec:
    devices:
      requests:
      - name: req-0
        firstAvailable:
        - name: 2g-10gb
          deviceClassName: example-device-class
          selectors:
          - cel:
              expression: "device.attributes['driver.example.com'].profile == '2g.10gb'"
        - name: 3g-20gb
          deviceClassName: example-device-class
          selectors:
          - cel:
              expression: "device.attributes['driver.example.com'].profile == '3g.20gb'"
----
+
--
where:

`spec.spec.devices.requests`:: Specifies a list of one or more requests for devices. The sub-request must include either `exactly` or `firstAvailable`.
+
* `exactly`: Specifies a request for one or more identical devices. The devices must match the request exactly for the request to be satisfied. If the requested device is not available, the scheduler cannot create the pod.  
* `firstAvailable`: Specifies multiple requests for a device, of which only one device needs to be available before the scheduler can create the requesting pod. The scheduler checks the availability of the devices in the order listed and selects the first available device. The scheduler can create the pod if one requested devices is available.

`spec.devices.requests.exactly.deviceClassName` or `spec.devices.requests.firstAvailable.deviceClassName`:: Specifies which device class to use with this request.

`spec.devices.requests.exactly.selectors` or `spec.devices.requests.firstAvailable.selectors`:: Specifies CEL expressions to request specific devices from the specified device class.
--

Resource claim::
Admins and operators can create a _resource claim_, which describes the GPU resource that a pod requires. The administrator or operator adds the resource claim to a pod specification. The {product-title} scheduler then schedules that pod on a node in the cluster that has the requested GPU. 
+
A resource claim can be used in multiple pod specifications, which allows you to share GPUs with multiple workloads. Resource claims are not deleted when a requesting pod is terminated. 
+
For the device request in a resource claim, you must specify either a list of one or more device requests that the scheduler must meet, or a provide a prioritized list of requests for the scheduler to choose from.
+
The following example resource claim uses a CEL expression to request one device in the `example-device-class` device class. Here, the `exactly` parameter indicates that a node with the specific requested device must be available before the scheduler can create the pod.
+
.Example resource claim object
[source,yaml]
----
apiVersion: resource.k8s.io/v1
kind: ResourceClaim
metadata:
  namespace: gpu-claim
  name: gpu-devices
spec:
  devices:
    requests:
    - name: req-0
      exactly:
        name: 2g-10gb
        deviceClassName: example-device-class
        selectors:
        - cel:
            expression: "device.attributes['driver.example.com'].profile == '2g.10gb'"
----

Admin access::
A cluster administrator can gain privileged access to a device that is in use by other users. This enables administrators to perform tasks such as monitoring the health and status of devices while ensuring that users can continue to use these devices with their workloads.
+
To gain admin access, an administrator must create a resource claim or resource claim template with the `adminAccess: true` parameter in a namespace that includes the `resource.kubernetes.io/admin-access: "true"` label. Non-administrator users cannot access namespaces with this label. 
+
.Example namespace with admin access label
[source,yaml]
----
apiVersion: v1
kind: Namespace
metadata:
  labels:
    resource.kubernetes.io/admin-access: "true"
# ...
----
+
In the following example, the administrator is granted access to the `2g-10gb` device:
+
.Example resource claim object with admin access
[source,yaml]
----
apiVersion: resource.k8s.io/v1
kind: ResourceClaimTemplate
metadata:
  name: large-black-cat-claim-template
spec:
  devices:
    requests:
    - name: req-0
      exactly:
        allocationMode: All
        adminAccess: true
        deviceClassName: example-device-class
        selectors:
        - cel:
            expression: "device.attributes['driver.example.com'].profile == '2g.10gb'"
----
+
--
where:

`spec.devices.requests.exactly.adminAccess.true` or `spec.devices.requests.firstAvailable.adminAccess.true`:: Specifies that the admin access mode is enabled for the specified device.
--

For information on adding resource claims to pods, see "Adding resource claims to pods".
