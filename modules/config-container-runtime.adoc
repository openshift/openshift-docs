// Module included in the following assemblies:
//
// * machine_configuration/machine-configs-custom.adoc

:_mod-docs-content-type: PROCEDURE
[id="config-container-runtime_{context}"]
= Configuring the container runtime

ifeval::["{product-version}" == "4.18"]
:418:
endif::[]


ifdef::418[]
[role="_abstract"]
Starting in {product-title} {product-version}, crun is the default container runtime for new containers. If you updated to 4.18 from an earlier {product-title} version, the runc container runtime remains the default. You can change the container runtime to crun to take advantage of the improvements over runC, if needed.

Specific machine configs were added to 4.18 to override the new default of crun as the runtime. You can remove these machine configs at any time to change the container runtime used with new workloads in your cluster. 

You can change between the runtimes by using a `ContainerRuntimeConfig` object, as described in the procedure below.
endif::[]

ifndef::4.18[]
[role="_abstract"]
You can change the container runtime used for new containers between the default crun and runC, if needed. 
endif::[]

Changing the container runtime affects new workloads only. Existing workloads continue to use the existing container runtime. 

For information on crun and runC, see "About the container engine and container runtime".

.Procedure
ifdef::418[]
* Perform the following tasks as appropriate:

* Configure crun as the container runtime for worker nodes by running the following command:
+
[source,terminal]
----
$ oc delete machineconfig 00-override-worker-generated-crio-default-container-runtime
----

* Configure crun as the container runtime for control plane nodes by running the following command:
+
[source,terminal]
----
$ oc delete machineconfig 00-override-master-generated-crio-default-container-runtime
----
endif::418[]

* Configure the container runtime for specific nodes by creating a container runtime configuration:

** Create a YAML file for the `ContainerRuntimeConfig` CR:
+
[source,yaml]
----
apiVersion: machineconfiguration.openshift.io/v1
kind: ContainerRuntimeConfig
metadata:
 name: configure-runc
spec:
 machineConfigPoolSelector:
   matchLabels:
     pools.operator.machineconfiguration.openshift.io/worker: ''
 containerRuntimeConfig:
   defaultRuntime: "runc"
----
where:
+
--
* `spec.machineConfigPoolSelector.matchLabels`:: Specifies a label for the machine config pool that you want you want to modify.
* `spec.containerRuntimeConfig.defaultRuntime`:: Specified the container runtime to use with new workloads, either `crun` or `runc`.
--

** Create the `ContainerRuntimeConfig` CR:
+
[source,terminal]
----
$ oc create -f <file_name>.yaml
----

.Verification

. After the nodes return to a ready state, open an `oc debug` session to a node by running a command similar to the following:
+
[source,terminal]
----
$ oc debug node/<node_name>
----
+
. Set `/host` as the root directory within the debug shell by running the following command:
+
[source,terminal]
----
sh-5.1# chroot /host
----

. Check the container runtime by using the following command:
+
[source,terminal]
----
sh-5.1# crio status config | grep default_runtime
----
+
.Example output
[source,terminal]
----
INFO[2026-01-27 23:09:18.413462914Z] Starting CRI-O, version: 1.30.14-6.rhaos4.17.gitfa27f6f.el9, git: unknown(clean) 
    default_runtime = "runc"
----

ifeval::["{product-version}" == "4.18"]
:!418:
endif::[]
