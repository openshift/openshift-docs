// Module included in the following assemblies:
//
// * microshift_install_rpm_ostree/microshift-embed-into-rpm-ostree.adoc
// * microshift_install_rpm/microshift-update-rpms-ostree.adoc

:_mod-docs-content-type: PROCEDURE
[id="adding-microshift-service-to-blueprint_{context}"]
= Adding the {microshift-short} service to a blueprint

[role="_abstract"]
Adding the {microshift-short} RPM package to an image builder blueprint enables the build of a {op-system-ostree} image with {microshift-short} embedded.

.Procedure

. Use the blueprint installed in the `/usr/share/microshift/blueprint` directory that is specific to your platform architecture. See the following example snippet for an explanation of the blueprint sections:
+
.Generated image builder blueprint example snippet
[source,text,subs="attributes+"]
----
name = "microshift_blueprint"
description = "MicroShift {ocp-version}.1 on x86_64 platform"
version = "0.0.1"
modules = []
groups = []

[[packages]]
name = "microshift"
version = "{ocp-version}.1"
...
...

[customizations.services]
enabled = ["microshift"]

[customizations.firewall]
ports = ["ssh"]
...
...

[[containers]]
source = "quay.io/openshift-release-dev/ocp-v4.0-art-dev@sha256:f41e79c17e8b41f1b0a5a32c3e2dd7cd15b8274554d3f1ba12b2598a347475f4"

[[containers]]
source = "quay.io/openshift-release-dev/ocp-v4.0-art-dev@sha256:dbc65f1fba7d92b36cf7514cd130fe83a9bd211005ddb23a8dc479e0eea645fd"
...
â€¦
EOF
----
* `\[[packages]] name = "microshift"`: references for all non-optional {microshift-short} RPM packages using the same version compatible with the `microshift-release-info` RPM.
* `[customizations.services] enabled = ["microshift"]`: references for automatically enabling {microshift-short} on system startup and applying default networking settings.
* `\[[containers]] source = "quay.io/openshift-release-dev/...`: references for all non-optional {microshift-short} container images necessary for an offline deployment. The SHA depends on the release you are using.

. Add the blueprint to the image builder by running the following command:
+
[source,terminal]
----
$ sudo composer-cli blueprints push microshift_blueprint.toml
----

.Verification

. Verify the image builder configuration listing only {microshift-short} packages by running the following command:
+
[source,terminal]
----
$ sudo composer-cli blueprints depsolve microshift_blueprint | grep microshift
----
+
.Example output
[source,terminal,subs="+attributes"]
----
blueprint: microshift_blueprint v0.0.1
    microshift-release-info-{ocp-version}.1-202511250827.p0.g4105d3b.assembly.{ocp-version}.1.el9.noarch
    microshift-{ocp-version}.1-202511250827.p0.g4105d3b.assembly.{ocp-version}.1.el9.x86_64
----

. Optional: Verify the image builder configuration that lists all of the components to be installed by running the following command:
+
[source,terminal,subs="+quotes"]
----
$ sudo composer-cli blueprints depsolve microshift_blueprint
----
