// module included in the following assemblies:
//
// * configuration/monitor-acs.adoc

:_mod-docs-content-type: PROCEDURE
[id="setting-up-a-prometheus-server-scraping-from-central-service_{context}"]
= Setting up a Prometheus server scraping from Central service

Before connecting Perses or other monitoring tools, configure Prometheus to scrape metrics from the Central service. For example, configure the machine access integration for the Kubernetes service account by creating a service account, performing role mapping, and assigning the necessary permissions. This ensures that Prometheus can securely access Central API data for monitoring and visualization purposes.

.Procedure

.  Perform role mapping to ensure that the Prometheus server can access the Central API with a service account token:
.. Create and assign a role with the appropriate permission set and scope.
.. Add a role mapping to the machine access configuration by using the following service account information:
+
--
[horizontal]
`type`:: `KUBE_SERVICE_ACCOUNT`
`key`:: `sub`
`value`:: `system:serviceaccount:stackrox:prometheus-server`
--

. Verify that the Prometheus custom resource (CR) contains the following information:
+
[source,yaml]
----
# ...
  serviceAccountName: prometheus-server
  volumes:
  - name: prometheus-token
    projected:
      sources:
      - serviceAccountToken:
          path: token
          expirationSeconds: 3600
  volumeMounts:
  - name: prometheus-token
    mountPath: /var/run/secrets/tokens
    readOnly: true
  additionalScrapeConfigs:
    name: prometheus-additional-scrape-configs
    key: prometheus-additional.yaml
# ...
----

. Create the additional scrape configuration secret by using the following content, for example:
+
[source,yaml]
----
apiVersion: v1
kind: Secret
metadata:
  name: prometheus-additional-scrape-configs
  namespace: stackrox
stringData:
  prometheus-additional.yaml: |
    - job_name: 'central-metrics'
      scheme: https
      metrics_path: /metrics
      bearer_token_file: /var/run/secrets/tokens/token
      tls_config:
        insecure_skip_verify: true
      static_configs:
      - targets: ['central.stackrox.svc.cluster.local:443']
----