// Module included in the following assemblies:
//
// * installing/installing_aws/installing-aws-network-customizations.adoc
// * installing/installing_azure/installing-azure-network-customizations.adoc
// * installing/installing_bare_metal/installing-bare-metal-network-customizations.adoc
// * installing/installing_vmc/installing-vmc-network-customizations-user-infra.adoc
// * installing/installing_vsphere/installing-vsphere-network-customizations.adoc
// * installing/installing_gcp/installing-gcp-network-customizations.adoc
// * installing/installing_vmc/installing-vmc-network-customizations.adoc
// * installing/installing_vsphere/installing-vsphere-installer-provisioned-network-customizations.adoc

ifeval::["{context}" == "installing-bare-metal-network-customizations"]
:ignition-config:
endif::[]
ifeval::["{context}" == "installing-vsphere-network-customizations"]
:ignition-config:
:vsphere:
endif::[]
ifeval::["{context}" == "installing-vmc-network-customizations-user-infra"]
:ignition-config:
:vmc:
endif::[]

:_content-type: PROCEDURE
[id="modifying-nwoperator-config-startup_{context}"]
= Specifying advanced network configuration

You can use advanced configuration customization to integrate your cluster into your existing network environment by specifying additional configuration for your cluster network provider.
You can specify advanced network configuration only before you install the cluster.

[IMPORTANT]
====
Modifying the {product-title} manifest files created by the installation program is not supported. Applying a manifest file that you create, as in the following procedure, is supported.
====

.Prerequisites

* Create the `install-config.yaml` file and complete any modifications to it.
ifdef::ignition-config[]
* Create the Ignition config files for your cluster.
endif::ignition-config[]

.Procedure

. Change to the directory that contains the installation program and create the manifests:
+
[source,terminal]
----
$ ./openshift-install create manifests --dir <installation_directory>
----
+
--
where:

`<installation_directory>`:: Specifies the name of the directory that contains the `install-config.yaml` file for your cluster.
--

. Create a stub manifest file for the advanced network configuration that is named `cluster-network-03-config.yml` in the `<installation_directory>/manifests/` directory:
+
[source,terminal]
----
$ cat <<EOF > <installation_directory>/manifests/cluster-network-03-config.yml
apiVersion: operator.openshift.io/v1
kind: Network
metadata:
  name: cluster
spec:
EOF
----
+
--
where:

`<installation_directory>`:: Specifies the directory name that contains the
`manifests/` directory for your cluster.
--

. Open the `cluster-network-03-config.yml` file in an editor and specify the advanced network configuration for your cluster, such as in the following example:
+
--
.Specify a different VXLAN port for the OpenShift SDN network provider
[source,yaml]
----
apiVersion: operator.openshift.io/v1
kind: Network
metadata:
  name: cluster
spec:
  defaultNetwork:
    openshiftSDNConfig:
      vxlanPort: 4800
----
--

. Save the `cluster-network-03-config.yml` file and quit the text editor.
. Optional: Back up the `manifests/cluster-network-03-config.yml` file. The
installation program deletes the `manifests/` directory when creating the
cluster.

ifdef::vsphere,vmc[]
. Remove the Kubernetes manifest files that define the control plane machines and compute machineSets:
+
[source,terminal]
----
$ rm -f openshift/99_openshift-cluster-api_master-machines-*.yaml openshift/99_openshift-cluster-api_worker-machineset-*.yaml
----
+
Because you create and manage these resources yourself, you do not have
to initialize them.
+
* You can preserve the MachineSet files to create compute machines by using the machine API, but you must update references to them to match your environment.
endif::vsphere,vmc[]

ifeval::["{context}" == "installing-bare-metal-network-customizations"]
:!ignition-config:
endif::[]
ifeval::["{context}" == "installing-vsphere-network-customizations"]
:!ignition-config:
:!vsphere:
endif::[]
ifeval::["{context}" == "installing-vmc-network-customizations-user-infra"]
:!ignition-config:
:!vmc:
endif::[]
