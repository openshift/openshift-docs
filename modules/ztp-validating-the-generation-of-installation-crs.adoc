// Module included in the following assemblies:
//
// *scalability_and_performance/ztp-deploying-disconnected.adoc

:_content-type: PROCEDURE
[id="ztp-validating-the-generation-of-installation-crs_{context}"]
= Validating the generation of ZTP installation CRs

The ZTP pipeline uses `SiteConfig` custom resources (CRs) to apply installation CRs to the hub cluster. To check the installation status of the spoke cluster, enter the following command specifying the cluster name as the namespace:

[source,terminal]
----
$ oc get AgentClusterInstall -n <cluster_name>
----

If no object is returned, use the following procedure to troubleshoot the ArgoCD pipeline flow from `SiteConfig` files to the installation CRs.

.Procedure

. Check the synchronization of the `SiteConfig` CRs to the hub cluster using either of the following commands:
+
[source,terminal]
----
$ oc get managedcluster
----
+
or
+
[source,terminal]
----
$ oc get siteconfig -n clusters-sub
----
+
If the `SiteConfig` CR is missing, one of the following situations has occurred:

. If the `SiteConfig->ManagedCluster` is missing, check to see if the `clusters` application failed to synchronize the files from the Git repository to the hub:
+
[source,terminal]
----
$ oc describe -n openshift-gitops application clusters
----

. Check for `Status: Conditions:` to view the error logs. For example, setting invalid `extraManifestPath:` in the siteConfig raises an error as shown below:
+
[source,text]
----
Status:
  Conditions:
    Last Transition Time:  2021-11-26T17:21:39Z
    Message:               rpc error: code = Unknown desc = `kustomize build /tmp/https___git.com/ran-sites/siteconfigs/ --enable-alpha-plugins` failed exit status 1: 2021/11/26 17:21:40 Error could not create extra-manifest ranSite1.extra-manifest3 stat extra-manifest3: no such file or directory
2021/11/26 17:21:40 Error: could not build the entire SiteConfig defined by /tmp/kust-plugin-config-913473579: stat extra-manifest3: no such file or directory
Error: failure in plugin configured via /tmp/kust-plugin-config-913473579; exit status 1: exit status 1
    Type:  ComparisonError
----

. Check for `Status: Sync:`. If there are log errors, `Sync: Status:` could indicate an
`Unknown` error:
+
[source,text]
----
Status:
  Sync:
    Compared To:
      Destination:
        Namespace:  clusters-sub
        Server:     https://kubernetes.default.svc
      Source:
        Path:             sites-config
        Repo URL:         https://git.com/ran-sites/siteconfigs/.git
        Target Revision:  master
    Status:               Unknown
----
