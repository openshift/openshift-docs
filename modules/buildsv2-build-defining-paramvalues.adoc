:_content-type: PROCEDURE

[id="build-defining-paramvalues_{context}"]
= Defining ParamValues

A `Build` resource can specify _paramValues_ for parameters that are defined in the referenced `BuildStrategy`. You specify these parameter values to control how the steps of the build strategy behave. You can overwrite values in the `BuildRun` resource. See the related link:./buildrun.md#defining-params[documentation] for more information.

The build strategy author can define a parameter as either a simple string or an array. Depending on that, you must specify the value accordingly. The build strategy parameter can be specified with a default value. You must specify a value in the `Build` or `BuildRun` for parameters without a default.

You can either specify values directly or reference keys from link:https://kubernetes.io/docs/concepts/configuration/configmap/[ConfigMaps] and link:https://kubernetes.io/docs/concepts/configuration/secret/[Secrets]. *Note*: the usage of ConfigMaps and Secrets is limited by the usage of the parameter in the build strategy steps. You can only use them if the parameter is used in the command, arguments, or environment variable values.

When using _paramValues_, avoid:

* Defining a `spec.paramValues` name that doesn't match one of the `spec.parameters` defined in the `BuildStrategy`.
* Defining a `spec.paramValues` name that collides with the {builds-v2shortname} reserved parameters. These are _BUILDER_IMAGE_, _DOCKERFILE_, _CONTEXT_DIR_, and any name starting with _shp-_.

In general, _paramValues_ are tightly bound to Strategy _parameters_. Please make sure you understand the contents of your strategy of choice before defining _paramValues_ in the _Build_.

.Prerequisites

.Procedure

The link:../samples/buildstrategy/buildkit/buildstrategy_buildkit_cr.yaml[BuildKit sample `BuildStrategy`] contains various parameters. Two of them are outlined here:

[source,yaml]
----
apiVersion: shipwright.io/v1alpha1
kind: ClusterBuildStrategy
metadata:
  name: buildkit
  ...
spec:
  parameters:
  - name: build-args
    description: "The ARG values in the Dockerfile. Values must be in the format KEY=VALUE."
    type: array
    defaults: []
  - name: cache
    description: "Configure BuildKit's cache usage. Allowed values are 'disabled' and 'registry'. The default is 'registry'."
    type: string
    default: registry
  ...
  buildSteps:
  ...
----

* The `cache` parameter is a simple string. You can provide it like this in your Build:
+
[source,yaml]
----
apiVersion: shipwright.io/v1alpha1
kind: Build
metadata:
  name: a-build
  namespace: a-namespace
spec:
  paramValues:
  - name: cache
    value: disabled
  strategy:
    name: buildkit
    kind: ClusterBuildStrategy
  source:
  ...
  output:
  ...
----

* If you have multiple Builds and want to control this parameter centrally, then you can create a ConfigMap:
+
[source,yaml]
----
apiVersion: v1
kind: ConfigMap
metadata:
  name: buildkit-configuration
  namespace: a-namespace
data:
  cache: disabled
----

* You reference the ConfigMap as a parameter value like this:
+
[source,yaml]
----
apiVersion: shipwright.io/v1alpha1
kind: Build
metadata:
  name: a-build
  namespace: a-namespace
spec:
  paramValues:
  - name: cache
    configMapValue:
      name: buildkit-configuration
      key: cache
  strategy:
    name: buildkit
    kind: ClusterBuildStrategy
  source:
  ...
  output:
  ...
----

* The `build-args` parameter is defined as an array. In the BuildKit strategy, you use `build-args` to set the link:https://docs.docker.com/engine/reference/builder/#arg[`ARG` values in the Dockerfile], specified as key-value pairs separated by an equals sign, for example, `NODE_VERSION=16`. Your Build then looks like this (the value for `cache` is retained to outline how multiple _paramValue_ can be set):
+
[source,yaml]
----
apiVersion: shipwright.io/v1alpha1
kind: Build
metadata:
  name: a-build
  namespace: a-namespace
spec:
  paramValues:
  - name: cache
    configMapValue:
      name: buildkit-configuration
      key: cache
  - name: build-args
    values:
    - value: NODE_VERSION=16
  strategy:
    name: buildkit
    kind: ClusterBuildStrategy
  source:
  ...
  output:
  ...
----

* Like simple values, you can also use the `build-args` array to
reference ConfigMaps and Secrets for every item in the array. For example:
+
[source,yaml]
----
apiVersion: shipwright.io/v1alpha1
kind: Build
metadata:
  name: a-build
  namespace: a-namespace
spec:
  paramValues:
  - name: cache
    configMapValue:
      name: buildkit-configuration
      key: cache
  - name: build-args
    values:
    - configMapValue: <1>
        name: project-configuration
        key: node-version
        format: NODE_VERSION=${CONFIGMAP_VALUE}
    - value: DEBUG_MODE=true <2>
    - secretValue: <3>
        name: npm-registry-access
        key: npm-auth-token
        format: NPM_AUTH_TOKEN=${SECRET_VALUE}
  strategy:
    name: buildkit
    kind: ClusterBuildStrategy
  source:
  ...
  output:
  ...
----
<1> The first item references a ConfigMap. Because the ConfigMap just contains the value (for example `"16"`) as the data of the `node-version` key, the `format` setting is used to prepend `NODE_VERSION=` to make it a complete key-value pair.
<2> The second item is just a hard-coded value.
<3> The third item references a Secret, the same as with ConfigMaps.

*NOTE*: The logging output of BuildKit contains expanded ``ARG``s in `RUN` commands. Also, such information ends up in the final container image if you use such args in the link:https://docs.docker.com/develop/develop-images/multistage-build/[final stage of your Dockerfile]. An alternative approach to pass secrets is using link:https://docs.docker.com/develop/develop-images/build_enhancements/#new-docker-build-secret-information[secret mounts]. The BuildKit sample strategy supports them using the `secrets` parameter.

// .Verification
//
// [role="_additional-resources"]
// .Additional resources
//
//
