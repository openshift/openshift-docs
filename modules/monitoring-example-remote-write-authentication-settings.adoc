// Module included in the following assemblies:
//
// * observability/monitoring/configuring-the-monitoring-stack.adoc

:_mod-docs-content-type: REFERENCE
[id="example-remote-write-authentication-settings_{context}"]
= Example remote write authentication settings

// Set attributes to distinguish between cluster monitoring example (core platform monitoring - CPM) and user workload monitoring (UWM) examples
// tag::CPM[]
:configmap-name: cluster-monitoring-config
:namespace-name: openshift-monitoring
:component: prometheusK8s
// end::CPM[]
// tag::UWM[]
:configmap-name: user-workload-monitoring-config
:namespace-name: openshift-user-workload-monitoring
:component: prometheus
// end::UWM[]

[role="_abstract"]
The following samples show different authentication settings you can use to connect to a remote write endpoint. 

Each sample also shows how to configure a corresponding `Secret` object that contains authentication credentials and other relevant settings. Each sample configures authentication for use with
// tag::CPM[]
default platform monitoring
// end::CPM[]
// tag::UWM[]
monitoring for user-defined projects
// end::UWM[]
in the `{namespace-name}` namespace.

[id="remote-write-sample-yaml-aws-sigv4_{context}"]
== Sample YAML for AWS Signature Version 4 authentication

The following shows the settings for a `sigv4` secret named `sigv4-credentials` in the `{namespace-name}` namespace.

[source,yaml,subs="attributes+"]
----
apiVersion: v1
kind: Secret
metadata:
  name: sigv4-credentials
  namespace: {namespace-name}
stringData:
  accessKey: <AWS_access_key>
  secretKey: <AWS_secret_key>
type: Opaque
----

where:

`<AWS_access_key>`::
Specifies the AWS API access key.

`<AWS_secret_key>`::
Specifies the AWS API secret key.

The following shows sample AWS Signature Version 4 remote write authentication settings that use a `Secret` object named `sigv4-credentials` in the `{namespace-name}` namespace:

[source,yaml,subs="attributes+"]
----
apiVersion: v1
kind: ConfigMap
metadata:
  name: {configmap-name}
  namespace: {namespace-name}
data:
  config.yaml: |
    {component}:
      remoteWrite:
      - url: "https://authorization.example.com/api/write"
        sigv4:
          region: <AWS_region>
          accessKey:
            name: sigv4-credentials
            key: accessKey
          secretKey:
            name: sigv4-credentials
            key: secretKey
          profile: <AWS_profile_name>
          roleArn: <AWS_role_arn>
----

where:

`<AWS_region>`::
Specifies the AWS region.

`accessKey.name`, `secretKey.name`::
Define the name of the `Secret` object containing the AWS API access credentials.

`accessKey.key`::
Defines the key that contains the AWS API access key in the specified `Secret` object.

`secretKey.key`::
Defines the key that contains the AWS API secret key in the specified `Secret` object.

`<AWS_profile_name>`::
Specifies the name of the AWS profile that is being used to authenticate.

`<AWS_role_arn>`::
Specifies the unique identifier for the Amazon Resource Name (ARN) assigned to your role.

[id="remote-write-sample-yaml-basic-auth_{context}"]
== Sample YAML for Basic authentication

The following shows sample Basic authentication settings for a `Secret` object named `rw-basic-auth` in the `{namespace-name}` namespace:

[source,yaml,subs="attributes+"]
----
apiVersion: v1
kind: Secret
metadata:
  name: rw-basic-auth
  namespace: {namespace-name}
stringData:
  user: <basic_username>
  password: <basic_password>
type: Opaque
----

where:

`<basic_username>`::
Specifies the username.

`<basic_password>`::
Specifies the password.

The following sample shows a `basicAuth` remote write configuration that uses a `Secret` object named `rw-basic-auth` in the `{namespace-name}` namespace.
It assumes that you have already set up authentication credentials for the endpoint.

[source,yaml,subs="attributes+"]
----
apiVersion: v1
kind: ConfigMap
metadata:
  name: {configmap-name}
  namespace: {namespace-name}
data:
  config.yaml: |
    {component}:
      remoteWrite:
      - url: "https://basicauth.example.com/api/write"
        basicAuth:
          username:
            name: rw-basic-auth
            key: user
          password:
            name: rw-basic-auth
            key: password
----

where:

`username.name`, `password.name`::
Define the name of the `Secret` object that contains the authentication credentials.

`username.key`::
Defines the key that contains the username in the specified `Secret` object.

`password.key`::
Defines the key that contains the password in the specified `Secret` object.

[id="remote-write-sample-yaml-bearer-token_{context}"]
== Sample YAML for authentication with a bearer token using a `Secret` Object

The following shows bearer token settings for a `Secret` object named `rw-bearer-auth` in the `{namespace-name}` namespace:

[source,yaml,subs="attributes+"]
----
apiVersion: v1
kind: Secret
metadata:
  name: rw-bearer-auth
  namespace: {namespace-name}
stringData:
  token: <authentication_token>
type: Opaque
----

where:

`<authentication_token>`::
Specifies the authentication token.

The following shows sample bearer token config map settings that use a `Secret` object named `rw-bearer-auth` in the `{namespace-name}` namespace:

[source,yaml,subs="attributes+"]
----
apiVersion: v1
kind: ConfigMap
metadata:
  name: {configmap-name}
  namespace: {namespace-name}
data:
  config.yaml: |
    {component}:
      remoteWrite:
      - url: "https://authorization.example.com/api/write"
        authorization:
          type: Bearer
          credentials:
            name: rw-bearer-auth
            key: token
----

where:

`authorization.type`::
Defines the authentication type of the request. The default value is `Bearer`.

`credentials.name`::
Defines the name of the `Secret` object that contains the authentication credentials.

`credentials.key`::
Defines the key that contains the authentication token in the specified `Secret` object.

[id="remote-write-sample-yaml-oauth-20_{context}"]
== Sample YAML for OAuth 2.0 authentication

The following shows sample OAuth 2.0 settings for a `Secret` object named `oauth2-credentials` in the `{namespace-name}` namespace:

[source,yaml,subs="attributes+"]
----
apiVersion: v1
kind: Secret
metadata:
  name: oauth2-credentials
  namespace: {namespace-name}
stringData:
  id: <oauth2_id>
  secret: <oauth2_secret>
type: Opaque
----

where:

`<oauth2_id>`::
Specifies the Oauth 2.0 ID.

`<oauth2_secret>`::
Specifies the OAuth 2.0 secret.

The following shows an `oauth2` remote write authentication sample configuration that uses a `Secret` object named `oauth2-credentials` in the `{namespace-name}` namespace:

[source,yaml,subs="attributes+"]
----
apiVersion: v1
kind: ConfigMap
metadata:
  name: {configmap-name}
  namespace: {namespace-name}
data:
  config.yaml: |
    {component}:
      remoteWrite:
      - url: "https://test.example.com/api/write"
        oauth2:
          clientId:
            secret:
              name: oauth2-credentials
              key: id
          clientSecret:
            name: oauth2-credentials
            key: secret
          tokenUrl: https://example.com/oauth2/token
          scopes:
          - <scope_1>
          - <scope_2>
          endpointParams:
            param1: <parameter_1>
            param2: <parameter_2>
----

where:

`oauth2.clientId.secret.name`, `oauth2.clientSecret.name`::
Define the name of the corresponding `Secret` object. Note that `ClientId` can alternatively refer to a `ConfigMap` object, although `clientSecret` must refer to a `Secret` object.

`oauth2.clientId.secret.key`, `oauth2.clientSecret.key`::
Define the key that contains the OAuth 2.0 credentials in the specified `Secret` object.

`tokenUrl`::
Defines the URL used to fetch a token with the specified `clientId` and `clientSecret`.

`scopes`::
Defines the OAuth 2.0 scopes for the authorization request. These scopes limit what data the tokens can access.

`endpointParams`::
Defines the OAuth 2.0 authorization request parameters required for the authorization server.

[id="remote-write-sample-yaml-tls_{context}"]
== Sample YAML for TLS client authentication

The following shows sample TLS client settings for a `tls` `Secret` object named `mtls-bundle` in the `{namespace-name}` namespace.

[source,yaml,subs="attributes+"]
----
apiVersion: v1
kind: Secret
metadata:
  name: mtls-bundle
  namespace: {namespace-name}
data:
  ca.crt: <ca_cert>
  client.crt: <client_cert>
  client.key: <client_key>
type: tls
----

where:

`<ca_cert>`::
Specifies the CA certificate in the Prometheus container with which to validate the server certificate.

`<client_cert>`::
Specifies the client certificate for authentication with the server.

`<client_key>`::
Specifies the client key.

The following sample shows a `tlsConfig` remote write authentication configuration that uses a TLS `Secret` object named `mtls-bundle`.

[source,yaml,subs="attributes+"]
----
apiVersion: v1
kind: ConfigMap
metadata:
  name: {configmap-name}
  namespace: {namespace-name}
data:
  config.yaml: |
    {component}:
      remoteWrite:
      - url: "https://remote-write-endpoint.example.com"
        tlsConfig:
          ca:
            secret:
              name: mtls-bundle
              key: ca.crt
          cert:
            secret:
              name: mtls-bundle
              key: client.crt
          keySecret:
            name: mtls-bundle
            key: client.key
----

where:

`ca.secret.name`, `cert.secret.name`, `keySecret.name`::
Define the name of the corresponding `Secret` object that contains the TLS authentication credentials. Note that `ca` and `cert` can alternatively refer to a `ConfigMap` object, though `keySecret` must refer to a `Secret` object.

`ca.secret.key`::
Defines the key in the specified `Secret` object that contains the CA certificate for the endpoint.

`cert.secret.key`::
Defines the key in the specified `Secret` object that contains the client certificate for the endpoint.

`keySecret.key`::
Defines the key in the specified `Secret` object that contains the client key secret.

// Unset the source code block attributes just to be safe.
:!configmap-name:
:!namespace-name:
:!component:
