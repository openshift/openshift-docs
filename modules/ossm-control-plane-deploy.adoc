// Module included in the following assemblies:
//
// * service_mesh/service_mesh_install/installing-ossm.adoc

[id="ossm-control-plane-deploy_{context}"]
= Deploying the {ProductName} control plane

////
TODO - Flesh out how multitenancy affects this.
////

The `ServiceMeshControlPlane` resource defines the configuration to be used during installation. You can deploy the default configuration provided by Red Hat or customize the `ServiceMeshControlPlane` file to fit your business needs.

You can deploy the {ProductShortName} control plane by using the {product-title} web console or from the command line using the `oc` client tool.

[id="ossm-control-plane-deploy-operatorhub_{context}"]
== Deploying the control plane from the web console

Follow this procedure to deploy the {ProductName} control plane by using the web console.

.Prerequisites

* The {ProductName} Operator must be installed.
* Review the instructions for how to customize the {ProductName} installation.
* An account with the `cluster-admin` role.

.Procedure

. Log in to the {product-title} web console as a user with the `cluster-admin` role.

. Create a new project, for example `istio-system`.

.. Navigate to *Home* -> *Projects*.

.. Click *Create Project*.

.. Enter `istio-system` in the *Name* field.

.. Click *Create*.

. Navigate to *Operators* -> *Installed Operators*.

. If necessary, select `istio-system` from the Project menu.  You may have to wait a few moments for the Operators to be copied to the new project.

. Click the {ProductName} Operator.  Under *Provided APIs*, the Operator provides links to create two resource types:
** A `ServiceMeshControlPlane` resource
** A `ServiceMeshMemberRoll` resource

. Under *Istio Service Mesh Control Plane* click *Create Instance*.

. On the *Create Service Mesh Control Plane* page, modify the YAML for the default `ServiceMeshControlPlane` template as needed.
+
[NOTE]
====
For additional information about customizing the control plane, see customizing the {ProductName} installation. Note that for production use you _must_ change the default Jaeger template.
====

. Click *Create* to create the control plane.  The Operator begins creating Pods, services, and {ProductShortName} control plane components based on your configuration parameters.

. Click the *Istio Service Mesh Control Plane* tab.

. Click the name of the new control plane. The default name is `basic-install`.

. Click the *Resources* tab to see the {ProductName} control plane resources the Operator created and configured. The default configuration creates a total of 57 items, including 10 Pods.  Wait until all the Pods have been created and show a status of `running` before continuing to the next step.


[id="ossm-control-plane-deploy-cli_{context}"]
== Deploying the control plane from the CLI

Follow this procedure to deploy the {ProductName} control plane the command line.

.Prerequisites

* The {ProductName} Operator must be installed.
* Review the instructions for how to customize the {ProductName} installation.
* An account with the `cluster-admin` role.
* Access to the {product-title} Command-line Interface (CLI), commonly known as `oc`.

.Procedure

. Log in to the {product-title} CLI as a user with the `cluster-admin` role.
+
----
$ oc login https://{HOSTNAME}:8443
----

. Create a new project, for example `istio-system`.
+
----
$ oc new-project istio-system
----

. Create a `ServiceMeshControlPlane` file named `istio-installation.yaml` using the example found in "Customize the {ProductName} installation". You can customize the values as needed to match your use case.  Note that for production use you _must_ change the default Jaeger template.

. Run the following command to deploy the control plane:
+
----
$ oc create -n istio-system -f istio-installation.yaml
----
+
. Execute the following command to see the status of the control plane installation.
+
----
$ oc get smcp -n istio-system
----
+
The installation has finished successfully when the READY column is true.
+
----
NAME           READY
basic-install   True
----
+
. Run the following command to watch the progress of the Pods during the installation process:
+
----
$ oc get pods -n istio-system -w
----
+
You should see output similar to the following:
+
----
NAME                                     READY   STATUS             RESTARTS   AGE
grafana-7bf5764d9d-2b2f6                 2/2     Running            0          28h
istio-citadel-576b9c5bbd-z84z4           1/1     Running            0          28h
istio-egressgateway-5476bc4656-r4zdv     1/1     Running            0          28h
istio-galley-7d57b47bb7-lqdxv            1/1     Running            0          28h
istio-ingressgateway-dbb8f7f46-ct6n5     1/1     Running            0          28h
istio-pilot-546bf69578-ccg5x             2/2     Running            0          28h
istio-policy-77fd498655-7pvjw            2/2     Running            0          28h
istio-sidecar-injector-df45bd899-ctxdt   1/1     Running            0          28h
istio-telemetry-66f697d6d5-cj28l         2/2     Running            0          28h
jaeger-896945cbc-7lqrr                   2/2     Running            0          11h
kiali-78d9c5b87c-snjzh                   1/1     Running            0          22h
prometheus-6dff867c97-gr2n5              2/2     Running            0          28h
----
