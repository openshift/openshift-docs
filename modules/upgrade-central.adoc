// Module included in the following assemblies:
//
// * upgrade/upgrade-roxctl.adoc
:_module-type: PROCEDURE
[id="upgrade-central_{context}"]
= Upgrading Central

You can update Central to the latest version by downloading and deploying the updated images.

.Prerequisites

* If you deploy images from a private image registry, first push the new image into your private registry, and then replace your image registry for the commands in this section.

.Procedure

* Run the following commands to upgrade Central:
+
[source,terminal]
----
$ oc -n stackrox patch deploy/central -p '{"spec":{"template":{"spec":{"containers":[{"name":"central","env":[{"name":"ROX_NAMESPACE","valueFrom":{"fieldRef":{"fieldPath":"metadata.namespace"}}}]}]}}}}' <1>
----
<1> If you use Kubernetes, enter `kubectl` instead of `oc`.
+
[source,terminal]
----
$ oc -n stackrox patch deployment/scanner -p '{"spec":{"template":{"spec":{"containers":[{"name":"scanner","securityContext":{"runAsUser":65534}}]}}}}' <1>
----
<1> If you use Kubernetes, enter `kubectl` instead of `oc`.
+
[source,terminal,subs=attributes+]
----
$ oc -n stackrox set image deploy/central central=registry.redhat.io/rh-acs/main:{rhacs-version} <1>
----
<1> If you use Kubernetes, enter `kubectl` instead of `oc`.
+
[IMPORTANT]
====
* If you are upgrading from {product-title} 3.65.0, you must run the following additional command to create the `stackrox-central-diagnostics` role:
+
[source,terminal]
----
$ oc -n stackrox patch role stackrox-central-diagnostics -p '{"rules":[{"apiGroups":["*"],"resources":["deployments","daemonsets","replicasets","configmaps","services"],"verbs":["get","list"]}]}' <1>
----
<1> If you use Kubernetes, enter `kubectl` instead of `oc`.

* If you have not installed {product-title} by using Helm or Operator, and you want to enable authentication using the OpenShift OAuth server, you must run the following additional command:
+
[source,terminal]
----
$ oc -n stackrox set env deploy/central ROX_ENABLE_OPENSHIFT_AUTH=true
----
+
[source,terminal]
----
$ oc -n stackrox patch serviceaccount/central -p '
{
"metadata": {
"annotations": {
"serviceaccounts.openshift.io/oauth-redirecturi.main": "sso/providers/openshift/callback",
"serviceaccounts.openshift.io/oauth-redirectreference.main": "{"kind":"OAuthRedirectReference","apiVersion":"v1","reference":{"kind":"Route","name":"central"}}"
}
}
}'
----

====

.Verification

* Check that the new pods have deployed:
+
[source,terminal]
----
$ oc get deploy -n stackrox -o wide <1>
----
<1> If you use Kubernetes, enter `kubectl` instead of `oc`.
+
[source,terminal]
----
$ oc get pod -n stackrox --watch <1>
----
<1> If you use Kubernetes, enter `kubectl` instead of `oc`.
