// Module included in the following assemblies:
//
// * virt/logging_events_monitoring/virt-events.html/virt-virtualization-alerts.adoc

[id="virt-cnv-network-alerts-kubemacpoolduplicatemacsfound_{context}"]
= KubeMacPoolDuplicateMacsFound alert

The KubeMacPool is responsible for allocating MAC Addresses and preventing MAC Address conflicts. After opening the KubeMacPool, a scan of the cluster for MAC Addresses in virtual machines set on the managed namespaces occurs. This alert occurs if duplicate MAC addresses are found in the scan.

Duplicate MAC Addresses on the same LAN may cause unexpected and various connectability issues in the network.

.Procedure

* Diagnose the failed component deployment's cause.

** Determine the `kubemacpool-mac-controller` pod namespace and name.
+
[source,terminal]
----
kubectl get pod -A -l control-plane=mac-controller-manager --no-headers -o custom-columns=":metadata.namespace,:metadata.name"
----

** Extract the confliciting Mac Addresses from the kubemacpool-mac-controller pod.
+
[source,terminal]
----
kubectl logs -n <kubemacpool-namespace> <kubemacpool-mac-controller-pod-name> | grep "already allocated"
----
+
The extracted output contains the necessary information:
+
*** The Mac Address which has a conflict
*** The current entry in the database (VM namespace, name, and interface)
*** The entry that rejected due to conflict (VM namespace, name, and interface)
+
An example of a log line is ``"mac address 02:00:ff:ff:ff:ff already allocated to vm/kubemacpool-test/testvm, br1, conflict with: vm/kubemacpool-test/testvm2, br1"`.

** Check the Kubemacpool-manager pod's pod description and logs.
+
[source,terminal]
----
kubectl describe pod -n $KMP_NAMESPACE $KMP_NAME
kubectl logs -n $KMP_NAMESPACE $KMP_NAME
----

* Inspect the duplicates.
* Update the VMs to remove the duplicate MAC Addresses.
* Once all the conflicts are resolved, restart the `kubemacpool-mac-controller` pod.
+
[source,terminal]
----
kubectl delete pod -n <kubemacpool-namespace> <kubemacpool-mac-controller-pod-name>
----
