// This module is included in the following assemblies:
// * pac/creating-pipeline-runs-pac.adoc

:_mod-docs-content-type: PROCEDURE
[id="components-pipeline-run-pac_{context}"]
= Components of a a pipeline run in {pac}

You can create a pipeline run definition for {pac} in your repository and match it to an event, such as a pull request. When the event happens, {pac} creates a `PipelineRun` custom resource (CR) from this definition, and then {pipelines-shortname} executes the pipeline run.

Your pipeline run definition must be in a file in the `.tekton` directory of your Git repository. It can use any features that a regular `PipelineRun` custom resource (CR) in {pipelines-shortname} can use.

.Resource definitions in other files

The definition can refer by name to any resources, such as `Pipeline` or `Task` CRs, that you define in other files in the same subdirectory. You do not need to provide any additional reference for these resources, as the {pac} resolver resolves them automatically.

.Annotations referring to resources from {tekton-hub} or an HTTP URL

You might want to use resource definitions from {tekton-hub} or from an HTTP URL in your pipeline run definitions. To refer to such resource definitions, use _{pac} resolver annotations_. A {pac} resolver annotation references a pipeline or task in {tekton-hub}, an HTTP location, or a location in your repository outside the `.tekton` directory. If you create a {pac} resolver annotation to reference a resource, you can use this resource by name in your pipeline run definition. The {pac} resolver automatically resolves these resources and includes them in the  `PipelineRun` CR that is based on your definition. For example, the `pipelinesascode.tekton.dev/task: "[git-clone]"` annotation refers to the `git-clone` task definition in {tekton-hub}.

For more information about these annotations, see the "{pac} resolver annotations" section.

.Dynamic variables for context information

The definition might need to use context information that is specific to the particular event. For example, if you want to build the source from the source branch of the pull request, your pipeline need to use the repository URL and the revision name oto retrieve the source. To provide this information, include {pac} _dynamic variables_ in the definition. {pac} replaces these dynamic variables with the required context information. For example, `{{ repo_url }}` is the current URL for the repository and `{{ revision }}` is the commit SHA on which the pipeline run was started.

For more information about dynamic variables, see the "Dynamic variables in a pipeline run specification" section.

.Annotations for matching the pipeline run to events

You must match the pipeline run to events by adding any of the following annotations. When the defined event happens, {pac} starts the pipeline run.

* A combination of the `pipelinesascode.tekton.dev/on-event` annotation, which defines a `pull request` or `push` event, and a `pipelinesascode.tekton.dev/on-target-branch` annotation, which defines the branch that the pull request or push event must target. If you match your pipeline run to a pull request or push event, the pipeline run starts when the event is created and also each time the source branch of the pull request or push event is updated.
+
[NOTE]
====
If your Git repository provider uses merge requests and not pull requests, a `pull_request` event definition matches a merge request.
====

* A `pipelinesascode.tekton.dev/on-comment` annotation, which matches the pipeline run to a comment on a pull request by regular expression. If you match your pipeline run to a comment, it starts when the comment is added to a pull request. To start the pipeline run again, add the comment again.

* A `pipelinesascode.tekton.dev/on-cel-expression` annotation, which matches the pipeline run if the specified Common Expression Language (CEL) expression evaluates to `true` on a pull request or push event.

For more information about matching the pipeline run to events, see the "Annotations for matching events to a pipeline run" section.

.Annotations for filtering matching events

You can specify one or more annotations that filter the matching events. With these annotations, when the defined matching event (such as a pull request, a push event, or a comment) happens, {pac} checks if these annotations are also matched. The pipeline run starts only if all the annotations that you added to it are matched.

The following annotations for filtering matching events are available:

* A `pipelinesascode.tekton.dev/on-path-changed` annotation is matched if the pull request or push event affect files in the specified paths.

* A `pipelinesascode.tekton.dev/on-path-changed-ignore` annotation excludes matching the event if the event changes _only_ files in the specified paths and does not change any other files in the repository.

* A `pipelinesascode.tekton.dev/on-label` annotation is matched if the pull request or push event has one of the specified labels.

For more information about filtering matching events, see the "Annotations for filtering events" section.

.Cancel-in-progress configuration

You can add the `pipelinesascode.tekton.dev/cancel-in-progress: "true"` annotation to enable automatic cancellation of the pipeline run in certain cases. For example, if a pull request triggers a pipeline run and then the user pushes new commits into the pull request source branch, each push triggers a new copy of the pipeline run. if you enable automatic cancellation-in-progress, after a new copy of the pipeline run starts, {pac} cancels the older run to avoid running many copies of the pipeline run at the same time.

For more information about this annotation, see the "Annotations for specifying automatic cancellation-in-progress for a pipeline run" section.
