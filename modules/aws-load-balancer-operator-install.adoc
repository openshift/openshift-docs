// Module included in the following assemblies:
//
// * networking/aws-load-balancer.adoc

:_content-type: CONCEPT
[id="aws-load-balancer-operator-install_{context}"]
= Installing an AWS Load Balancer Operator
{product-title} users can install the AWS Load Balancer Operator using the  AWS (ROSA) CLI, rosa.

.Prerequisites

* AWS CLI
* OC CLI
* ROSA CLI
* An existing {product-title} cluster with BYO-VPC installed in STS mode
* cluster-admin credentials
* OCP version 4.13 and above.

.Procedure

. Run the following command to identify the cluster's Infrastrucure ID.
+
[source,terminal]
----
$ rosa describe cluster -c {cluster-name} | grep -i 'Infra ID'
----
+
. Run the following command to identify the cluster OIDC DNS
+
[source,terminal]
----
$ rosa describe cluster -c {cluster-name} | grep -i 'OIDC'
----
+
. Create an AWS Policy required for the ALBC. (https://raw.githubusercontent.com/kubernetes-sigs/aws-load-balancer-controller/v2.4.7/docs/install/iam_policy.json).

. Create an AWS Policy required for the ALBO. For more information, see https://docs.aws.amazon.com/elasticloadbalancing/latest/userguide/managed-policies.html.

. Create an AWS Role and add permission policies required for the ALBC and ALBO. For more information, see https://docs.aws.amazon.com/IAM/latest/UserGuide/access_policies_manage-attach-detach.html)

. Add the Trust Policy which allows the ALBO to assume the AWS Role. Use the OIDC Endpoint (without the 'http://) captured from step 2 above.
+
[source,terminal]
----
{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Effect": "Allow",
            "Principal": {
                "Federated": "arn:aws:iam::{AWS-AccountNo}:<1>
                {Cluster's OIDC Endpoint}"<2>
            },
            "Action": "sts:AssumeRoleWithWebIdentity",
            "Condition": {
                "StringEquals": {
                    "{Cluster's OIDC Endpoint}:<3>
                    sub": [
                        "system:serviceaccount:aws-load-balancer-operator:aws-load-balancer-operator-controller-manager",
                        "system:serviceaccount:aws-load-balancer-operator:aws-load-balancer-controller-cluster"
                    ]
                }
            }
        }
    ]
}
----
+
<1> This value is the cluster admin's AWS account number.
<2> This value is the cluster's OIDC DNS, identified in step 4 above. When inputting this value, do not include the 'https://'.
<3> This value is the cluster's OIDC DNS, identified in step 4 above. When inputting this value, do not include the 'https://'.

. Add the following `key:value` tag: kubernetes.io/cluster/$cluster/ Infra ID;owned where 'Infra ID'is indenfied in step 3 above.
. Add the tag "Key: value) to the VPC that is hosting the ROSA cluster"
. Add ELB tags to private subnets and optionally public subnets.... In the Private subnets, add the tags required by ALBC Subnet Discovery: kubernetes.io/role/elb:1 on public subnets and kubernetes.io/role/interna-elb:1 on private subnets. Internet-facing and internal load balancers will be created with these AZs subnets are part of.
. aws-load-balancer-operator-install.adoc
. Create NEw Project ....  oc new-project aws-load-balancer-operator