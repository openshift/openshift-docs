// Module included in the following assemblies:
//
// * networking/network_security/network_policy/nw-networkpolicy-full-multitenant-isolation.adoc

:_mod-docs-content-type: REFERENCE
[id="nw-networkpolicy-same-namespace-communication_{context}"]
= Creating a network policy for same namespace communication

With the `deny-by-default` network policy in place, a second option to enable communication is to create a network policy that allows for same namespace communication using the following `allow-same-namespace` network policy.

.Prerequisites

* You have created the `deny-by-default` network policy and applied it to all necessary namespaces.

.Procedure

. Create the following `allow-same-namespace` network policy to allow pods within the same to communicate with each other. Save the YAML in the `allow-same-namespace` file:
+
[source,yaml]
----
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: allow-same-namespace
spec:
  podSelector: {}
  policyTypes:
  - Ingress
  ingress:
  - from:
    - podSelector: {}
----

. Apply the `allow-same-namespace` network policy to the `project-a` namespace by entering the following command:
+
[source,terminal]
----
$ oc apply -f allow-same-namespace.yaml -n project-a
----

.Verification

. Obtain the IP addresses of pods in `project-a` by running the following command:
+
[source,terminal]
----
$ oc get pod -n project-a -o wide
----
+
.Example output
+
[source,terminal]
----
NAME            READY   STATUS    RESTARTS   AGE   IP            NODE                           NOMINATED NODE   READINESS GATES
busybox-pod-a   1/1     Running   0          44m   10.132.0.38   ip-10-0-132-187.ec2.internal   <none>           <none>
test-pod-a      1/1     Running   0          44m   10.132.0.40   ip-10-0-132-187.ec2.internal   <none>           <none>
----

. Ensure that communication can be made between pods in `project-a` by entering the following command:
+
[source,terminal]
----
$ oc exec -it busybox-pod-a -n project-a -- ping 10.132.0.40
----
+
.Example output
+
[source,terminal]
----
PING 10.132.0.40 (10.132.0.40): 56 data bytes
64 bytes from 10.132.0.40: seq=0 ttl=42 time=0.792 ms
64 bytes from 10.132.0.40: seq=1 ttl=42 time=0.533 ms
----