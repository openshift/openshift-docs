// Module included in the following assemblies:
// network_observability/observing-network-traffic.adoc

:_mod-docs-content-type: REFERENCE
[id="network-observability-ebpf-flow-data-filtering-examples_{context}"]
= eBPF flow data filtering examples

[role="_abstract"]
Use these `FlowCollector` custom resource examples to filter eBPF flows using multiple rules to control the flow of packets cached in the eBPF flow table.

[id="example-yaml-sample-all-north-south-traffic_{context}"]
== Example YAML to sample all North-South traffic, and 1:50 East-West traffic

By default, all other flows are rejected.

[source, yaml]
----
apiVersion: flows.netobserv.io/v1beta2
kind: FlowCollector
metadata:
  name: cluster
spec:
  namespace: netobserv
  deploymentModel: Direct
  agent:
    type: eBPF
    ebpf:
      flowFilter:
        enable: true <1>
        rules:
         - action: Accept <2>
           cidr: 0.0.0.0/0 <3>
           sampling: 1 <4>
         - action: Accept
           cidr: 10.128.0.0/14
           peerCIDR: 10.128.0.0/14 <5>
         - action: Accept
           cidr: 172.30.0.0/16
           peerCIDR: 10.128.0.0/14
           sampling: 50
----
<1> Enables `eBPF` flow filtering by setting `spec.agent.ebpf.flowFilter.enable` to `true`.
<2> Defines the action for the flow filter rule. Valid values are `Accept` or `Reject`.
<3> Defines the IP address and `CIDR` mask for the flow filter rule. This parameter supports both `IPv4` and `IPv6` address formats. Use `0.0.0.0/0` for `IPv4` or `::/0` for `IPv6` to match any IP address.
<4> Defines the sampling interval for matched flows and overrides the global sampling setting (`spec.agent.ebpf.sampling`).
<5> Filters flows by Peer IP `CIDR`.

[id="example-yaml-filter-flows-with-packet-drops_{context}"]
== Example YAML to filter flows with packet drops

By default, all other flows are rejected.

[source, yaml]
----
apiVersion: flows.netobserv.io/v1beta2
kind: FlowCollector
metadata:
  name: cluster
spec:
  namespace: netobserv
  deploymentModel: Direct
  agent:
    type: eBPF
    ebpf:
      privileged: true <1>
      features:
        - PacketDrop <2>
      flowFilter:
        enable: true <3>
        rules:
        - action: Accept <4>
          cidr: 172.30.0.0/16
          pktDrops: true <5>
----
<1> Enables packet drops reporting by setting `spec.agent.ebpf.privileged` to `true`.
<2> Reports packet drops for each network flow by adding the `PacketDrop` value to the `spec.agent.ebpf.features` list.
<3> Enables `eBPF` flow filtering by setting `spec.agent.ebpf.flowFilter.enable` to `true`.
<4> Defines the action for the flow filter rule. Valid values are `Accept` or `Reject`.
<5> Filters flows that contain drops by setting `pktDrops` to `true`.