// Module included in the following assemblies:
//
// * upgrading/upgrade-operator.adoc
:_module-type: PROCEDURE
[id="operator-upgrade-modify-central-custom-resource-tech-preview_{context}"]
= Modifying Central custom resource for external database

:FeatureName: External PostgreSQL support
include::snippets/technology-preview.adoc[]

.Prerequisites
* You must provision a database that supports PostgreSQL 13 and you must only use it for {product-title-short}.
* User must be superuser with ability to create and delete databases.

[NOTE]
====
* A multitenant database is currently unsupported.
* Connections through PgBouncer are not supported.
====

.Procedure

. Create a password secret in the deployed namespace by using the {ocp} web console or the terminal.
** On the {ocp} web console, go to the *Workloads* â†’ *Secrets* page. Create a *Key/Value secret* with the key `password` and the value as the path of a plain text file containing the password for the superuser of the provisioned database.
** Or, run the following command in your terminal:
+
[source,terminal]
----
$ oc create secret generic external-db-password \ <1>
  --from-file=password=<password.txt> <2>
----
<1> If you use Kubernetes, enter `kubectl` instead of `oc`.
<2> Replace `password.txt` with the path of the file which has the plain text password.
. Go to the {product-title} operator page in the {ocp} web console. Select *Central* in the top navigation bar and select the instance you want to connect to the database.
. Go to the *YAML editor* view.
. For *`db.passwordSecret.name`* specify the referenced secret that you created in earlier steps. For example, `external-db-password`.
. For *`db.connectionString`* specify the connection string in `keyword=value` format, for example, `host=<host> port=5432 user=postgres sslmode=verify-ca`
. For *`db.persistence`* delete the entire block.
. If necessary, you can specify a Certificate Authority for Central to trust the database certificate by adding a TLS block under the top-level spec, as shown in the following example:

** Update the central custom resource with the following configuration:
+
[source,terminal]
----
spec:
  tls:
    additionalCAs:
    - name: db-ca
      content: |
        <certificate>
  central:
    db:
      isEnabled: Default <1>
      connectionString: "host=<host> port=5432 user=<user> sslmode=verify-ca"
      passwordSecret:
        name: external-db-password
----
<1> You must not change the value of `IsEnabled` to `Enabled`.

. Click *Save*.
