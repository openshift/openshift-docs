[id="create-gateway_{context}"]
= Create your Gateway instance

This section shows how you can deploy a Gateway in your OpenShift cluster. This task is typically performed by platform engineers when setting up the infrastructure to be used by application developers. 

NOTE: In a multicluster environment, for {prodname} to balance traffic by using DNS across clusters, you must define a Gateway with a shared hostname. You can define this by using an HTTPS listener with a wildcard hostname based on the root domain. As mentioned previously, you must apply these resources to all clusters.

.Prerequisites

* See xref:set-up-environment_{context}[].

.Procedure

. Enter the following command to create the Gateway:
+
[source,bash]
----
kubectl apply -f - <<EOF
apiVersion: gateway.networking.k8s.io/v1
kind: Gateway
metadata:
  name: ${KUADRANT_GATEWAY_NAME}
  namespace: ${KUADRANT_GATEWAY_NS}
  labels:
    kuadrant.io/gateway: "true"
spec:
    gatewayClassName: istio
    listeners:
    - allowedRoutes:
        namespaces:
          from: All 
      hostname: "api.${KUADRANT_ZONE_ROOT_DOMAIN}"
      name: api
      port: 443
      protocol: HTTPS
      tls:
        certificateRefs:
        - group: ""
          kind: Secret
          name: api-${KUADRANT_GATEWAY_NAME}-tls
        mode: Terminate
EOF
----

. Check the status of your Gateway as follows:
+
[source,bash]
----
kubectl get gateway ${KUADRANT_GATEWAY_NAME} -n ${KUADRANT_GATEWAY_NS} -o=jsonpath='{.status.conditions[?(@.type=="Accepted")].message}{"\n"}{.status.conditions[?(@.type=="Programmed")].message}'
----
+
Your Gateway should be `Accepted` and `Programmed`, which means that it is valid and assigned an external address. 

. Check the status of your HTTPS listener as follows:
+
[source,bash]
----
kubectl get gateway ${KUADRANT_GATEWAY_NAME} -n ${KUADRANT_GATEWAY_NS} -o=jsonpath='{.status.listeners[0].conditions[?(@.type=="Programmed")].message}'
----
+
You will see that the HTTPS listener is not yet programmed or ready to accept traffic due to bad TLS configuration. {prodname} can help with this by using a TLSPolicy, which is described in the next step.
