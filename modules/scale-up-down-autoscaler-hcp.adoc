// Module included in the following assemblies:
//
// * hosted_control_planes/hcp-machine-config.adoc

:_mod-docs-content-type: PROCEDURE
[id="scale-up-down-autoscaler-hcp_{context}"]
= Scaling up and down workloads in a hosted cluster

On {hcp}, you can scale up and down workloads in your hosted cluster by using the cluster autoscaler.

.Prerequisites

* You have created the `HostedCluster` and `NodePool` resources.

.Procedure

. Enable cluster autoscaling on the `HostedCluster` resource by running the following command:
+
[source,terminal]
----
$ oc patch -n <hosted_cluster_namespace> hostedcluster <hosted_cluster_name> \
  --type=merge \
  --patch='{"spec": {"autoscaling": {"scaling": "ScaleUpAndScaleDown", "maxPodGracePeriod": 60, "scaleDown": {"delayAfterAddSeconds": 60, "delayAfterDeleteSeconds": 60, "delayAfterFailureSeconds": 60, "unneededDurationSeconds": 60, "utilizationThresholdPercent": 50}}}}'
----

. Enable cluster autoscaling on node pools:

.. Remove the `spec.replicas` field from your `NodePool` resource by running the following command:
+
[source,terminal]
----
$ oc patch -n <hosted_cluster_namespace> nodepool <nodepool_name>
  --type=json  --patch='[{"op": "remove", "path": "/spec/replicas"}]'
----

.. Enable cluster autoscaling on your `NodePool` resource by running the following command:
+
[source,terminal]
----
$ oc patch -n <hosted_cluster_namespace> nodepool <nodepool_name>
  --type=merge --patch='{"spec": {"autoScaling": {"max": 3, "min": 1}}}'
----

. Wait until all worker nodes are in the `Ready` status by running the following command:
+
[source,terminal]
----
$ oc --kubeconfig <hosted_cluster_name>.kubeconfig get nodes
----
+
.Example output
[source,terminal]
----
NAME                                         STATUS   ROLES    AGE     VERSION
ip-10-0-138-210.us-west-2.compute.internal   Ready    worker   37m     v1.33.2
ip-10-0-138-75.us-west-2.compute.internal    Ready    worker   2m54s   v1.33.2
----

. Check that the `--expander=priority,least-waste` argument is available in the cluster autoscaler pod by running the following command:
+
[source,terminal]
----
$ oc get pod -n <hosted_cluster_namespace>-<hosted_cluster_name> <cluster_autoscaler_pod_name> -o jsonpath='{.spec.containers[0].args}'|jq
----
+
.Example output
[source,json]
----
[
# ...
  "--scale-down-enabled=true",
# ...
  "--balancing-ignore-label=topology.k8s.aws/zone-id"
  "--expander=priority,least-waste",
# ...
]
----
