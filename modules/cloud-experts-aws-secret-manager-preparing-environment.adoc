// Module included in the following assemblies:
//
// * cloud_experts_tutorials/cloud-experts-aws-secret-manager.adoc

:_mod-docs-content-type: PROCEDURE
[id="cloud-experts-aws-secret-manager-preparing-environment_{context}"]
= Additional environment requirements

[role="_abstract"]
Before creating your application, you need to gain access to your {product-title} cluster.

.Procedure
. Log in to your {product-title} cluster by running the following command:
+
[source,terminal]
----
$ oc login --token=<your-token> --server=<your-server-url>
----
+
You can find your login token by accessing your cluster in {cluster-manager-url-pull}.

. Validate that your cluster has STS by running the following command:
+
[source,terminal]
----
$ oc get authentication.config.openshift.io cluster -o json \
  | jq .spec.serviceAccountIssuer
----
+
**Example output**:
+
[source,terminal]
----
"https://xxxxx.cloudfront.net/xxxxx"
----
+
If your output is different, do not proceed.
See
ifndef::openshift-rosa-hcp[]
link:https://docs.redhat.com/en/documentation/red_hat_openshift_service_on_aws_classic_architecture/4/html-single/install_rosa_classic_clusters/index#rosa-sts-creating-a-cluster-quickly[Red{nbsp}Hat documentation on creating an STS cluster] before continuing this process.
endif::openshift-rosa-hcp[]
ifdef::openshift-rosa-hcp[]
link:https://docs.redhat.com/en/documentation/red_hat_openshift_service_on_aws/4/html-single/install_clusters/index#rosa-hcp-sts-creating-a-cluster-quickly[Red{nbsp}Hat documentation on creating an STS cluster] before continuing this process.
endif::openshift-rosa-hcp[]

. Set the `SecurityContextConstraints` permission to allow the CSI driver to run by running the following command:
+
[source,terminal]
----
$ oc new-project csi-secrets-store
$ oc adm policy add-scc-to-user privileged \
    system:serviceaccount:csi-secrets-store:secrets-store-csi-driver
$ oc adm policy add-scc-to-user privileged \
    system:serviceaccount:csi-secrets-store:csi-secrets-store-provider-aws
----

. Create environment variables to use later in this process by running the following command:
+
[source,terminal]
----
$ export REGION=$(oc get infrastructure cluster -o=jsonpath="{.status.platformStatus.aws.region}")
$ export OIDC_ENDPOINT=$(oc get authentication.config.openshift.io cluster \
   -o jsonpath='{.spec.serviceAccountIssuer}' | sed  's|^https://||')
$ export AWS_ACCOUNT_ID=`aws sts get-caller-identity --query Account --output text`
$ export AWS_PAGER=""
----