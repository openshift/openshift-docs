// Module included in the following assembly:
//
// * release-notes/monitoring-release-notes.adoc

:_mod-docs-content-type: REFERENCE
[id="monitoring-4-16-release-notes_{context}"]
= {ocp} {product-version} monitoring release notes

[role="_abstract"]
The changes for {ocp} {product-version} monitoring are included in the following errata advisory:

* link:https://access.redhat.com/errata/RHSA-2024:0041[RHSA-2024:0041]

[id="monitoring-4-16-updates-to-monitoring-components-and-dependencies_{context}"]
== Updates to monitoring stack components and dependencies

This release includes the following version updates for monitoring stack components and dependencies:

* kube-state-metrics to 2.12.0
* Metrics Server to 0.7.1
* node-exporter to 1.8.0
* prom-label-proxy to 0.8.1
* Prometheus to 2.52.0
* Prometheus Operator to 0.73.2
* Thanos to 0.35.0

[id="monitoring-4-16-changes-alerting-rules_{context}"]
== Changes to alerting rules

[NOTE]
====
Red{nbsp}Hat does not guarantee backward compatibility for recording rules or alerting rules.
====

* Added the `ClusterMonitoringOperatorDeprecatedConfig` alert to monitor when the Cluster Monitoring Operator configuration uses a deprecated field.
* Added the `PrometheusOperatorStatusUpdateErrors` alert to monitor when the Prometheus Operator fails to update object status.

[id="monitoring-4-16-new-features-and-enhancements_{context}"]
== New features and enhancements

The monitoring stack for this release includes the following new features and enhancements:

Metrics Server component to access the Metrics API general availability (GA)::
The Metrics Server component is now generally available and automatically installed instead of the deprecated Prometheus Adapter. Metrics Server collects resource metrics and exposes them in the `metrics.k8s.io` Metrics API service for use by other tools and APIs, which frees the core platform Prometheus stack from handling this functionality. For more information, see link:https://docs.redhat.com/en/documentation/monitoring_stack_for_red_hat_openshift/4.16/html-single/config_map_reference_for_the_cluster_monitoring_operator/index#metricsserverconfig in the config map API reference for the Cluster Monitoring Operator.

New monitoring role to allow read-only access to the Alertmanager API::
This release introduces a new `monitoring-alertmanager-view` role to allow read-only access to the Alertmanager API in the `openshift-monitoring` project.

VPA metrics are available in the kube-state-metrics agent::
Vertical Pod Autoscaler (VPA) metrics are now available through the `kube-state-metrics` agent. VPA metrics follow a similar exposition format just as they did before being deprecated and removed from native support upstream.

Change in proxy service for monitoring components::
With this release, the proxy service in front of Prometheus, Alertmanager, and Thanos Ruler has been updated from OAuth to `kube-rbac-proxy`. This change might affect service accounts and users accessing these API endpoints without the appropriate roles and cluster roles.

Change in how Prometheus handles duplicate samples::
With this release, when Prometheus scrapes a target, duplicate samples are no longer silently ignored, even if they have the same value. The first sample is accepted and the `prometheus_target_scrapes_sample_duplicate_timestamp_total` counter is incremented, which might trigger the `PrometheusDuplicateTimestamps` alert.

[id="monitoring-4-16-technology-preview-features_{context}"]
== Technology Preview features

[IMPORTANT]
====
[subs="attributes+"]
Technology Preview features are not supported with Red{nbsp}Hat production service level agreements (SLAs) and might not be functionally complete. Red{nbsp}Hat does not recommend using them in production. These features provide early access to upcoming product features, enabling customers to test functionality and provide feedback during the development process.

For more information about the support scope of Red{nbsp}Hat Technology Preview features, see link:https://access.redhat.com/support/offerings/techpreview/[Technology Preview Features Support Scope].
====

The following table tracks features that are in Technology Preview or were Technology Preview in recent releases. Features are marked with the following statuses:

* _Not Available_
* _Technology Preview_
* _General Availability_

.Monitoring Technology Preview tracker
[cols="4,1,1,1",options="header"]
|====
|Feature |4.14 |4.15 |4.16

|Metrics Collection Profiles
|Technology Preview
|Technology Preview
|Technology Preview

|Metrics Server
|Not Available
|Technology Preview
|General Availability

|====

[id="monitoring-4-16-removed-features_{context}"]
== Removed features

The following features in the monitoring stack are removed in this release:

Dedicated service monitors for core platform monitoring::
With this release, the dedicated service monitors feature for core platform monitoring has been removed. You can no longer enable this feature in the `cluster-monitoring-config` config map object in the `openshift-monitoring` namespace. To replace this feature, Prometheus functionality has been improved to ensure that alerts and time aggregations are accurate. This improved functionality is active by default and makes the dedicated service monitors feature obsolete.

Prometheus Adapter for core platform monitoring::
With this release, the Prometheus Adapter component for core platform monitoring has been removed. It has been replaced by the new Metrics Server component.

[id="monitoring-4-16-deprecated-and-removed-tracker_{context}"]
== Deprecated and removed feature tracker

The following table tracks features that are deprecated or removed in recent releases. Features are marked with the following statuses:

* _General Availability_
* _Deprecated_
* _Removed_

.Monitoring deprecated and removed tracker
[cols="4,1,1,1",options="header"]
|====
|Feature |4.14 |4.15 |4.16

|`dedicatedServiceMonitors` setting that enables dedicated service monitors for core platform monitoring
|General Availability
|Deprecated
|Removed

|`prometheus-adapter` component that queries resource metrics from Prometheus and exposes them in the metrics API.
|General Availability
|Deprecated
|Removed

|====

[id="monitoring-4-16-fixed-issues_{context}"]
== Fixed issues

The monitoring stack for this release includes the following fixed issues:

* Previously, the Fibre Channel collector in the `node-exporter` agent failed if certain Fibre Channel device drivers did not expose all attributes. With this release, the Fibre Channel collector disregards these optional attributes and the issue has been resolved. (link:https://issues.redhat.com/browse/OCPBUGS-20151[OCPBUGS-20151])

* Previously, the `oc get podmetrics` and `oc get nodemetrics` commands were not working properly. With this release, the issue has been resolved. (link:https://issues.redhat.com/browse/OCPBUGS-25164[OCPBUGS-25164])

* Previously, setting an invalid `.spec.endpoints.proxyUrl` attribute in the `ServiceMonitor` resource would result in breaking, reloading, and restarting Prometheus. This update fixes the issue by validating the `proxyUrl` attribute against invalid syntax. (link:https://issues.redhat.com/browse/OCPBUGS-30989[OCPBUGS-30989])