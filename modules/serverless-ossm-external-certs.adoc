// Module included in the following assemblies:
//
// * /serverless/integrations/serverless-ossm-setup.adoc

:_content-type: PROCEDURE
[id="serverlesss-ossm-external-certs_{context}"]
= Creating a certificate to encrypt incoming external traffic

By default, the {SMProductShortName} mTLS feature only secures traffic inside of the {SMProductShortName} itself, between the ingress gateway and individual pods that have sidecars. To encrypt traffic as it flows into the {ocp-product-title} cluster, you must generate a certificate before you enable the {ServerlessProductName} and {SMProductShortName} integration.

.Prerequisites

* You have cluster administrator permissions on {ocp-product-title}, or you have cluster or dedicated administrator permissions on {rosa-product-title} or {dedicated-product-title}.
* You have installed the {ServerlessOperatorName} and Knative Serving.
* You have installed the OpenShift CLI (`oc`).
* You have access to the `knative-serving-ingress` namespace, which the {ServerlessOperatorName} creates automatically during installation.
* You have created a project or have access to a project with the appropriate roles and permissions to create applications and other workloads.

.Procedure

. Create a root certificate and private key that signs the certificates for your Knative services:
+
[source,terminal]
----
$ openssl req -x509 -sha256 -nodes -days 365 -newkey rsa:2048 \
    -subj '/O=Example Inc./CN=example.com' \
    -keyout root.key \
    -out root.crt
----
. Create a wildcard certificate:
+
[source,terminal]
----
$ openssl req -nodes -newkey rsa:2048 \
    -subj "/CN=*.apps.openshift.example.com/O=Example Inc." \
    -keyout wildcard.key \
    -out wildcard.csr
----
. Sign the wildcard certificate:
+
[source,terminal]
----
$ openssl x509 -req -days 365 -set_serial 0 \
    -CA root.crt \
    -CAkey root.key \
    -in wildcard.csr \
    -out wildcard.crt
----
. Create a secret containing the wildcard certificate by entering one of the following commands, depending on your {SMProductShortName} version:

** Option A: For {SMProductShortName} 2.x, create the secret in the `istio-system` namespace by entering the folloing command:
+
[source,terminal]
----
$ oc create -n istio-system secret tls wildcard-certs \
    --key=wildcard.key \
    --cert=wildcard.crt
----

** Option B: For {SMProductShortName} 3.x, create the secret in the `knative-serving-ingress` namespace by entering the folloing command:
+
[source,terminal]
----
$ oc create -n knative-serving-ingress secret tls wildcard-certs \
    --key=wildcard.key \
    --cert=wildcard.crt
----
+
The namespace used for the secret depends on the version of {SMProductShortName}. {SMProductShortName} 2.x expects the certificate in the `istio-system` namespace. The {SMProductShortName} 3.x uses the dedicated `knative-serving-ingress` namespace where the {ServerlessProductName} ingress gateway runs.

