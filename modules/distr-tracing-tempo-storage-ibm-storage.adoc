// Module included in the following assemblies:
//
//* observability/distr_tracing/distr_tracing_tempo/distr-tracing-tempo-installing.adoc
:_mod-docs-content-type: PROCEDURE
[id="distr-tracing-tempo-object-storage-setup-ibm-cloud-install_{context}"]
= IBM Object Store installation

You can set up the IBM Cloud storage by using the IBM Cloud Command Line Interface (AWS CLI) and OpenShift CLI

.Prerequisites

* You have installed the latest version of the IBM Cloud CLI.

.Procedure

. Set the IBM Cloud credential. In this case the creential is fetched from a Cluster deployed on IBM Cloud
+
[source,terminal]
----
export IBMCLOUD_API_KEY=$(oc get secrets ibmcloud-creds -n kube-system -o json | jq -r '.data.apiKey' | base64 -d)
----
+
. Login to IBM Cloud using IBM Cloud CLI
+
[source,terminal]
----
$ ibmcloud login -r us-east 
----
+
. Install the cloud-object-storage and infrastructure-service plugins.
+
[source,terminal]
----
$ ibmcloud plugin install cloud-object-storage
$ ibmcloud plugin install infrastructure-service
----
+
. Create a resource group.
+
[source,terminal]
----
$ ibmcloud resource group-create tempo-tracing
$ ibmcloud target -g tempo-tracing
----
+
. Create a service instance for the object store.
+
[source,terminal]
----
$ ibmcloud resource service-instance-create -d premium-global-deployment <tempo-bucket> cloud-object-storage standard global

$ export IBM_SERVICE_INSTANCE_ID=$(ibmcloud resource service-instance <tempo-bucket> -o json | jq -r '.[0].crn')
----
+
. Create the object store bucket.
+
[source,terminal]
----
$ ibmcloud cos bucket-create --bucket <tempo-bucket> --ibm-service-instance-id "$IBM_SERVICE_INSTANCE_ID"
----
+
. Create service key for connecting to the bucket.
+
[source,terminal]
----
$ ibmcloud resource service-key-create <tempo-bucket> Writer --instance-name <tempo-bucket>t --parameters '{"HMAC":true}'
----
+
. Create secret in OpenShift cluster with IBM cloud bucket credentials.
+
[source,terminal]
----
$ oc new-project tracing-system
----
+
. Extract access and secret keys to be used on secret creation.
+
[source,terminal]
----
$ json_output=$(ibmcloud resource service-key <tempo-bucket> -o json)

$ export IBM_BUCKET_ACCESS_KEY=$(echo $json_output | jq -r '.[0].credentials.cos_hmac_keys.access_key_id')

$ export IBM_BUCKET_SECRET_KEY=$(echo $json_output | jq -r '.[0].credentials.cos_hmac_keys.secret_access_key')

$ export IBM_BUCKET_ENDPOINT="https://s3.us-east.cloud-object-storage.appdomain.cloud"
----
+
. Create secret on OpenShift
+
[source,terminal]
----
$ oc -n tracing-system create secret generic ibm-cos-secret \
  --from-literal=bucket="ikanse-tempo-bucket" \
  --from-literal=endpoint="$IBM_BUCKET_ENDPOINT" \
  --from-literal=access_key_id="$IBM_BUCKET_ACCESS_KEY" \
  --from-literal=access_key_secret="$IBM_BUCKET_SECRET_KEY"
----
+
. Set the storage section as follows in the Tempo CR.
+
[source,yaml]
----
apiVersion: tempo.grafana.com/v1alpha1
kind:  TempoStack
# ...
spec:
# ...
  storage:
    secret:
      name: ibm-cos-secret # <1>
      type: s3 # <2>
# ...
----
<1> Name of the secret that contains IBM Cloud Storage access and secret keys
<2> This should be set to S3