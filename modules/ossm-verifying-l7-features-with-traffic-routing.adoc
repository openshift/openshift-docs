// Module included in the following assemblies:
// update/ossm-updating-openshift-service-mesh-in-ambient-mode.adoc

:_mod-docs-content-type: PROCEDURE
[id="ossm-verifying-l7-features-with-traffic-routing_{context}"]
= Verifying Layer 7 (L7) features with traffic routing

[role="_abstract"]
After updating the waypoint proxies, verify that Layer 7 (L7) features function as expected.
If you use traffic routing rules such as `HTTPRoute`, confirm that they continue to enforce the intended behavior.

.Prerequisites

* You have updated the waypoint proxies.

* You have deployed the `bookinfo` application.

* You have created an `HTTPRoute` resource.

.Procedure

. Optional: Create the `HTTPRoute` resource if it does not already exist by running the following command:
+
[source,terminal]
----
$ oc apply -f - <<EOF
apiVersion: gateway.networking.k8s.io/v1
kind: HTTPRoute
metadata:
  name: reviews
  namespace: bookinfo
spec:
  parentRefs:
  - group: ""
    kind: Service
    name: reviews
    port: 9080
  rules:
  - backendRefs:
    - name: reviews-v1
      port: 9080
      weight: 90
    - name: reviews-v2
      port: 9080
      weight: 10
EOF
----

. Verify that the `HTTPRoute` rules distribute traffic correctly by running the following command:
+
[source,terminal]
----
for i in {1..10}; do
  kubectl exec "$(
    kubectl get pod \
      -l app=productpage \
      -n bookinfo \
      -o jsonpath='{.items[0].metadata.name}'
  )" \
  -c istio-proxy \
  -n bookinfo -- \
  curl -s http://reviews:9080/reviews/0 | grep -o "reviews-v[0-9]"
done
----
+
The output should reflect the traffic distribution defined in your `HTTPRoute`. For example, with a `90/10` weight split between `reviews-v1` and `reviews-v2`, you should observe about nine requests routed to `reviews-v1` and one request routed to `reviews-v2`. The exact ratio can vary slightly due to load-balancing behavior, but should closely match the configured weights over multiple test runs.
