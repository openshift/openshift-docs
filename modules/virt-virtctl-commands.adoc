// Module included in the following assemblies:
//
// * virt/virt-using-the-cli-tools.adoc

:_content-type: REFERENCE
[id="virt-virtctl-commands_{context}"]
= Virtctl commands

The `virtctl` client is a command-line utility for managing {VirtProductName} resources.

Although the examples refer to virtual machines (VMs), you can use these commands with virtual machine instances (VMIs).

// apinnick: I recommend not breaking these sections into separate modules because of maintenance issues.
// These sections will never be used independently.

[id='virtctl-information-commands_{context}']
== Virtctl information commands

You use `virtctl` information commands to view information about the `virtctl` client.

.Information commands
[width="100%",cols="1a,2a",options="header"]
|===
|Command |Description
|`virtctl version`
|View the `virtctl` client and server versions.

|`virtctl help`
|View a list of `virtctl` commands.

|`virtctl <command> -h\|--help`
|View a list of options for a specific command.

|`virtctl options`
|View a list of global command options for any `virtctl` command.
|===

[id='vm-information-commands_{context}']
== VM information commands

You can use `virtctl` to view information about VMs.

.VM information commands
[width="100%",cols="1a,2a",options="header"]
|===
|Command |Description
|`virtctl fslist <vm_name>`
|View the file systems available on a guest machine.

|`virtctl guestosinfo <vm_name>`
|View information about the operating systems on a guest machine.

|`virtctl userlist <vm_name>`
|View the logged-in users on a guest machine.
|===

[id='vm-management-commands_{context}']
== VM management commands

You use `virtctl` virtual machine (VM) management commands to manage VMs.

.VM management commands
[width="100%",cols="1a,2a",options="header"]
|===
|Command |Description
|`virtctl start <vm_name>`
|Start a VM.

|`virtctl start --paused <vm_name>`
|Start a VM in a paused state. This option enables you to interrupt the boot process from the VNC console.

|`virtctl stop <vm_name>`
|Stop a VM.

|`virtctl stop <vm_name> --grace-period 0 --force`
|Force stop a VM. This option might cause data inconsistency or data loss.

|`virtctl pause vm <vm_name>`
|Pause a VM. The machine state is kept in memory.

|`virtctl unpause vm\|vmi <vm_name>`
|Unpause a VM.

|`virtctl migrate <vm_name>`
|Migrate a VM.

|`virtctl restart <vm_name>`
|Restart a VM.
|===

[id='vm-and-vmi-connection-commands_{context}']
== VM connection commands

You use `virtctl` connection commands to expose ports and connect to virtual machines (VMs).

.VM connection commands
[width="100%",cols="1a,2a",options="header"]
|===
|Command |Description
|`virtctl console <vm_name>`
|Connect to the serial console of a VM.

|`virtctl expose <vm_name>`
|Create a service that forwards a designated port of a VM and expose the service on the specified port of the node.

|`virtctl scp -i <ssh_key> <filename> <vm_username>@<vm_name>`
|Copy a file from your machine to a VM. The command uses the private key of an SSH key pair. The VM must be configured with its public key.

|`virtctl scp -i <ssh_key> <vm_username@<vm_name>:<filename> .`
|Copy a file from a VM to your machine. The command uses the private key of an SSH key pair. The VM must be configured with its public key.

|`virtctl ssh -i <ssh_key> <user_name>@<vm_name>`
|Open an SSH connection with a VM. The command uses the private key of an SSH key pair. The VM must be configured with its public key.

|`virtctl vnc --kubeconfig=$KUBECONFIG <vm_name>`
|Connect to the VNC console of a VM.

Accessing the graphical console of a VM through VNC requires a remote viewer on your local machine.

|`virtctl vnc --kubeconfig=$KUBECONFIG --proxy-only=true <vm_name>`
|Display the port number and connect manually to a VMI by using any viewer through the VNC connection.

|`virtctl vnc --kubeconfig=$KUBECONFIG --port=<port-number> <vm_name>`
|Specify a port number to run the proxy on the specified port, if that port is available.

If a port number is not specified, the proxy runs on a random port.
|===

[id='vm-volume-export-commands_{context}']
== VM export commands

You can use `virtctl vmexport` commands to create, download, or delete a volume exported from a VM, VM snapshot, or persistent volume claim (PVC).

.VM export commands
[width="100%",cols="1a,2a",options="header"]
|===
|Command |Description
|`virtctl vmexport create <vmexport_name> --vm\|snapshot\|pvc=<object_name>`
|Create a `VirtualMachineExport` custom resource (CR) to export a volume from a VM, VM snapshot, or PVC.

* `--vm`: Exports the PVCs of a VM.
* `--snapshot`: Exports the PVCs contained in a `VirtualMachineSnapshot` CR.
* `--pvc`: Exports a PVC.
* Optional: `--ttl=1h` specifies the time to live. The default duration is 2 hours.

|`virtctl vmexport delete <vmexport_name>`
|Delete a `VirtualMachineExport` CR manually.

|`virtctl vmexport download <vmexport_name> --output=<output_file> --volume=<volume_name>`
|Download the volume defined in a `VirtualMachineExport` CR.

* `--output` specifies the file format. Example: `disk.img.gz`.
* `--volume` specifies the volume to download. This flag is optional if only one volume is available.

Optional:

* `--keep-vme` retains the `VirtualMachineExport` CR after download. The default behavior is to delete the `VirtualMachineExport` CR after download.
* `--insecure` enables an insecure HTTP connection.

|`virtctl vmexport download <vmexport_name> --<vm\|snapshot\|pvc>=<object_name> --output=<output_file> --volume=<volume_name>`
|Create a `VirtualMachineExport` CR and then download the volume defined in the CR.
|===

[id='vm-memory-dump-commands_{context}']
== VM memory dump commands

You can use the `virtctl memory-dump` command to output a virtual machine (VM) memory dump on a PVC. You can specify an existing PVC or use the `--create-claim` flag to create a new PVC.

.Prerequisites

* The PVC volume mode must be `FileSystem`.
* The PVC must be large enough to contain the memory dump.
+
The formula for calculating the PVC size is `(VMMemorySize + 100Mi) * FileSystemOverhead`, where `100Mi` is the memory dump overhead.

* You must enable the hot plug feature gate in the `HyperConverged` custom resource by running the following command:
+
[source,terminal]
----
$ oc patch hco kubevirt-hyperconverged -n openshift-cnv \
  --type json -p '[{"op": "add", "path": "/spec/featureGates", \
  "value": "HotplugVolumes"}]'
----

.Downloading the memory dump

You must use the `virtctl vmexport download` command to download the memory dump:

[source,terminal]
----
$ virtctl vmexport download <vmexport_name> --vm\|pvc=<object_name> \
  --volume=<volume_name> --output=<output_file>
----

.VM memory dump commands
[width="100%",cols="1a,2a",options="header"]
|===
|Command |Description
|`virtctl memory-dump get <vm_name> --claim-name=<pvc_name>`
|Save the memory dump of a VM on a PVC. The memory dump status is displayed in the `status` section of the `VirtualMachine` resource.

Optional:

* `--create-claim` creates a new PVC with the appropriate size. This flag has the following options:

** `--storage-class=<storage_class>`: Specify a storage class for the PVC.
** `--access-mode=<access_mode>`: Specify `ReadWriteOnce` or `ReadWriteMany`.

|`virtctl memory-dump get <vm_name>`
|Rerun the `virtctl memory-dump` command with the same PVC.

This command overwrites the previous memory dump.

|`virtctl memory-dump remove <vm_name>`
|Remove a memory dump.

You must remove a memory dump manually if you want to change the target PVC.

This command removes the association between the VM and the PVC, so that the memory dump is not displayed in the `status` section of the `VirtualMachine` resource. The PVC is not affected.
|===

[id='image-upload-commands_{context}']
== Image upload commands

You can use the `virtctl image-upload` commands to upload a VM image to a data volume.

.Image upload commands
[width="100%",cols="1a,2a",options="header"]
|===
|Command |Description
|`virtctl image-upload dv <datavolume_name> --image-path=</path/to/image> --no-create`
|Upload a VM image to a data volume that already exists.

|`virtctl image-upload dv <datavolume_name> --size=<datavolume_size> --image-path=</path/to/image>`
|Upload a VM image to a new data volume of a specified requested size.
|===

