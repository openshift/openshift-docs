:_newdoc-version: 2.18.4
:_template-generated: 2025-04-28
:_mod-docs-content-type: PROCEDURE

[id="forwarding-logs-to-lokistack-in-logging-6_{context}"]
= Forwarding logs to LokiStack in Logging 6

If you forward logs to LokiStack in Logging 5.x, then you must make a few updates to the cluster log forwarder when upgrading to Logging 6.x.

////
.Prerequisites
* A bulleted list of conditions that must be satisfied before the user starts the steps in this module.
////

.Procedure

. Provide the permissions to collect and write to Loki gateway.
** Provide collect permissions by running the following commands:
+
[source]
----
$ oc adm policy add-cluster-role-to-user collect-application-logs -z logging-admin
$ oc adm policy add-cluster-role-to-user collect-infrastructure-logs -z logging-admin
$ oc adm policy add-cluster-role-to-user collect-audit-logs -z logging-admin
----
** Provide write permissions by running the following commands:
+
[source]
----
 $ oc adm policy add-cluster-role-to-user cluster-logging-write-application-log -z logging-admin
$ oc adm policy add-cluster-role-to-user cluster-logging-write-infrastructure-logs -z logging-admin
$ oc adm policy add-cluster-role-to-user cluster-logging-write-audit-logs -z logging-admin
----
+
[NOTE]
====
The -z flag used above creates a cluster role binding to the service account in the current namespace. Use oc create clusterolebinding -h for more explicit options when creating bindings
====

. Create a cluster log forwarder by using the `observability.openshift.io` API.
+
.Example ClusterLogForwarder
[source,yaml]
----
apiVersion: observability.openshift.io/v1
kind: ClusterLogForwarder
metadata:
  name: my-forwarder
spec:
  serviceAccount:
    name: logging-admin # <1>
  outputs:
  - name: default-lokistack
    type: lokiStack
    lokiStack:
      target:
        name: logging-loki # <2>
        namespace: openshift-logging
      authentication:
        token:
          from: serviceAccount
    tls:
      ca:
        key: service-ca.crt # <3>
        configMapName: openshift-service-ca.crt
  pipelines:
  - name: my-pipeline
    outputRefs:
    - default-lokistack
    inputRefs:
    - application
    - infrastructure
----
<1> serviceAccount.name must have permissions to collect and write to loki gateway. 
<2> lokiStack.target name and namespace must match your loki instance name.
<3> TLS configuration key and configMapName can use the existing openshift service config map.

////
.Verification
Delete this section if it does not apply to your module. Provide the user with verification methods for the procedure, such as expected output or commands that confirm success or failure.

* Provide an example of expected command output or a pop-up window that the user receives when the procedure is successful.
* List actions for the user to complete, such as entering a command, to determine the success or failure of the procedure.
* Make each step an instruction.
* Use an unnumbered bullet (*) if the verification includes only one step.

.Troubleshooting
Delete this section if it does not apply to your module. Provide the user with troubleshooting steps.

* Make each step an instruction.
* Use an unnumbered bullet (*) if the troubleshooting includes only one step.

.Next steps
* Delete this section if it does not apply to your module.
* Provide a bulleted list of links that contain instructions that might be useful to the user after they complete this procedure.
* Use an unnumbered bullet (*) if the list includes only one step.

NOTE: Do not use *Next steps* to provide a second list of instructions.

[role="_additional-resources"]
.Additional resources
* link:https://github.com/redhat-documentation/modular-docs#modular-documentation-reference-guide[Modular Documentation Reference Guide]
* xref:some-module_{context}[]

////
