// This module is included in the following assemblies:
// * secure/authenticating-pipelines-and-tasks-using-secrets.adoc

:_mod-docs-content-type: PROCEDURE
[id="op-configuring-container-registry-authentication-using-workspaces_{context}"]
= Configuring container registry authentication using workspaces

For a pipeline to retrieve container images from a registry, you must configure the authentication for that registry.

To configure authentication for a container registry, create an authentication secret with the Docker configuration file, configure a named workspace for this secret in the task, and specify the secret when running the task.

.Procedure

. Create the container registry authentication secret from an existing `config.json` file, which contains the authentication information, by entering the following command:
+
[source, terminal]
----
$ oc create secret generic my-registry-credentials \ # <1>
  --from-file=config.json=/home/user/credentials/config.json # <2>
----
<1> The name of the secret, in this example, `my-registry-credentials`
<2> The path name of the `config.json` file, in this example, `/home/user/credentials/config.json`

. In your task definition, configure a named workspace for the Git authentication, for example, `ssh-directory`:
+
.Example definition of a workspace
[source, yaml]
----
apiVersion: tekton.dev/v1beta1
kind: Task
metadata:
  name: skopeo-copy
spec:
  workspaces:
    - name: dockerconfig
      description: Includes a docker `config.json`
# ...
----

. In the steps of the task, access the directory by using the path in the `$(workspaces.<workspace_name>.path)` environment variable, for example, `$(workspaces.dockerconfig.path)`.

. To run the task, specify the secret for the named workspace by including the `--workspace` argument in the `tkn task start` command:
+
[source, terminal]
----
$ tkn task start <task_name>
      --workspace name=<workspace_name>,secret=<secret_name> # <1>
      # ...
----
<1> Replace `<workspace_name>` with the name of the workspace that you configured and `<secret_name>` with the name of the secret that you created.

.Example task for copying an image from a container repository using Skopeo
[source,yaml,subs="attributes+"]
----
apiVersion: tekton.dev/v1beta1
kind: Task
metadata:
  name: skopeo-copy
spec:
  workspaces:
    - name: dockerconfig <1>
      description: Includes a docker `config.json`
  steps:
    - name: clone
      image: quay.io/skopeo/stable:v1.8.0
      env:
      - name: DOCKER_CONFIG
        value: $(workspaces.dockerconfig.path) <2>
      script: |
        #!/usr/bin/env sh
        set -eu
        skopeo copy docker://docker.io/library/ubuntu:latest docker://quay.io/example_repository/ubuntu-copy:latest
----
<1> The name of the workspace that contains the `config.json` file.
<2> The `DOCKER_CONFIG` environment variable points to the location of the `config.json` file in the `dockerconfig` workspace. Skopeo uses this environment variable to get the authentication information.

.Example command for running the task
[source, terminal]
----
$ tkn task start skopeo-copy
      --workspace name=dockerconfig,secret=my-registry-credentials
      --use-param-defaults --showlog
----
