// This module is included in the following assemblies:
// * secure/authenticating-pipelines-and-tasks-using-secrets.adoc

:_mod-docs-content-type: PROCEDURE
[id="op-configuring-container-registry-authentication-using-workspaces_{context}"]
= Configuring container registry authentication using workspaces

[role="_abstract"]
For a pipeline to retrieve container images from a registry, you must configure the authentication for that registry.

To configure authentication for a container registry, create an authentication secret with the Docker configuration file, configure a named workspace for this secret in the task, and specify the secret when running the task.

.Procedure

. Create the container registry authentication secret from an existing `config.json` file, which has the authentication information, by entering the following command:
+
[source, terminal]
----
$ oc create secret generic my-registry-credentials \
  --from-file=config.json=/home/user/credentials/config.json
----
+
`my-registry-credentials`:: The name of the secret. Replace `my-registry-credentials` with the registry credential.
`config.json`:: The path name of the `config.json` file. Replace `/home/user/credentials/config.json` with the path of the `config.json` file.

. In your task definition, configure a named workspace for the Git authentication, for example, `ssh-directory`:
+
.Example definition of a workspace
[source, yaml]
----
apiVersion: tekton.dev/v1beta1
kind: Task
metadata:
  name: skopeo-copy
spec:
  workspaces:
    - name: dockerconfig
      description: Includes a docker `config.json`
# ...
----

. In the steps of the task, access the directory by using the path in the `$(workspaces.<workspace_name>.path)` environment variable, for example, `$(workspaces.dockerconfig.path)`.

. To run the task, specify the secret for the named workspace by including the `--workspace` argument in the `tkn task start` command:
+
[source, terminal]
----
$ tkn task start <task_name>
      --workspace name=<workspace_name>,secret=<secret_name>
      # ...
----
+
`--workspace`:: Replace `<workspace_name>` with the name of the workspace that you configured, and `<secret_name>` with the name of the secret that you created.
+
.Example task for copying an image from a container repository by using Skopeo
[source,yaml,subs="attributes+"]
----
apiVersion: tekton.dev/v1beta1
kind: Task
metadata:
  name: skopeo-copy
spec:
  workspaces:
    - name: dockerconfig
      description: Includes a docker `config.json`
  steps:
    - name: clone
      image: quay.io/skopeo/stable:v1.8.0
      env:
      - name: DOCKER_CONFIG
        value: $(workspaces.dockerconfig.path)
      script: |
        #!/usr/bin/env sh
        set -eu
        skopeo copy docker://docker.io/library/ubuntu:latest docker://quay.io/example_repository/ubuntu-copy:latest
----
+
`dockerconfig`:: The name of the workspace that has the `config.json` file.
`$(workspaces.dockerconfig.path)`:: The `DOCKER_CONFIG` environment variable points to the location of the `config.json` file in the `dockerconfig` workspace. Skopeo uses this environment variable to get the authentication information.
+
.Example command for running the task
[source, terminal]
----
$ tkn task start skopeo-copy
      --workspace name=dockerconfig,secret=my-registry-credentials
      --use-param-defaults --showlog
----
