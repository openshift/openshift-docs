[id="configure_observability_metrics{context}"]
= Configuring observability metrics
:prodname: Connectivity Link

The example dashboards and alerts provided by {prodname} use metrics exported by {prodname} and Gateway API components to provide insight into your applications, APIs, and Gateways. While not essential, it is best to configure these metrics and set up these dashboards and alerts on your OpenShift cluster. 

The example dashboards and alerts for observing {prodname} functionality use low-level CPU metrics and network metrics available from the user monitoring stack in OpenShift and resource state metrics from Gateway API and {prodname} resources.

This section provides links to OpenShift documentation on how to configure monitoring and metrics storage and shows how to configure resources to scrape the relevant metrics.

NOTE: You must perform these steps on each OpenShift cluster that you want to use {prodname} on.

.Prerequisites

* You have installed {prodname} as described in {LinkRHCLInstall}[{NameRHCLInstall}].
* You have set up monitoring for user-defined projects as described in the https://docs.openshift.com/container-platform/latest/observability/monitoring/enabling-monitoring-for-user-defined-projects.html#enabling-monitoring-for-user-defined-projects_enabling-monitoring-for-user-defined-projects[OpenShift monitoring documentation].

.Procedure

. When monitoring for user projects is enabled in OpenShift, this allows the scraping of metrics from the Gateway and {prodname} components. To scrape additional metrics in OpenShift, you can install a `kube-state-metrics` instance, with a custom resource configuration as follows:
+
[,bash]
----
kubectl apply -f https://raw.githubusercontent.com/Kuadrant/kuadrant-operator/v1.0.1/config/observability/openshift/kube-state-metrics.yaml

kubectl apply -k https://github.com/Kuadrant/gateway-api-state-metrics/config/kuadrant?ref=0.6.0
----

. Some example dashboards aggregate data by request path. By default, {service-mesh} metrics do not include labels for request paths, however, you can enable these labels as follows:
+
[,bash]
----
kubectl apply -f https://raw.githubusercontent.com/Kuadrant/kuadrant-operator/v1.0.1/config/observability/openshift/telemetry.yaml
----
+
NOTE: This might lead to a high cardinality label where multiple time series are generated, which can have an impact on performance and resource usage. For more details, see the https://www.robustperception.io/cardinality-is-key/[Reliable Insights blog post on cardinality].

. You can configure scraping of metrics from the various {prodname} Operators as follows:
+
[,bash]
----
kubectl apply -f https://raw.githubusercontent.com/Kuadrant/kuadrant-operator/v1.0.1/config/observability/prometheus/monitors/operators.yaml
----
+
NOTE: You must apply additional configuration so that all relevant metrics are scraped. However, this configuration depends on how you deploy your Gateway later. For details on the required steps, see {LinkRHCLDeploy}#optional_configure_metrics_to_be_scraped_from_the_gateway_instance[{NameRHCLDeploy}].  	


.Additional resources

* For details on how to enable metrics in {service-mesh}, see the https://docs.redhat.com/en/documentation/red_hat_openshift_service_mesh/{service-mesh-version}/html-single/observability/index#ossm-metrics-assembly[{service-mesh} metrics documentation]. 
* For more details on Connectivity Link component metrics, see the https://docs.kuadrant.io/1.0.x/kuadrant-operator/doc/observability/metrics/[Kuadrant metrics documentation].
