[id="configure-observability-metrics_{context}"]
= Configuring observability metrics
:prodname: Connectivity Link

The {prodname} example dashboards and alerts use metrics exported by {prodname}, Gateway API, and OpenShift components to provide insight into your  Gateways, applications, and APIs. This section explains how to configure these metrics and set up these dashboards and alerts on your OpenShift cluster. 

The example dashboards and alerts for observing {prodname} functionality use low-level CPU and network metrics from the user monitoring stack in OpenShift and resource state metrics from Gateway API and {prodname} resources. The user monitoring stack in OpenShift is based on the https://prometheus.io/[Prometheus] open source project. 

NOTE: You must perform these steps on each OpenShift cluster that you want to use {prodname} on.

.Prerequisites

* You have {prodname} installed as described in {LinkRHCLInstall}[{NameRHCLInstall}].
* You have monitoring for user-defined projects set up as described in the https://docs.redhat.com/en/documentation/openshift_container_platform/latest/html-single/monitoring/index#preparing-to-configure-the-monitoring-stack-uwm[OpenShift monitoring documentation].
* You have Grafana installed and configured on your OpenShift cluster. For a community-based example, see https://kuadrant.io/blog/grafana-on-openshift-for-kuadrant[Installing Grafana on OpenShift for Kuadrant Observability]. 
* You have cloned the https://github.com/Kuadrant/kuadrant-operator[Kuadrant Operator GitHub repository]. 

.Procedure

. Verify that user workload monitoring is configured correctly in your OpenShift cluster as follows:
+
[source,bash]
----
kubectl get configmap cluster-monitoring-config -n openshift-monitoring -o jsonpath='{.data.config\.yaml}'|grep enableUserWorkload
----
+
The expected output is `enableUserWorkload: true`.

. Install the {prodname}, Gateway, and Grafana component metrics and configuration as follows:
+
[source,bash]
----
kubectl apply -k https://github.com/Kuadrant/kuadrant-operator/config/install/configure/observability?ref=v1.2.0
----

. From the root directory of your Kuadrant Operator repository, configure the OpenShift `thanos-query` instance as a data source in Grafana as follows: 
+
[source,bash]
----
TOKEN="Bearer $(oc whoami -t)"
HOST="$(kubectl -n openshift-monitoring get route thanos-querier -o jsonpath='https://{.status.ingress[].host}')"
echo "TOKEN=$TOKEN" > config/observability/openshift/grafana/datasource.env
echo "HOST=$HOST" >> config/observability/openshift/grafana/datasource.env
kubectl apply -k config/observability/openshift/grafana
----

. Configure the example Grafana dashboards as follows:
+
[source,bash]
----
kubectl apply -k https://github.com/Kuadrant/kuadrant-operator/examples/dashboards?ref=v1.2.0
----	

.Additional resources

* For information on how to configure metrics in {service-mesh}, see the https://docs.redhat.com/en/documentation/red_hat_openshift_service_mesh/latest/html-single/observability/index#ossm-metrics-assembly[{service-mesh} metrics documentation]. 
* For reference information on component metrics, see the https://docs.kuadrant.io/{version}.x/kuadrant-operator/doc/observability/metrics/[Kuadrant metrics documentation].


