// Module included in the following assemblies:
//
// * cloud_experts_tutorials/cloud-experts-aws-secret-manager.adoc

:_mod-docs-content-type: PROCEDURE
[id="cloud-experts-aws-secret-manager-cleanup_{context}"]
= Clean up

[role="_abstract"]
Clean up your AWS resources after completing this lab tutorial.

.Procedure
. Delete the application by running the following command:
+
[source,terminal]
----
$ oc delete project my-application
----

. Delete the secrets store csi driver by running the following command:
+
[source,terminal]
----
$ helm delete -n csi-secrets-store csi-secrets-store-driver
----

. Delete the security context constraints by running the following command:
+
[source,terminal]
----
$ oc adm policy remove-scc-from-user privileged \
    system:serviceaccount:csi-secrets-store:secrets-store-csi-driver; oc adm policy remove-scc-from-user privileged \
    system:serviceaccount:csi-secrets-store:csi-secrets-store-provider-aws
----

. Delete the AWS provider by running the following command:
+
[source,terminal]
----
$ oc -n csi-secrets-store delete -f \
https://raw.githubusercontent.com/rh-mobb/documentation/main/content/misc/secrets-store-csi/aws-provider-installer.yaml
----

. Delete AWS Roles and Policies by running the following command:
+
[source,terminal]
----
$ aws iam detach-role-policy --role-name openshift-access-to-mysecret \
    --policy-arn $POLICY_ARN; aws iam delete-role --role-name openshift-access-to-mysecret; aws iam delete-policy --policy-arn $POLICY_ARN
----

. Delete the Secrets Manager secret by running the following command:
+
[source,terminal]
----
$ aws secretsmanager --region $REGION delete-secret --secret-id $SECRET_ARN
----