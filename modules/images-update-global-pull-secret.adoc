// Module included in the following assemblies:
// * openshift_images/managing_images/using-image-pull-secrets.adoc
// * updating/updating_a_cluster/updating_disconnected_cluster/disconnected-update-osus.adoc
// * support/remote_health_monitoring/remote-health-reporting.adoc
//
// Not included, but linked to from:
// * operators/admin/olm-managing-custom-catalogs.adoc

ifeval::["{context}" == "using-image-pull-secrets"]
:image-pull-secrets:
endif::[]

:_mod-docs-content-type: PROCEDURE
[id="images-update-global-pull-secret_{context}"]
= Updating the global cluster pull secret

[role="_abstract"]
To add new registries or change authentication for your {product-title} cluster, you can update the global pull secret by replacing it or appending new credentials. Use the `oc set data secret/pull-secret` command to apply the updated pull secret to all nodes in your cluster.

ifndef::image-pull-secrets[]
Use this procedure when you need a separate registry to store images than the registry used during installation.
endif::image-pull-secrets[]

ifdef::image-pull-secrets[]
[IMPORTANT]
====
To transfer your cluster to another owner, you must initiate the transfer in {cluster-manager-url} and then update the pull secret on the cluster. Updating a cluster's pull secret without initiating the transfer in {cluster-manager} causes the cluster to stop reporting Telemetry metrics in {cluster-manager}.

For more information, see "Transferring cluster ownership" in the {cluster-manager-first} documentation.
====
endif::image-pull-secrets[]

.Prerequisites

* You have access to the cluster as a user with the `cluster-admin` role.

.Procedure

. Optional: To append a new pull secret to the existing pull secret:
+
.. Download the pull secret by entering the following command:
+
[source,terminal]
----
$ oc get secret/pull-secret -n openshift-config --template='{{index .data ".dockerconfigjson" | base64decode}}' > <pull_secret_location> <1>
----
+
--
where:

`<pull_secret_location>`:: Specifies the path to the pull secret file.
--

.. Add the new pull secret by entering the following command:
+
[source,terminal]
----
$ oc registry login --registry="<registry>" \
--auth-basic="<username>:<password>" \
--to=<pull_secret_location>
----
+
--
where:

`<registry>`:: Specifies the new registry. You can include many repositories within the same registry, for example: `--registry="<registry/my-namespace/my-repository>`.

`<username>:<password>`:: Specifies the credentials of the new registry.

`<pull_secret_location>`:: Specifies the path to the pull secret file.
--

. Update the global pull secret for your cluster by entering the following command. Note that this update rolls out to all nodes, which can take some time depending on the size of your cluster.
+
[source,terminal]
----
$ oc set data secret/pull-secret -n openshift-config \
  --from-file=.dockerconfigjson=<pull_secret_location>
----
+
--
where:

`<pull_secret_location>`:: Specifies the path to the new pull secret file.
--

ifeval::["{context}" == "using-image-pull-secrets"]
:!image-pull-secrets:
endif::[]
