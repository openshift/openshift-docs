// This module is included in the following assemblies:
// * create/remote-pipelines-tasks-resolvers.adoc

// // *openshift_pipelines/remote-pipelines-tasks-resolvers.adoc
:_mod-docs-content-type: REFERENCE
[id="resolver-community-tasks-ref_{context}"]
= Community tasks provided in the {pipelines-shortname} namespace

By default, an {pipelines-shortname} installation includes a set of community tasks that you can use in your pipelines. These tasks are located in the {pipelines-shortname} installation namespace, which is normally the `openshift-pipelines` namespace.

[discrete]
[id="op-ctaskref-argocd-task-sync-and-wait_{context}"]
== argocd-task-sync-and-wait
The `argocd-task-sync-and-wait` community task deploys an Argo CD application and waits for it to be healthy. 

To do so, it requires the following configurations:
* The address of the Argo CD server configured in the `argocd-env-configmap` config map.
* The authentication information configured in the `argocd-env-secret` secret.

.Example config map with the address information
[source,yaml]
----
apiVersion: v1
kind: ConfigMap
metadata:
  name: argocd-env-configmap
data:
  ARGOCD_SERVER: https://argocd.example.com
# ...
----

.Example secret with the authentication information
[source,yaml]
----
apiVersion: v1
kind: Secret
metadata:
  name: argocd-env-secret
data:
  # Option 1
  ARGOCD_USERNAME: example_username #<1>
  ARGOCD_PASSWORD: example_password
  # Option 2
  ARGOCD_AUTH_TOKEN: exmaple_token
----
<1> Configure either a username and password or an authentication token.

.Example usage of the `argocd-task-sync-and-wait` community task
[source,yaml,subs="attributes+"]
----
apiVersion: tekton.dev/v1
kind: Pipeline
metadata:
  name: argocd-task-sync-and-wait
spec:
  tasks:
    - name: argocd-task-sync-and-wait
      params:
        - name: application-name
          value: example_app_name
        - name: revision
          value: HEAD
        - name: flags
          value: '--'
        - name: argocd-version
          value: v2.2.2
      taskRef:
        kind: Task
        name: argocd-task-sync-and-wait
----

.Supported parameters for the `argocd-task-sync-and-wait` community task
[cols="1,2,1",options="header"]
|===
| Parameter | Description | Default value
|`application-name` |Name of the application to deploy.|
|`revision` |Revision to deploy. | `HEAD`
|`flags` |  | `--`
|`argocd-version` |Version of Argo CD. |`v2.2.2`
|===

[discrete]
[id="op-ctaskref-helm-upgrade-from-repo_{context}"]
== helm-upgrade-from-repo

The `helm-upgrade-from-repo` community task installs or upgrades a Helm chart in your {OCP} cluster based on the given Helm repository and chart.

.Example usage of the `helm-upgrade-from-repo` community task
[source,yaml,subs="attributes+"]
----
apiVersion: tekton.dev/v1
kind: Pipeline
metadata:
  name: helm-upgrade-from-repo
spec:
  tasks:
    - name: helm-upgrade-from-repo
      params:
        - name: helm_repo
          value: example_helm_repository
        - name: chart_name
          value: example_chart_name
        - name: release_version
          value: v1.0.0
        - name: release_name
          value: helm-release
        - name: release_namespace
          value: ''
        - name: overwrite_values
          value: ''
        - name: helm_image
          value: 'docker.io/lachlanevenson/k8s-helm@sha256:5c792f29950b388de24e7448d378881f68b3df73a7b30769a6aa861061fd08ae'
      taskRef:
        kind: Task
        name: helm-upgrade-from-repo
----

.Supported parameters for the `helm-upgrade-from-repo` community task
[cols="1,2,1",options="header"]
|===
| Parameter | Description | Default value
|`helm_repo` |Helm repository. |
|`chart_name` |Helm chart name to be deployed. |
|`release_version` |Helm release version in semantic versioning format. |`v1.0.0`
|`release_name` |Helm release name. |`helm-release`
|`release_namespace` |Helm release namespace. |`""`
|`overwrite_values` |Configuration parameters to overwrite, comma separated. For example: `autoscaling.enabled=true,replicas=1`|`""`
|`helm_image` |Helm image to be used. |`docker.io/lachlanevenson/k8s-helm@sha256:5c792f29950b388de24e7448d378881f68b3df73a7b30769a6aa861061fd08ae`
|===

[discrete]
[id="op-ctaskref-helm-upgrade-from-source_{context}"]
== helm-upgrade-from-source

The `helm-upgrade-from-source` community task installs and upgrades a Helm chart in your {OCP} cluster based on the given chart and source workspace.

.Example usage of the `helm-upgrade-from-source` community task
[source,yaml,subs="attributes+"]
----
apiVersion: tekton.dev/v1
kind: Pipeline
metadata:
  name: helm-upgrade-from-source
spec:
  tasks:
    - name: helm-upgrade-from-source
      params:
        - name: charts_dir
          value: example_directory_path
        - name: release_version
          value: v1.0.0
        - name: release_name
          value: helm-release
        - name: release_namespace
          value: ''
        - name: overwrite_values
          value: ''
        - name: values_file
          value: values.yaml
        - name: helm_image
          value: 'docker.io/lachlanevenson/k8s-helm@sha256:5c792f29950b388de24e7448d378881f68b3df73a7b30769a6aa861061fd08ae'
        - name: upgrade_extra_params
          value: ''
      taskRef:
        kind: Task
        name: helm-upgrade-from-source
      workspaces:
        - name: source
          workspace: shared-workspace
  #...
----

.Supported parameters for the `helm-upgrade-from-source` community task
[cols="1,2,1",options="header"]
|===
| Parameter | Description | Default value
|`charts_dir` |Directory in the source workspace that contains the Helm chart. |
|`release_version` |Helm release version in semantic versioning format. | `v1.0.0`
|`release_name` |Helm release name. |`helm-release`
|`release_namespace` |Helm release namespace. |`""`
|`overwrite_values` |Configuration parameters to overwrite, comma separated. For example: `autoscaling.enabled=true,replicas=1`|`""`
|`values_file` |File with configuration parameters for Helm. |`values.yaml`
|`helm_image` |Helm image to be used. |`docker.io/lachlanevenson/k8s-helm@sha256:5c792f29950b388de24e7448d378881f68b3df73a7b30769a6aa861061fd08ae`
|`upgrade_extra_params` |Extra parameters passed for the Helm upgrade command.|`""`
|===

.Supported workspaces for the `helm-upgrade-from-source` community task
[cols="1,3",options="header"]
|===
| Workspace | Description
| `source` | The workspace that contains the Helm chart.
|===

[discrete]
[id="op-ctaskref-jib-maven_{context}"]
== jib-maven

The `jib-maven` community task builds Java, Kotlin, Groovy, and Scala sources into a container image by using the Jib tool for Maven projects. 

.Example usage of the `jib-maven` community task
[source,yaml,subs="attributes+"]
----
apiVersion: tekton.dev/v1
kind: Pipeline
metadata:
  name: jib-maven
spec:
  tasks:
    - name: jib-maven
      params:
        - name: IMAGE
          value: example_image
        - name: MAVEN_IMAGE
          value: 'registry.redhat.io/ubi9/openjdk-17@sha256:78613bdf887530100efb6ddf92d2a17f6176542740ed83e509cdc19ee7c072d6'
        - name: DIRECTORY
          value: .
        - name: CACHE
          value: empty-dir-volume
        - name: INSECUREREGISTRY
          value: 'false'
        - name: CACERTFILE
          value: service-ca.crt
      taskRef:
        kind: Task
        name: jib-maven
      workspaces:
        - name: source
          workspace: shared-workspace
  #...
----

.Supported parameters for the `jib-maven` community task
[cols="1,2,1",options="header"]
|===
| Parameter | Description | Default value
|`IMAGE` |Name of the image to build. |
|`MAVEN_IMAGE` |Maven base image. |`registry.redhat.io/ubi9/openjdk-17@sha256:78613bdf887530100efb6ddf92d2a17f6176542740ed83e509cdc19ee7c072d6`
|`DIRECTORY` |Directory{nbsp}containing{nbsp}the{nbsp}app,{nbsp}relative{nbsp}to the source repository root. |`.`
|`CACHE` |Name of the volume for caching Maven artifacts and base image layers. |`empty-dir-volume`
|`INSECUREREGISTRY` |Allow an insecure registry. |`false`
|`CACERTFILE` |Certificate authority (CA) bundle file name for an insecure registry service. |`service-ca.crt`
|===

.Supported workspaces for the `jib-maven` community task
[cols="1,3",options="header"]
|===
| Workspace | Description
| `source` | Workspace that contains the Maven project.
|`sslcertdir` | Optional workspace that contains SSL certificates.
|===

.Results that the `jib-maven` task returns
[cols="1,1,2",options="header"]
|===
| Result | Type | Description
|`IMAGE_DIGEST` |`string` |Digest of the image that was built.
|===

.Changes from the `jib-maven` community cluster task

* The default values for the `IMAGE` and `MAVEN_IMAGE` parameters were changed.

[discrete]
[id="op-ctaskref-kubeconfig-creator_{context}"]
== kubeconfig-creator
The `kubeconfig-creator` community task creates a `kubeconfig` file that other tasks in the pipeline can use for accessing different clusters.

.Example usage of the `kubeconfig-creator` community task
[source,yaml,subs="attributes+"]
----
apiVersion: tekton.dev/v1
kind: Pipeline
metadata:
  name: kubeconfig-creator
spec:
  tasks:
    - name: kubeconfig-creator
      params:
        - name: name
          value: example_cluster
        - name: url
          value: https://cluster.example.com
        - name: username
          value: example_username
        - name: password
          value: example_password
        - name: cadata
          value: ''
        - name: clientKeyData
          value: ''
        - name: clientCertificateData
          value: ''
        - name: namespace
          value: ''
        - name: token
          value: ''
        - name: insecure
          value: 'false'
      taskRef:
        kind: Task
        name: kubeconfig-creator
      workspaces:
        - name: output
          workspace: shared-workspace
  #...
----

.Supported parameters for the `kubeconfig-creator` community task
[cols="1,2,1",options="header"]
|===
| Parameter | Description | Default value
|`name` |Name of the cluster to access. |
|`url` |Address of the cluster to access. |
|`username` |Username for basic authentication to the cluster. |
|`password` |Password for basic authentication to the cluster. |`""`
|`cadata` |PEM-encoded certificate authority (CA) certificates. |`""`
|`clientKeyData` |PEM-encoded data from a client key file for TLS. |`""`
|`clientCertificateData` |PEM-encoded data from a client certification file for TLS. |`""`
|`namespace` |Default namespace to use on unspecified requests. |`""`
|`token` |Bearer token for authentication to the cluster. |`""`
|`insecure` |To indicate whether a server should be accessed without verifying the TLS certificate. |`false`
|===

.Supported workspaces for the `kubeconfig-creator` community task
[cols="1,3",options="header"]
|===
| Workspace | Description
| `output` | The workspace where the `kubeconfig-creator` task stores the `kubeconfig` file.
|===

[discrete]
[id="op-ctaskref-pull-request_{context}"]
== pull-request

You can use the `pull-request` community task to interact with a source control management (SCM) system through an abstracted interface.

This community task works with both public SCM instances and self-hosted or enterprise GitHub or GitLab instances. 

In download mode, this task populates the `pr` workspace with the state of the existing pull request, including the `.MANIFEST` file. 

In upload mode, this task compares the contents of the `pr` workspace, including the `.MANIFEST` file, with the content of the pull request and, if the content is different, updates the pull request to match the `pr` workspace.

.Example usage of the `pull-request` community task
[source,yaml,subs="attributes+"]
----
apiVersion: tekton.dev/v1
kind: Pipeline
metadata:
  name: pull-request
spec:
spec:
  tasks:
    - name: pull-request
      params:
        - name: mode
          value: upload
        - name: url
          value: https://github.com/example/pull/xxxxx
        - name: provider
          value: github
        - name: secret-key-ref
          value: example_secret
        - name: insecure-skip-tls-verify
          value: 'false'
      taskRef:
        kind: Task
        name: pull-request
      workspaces:
        - name: pr
          workspace: shared-workspace
  #...
----

.Supported parameters for the `pull-request` community task
[cols="1,2,1",options="header"]
|===
| Parameter | Description | Default value
|`mode` |If set to `download`, the state of the pull request at `url` is fetched. If set to `upload` then the pull request at `url` is updated. |
|`url` |URL of the pull request. |
|`provider` |Type of the SCM system. The supported values are `github` or `gitlab`. |
|`secret-key-ref` |Name of a `Secret` object of `Opaque` type that contains a key called `token` with a base64 encoded SCM token.|
|`insecure-skip-tls-verify` |If set to `true`, the certificate validation is disabled. |`false`
|===

.Supported workspaces for the `pull-request` community task
[cols="1,3",options="header"]
|===
| Workspace | Description
| `pr` | The workspace that contains the state of the pull request.
|===

[discrete]
[id="op-ctaskref-trigger-jenkins-job_{context}"]
== trigger-jenkins-job

You can use the `trigger-jenkins-job` community task to trigger a Jenkins job by using a `curl` request.

.Example usage of the `trigger-jenkins-job` community task
[source,yaml,subs="attributes+"]
----
apiVersion: tekton.dev/v1
kind: Pipeline
metadata:
  name: trigger-jenkins-job
spec:
  tasks:
    - name: trigger-jenkins-job
      params:
        - name: JENKINS_HOST_URL
          value: example_host_URL
        - name: JOB_NAME
          value: example_job_name
        - name: JENKINS_SECRETS
          value: jenkins-credentials
        - name: JOB_PARAMS
          value:
            - example_param
      taskRef:
        kind: Task
        name: trigger-jenkins-job
      workspaces:
        - name: source
          workspace: shared-workspace
  # ...
----

.Supported parameters for the `trigger-jenkins-job` community task
[cols="1,2,1",options="header"]
|===
| Parameter | Description | Default value
|`JENKINS_HOST_URL` |Server URL on which Jenkins is running. |
|`JOB_NAME` |Jenkins Job which needs to be triggered. |
|`JENKINS_SECRETS` |Jenkins secret containing credentials. |`jenkins-credentials`
|`JOB_PARAMS` |Extra arguments to append as a part of the `curl` request. |`""`
|===


.Supported workspaces for the `trigger-jenkins-job` community task
[cols="1,3",options="header"]
|===
| Workspace | Description
|`source` | The workspace which can be used to mount files which can be sent through the `curl` request to the Jenkins job.
|===

