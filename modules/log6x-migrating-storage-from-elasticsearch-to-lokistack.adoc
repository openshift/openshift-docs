:_newdoc-version: 2.18.4
:_template-generated: 2025-05-12
:_mod-docs-content-type: PROCEDURE

[id="migrating-storage-from-elasticsearch-to-lokistack_{context}"]
= Migrating storage from Elasticsearch to LokiStack

The only managed log storage solution available in this release is a Lokistack, managed by the {loki-op}. This solution, previously available as the preferred alternative to the managed Elasticsearch offering, remains unchanged in its deployment process.

////
.Prerequisites
* A bulleted list of conditions that must be satisfied before the user starts the steps in this module.
* Prerequisites can be full sentences or sentence fragments; however, prerequisite list items must be parallel.
* Do not use imperative statements in the Prerequisites section.
////


.Procedure

. Temporarily set the state of the `ClusterLogging` as `Unmanaged`
+
[source,terminal]
----
$ oc -n openshift-logging patch clusterlogging/instance -p '{"spec":{"managementState": "Unmanaged"}}' --type=merge
----

.  Remove `ClusterLogging` `ownerReferences` from the `Elasticsearch` resource.
+
The following command ensures that the `ClusterLogging` resource no longer owns the `Elasticsearch` resource. Updates to the `ClusterLogging` resource's `logStore` field will no longer affect the `Elasticsearch` resource.
+
[source,terminal]
----
$ oc -n openshift-logging patch elasticsearch/elasticsearch -p '{"metadata":{"ownerReferences": []}}' --type=merge
----

. Remove `ClusterLogging` `ownerReferences` from the `Kibana` resource
+
The following command ensures that *ClusterLogging* no longer owns the *Kibana* resource. Updates to the *ClusterLogging* resource's `visualization` field will no longer affect the *Kibana* resource.
+
[source,terminal]
----
$ oc -n openshift-logging patch kibana/kibana -p '{"metadata":{"ownerReferences": []}}' --type=merge
----

. Set *ClusterLogging* to state `Managed`
+
[source,terminal]
----
$ oc -n openshift-logging patch clusterlogging/instance -p '{"spec":{"managementState": "Managed"}}' --type=merge
----
////
.Verification
Delete this section if it does not apply to your module. Provide the user with verification methods for the procedure, such as expected output or commands that confirm success or failure.

* Provide an example of expected command output or a pop-up window that the user receives when the procedure is successful.
* List actions for the user to complete, such as entering a command, to determine the success or failure of the procedure.
* Make each step an instruction.
* Use an unnumbered bullet (*) if the verification includes only one step.

.Troubleshooting
Delete this section if it does not apply to your module. Provide the user with troubleshooting steps.

* Make each step an instruction.
* Use an unnumbered bullet (*) if the troubleshooting includes only one step.

.Next steps
* Delete this section if it does not apply to your module.
* Provide a bulleted list of links that contain instructions that might be useful to the user after they complete this procedure.
* Use an unnumbered bullet (*) if the list includes only one step.

NOTE: Do not use *Next steps* to provide a second list of instructions.

[role="_additional-resources"]
.Additional resources
* link:https://github.com/redhat-documentation/modular-docs#modular-documentation-reference-guide[Modular Documentation Reference Guide]
* xref:some-module_{context}[]
////

