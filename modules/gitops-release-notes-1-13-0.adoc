// Module included in the following assembly:
//
// * release_notes/gitops-release-notes.adoc

:_mod-docs-content-type: REFERENCE

[id="gitops-release-notes-1-13-0_{context}"]
= Release notes for {gitops-title} 1.13.0

[role="_abstract"]
{gitops-title} 1.13.0 is now available on {OCP} 4.12, 4.13, 4.14, 4.15, and 4.16.

[id="new-features-1-13-0_{context}"]
== New features

* With this update, you can configure Argo CD to disable the automatic scraping of metrics for your instance. Before this update, there was no option to disable this feature, resulting in excessive storage usage when multiple Argo CD instances were available on the cluster. link:https://issues.redhat.com/browse/GITOPS-4519[GITOPS-4519]
+
[NOTE]
====
In {gitops-shortname}, the scraping of metrics is enabled by default for all Argo CD instances.
====
+
To disable metrics for your Argo CD instance, edit the `spec.monitoring.disableMetrics` field in the Argo CD CR to `true`.
+
.Example 
[source,YAML]
----
apiVersion: argoproj.io/v1beta1
kind: ArgoCD
metadata:
 name: argocd-sample
 namespace: default
spec:
 monitoring:
   disableMetrics: true
----
+
Use the following command to scrape metrics in the Argo CD CLI:
+
[source,terminal]
----
$ oc patch argocd argocd-sample -n default --type='json' -p='[{"op": "replace", "path": "/spec/monitoring/disableMetrics", "value": true}]'
----

* With this update, the Argo Rollouts functionality in {gitops-title} is promoted from Technology Preview (TP) to General Availability (GA). link:https://issues.redhat.com/browse/GITOPS-3848[GITOPS-3848]
+
Use this feature to perform the following actions:
+
** Run cluster-scoped Argo Rollouts instead of namespace-scoped Argo Rollouts
** Route traffic by using OpenShift Routes for canary application deployment 
** Configure the Argo Rollouts CLI

* With this update, you can perform canary-based Argo Rollouts deployments by using OpenShift Routes-based traffic management. Argo Rollouts supports traffic splitting by modifying the percentage of traffic that reaches the canary or stable application version during a deployment. link:https://issues.redhat.com/browse/GITOPS-2400[GITOPS-2400]

* With this update, the Argo CD applications in non-control plane namespaces feature is promoted from Technology Preview (TP) to General Availability (GA). link:https://issues.redhat.com/browse/GITOPS-3796[GITOPS-3796]
+
* With this update, the following new commands are introduced for the Argo CD applications in non-control plane namespaces feature:
** `argocd proj add-source-namespace`: Use this command to add source namespaces to the `.spec.sourceNamespaces` field of the `AppProject` CR to allow specific namespaces for application creation.
** `argocd proj delete-source-namespace`: Use this command to remove source namespaces from the `.spec.sourceNamespaces` field of the `AppProject` CR to exclude specific namespaces. link:https://issues.redhat.com/browse/GITOPS-4045[GITOPS-4045]

* With this update, you can customize permissions for a cluster-scoped Argo CD instance by creating user-defined `ClusterRoles` and `ClusterRoleBindings` for the Argo CD Application Controller and server components. link:https://issues.redhat.com/browse/GITOPS-2614[GITOPS-2614]

* With this update, you can customize the Keycloak route name in the {gitops-title} Operator. This update also enables support for complex routing scenarios, such as dividing routes among various ingress controller shards. link:https://issues.redhat.com/browse/GITOPS-4451[GITOPS-4451]

* With this update, the route TLS termination is set as default to the reencrypt mode for both the default and user-defined Argo CD instances. TLS connections to the Argo CD instances now receive the default ingress certificate that is set in OpenShift Container Platform, instead of the self-signed Argo CD certificate generated by the {gitops-title} Operator. You can modify the route TLS termination policy by configuring the `.spec.server.route.tls` field of the Argo CD CR. link:https://issues.redhat.com/browse/GITOPS-3918[GITOPS-3918]

* With this update, Argo CD upstream is enhanced to ensure that resource deletion is managed properly when using sync-waves. Now, Argo CD waits for resources to be entirely deleted before advancing to the next sync-wave in the deletion process. This approach ensures a controlled and predictable workflow, enhancing the user experience and preventing potential issues that might arise from not waiting for resources to be fully recycled before proceeding to the next sync-wave. link:https://issues.redhat.com/browse/GITOPS-2642[GITOPS-2642]

* With this update, Argo CD CLI has been enhanced by enabling the `--app-namespace` flag for various application-related commands. link:https://issues.redhat.com/browse/GITOPS-3834[GITOPS-3834]
+
This flag allows users to specify the namespace for operations such as waiting, rolling back, patching, editing, diffing, viewing history, syncing, and deleting applications. As a result, the following commands are updated in {gitops-title}:
+
** `argocd app wait`
** `argocd app rollback`
** `argocd app patch`
** `argocd app edit`
** `argocd app diff`
** `argocd app history`
** `argocd app sync`
** `argocd app delete`
** `argocd app get`

[id="fixed-issues-1-13-0_{context}"]
== Fixed issues

* Before this update, if the `DeploymentConfig [apps.openshift.io/v1]` API was disabled in the {OCP} cluster, the {gitops-shortname} Operator would enter the `CrashLoopBackoff` error state and would not function properly. This update fixes the issue by modifying the functionality of the {gitops-shortname} Operator to ensure that it does not enter the `CrashLoopBackoff` error state when the API is unavailable in the cluster. link:https://issues.redhat.com/browse/GITOPS-4489[GITOPS-4489]

* Before this update, users were unable to connect to remote Git repositories through a SOCKS5 proxy server because it was only compatible with HTTPS URLs. With this update, users can access remote Git repositories by using a SOCKS5 proxy server that supports the SSH protocol. link:https://issues.redhat.com/browse/GITOPS-3710[GITOPS-3710]

* Before this update, the `forceHttpBasicAuth` repository configuration was not initialized properly during repository updates from Argo CD UI. As a result, the value was reset to default, leading to connection errors, particularly for Azure DevOps repositories. This update fixes the issue by adding a change in the upstream to ensure that the `forceHttpBasicAuth` configuration is correctly initialized during repository update operations. link:https://issues.redhat.com/browse/GITOPS-3706[GITOPS-3706]

* Before this update, the Argo CD CLI would designate the initial source as the main source for multi-source applications. With this update, the Argo CD CLI supports multi-source applications by considering all sources during processing. link:https://issues.redhat.com/browse/GITOPS-2623[GITOPS-2623]

* Before this update, the Argo Rollouts controller CR did not create `ServiceMonitor`. With this update, the Argo Rollouts controller CR is improved to include support for `ServiceMonitor` creation. As a result, you can gather metrics from Rollouts using the enhanced Argo Rollouts controller CR, and these metrics are visible in monitoring. link:https://issues.redhat.com/browse/GITOPS-3271[GITOPS-3271]

[id="known-issues-1-13-0_{context}"]
== Known Issues

* There is currently a known issue that prevents the {gitops-title} Operator from updating the default TLS termination policy of the Argo CD server route from `Passthrough` to `Reencrypt`. This is a race condition that occurs when upgrading from an older version. link:https://issues.redhat.com/browse/GITOPS-4947[GITOPS-4947]
+
Workaround: Delete the Argo CD server route and the Argo CD server pod. The recreated route and pod now uses the `Reencrypt` policy.

[id="deprecated-features-1-13-0_{context}"]
== Deprecated and removed features

* In {gitops-title} 1.13, the {gitops-title} Application Manager CLI, `kam`, is deprecated and is planned to be removed in the future release. Red{nbsp}Hat will provide bug fixes and support for this feature during the current release lifecycle, but this feature will no longer receive enhancements and will be removed. As an alternative to the {gitops-title} Application Manager CLI, `kam`, you can use the Argo CD CLI that is available from {gitops-title} Operator v1.12. link:https://issues.redhat.com/browse/GITOPS-4466[GITOPS-4466]

[id="breaking-change-1-13-0_{context}"]
== Breaking change

[id="argo-rollouts-instances-are-installed-as-namespace-scoped_{context}"]
=== Argo Rollouts instances are installed as namespace-scoped

* When you upgrade to {gitops-title} v1.13, Argo Rollouts instances in {gitops-title} are installed as namespace-scoped. Previously, when you created a `RolloutManager` CR within a namespace, that Argo Rollouts instance would only have permissions to deploy within that specific namespace. Now, because Argo Rollouts instances in {gitops-title} are installed as cluster-scoped, a RolloutManager CR created within a namespace can be deployed across the entire cluster. link:https://issues.redhat.com/browse/GITOPS-3847[GITOPS-3847]

[role="_additional-resources"]
.Additional resources
* xref:../argo_rollouts/using-argo-rollouts-for-progressive-deployment-delivery.adoc[Argo Rollouts]