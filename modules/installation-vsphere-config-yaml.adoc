// Module included in the following assemblies:
//
// * installing/installing_vmc/installing-restricted-networks-vmc-user-infra.adoc
// * installing/installing_vmc/installing-vmc-network-customizations-user-infra.adoc
// * installing/installing_vmc/installing-vmc-user-infra.adoc
// * installing/installing_vsphere/installing-restricted-networks-vsphere.adoc
// * installing/installing_vsphere/installing-vsphere-network-customizations.adoc
// * installing/installing_vsphere/installing-vsphere.adoc

ifeval::["{context}" == "installing-restricted-networks-vsphere"]
:restricted:
endif::[]
ifdef::openshift-origin[]
:restricted:
endif::[]
ifeval::["{context}" == "installing-restricted-networks-vmc-user-infra"]
:restricted:
endif::[]

[id="installation-vsphere-config-yaml_{context}"]
= Sample `install-config.yaml` file for VMware vSphere

You can customize the `install-config.yaml` file to specify more details about
your {product-title} cluster's platform or modify the values of the required
parameters.

[NOTE]
====
If you want to deploy an {product-title} cluster to multiple vSphere datacenters that run in a single VMware vCenter, you must modify the `install-config.yaml` file for this environment. For more information about creating this environment, see the section named _VMware vSphere region and zone enablement_. 
====

[source,yaml]
----
additionalTrustBundlePolicy: Proxyonly
apiVersion: v1
baseDomain: example.com <1>
compute: <2>
- architecture: amd64
  hyperthreading: Enabled <3>
  name: <worker_node>
  platform: {}
  replicas: 0 <4>
controlPlane: <2>
  architecture: amd64
  hyperthreading: Enabled <3>
  name: <parent_node>
  platform: {}
  replicas: 3 <5>
metadata:
  creationTimestamp: null
  name: test <6>
networking:
...
...
platform:
  vsphere:
    apiVIPs:
    - 10.0.0.1
    failureDomains:
    - name: <failure_domain_name>
      region: <default_region_name>
      server: vcenters[0].server
      topology:
        computeCluster: "/<datacenter>/host/<cluster>"
        datacenter: <datacenter> <7>
        datastore: "/<datacenter>/datastore/<datastore>"
        networks:
        - <VM_Network_name>
        resourcePool: "/<datacenter>/host/<cluster>/Resources/<resourcePool>" <8>
        folder: "/<datacenter_name>/vm/<folder_name>/<subfolder_name>" <9>
      zone: <default_zone_name>
    ingressVIPs:
    - 10.0.0.2
    vcenters: <10>
    - datacenters:
      - <datacenter>
      password: <password> <11>
      port: 443
      server: vcenters[0].server
      user: administrator@vsphere.local
      diskType: thin <12>
ifndef::restricted[]
ifndef::openshift-origin[]
fips: false <13>
endif::openshift-origin[]
ifndef::openshift-origin[]
pullSecret: '{"auths": ...}' <14>
endif::openshift-origin[]
ifdef::openshift-origin[]
pullSecret: '{"auths": ...}' <13>
endif::openshift-origin[]
endif::restricted[]
ifdef::restricted[]
ifndef::openshift-origin[]
fips: false <13>
pullSecret: '{"auths":{"<local_registry>": {"auth": "<credentials>","email": "you@example.com"}}}' <14>
endif::openshift-origin[]
ifdef::openshift-origin[]
pullSecret: '{"auths":{"<local_registry>": {"auth": "<credentials>","email": "you@example.com"}}}' <13>
endif::openshift-origin[]
endif::restricted[]
ifndef::openshift-origin[]
sshKey: 'ssh-ed25519 AAAA...' <15>
endif::openshift-origin[]
ifdef::openshift-origin[]
sshKey: 'ssh-ed25519 AAAA...' <14>
endif::openshift-origin[]
ifdef::restricted[]
ifndef::openshift-origin[]
additionalTrustBundle: | <16>
  -----BEGIN CERTIFICATE-----
  ZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZ
  -----END CERTIFICATE-----
imageContentSources: <17>
- mirrors:
  - <local_registry>/<local_repository_name>/release
  source: quay.io/openshift-release-dev/ocp-release
- mirrors:
  - <local_registry>/<local_repository_name>/release
  source: quay.io/openshift-release-dev/ocp-v4.0-art-dev
endif::openshift-origin[]
ifdef::openshift-origin[]
additionalTrustBundle: | <15>
  -----BEGIN CERTIFICATE-----
  ZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZ
  -----END CERTIFICATE-----
imageContentSources: <16>
- mirrors:
  - <local_registry>/<local_repository_name>/release
  source: quay.io/openshift-release-dev/ocp-release
- mirrors:
  - <local_registry>/<local_repository_name>/release
  source: quay.io/openshift-release-dev/ocp-v4.0-art-dev
endif::openshift-origin[]
endif::restricted[]
----
<1> `baseDomain`: The base domain of the cluster. All DNS records must be sub-domains of this
base and include the cluster name.
<2> `compute`: The `controlPlane` section is a single mapping, but the compute section is a
sequence of mappings. To meet the requirements of the different data structures,
the first line of the `compute` section must begin with a hyphen, `-`, and the
first line of the `controlPlane` section must not. Although both sections
currently define a single machine pool, it is possible that future versions
of {product-title} will support defining multiple compute pools during
installation. Only one control plane pool is used.
<3> `hyperthreading`: Whether to enable or disable simultaneous multithreading, or
`hyperthreading`. By default, simultaneous multithreading is enabled
to increase the performance of your machines' cores. You can disable it by
setting the parameter value to `Disabled`. If you disable simultaneous
multithreading in some cluster machines, you must disable it in all cluster
machines.
+
[IMPORTANT]
====
If you disable simultaneous multithreading, ensure that your capacity planning
accounts for the dramatically decreased machine performance.
Your machines must use at least 8 CPUs and 32 GB of RAM if you disable
simultaneous multithreading.
====
<4> `replicas`: You must set the value of the `replicas` parameter to `0`. This parameter
controls the number of workers that the cluster creates and manages for you,
which are functions that the cluster does not perform when you
use user-provisioned infrastructure. You must manually deploy worker
machines for the cluster to use before you finish installing {product-title}.
<5> `replicas`: The number of control plane machines that you add to the cluster. Because
the cluster uses this values as the number of etcd endpoints in the cluster, the
value must match the number of control plane machines that you deploy.
<6> `name`: The cluster name that you specified in your DNS records.
<7> `datacenter`: The vSphere datacenter.
<8> `resourcePool`: Optional parameter. For installer-provisioned infrastructure, the absolute path of an existing resource pool where the installation program creates the virtual machines, for example, `/<datacenter_name>/host/<cluster_name>/Resources/<resource_pool_name>/<optional_nested_resource_pool_name>`. If you do not specify a value, resources are installed in the root of the cluster `/example_datacenter/host/example_cluster/Resources`.
<9> `folder`: Optional parameter For installer-provisioned infrastructure, the absolute path of an existing folder where the installation program creates the virtual machines, for example, `/<datacenter_name>/vm/<folder_name>/<subfolder_name>`. If you do not provide this value, the installation program creates a top-level folder in the datacenter virtual machine folder that is named with the infrastructure ID. If you are providing the infrastructure for the cluster, omit this parameter.
<10> `vcenters`: The fully-qualified hostname or IP address of the vCenter server.
<11> `password`: The password associated with the vSphere user.
<12> `diskType`: The vSphere disk provisioning method.
ifndef::openshift-origin[]
<13> `fips`: Whether to enable or disable FIPS mode. By default, FIPS mode is not enabled. If FIPS mode is enabled, the {op-system-first} machines that {product-title} runs on bypass the default Kubernetes cryptography suite and use the cryptography modules that are provided with {op-system} instead.
+
[IMPORTANT]
====
The use of FIPS Validated / Modules in Process cryptographic libraries is only supported on {product-title} deployments on the `x86_64` architecture.
====
endif::openshift-origin[]
ifndef::restricted[]
ifndef::openshift-origin[]
<14> `pullSecret`: The pull secret that you obtained from {cluster-manager-url}. This pull secret allows you to authenticate with the services that are provided by the included authorities, including Quay.io, which serves the container images for {product-title} components.
<15> The public portion of the default SSH key for the `core` user in
{op-system-first}.
endif::openshift-origin[]
ifdef::openshift-origin[]
<14> `pullSecret`: You obtained the {cluster-manager-url-pull}. This pull secret allows you to authenticate with the services that are provided by the included authorities, including Quay.io, which serves the container images for {product-title} components.
<15> `sshKey`: The public portion of the default SSH key for the `core` user in
{op-system-first}.
+
[NOTE]
====
For production {product-title} clusters on which you want to perform installation debugging or disaster recovery, specify an SSH key that your `ssh-agent` process uses.
====
endif::openshift-origin[]
endif::restricted[]
ifdef::restricted[]
ifndef::openshift-origin[]
<14> `<local_registry>`: For `<local_registry>`, specify the registry domain name, and optionally the
port, that your mirror registry uses to serve content. For example
`registry.example.com` or `registry.example.com:5000`. For `<credentials>`,
specify the base64-encoded user name and password for your mirror registry.
<15> `sshKey`: The public portion of the default SSH key for the `core` user in
{op-system-first}.
+
[NOTE]
====
For production {product-title} clusters on which you want to perform installation debugging or disaster recovery, specify an SSH key that your `ssh-agent` process uses.
====
endif::openshift-origin[]
ifdef::openshift-origin[]
<13> `<local_registry>`: For `<local_registry>`, specify the registry domain name, and optionally the
port, that your mirror registry uses to serve content. For example
`registry.example.com` or `registry.example.com:5000`. For `<credentials>`,
specify the base64-encoded user name and password for your mirror registry.
<14> `sshKey` The public portion of the default SSH key for the `core` user in
{op-system-first}.
+
[NOTE]
====
For production {product-title} clusters on which you want to perform installation debugging or disaster recovery, specify an SSH key that your `ssh-agent` process uses.
====
endif::openshift-origin[]
endif::restricted[]
ifdef::restricted[]
ifndef::openshift-origin[]
<16> `additionalTrustBundle`: Provide the contents of the certificate file that you used for your mirror
registry.
<17> `imageContentSource`: Provide the `imageContentSources` section from the output of the command to
mirror the repository.
endif::openshift-origin[]
ifdef::openshift-origin[]
<15> `additionalTrustBundle:` Provide the contents of the certificate file that you used for your mirror
registry.
<16> `imageContentSources`: Provide the `imageContentSources` section from the output of the command to
mirror the repository.
endif::openshift-origin[]
endif::restricted[]

ifeval::["{context}" == "installing-restricted-networks-vsphere"]
:!restricted:
endif::[]
ifdef::openshift-origin[]
:!restricted:
endif::[]
ifeval::["{context}" == "installing-restricted-networks-vmc-user-infra"]
:!restricted:
endif::[]