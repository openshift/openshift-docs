// This module is included in the following assembly:
//
// * records/understanding-the-tekton-results-retention-policy.adoc

:_mod-docs-content-type: CONCEPT
[id="op-fine-grained-retention-policies_{context}"]
= Fine-grained retention policies

[role="_abstract"]
You can use the `policies` field to define rules that apply to specific Results. The policies are evaluated in order, and the first policy that matches is applied. If no policies match, the `defaultRetention` value is used.

Each policy includes the following fields:

[options="header"]
|===
|Field |Description

|`name`
|A descriptive name for the policy.

|`selector`
|Defines criteria for matching Results. All selector types use AND logic, meaning a Result must satisfy all specified conditions to match. You can omit a selector type to match all Results for that criterion.

|`matchNamespaces`
|A list of namespaces. The policy matches Results in any of the listed namespaces.

|`matchLabels`
|A map of label keys and possible values. A Result must have all listed label keys, and each value must match one of the values in the list.

|`matchAnnotations`
|A map of annotation keys and possible values. Works similarly to `matchLabels`.

|`matchStatuses`
|A list of final statuses such as `Succeeded`, `Failed`, `Cancelled`, `Running`, or `Pending`. The policy matches if the Result's final status reason is in this list.

|`retention`
|The retention period for matching Results. The value can be a number (days) or a duration string such as `24h` or `7d`.
|===

The following example shows a config map that defines multiple retention policies:

[source,yaml]
----
apiVersion: v1
kind: ConfigMap
metadata:
  name: tekton-results-config-results-retention-policy
  namespace: openshift-pipelines
data:
  runAt: "0 2 * * *"
  defaultRetention: "30d"
  policies: |
    - name: "retain-critical-failures-long-term"
      selector:
        matchNamespaces:
          - "production"
          - "prod-east"
        matchLabels:
          "criticality": ["high"]
        matchStatuses:
          - "Failed"
      retention: "180d"
    - name: "retain-annotated-for-debug"
      selector:
        matchAnnotations:
          "debug/retain": ["true"]
      retention: "14d"
    - name: "default-production-policy"
      selector:
        matchNamespaces:
          - "production"
          - "prod-east"
      retention: "60d"
    - name: "short-term-ci-retention"
      selector:
        matchNamespaces:
          - "ci"
      retention: "7d"
----

The following examples describe how the defined retention policies are applied to different Results based on their namespaces, labels, annotations, and statuses.

* A failed Result in the `production` or `prod-east` namespace with the label `criticality: high` is retained for 180 days.  
* Any Result with the annotation `debug/retain: "true"` is retained for 14 days.  
* Results in the `production` or `prod-east` namespaces are retained for 60 days.  
* Results in the `ci` namespace are retained for 7 days.  
* All other Results that do not match any policy are retained for the default 30 days.
