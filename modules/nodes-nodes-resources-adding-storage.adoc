// Module included in the following assemblies:
//
// * nodes/nodes-nodes-resources-configuring.adoc

[id="nodes-nodes-resources-adding-storage_{context}"]
= Adding container engine storage to installed nodes

You can configure the Machine Config Operator to use machine configs that mount a separate or secondary disk for container storage in {product-title}.

If all control plane or worker nodes are identical, such as in the case of many cloud instances or racks of matching bare metal servers, a configuration change can be applied to either the default worker or control plane machine config pools, or both. If some hardware is different, such as having a different number of storage drives or device names, or for example, if you do not want this change applied to all workers, you must create a separate machine config pool.

.Prerequisites

* You have access to the cluster as a user with the `cluster-admin` role.
* You can acess the `/var/lib/containers` subdirectory.

.Procedure

. To mount `/dev/sdb` to the container storage root directory `/var/lib/containers`, create a machine config file. The following example creates a file named `98-var-lib-containers` that defines the machine config:
+
[source,yaml]
----
  apiVersion: machineconfiguration.openshift.io/v1
  kind: MachineConfig
  metadata:
    labels:
      machineconfiguration.openshift.io/role: worker <1>
    name: 98-var-lib-containers
  spec:
    config:
      ignition:
        version: 3.2.0
      storage:
        files:
          - contents:
              source: data:,%2Fdev%2Fsdb%09%2Fvar%2Flib%2Fcontainers%09xfs%09defaults%2Cprjquota%2Cx-systemd.makefs%090%200%0A <2>
            path: /etc/fstab
----
+
<1> The `machineconfiguration.openshift.io/role` label must match your machine config pool, such as `master`, `worker`, or a custom pool.
<2> The `sdb` value must match your node's secondary storage device, such as `/dev/sdb`. Be sure to change the `sdb` reference everywhere it occurs in the file. This creates an `/etc/fstab` file on each node in the relevant machine config pool with the following contents:
+
[source,terminal]
----
/dev/sdb    /var/lib/containers    xfs    defaults,prjquota,x-systemd.makefs    0 0
----

. Create the new machine config:
+
[source,terminal]
----
$ oc create -f 98-var-lib-containers.yaml
----
+
.Example output
+
----
machineconfig.machineconfiguration.openshift.io/98-var-lib-containers created
----

After the new machine config is rendered, the applicable nodes are updated and rebooted. On reboot, a new XFS file sytem is created on the specified disk and the disk is mounted to the `/var/lib/containers` root subdirectory.

[IMPORTANT]
====
While this process can be used to mount additional disks to a {op-system-first} node, support is limited to no more than one additional file system partition.

Using `/` and `/var/lib/containers` as separate file systems is supported.
====
