// Module included in the following assemblies:
//
// * monitoring/config-map-reference-for-the-cluster-monitoring-operator.adoc

:_content-type: REFERENCE
[id="prometheus-reference_{context}"]
= prometheus reference

These settings configure the Prometheus component for user-defined projects.

.Configuration options

[source,yaml]
----
prometheus:
  # Contains the configuration for how the Prometheus component communicates 
  # with additional Alertmanager instances, including such settings as 
  # configuring the URL scheme, connection timeout, and authentication method.
  # default: nil
  additionalAlertmanagerConfigs: AdditionalAlertmanagerConfig
  # Defines a global limit on the number of scraped samples that will be 
  # accepted. This setting overrides any SampleLimit set per ServiceMonitor 
  # and/or PodMonitor. Admins can use this setting to enforce the SampleLimit 
  # and thus keep the overall number of samples/series under the
  # desired limit. 
  # Note that if SampleLimit is lower that value will be taken instead.
  # default: 0
  enforcedSampleLimit: <integer>
  # Defines a global limit on the number of scraped targets. This setting 
  # overrides any TargetLimit set per ServiceMonitor and/or PodMonitor.
  # Admins can use it to enforce the TargetLimit to keep the overall number of 
  # targets under the desired limit. 
  # Note that if TargetLimit is lower, that value will be taken instead, 
  # except if either value is zero, in which case the non-zero value will be 
  # used. If both values are zero, no limit is enforced.
  # default: 0
  enforcedTargetLimit: <integer>
  # The labels to add to any time series or alerts when communicating with 
  # external systems (federation, remote storage, Alertmanager).
  externalLabels: <map[string]string>
  # Defines the log level for Prometheus.
  # Possible values are: error, warn, info, debug.
  # default: info
  logLevel: <string>
  # Defines the nodes on which the pods are scheduled.
  nodeSelector: v1.NodeSelector
  # QueryLogFile specifies the file to which PromQL queries are logged. 
  # This setting supports either or a file name or a full path.
  # If a file name is specified, queries are saved to an emptyDir volume at 
  # /var/log/prometheus. If a full path is specified, an emptyDir volume is 
  # mounted at that location. Relative paths not supported.
  # default: ""
  queryLogFile: <string>
  # Contains the remote write configuration, including the URL, authorization, and relabeling settings.
  remoteWrite: RemoteWriteSpec
  # Defines resource requests and limits for single pods.
  resources: v1.ResourceRequirements
  # Defines how long Prometheus retains data. 
  # The default is '24h'. The setting must match the regular expression 
  # [0-9]+(ms|s|m|h|d|w|y) (milliseconds seconds minutes
  # hours days weeks years).
  retention: <string>
  # Defines tolerations for the pods.
  tolerations: v1.Toleration
  # Allows a user to configure persistent storage for the Prometheus pods.
  # If enabled, a user can configure storageClass and size of volume.
  volumeClaimTemplate: v1.PersistentVolumeClaim
----

.Example

[source,yaml]
----
apiVersion: v1
kind: ConfigMap
metadata:
  name: user-workload-monitoring-config
  namespace: openshift-user-workload-monitoring
data:
  config.yaml: |
    prometheus:
      additionalAlertmanagerConfigs:
      - apiVersion: v2
        scheme: https
        bearerToken:
          name: alertmanager1-bearer-token
          key: token
        staticConfigs:
        - alertmanager1-remote.com
      enforcedLabelLimit: 500
      enforcedLabelNameLengthLimit: 50
      enforcedLabelValueLengthLimit: 600
      enforcedSampleLimit: 100
      enforcedTargetLimit: 10
      externalLabels:
        datacenter: eu-west
      logLevel: debug
      nodeSelector:
        kubernetes.io/os: linux
      queryLogFile: /tmp/test.log
      retention: 10h
      resources:
        requests:
          cpu: 100m
          memory: 100Mi
      remoteWrite:
      - url: "https://test.remotewrite.com/api/write"
      retention: 24h
      retentionSize: 15GB
      tolerations:
        - operator: "Exists"
      volumeClaimTemplate:
        spec:
          resources:
            requests:
              storage: 15Gb
----
