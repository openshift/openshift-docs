// Module included in the following assemblies:
//
// * security/zero_trust_workload_identity_manager/zero-trust-manager-upstream-authority plugins.adoc

:_mod-docs-content-type: PROCEDURE
[id="zero-trust-manager-cert-manager-crd_{context}"]
= Configuring cert-manager plugin using the SPIRE server CRD

To configure the cert-manager plugin using the SPIRE server Custom Resource Defnition (CRD), perform the following steps:

.Procedure

. Create a YAML file containing the configuration for the `SpireServer` resource, for example `spireserver.yaml`. The file includes the `spec` block and the `upstreamAuthority` block configured to use the `cert-manager` plugin.
+
.Example `spireserver.yaml`
+
[source,yaml]
----
apiVersion: operator.openshift.io/v1alpha1
kind: SpireServer
metadata:
  name: cluster
spec:
  trustDomain: "example.org"
  upstreamAuthority:
    type: "cert-manager"
    upstreamAuthorityCertManager:
      issuerName: "ca-issuer" <1>
      issuerKind: "ClusterIssuer" <2>
      issuerGroup: "cert-manager.io" <3>
      namespace: "zero-trust-workload-identity-manager" <4>
      kubeConfigSecretName: "external-cluster-kubeconfig" <5>
----
<1> The name of the `cert-manager` Issuer or ClusterIssuer that signs the `certificateRequest`.
<2> Set to `ClusterIssuer` if issuer is cluster-scoped. The default is `Issuer`.
<3> The API group of the issuer. The default is `cert-manager.io`.
<4> The namespace where the `CertificateRequest` is created. The default is `zero-trust-workload-identity-manager`.
<5> The name of a Secret containing the `kubeconfig` to connect to the clsuter where `cert-manager` is running. If empy, an in-cluster configuration is used.

. Apply the configuration by running the following command:
+
[source, terminal]
----
$ oc apply -f spireserver.yaml
----

.Verification

. Run the following command to list the `CertificateRequest` resources in the namespace where the SPIRE server creates them.
+
[source, terminal]
----
$ oc get certificaterequests -n <namespace>
----

. Run the following command ot inspect a specific `CertificateRequest`. Review the `Status` section to confirm the certificate has been signed and that  the certificate data is present.
+
[source, terminal]
----
$ oc describe certificaterequest <name-of-cert-request> -n <namespace>
----