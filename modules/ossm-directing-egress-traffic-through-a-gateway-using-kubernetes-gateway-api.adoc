// This procedure is used in the following assembly:
// * service-mesh-docs-main/gateways/ossm-directing-outbound-traffic-through-a-gateway

:_mod-docs-content-type: PROCEDURE
[id="ossm-directing-egress-traffic-through-a-gateway-using-kubernetes-gateway-api_{context}"]
= Directing egress traffic through a gateway by using the {k8s} Gateway API

Use the {k8s} Gateway API to direct outbound HTTP traffic through an egress gateway.

.Prerequisites

* You have installed a gateway using gateway injection.

.Procedure

. Optional: Enable the Kubernetes Gateway API CRDs by running the following command:
+
[source,terminal]
----
$ oc apply -f https://raw.githubusercontent.com/istio/istio/master/samples/bookinfo/gateway-api/bookinfo-gateway.yaml
----
+
[NOTE]
====
As of {k8s} 1.28 and {ocp-product-title} 4.18 or earlier, the Kubernetes Gateway API CRDs are not available by default and must be enabled to be used. the CRDs are enabled by default in  {ocp-product-title} 4.19 and later.
====

. Create a namespace called bookinfo by running the following command:
+
[source,terminal]
----
$ oc create namespace bookinfo
----

. Create and configure a gateway that uses a `Gateway` and `HTTPRoute` resources by running the following command:
+
[source,terminal]
----
$ oc apply -f https://raw.githubusercontent.com/istio/istio/master/samples/bookinfo/gateway-api/bookinfo-gateway.yaml
----

. Retrieve the host for the ingress gateway by running the following command:
+
[source,terminal]
----
$ export INGRESS_HOST=$(kubectl get gtw bookinfo-gateway -o jsonpath='{.status.addresses[0].value}')
----

. Retrieve the port that the ingress uses to expose traffic to the mesh by running the following command:
+
[source,terminal]
----
$ export INGRESS_PORT=$(kubectl get gtw bookinfo-gateway -o jsonpath='{.spec.listeners[?(@.name=="http")].port}') 
----

. Retrieve the URL for the ingress gateway by running the following command:
+
[source,terminal]
----
$ export GATEWAY_URL=$INGRESS_HOST:$INGRESS_PORT 
----

. Obtain the product page URL by running the following command:
+
[source,terminal]
----
$ echo "http://${GATEWAY_URL}/productpage"
----
+
Verify that you can access the page using a browser.

. Create a namespace called egress-gateway by running the following command:
+
[source,terminal]
----
$ oc create namespace egress-gateway
----

. Apply the istio-injection label to the namespace by running the following command:
+
[source,terminal]
----
$ oc label namespace egress-gateway istio-injection=enabled
----

. Apply the example egress gateway configuration by running the following command:
+
[source,terminal]
----
$ oc apply -f https://raw.githubusercontent.com/istio-ecosystem/sail-operator/main/chart/samples/egress-gateway-gw-api.yaml -n egress-gateway
----

. Create a `curl` pod in the `egress-gateway` namespace by running the following command:
+
[source,terminal]
----
$ oc run test-pod --image=curlimages/curl:latest -n egress-gateway --rm -it --restart=Never -- sh
----

. Using the `curl` client, verify that you can access `httpbin.org` through the egress gateway. Run the following command:
+
[source,terminal]
----
$ curl -v http://httpbin.org/get
----