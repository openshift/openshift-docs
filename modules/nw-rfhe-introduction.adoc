// Module included in the following assemblies:
//
// * networking/multiple_networks/configuring-ptp.adoc

[id="nw-rfhe-introduction_{context}"]
= How Redfish hardware events work

{product-title} now provides a hardware event proxy that enables applications running on bare-metal clusters to respond quickly to Redfish hardware events such as hardware changes and failures.

The hardware event proxy supports a publish-subscribe service through which hardware events detected by Redfish can be consumed by relevant applications. The proxy must be running on hardware that supports Redfish OpenAPI v1.8 and higher.

The applications can be developed using a REST API to consume and respond to events such as breaches of temperature thresholds, fan failure, disk loss, power outages, and memory failure. Reliable end-to-end messaging without persistent stores is based on the Advanced Message Queuing Protocol (AMQP). The latency of the messaging service is in the 10 millisecond range.

[NOTE]
====
This feature is supported for single node OpenShift clusters only.
====

[id="rfhe-elements_{context}"]
== Elements of a Redfish events domain

== Diagram

=== Redfish hardware
Hardware that is compatible with the Redfish standard and exposes hardware-related events through Redfish.

=== Redfish event
Redfish events are triggered by conditions such as excess temperatures, hardware outages such as server, router, or fan failure, and updates on network elements that have or could go wrong.
A typical use case for Redfish hardware events is tracking faults in Edge devices such as DUs, but they can be useful in tracking a wide variety of hardware networking environments.

=== REST APIs
REST APIs provide a publish-subscribe model for the exhange of information between producing and subscribing applications. A REST API establishes the content required by the subscribing application (the call) and the content produced by the hardware event proxy (the response).

=== Operator-managed pod
The Operator makes use of custom resources to manage the pod containing the hardware event proxy and its components.

=== Hardware event proxy
A container created to handle Redfish events. At startup, the hardware event proxy queries the Redfish API and downloads all the Message Registries, including custom registries. The hardware event proxy then begins to receive subscribed events from the Redfish hardware.

=== Cloud Native Event
Cloud Native Events (CNE) is a Rest-API specification for defining the format of event data. https://github.com/redhat-cne/spec/blob/main/event_spec.md

=== CNCF CloudEvents
CloudEvents is a vendor-neutral specification for defining the format of event data.
A specification developed by the Cloud Native Computing Foundation (CNCF) for describing event data in a common way. A common way of describing events means that developers don't have to write new event handling logic for each event source. https://github.com/cloudevents/spec/blob/v1.0.1/spec.md

=== Dispatch router (AMQP 1.0 qpid)

The dispatch router is responsible for the message delivery service between publisher and subscriber. AMQP 1.0 qpid is an open standard designed to support reliable, high-performance, fully-symmetrical messaging over the internet. AMQP connects systems, supports management processes with the information they need and reliably transmits onward the instructions that run a distributed network via a connection-oriented messaging API.

=== Application pod (Subscriber)
Hardware events listener? vDU? virtual Distributed unit for 5G network. Runs vDU and sidecar.

=== vDU
 

=== Sidecar: Cloud event proxy
cloud events framework (based on ORAN API specifications)  container image, this image is mainly a  utility container in a pod that's loosely coupled to the main application container, the purpose of this image is to provide an event publishing/subscribing framework to publish/subscribe events.

(single entry for both sidecars)


=== Application
An application such as a vDU that consumes the messages coming from the Cloud Event Proxy framework. The response to these messages is determined by the customer application.

[id="rfhe-data-flow_{context}"]
== Redfish hardware events data flow

Redfish Hardware Event Proxy contains a main `hw-event-proxy` module written in Go and a `message-parser' module written in Python.

The 'message-parser' module is used to parse messages from the Redfish Event Message Registry. At startup, it queries the Redfish API and downloads all the Message Registries (if not already included in the Sushy library) including custom registries.

Once subscribed, Redfish events can be received by the webhook located in the hw-event-proxy module. If the event received does not contain a Message field, hw-event-proxy will send a request with a MessageId to the message-parser.

The 'message-parser' uses the `MessageId` to search in the Message Registries for the Message and Resolution. The information is passed back to the `hw-event-proxy`. The `hw-event-proxy` adds these fields to the event content and converts the event to a Cloud Native Event and sends it out to the Cloud Event Proxy framework.

[id="rfhe-advantages-over-ntp_{context}"]
== Advantages of Redfish hardware events over SMTP traps

* With SNMP traps, alerts are configured to generate SNMP traps.All alerts that can currently generate SNMP traps can also be configured to
generate Redfish events. However, Redfish events are supported for a larger range of system events.

* SNMP <> clients need the latest MIB to be imported to decipher the traps. Redfish events are in human-readable format.
* SNMP is mainly used by older SNMP based clients. Modern REST or Redfish clients such as OpenStack Ironic can readily process Redfish
events.

* SNMP implementations typically supports only GET and TRAP operations. SET operations are not supported. The Redfish stack supports GET, PATCH, POST, DELETE, and PUT operations.

* SNMPv2 or SNMPv3 are required to encrypt packets and send traps securely. Redfish events use HTTPs to send events securely.

* SNMP supports only SNMP traps of the push type. Redfish supports push type and ServerSentEvents, using single HTTPS GET
Connection operations to subscribe and receive the alert events. This connection exists until either the client or server closes it.
