// Module included in the following assemblies:
//
// * logging/cluster-logging-external.adoc

[id="cluster-logging-collector-log-forward-syslog_{context}"]
= Forwarding logs using the syslog protocol  

You can use the *syslog* link:https://tools.ietf.org/html/rfc3164[RFC3164] or link:https://tools.ietf.org/html/rfc5424[RFC5424] protocol to send a copy of your logs to an external log aggregator configured to accept the protocol instead of or in addition to the default Elasticsearch log store. You are responsible for configuring the external log aggregator to receive the logs from {product-title}.

To configure forwarding logs using the *syslog* protocol, create a `ClusterLogForwarder` custom resource (CR) with one or more outputs to the syslog servers and pipelines that use those outputs. The syslog output can use a UDP, TCP, or TLS connection.

[NOTE]
====
Alternately, you can use a ConfigMap to forward logs using the *syslog* RFC3164 protocols. However, this method is deprecated in {product-title} and will be removed in a future release.  
====

.Procedure

. Create a `ClusterLogForwarder` CR YAML file similar to the following:
+
[source,yaml]
----
apiVersion: logging.openshift.io/v1
kind: ClusterLogForwarder
metadata:
  name: instance <1>
spec:
  outputs:
   - name: rsyslog-east <2>
     type: syslog <3>
     syslog: <4>
       facility: local0      
       rfc: RFC3164      
       payloadKey: message      
       severity: informational      
     url: 'tls://rsyslogserver.east.example.com:514' <5>
     secret: <6>
        name: fluentd 
   - name: rsyslog-west
     type: syslog
     syslog:
      appName: myapp
      facility: user
      msgID: mymsg
      procID: myproc
      rfc: RFC5424
      severity: debug
     url: 'udp://rsyslogserver.west.example.com:514'       
  pipelines:
   - name: syslog-east <7>
     inputRefs: <8>
     - infrastructure
     - application
     outputRefs: <9>
     - rsyslog-east
     - default <10>
     labels:
       syslog: east
   - name: syslog-west <11>
     inputRefs:
     - audit
     outputRefs:
     - rsyslog-west
     - default
     labels:
       syslog: west
----
<1> The name of the `ClusterLogForward` CR must be `instance`.
<2> Specify a name for the output.
<3> Specify the `syslog` type.
<4> Optional. Specify the syslog parameters, listed below.
<5> Specify the URL and port of the external syslog instance. If the cluster-wide proxy using the CIDR annotation is enabled, the output must be a server name or FQDN, not an IP Address.
<6> Optional: If using a `tls` prefix, you must specify the name of the secret required by the endpoint for TLS communication. The secret must exist in the `openshift-logging` project. The secret must exist in the `openshift-logging` project and must have keys of: *tls.crt*, *tls.key*, and *ca-bundler.crt* that point to the respective certificates that they represent.
<7> Optional. Specify a name for the pipeline.
<8> Specify which log types should be forwarded using that pipeline: `application,` `infrastructure`, or `audit`.
<9> Specify the output to use  with that pipeline for forwarding the logs.
<10> Optional. Specify the `default` output in pipelines to also forward logs to the internal Elasticsearch instance.
<11> Optional. Configure multiple outputs to forward logs to other external syslog log aggregtors.

. Create the CR object:
+
[source,terminal]
----
$ oc create -f <file-name>.yaml
----

[id=cluster-logging-collector-log-forward-examples-syslog-parms]
=== Syslog parameters:

You can configure the following for the `syslog` outputs. For more information, see the syslog link:https://tools.ietf.org/html/rfc3164[RFC3164] or link:https://tools.ietf.org/html/rfc5424[RFC5424] RFC. 

* facility: The link:https://tools.ietf.org/html/rfc5424#section-6.2.1[syslog facility]. The value can be a decimal integer or a case-insensitive keyword:
** `0` or `kern` for kernel messages.
** `1` or `user` for user-level messages. This is the default.
** `2` or `mail` for the mail system..
** `3` or `daemon` for system daemons.
** `4` or `auth` for security/authentication messages.
** `5` or `syslog` for messages generated internally by syslogd.
** `6` or `lpr` for line printer subsystem.
** `7` or `news` for the network news subsystem.
** `8` or `uucp` for the UUCP subsystem.
** `9` or `cron` for the clock daemon.
** `10` or `authpriv` for security authentication messages.
** `11` or `ftp` for the FTP daemon.
** `12` or `ntp` for the NTP subsystem.
** `13` or `security` for log audit.
** `14` or `console` for log alert.
** `15` or `solaris-cron` for the scheduling daemon.
** `16`–`23` or `local0` – `local7` for locally used facilities
* payloadKey: The record field to use as payload for the syslog message.
* rfc: The RFC to be used for sending log using syslog. The default is RFC5424.
* severity: The link:https://tools.ietf.org/html/rfc5424#section-6.2.1[syslog severity] to set on outgoing syslog records. The value can be a decimal integer or a case-insensitive keyword:
** `0` or `Emergency` for messages indicating the system is unusable.
** `1` or `Alert` for messages indicating action must be taken immediately.
** `2` or `Critical` for messages indicating critical conditions.
** `3` or `Error` for messages indicating error conditions.
** `4` or `Warning` for messages indicating warning conditions.
** `5` or `Notice` for messages indicating normal but significant condition.
** `6` or `Informational` for messages indicating informational messages.
** `7` or `Debug` for messages indicating debug-level messages. This is the default.
* tag: Tag specifies a record field to use as tag on the syslog message.
* trimPrefix: Remove the specified prefix from the tag.

[id=cluster-logging-collector-log-forward-examples-syslog-5424]
=== Additional RFC5424 syslog parameters

The following parameters apply to RFC5424:

* appName: The APP-NAME part of the syslog-msg header. Must be specified for `RFC5424`.
* msgID: The MSGID part of the syslog-msg header. Must be specified for `RFC5424`.
* procID: The PROCID part of the syslog-msg header. Must be specified for `RFC5424`.
