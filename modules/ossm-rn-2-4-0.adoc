////
Module included in the following assemblies:
* service_mesh/v2x/servicemesh-release-notes.adoc
////

:_content-type: REFERENCE
[id="ossm-rn-2-4-0_{context}"]

= New features and enhancements {SMProductName} version 2.4

This release of {SMProductName} addresses Common Vulnerabilities and Exposures (CVEs), contains bug fixes, and is supported on {product-title} 4.10 and later versions.

== Component versions included in {SMProductName} version 2.4

|===
|Component |Version

|Istio
|1.16.5

|Envoy Proxy
|1.24.8

|Jaeger
|1.42.0

|Kiali
|1.65.6
|===

=== Cluster-wide deployments
This enhancement introduces a generally available version of cluster-wide deployments. A cluster-wide deployment contains a service mesh control plane that monitors resources for an entire cluster. The control plane uses a single query across all namespaces to monitor each Istio or Kubernetes resource that affects the mesh configuration. Reducing the number of queries the control plane performs in a cluster-wide deployment improves performance.

=== Support for discovery selectors
This enhancement introduces a generally available version of the `meshConfig.discoverySelectors` field, which can be used in cluster-wide deployments to limit the services the service mesh control plane can discover.

[source,yaml]
----
spec:
  meshConfig    
    discoverySelectors:
    - matchLabels:
        env: prod
        region: us-east1
    - matchExpressions:
      - key: app
        operator: In
        values:
          - cassandra
          - spark
----

=== Integration with cert-manager istio-csr
With this update, {SMProductName} integrates with the `cert-manager` controller and the `istio-csr` agent. `cert-manager` adds certificates and certificate issuers as resource types in Kubernetes clusters, and simplifies the process of obtaining, renewing, and using those certificates. `cert-manager` provides and rotates an intermediate CA certificate for Istio. Integration with `istio-csr` enables users to delegate signing certificate requests from Istio proxies to `cert-manager`. `ServiceMeshControlPlane` v2.4 accepts CA certificates provided by `cert-manager` as `cacerts` secret.

[NOTE]
====
Integration with `cert-manager` and `istio-csr` is not supported on {ibmpowerProductName}, {ibmzProductName}, and {linuxoneProductName}.
====

=== Integration with external authorization systems 
This enhancement introduces a generally available method of integrating {SMProductName} with external authorization systems by using the `action: CUSTOM` field of the `AuthorizationPolicy` resource. Use the `envoyExtAuthzHttp` field to delegate the access control to an external authorization system.

=== Integration with external Prometheus installation

This enhancement introduces a generally available version of the Prometheus extension provider. You can expose metrics to the {product-title} monitoring stack or a custom Prometheus installation by setting the value of the `extensionProviders` field to `prometheus` in the `spec.meshConfig` specification. The telemetry object configures Istio proxies to collect traffic metrics. {SMProductShortName} only supports the Telemetry API for Prometheus metrics. 

[source,yaml]
----
spec:
  meshConfig:
    extenstionProviders:
    - name: prometheus
      prometheus: {}
---
apiVersion: telemetry.istio.io/v1alpha1
kind: Telemetry
metadata:
  name: enable-prometheus-metrics
spec:
  metrics:
  - providers:
    - name: prometheus
----

=== Single stack IPv6 support

This enhancement introduces generally available support for single stack IPv6 clusters, providing access to a broader range of IP addresses. Dual stack IPv4 or IPv6 cluster is not supported.

[NOTE]
====
Single stack IPv6 support is not available on {ibmpowerProductName}, {ibmzProductName}, and {linuxoneProductName}.
====

=== {product-title} Gateway API support

include::snippets/technology-preview.adoc[]

This enhancement introduces an updated Technology Preview version of the {product-title} Gateway API. By default, the {product-title} Gateway API is disabled.

==== Enabling {product-title} Gateway API
To enable the {product-title} Gateway API, set the value of the `enabled` field to `true` in the `techPreview.gatewayAPI` specification of the `ServiceMeshControlPlane` resource.

[source,yaml]
----
spec:
  techPreview:
    gatewayAPI:
      enabled: true
----

Previously, environment variables were used to enable the Gateway API.

[source,yaml]
----
spec:
  runtime:
    components:
      pilot:
        container:
          env:
            PILOT_ENABLE_GATEWAY_API: "true"
            PILOT_ENABLE_GATEWAY_API_STATUS: "true"
            PILOT_ENABLE_GATEWAY_API_DEPLOYMENT_CONTROLLER: "true"
----

=== Control plane deployment on infrastructure nodes
{SMProductShortName} control plane deployment is now supported and documented on OpenShift infrastructure nodes. For more information, see the following documentation:

* Configuring all {SMProductShortName} control plane components to run on infrastructure nodes
* Configuring individual {SMProductShortName} control plane components to run on infrastructure nodes

=== Istio 1.16 support
{SMProductShortName} 2.4 is based on Istio 1.16, which brings in new features and product enhancements. While many Istio 1.16 features are supported, the following exceptions should be noted:

* HBONE protocol for sidecars is an experimental feature that is not supported.
* {SMProductShortName} on ARM64 architecture is not supported.
* OpenTelemetry API remains a Technology Preview feature.