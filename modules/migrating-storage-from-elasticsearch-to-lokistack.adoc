:_newdoc-version: 2.18.4
:_template-generated: 2025-06-03
:_mod-docs-content-type: PROCEDURE

[id="migrating-storage-from-elasticsearch-to-lokistack_{context}"]
= Migrating storage from Elasticsearch to LokiStack

You can migrate your existing Red{nbsp}Hat managed Elasticsearch to LokiStack.

.Prerequisites

* You have installed {loki-op}.

.Procedure

. Temporarily set the state of the `ClusterLogging` resource as `Unmanaged`
+
[source,terminal]
----
$ oc -n openshift-logging patch clusterlogging/instance -p '{"spec":{"managementState": "Unmanaged"}}' --type=merge
----

.  Remove `ClusterLogging` `ownerReferences` from the `Elasticsearch` resource.
+
The following command ensures that the `ClusterLogging` resource no longer owns the `Elasticsearch` resource. Updates to the `ClusterLogging` resource's `logStore` field will no longer affect the `Elasticsearch` resource.
+
[source,terminal]
----
$ oc -n openshift-logging patch elasticsearch/elasticsearch -p '{"metadata":{"ownerReferences": []}}' --type=merge
----

. Remove `ClusterLogging` `ownerReferences` from the `Kibana` resource
+
The following command ensures that *ClusterLogging* no longer owns the *Kibana* resource. Updates to the *ClusterLogging* resource's `visualization` field will no longer affect the *Kibana* resource.
+
[source,terminal]
----
$ oc -n openshift-logging patch kibana/kibana -p '{"metadata":{"ownerReferences": []}}' --type=merge
----

. Update cluster logging to use LokiStack as the log store:
+
[source,yaml]
----
apiVersion: "logging.openshift.io/v1"
kind: "ClusterLogging"
metadata:
  name: "instance"
  namespace: openshift-logging
spec:
  managementState: "Managed"
  logStore:
    type: "lokistack"
    lokistack:
      name: logging-loki
  collection:
    type: "vector"
---- 
