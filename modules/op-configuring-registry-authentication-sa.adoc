// This module is included in the following assemblies:
// * secure/authenticating-pipelines-repos-using-secrets.adoc

:_mod-docs-content-type: PROCEDURE
[id="op-configuring-registry-authentication-sa_{context}"]
= Configuring container registry authentication using a service account

[role="_abstract"]
For a pipeline to retrieve container images from a registry or push container images to a registry, you must configure the authentication for that registry.

To configure registry authentication for a pipeline, create an authentication secret with the Docker configuration file, associate this secret with a service account, and associate this service account with a `TaskRun` or `PipelineRun` resource.

.Procedure

. Create the container registry authentication secret from an existing `config.json` file, which contains the authentication information, by entering the following command:
+
[source, terminal]
----
$ oc create secret generic my-registry-credentials \ # <1>
  --from-file=config.json=/home/user/credentials/config.json # <2>
----
<1> The name of the secret, in this example, `my-registry-credentials`
<2> The path name of the `config.json` file, in this example, `/home/user/credentials/config.json`

. Create the YAML manifest for the service account in the `serviceaccount.yaml` file. In this manifest, associate the secret with the service account.
+
[source,yaml,subs="attributes+"]
----
apiVersion: v1
kind: ServiceAccount
metadata:
  name: container-bot <1>
secrets:
  - name: my-registry-credentials <2>
----
<1> Name of the service account. In this example, `container-bot`.
<2> Name of the secret containing the SSH private key. In this example, `my-registry-credentials`.

. Create a YAML manifest for a task run or pipeline run as the `run.yaml` file. In this file, associate the service account with a task run or a pipeline run. Use one of the following examples:

** To associate the service account with a task run:
+
[source,yaml,subs="attributes+"]
----
apiVersion: tekton.dev/v1
kind: TaskRun
metadata:
  name: build-container-task-run-2 <1>
spec:
  taskRunTemplate:
    serviceAccountName: container-bot <2>
  taskRef:
    name: build-container <3>
----
<1> Name of the task run. In this example, `build-container-task-run-2`.
<2> Name of the service account. In this example, `container-bot`.
<3> Name of the task. In this example, `build-container`.
+
** To associate the service account with a pipeline run:
+
[source,yaml,subs="attributes+"]
----
apiVersion: tekton.dev/v1
kind: PipelineRun
metadata:
  name: demo-pipeline <1>
  namespace: default
spec:
  taskRunTemplate:
    serviceAccountName: container-bot <2>
  pipelineRef:
    name: demo-pipeline <3>
----
<1> Name of the pipeline run. In this example, `demo-pipeline`.
<2> Name of the service account. In this example, `container-bot`.
<3> Name of the pipeline. In this example, `demo-pipeline`.
+
. Apply the changes by entering the following command:
+
[source,terminal]
----
$ oc apply --filename serviceaccount.yaml,run.yaml
----
