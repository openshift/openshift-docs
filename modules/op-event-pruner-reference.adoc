// This module is included in the following assemblies:
// * install_config/customizing-configurations-in-the-tektonconfig-cr.adoc

:_mod-docs-content-type: REFERENCE
[id="event-pruner-reference_{context}"]
= Configuration of the event-based pruner

:FeatureName: The event-based pruner
include::snippets/technology-preview.adoc[]

You can configure the pruning behavior of the event-based pruner by modifying your `TektonConfig` custom resource (CR).

The following is an example of the `TektonConfig` CR with the default configuration that uses global pruning rules:

[source,yaml]
----
apiVersion: operator.tekton.dev/v1alpha1
kind: TektonConfig
metadata:
 name: config
spec:
  # ...
  tektonpruner:
    disabled: false
    global-config:
      enforcedConfigLevel: global
      failedHistoryLimit: null
      historyLimit: 10
      namespaces: null
      successfulHistoryLimit: null
      ttlSecondsAfterFinished: null
    options: {}
  # ...
----
* `failedHistoryLimit`: The amount of retained failed runs.
* `historyLimit`: The amount of runs to retain. Pruner uses this setting if status-specific limits are not defined.
* `namespaces`: Definition of per-namespace pruning policies, when you set `enforcedConfigLevel` to `namespace`.
* `successfulHistoryLimit`: The amount of retained successful runs. 
* `ttlSecondsAfterFinished`: Time in seconds after completion, after which the pruner deletes resources.

You can define pruning rules for individual namespaces by setting `enforcedConfigLevel` to `namespace` and configuring policies under the `namespaces` section. In the following example, a 60 second time to live (TTL) is applied to resources in the `dev-project` namespace:

[source,yaml]
----
apiVersion: operator.tekton.dev/v1alpha1
kind: TektonConfig
metadata:
 name: config
spec:
  # ...
  tektonpruner:
    disabled: false
    global-config:
      enforcedConfigLevel: namespace
      ttlSecondsAfterFinished: 300
      namespaces:
        dev-project:
          ttlSecondsAfterFinished: 60
  # ...
----

You can use the following parameters in your `TektonConfig` CR `tektonpruner`:

[cols="1,3",options="header"]
|===
|Parameter |Description

|`ttlSecondsAfterFinished`
|Delete resources a fixed number of seconds after they complete.

|`successfulHistoryLimit`
|Retain the specified number of the most recent successful runs. Delete older successful runs.

|`failedHistoryLimit`
|Retain the specified number of the most recent failed runs. Delete older failed runs.

|`historyLimit`
|Apply a generic history limit when `failedHistoryLimit` and `successfulHistoryLimit` are not defined.

|`enforcedConfigLevel`
|Specify the level at which pruner applies the configuration. Accepted values: `global` or `namespace`.

|`namespaces`
|Define per-namespace pruning policies.
|===

[NOTE]
====
You can use TTL-based pruning to prune resources exceeding set expiration times. Use history-based pruning to prune resources exceeding the configured `historyLimit`.
====
