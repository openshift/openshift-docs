// This module is included in the following assembly:
//
// * records/using-tekton-results-for-openshift-pipelines-observability.adoc

:_mod-docs-content-type: PROCEDURE
[id="results-search-records_{context}"]
= Searching for records

[role="_abstract"]
You can search for records using Common Expression Language (CEL) queries. As each record contains full YAML information for a pipeline run or task run, you can find records by many different criteria.

.Prerequisites

* You installed the `opc` utility and prepared its environment to query {tekton-results}.

.Procedure

* Search for records using a CEL query by entering the following command:
+
[source,terminal]
----
$ opc results records list --addr ${RESULTS_API} --filter="<cel_query>" <namespace_name>/result/-
----
+
Replace `<namespace_name>` with the namespace in which the pipeline runs or task runs were created. Alternatively, search for records within a single result by entering the following command:
+
[source,terminal]
----
$ opc results records list --addr ${RESULTS_API} --filter="<cel_query>" <result_name>
----
+
Replace `<result_name>` with the full name of the result.


.Example CEL queries for records
|===
| Purpose | CEL query

| Records of all task runs or pipeline runs that failed
| `!(data.status.conditions[0].status == 'True')`

| Records where the name of the `TaskRun` or `PipelineRun` custom resource (CR) was `run1`
| `data.metadata.name == 'run1'`

| Records for all task runs that were started by the `PipelineRun` CR named `run1`
| `data_type == 'TASK_RUN' && data.metadata.labels['tekton.dev/pipelineRun'] == 'run1'`

| Records of all pipeline runs and task runs that were created from a `Pipeline` CR named `pipeline1`
| `data.metadata.labels['tekton.dev/pipeline'] == 'pipeline1'`

| Records of all pipeline runs that were created from a `Pipeline` CR named `pipeline1`
| `data.metadata.labels['tekton.dev/pipeline'] == 'pipeline1' && data_type == 'PIPELINE_RUN'`

| Records of all task runs where the `TaskRun` CR name stared with `hello`
| `data.metadata.name.startsWith('hello') && data_type=='TASK_RUN'`

| Records of all pipeline runs that took more than five minutes to complete
| `data.status.completionTime - data.status.startTime > duration('5m') && data_type == 'PIPELINE_RUN'`

| Records of all pipeline runs and task runs that completed on October 7, 2023
| `data.status.completionTime.getDate() == 7 && data.status.completionTime.getMonth() == 10 && data.status.completionTime.getFullYear() == 2023`

| Records of all pipeline runs that included three or more tasks
| `size(data.status.pipelineSpec.tasks) >= 3 && data_type == 'PIPELINE_RUN'`

| Records of all pipeline runs that had annotations containing `ann1`
| `data.metadata.annotations.contains('ann1') && data_type == 'PIPELINE_RUN'`

| Records of all pipeline runs that had annotations containing `ann1` and the name of the `PipelineRun` CR started with `hello`
| `data.metadata.annotations.contains('ann1') && data.metadata.name.startsWith('hello') && data_type == 'PIPELINE_RUN'`

|===
