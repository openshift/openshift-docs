// Module included in the following assemblies:
//
// * installing/disconnected_install/installing-mirroring-disconnected-v2.adoc

:_mod-docs-content-type: REFERENCE
[id="oc-mirror-operator-catalog-filtering_{context}"]
= Operator catalog filtering

The list of bundles selected for mirroring by oc-mirror v2 is based on processing the catalog contents based on the information in `imageSetConfig`.

During the selection of bundles for mirroring, oc-mirror v2 does not seek to bridge the gap graph between two channels or catalogs. Instead, it rigorously adheres to the user's instructions outlined by the `imageSetConfig`.

When oc-mirror v2 selects bundles for mirroring, it refrains from inferring Group Version Kind (GVK) or bundle dependencies, omitting them from the mirroring set. It strictly adheres to the user's instructions. Therefore, you must explicitly specify any required dependent packages and their versions.

Most bundle versions adhere to semantic versioning standards. Bundles within a channel can be sorted by version, allowing selection of bundles falling within the specified range in the `ImageSetConfig`.

Such an algorithm will lead to consistent results compared to v1 results. Nevertheless, the upgrade graph information conveyed by the `replaces`, `skip` and `skipRange` is not taken into account. This algorithm is totally different from the one used by OLM. There is no guarantee here that the selected list of bundles would allow OLM to perform an upgrade for the selected operator. There may also be a much shorter path between the minVersion and the maxVersion requested. oc-mirror will, in this case, mirror more bundles than what a cluster would need to perform the upgrade.


.Scenarios:
[cols="1,2",options="header"]

|===

|ImageSetConfig operator filtering 
|Expected bundle versions


a|Scenario 1

[source,yaml]
----
mirror:
 operators:
   - catalog: registry.redhat.io/redhat/redhat-operator-index:v4.10
----
|For each package in the catalog, 1 bundle, corresponding to the head version of the default channel for that package.

a|Scenario 2

[source,yaml]
----
mirror:
  operators:
    - catalog: registry.redhat.io/redhat/redhat-operator-index:v4.10
      full: true
----
|All bundles of all channels of the specified catalog.

a|Scenario 3

[source,yaml]
----
mirror:
  operators:
    - catalog: registry.redhat.io/redhat/redhat-operator-index:v4.10
      - package: elastic-search-operator
----
|1 bundle, corresponding to the head version of the default channel for that package.

a|Scenario 4

[source,yaml]
----
mirror:
  operators:
    - catalog: registry.redhat.io/redhat/redhat-operator-index:v4.10
      full: true
      - packages:
          - name: elasticsearch-operator
----
|All bundles of all channels for the packages specified.

a|Scenario 5

[source,yaml]
----
mirror:
  operators:
      - catalog: registry.redhat.io/redhat/redhat-operator-index:v4.10
      - package: elastic-search-operator
        minVersion: 5.6.0
----
|All bundles in the default channel, from `minVersion`, up to channel head for that package (not relying of shortest path from upgrade graph).

a|Scenario 6

[source,yaml]
----
mirror:
  operators:
    - catalog: registry.redhat.io/redhat/redhat-operator-index:v4.10
      - package: elastic-search-operator
        maxVersion: 6.0.0
----
|All bundles in the default channel, that are lower than `maxVersion` for that package.

a|Scenario 7

[source,yaml]
----
mirror:
  operators:
    - catalog: registry.redhat.io/redhat/redhat-operator-index:v4.10
      - package: elastic-search-operator
        minVersion: 5.6.0
        maxVersion: 6.0.0
----
|All bundles in the default channel, between `minVersion` and `maxVersion` for that package. Head of channel is not included, even if multiple channels are included in the filtering.

a|Scenario 8

[source,yaml]
----
mirror:
  operators:
    - catalog: registry.redhat.io/redhat/redhat-operator-index:v4.10
      - package: elastic-search-operator
        channels
          - name: stable
----
|Head bundle for the selected channel of that package.

a|Scenario 9

[source,yaml]
----
mirror:
  operators:
    - catalog: registry.redhat.io/redhat/redhat-operator-index:v4.10
      full: true
      - packages:
          - name: elasticsearch-operator
            channels:
               - name: 'stable-v0'
----
|All bundles for the packages and channels specified.

a|Scenario 10

[source,yaml]
----
mirror:
  operators:
    - catalog: registry.redhat.io/redhat/redhat-operator-index:v4.10
      - package: elastic-search-operator
        channels
          - name: stable
          - name: stable-5.5
----
|Head bundle for the each selected channel of that package.

a|Scenario 11

[source,yaml]
----
mirror:
  operators:
    - catalog: registry.redhat.io/redhat/redhat-operator-index:v4.10
      - package: elastic-search-operator
        channels
          - name: stable
            minVersion: 5.6.0
----
|Within the selected channel of that package, all version starting `minVersion` up to channel head (not relying of shortest path from upgrade graph).

a|Scenario 12

[source,yaml]
----
mirror:
  operators:
    - catalog: registry.redhat.io/redhat/redhat-operator-index:v4.10
      - package: elastic-search-operator
        channels
          - name: stable
            maxVersion: 6.0.0
----
|Within the selected channel of that package, all versions up to `maxVersion` (not relying of shortest path from upgrade graph); Head of channel is not included, even if multiple channels are included in the filtering.

a|Scenario 13

[source,yaml]
----
mirror:
  operators:
    - catalog: registry.redhat.io/redhat/redhat-operator-index:v4.10
      - package: elastic-search-operator
        channels
          - name: stable
            minVersion: 5.6.0
            maxVersion: 6.0.0
----
|Within the selected channel of that package, all versions between `minVersion` and `maxVersion`, not relying of shortest path from upgrade graph; Head of channel is not included, even if multiple channels are included in the filtering.

a|Scenario 14

[source,yaml]
----
mirror:
  operators:
  - catalog: registry.redhat.io/redhat/redhat-operator-index:v4.14
    packages:
    - name: aws-load-balancer-operator
      bundles:
      - name: aws-load-balancer-operator.v1.1.0
    - name: 3scale-operator
      bundles:
      - name: 3scale-operator.v0.10.0-mas
----
|Only the bundles specified for each package are included in the filtering.

a|Scenario 15

[source,yaml]
----
mirror:
  operators:
    - catalog: registry.redhat.io/redhat/redhat-operator-index:v4.10
      - package: elastic-search-operator
        channels
          - name: stable
        minVersion: 5.6.0
        maxVersion: 6.0.0
----
|Error: Filtering by channel and by package min or max version should not be allowed.

a|Scenario 16

[source,yaml]
----
mirror:
  operators:
    - catalog: registry.redhat.io/redhat/redhat-operator-index:v4.10
      full: true
      - package: elastic-search-operator
        channels
          - name: stable
        minVersion: 5.6.0
        maxVersion: 6.0.0
----
|Error: Filtering using full:true and min or max version is not allowed.

a|Scenario 17

[source,yaml]
----
mirror:
  operators:
    - catalog: registry.redhat.io/redhat/redhat-operator-index:v4.10
      full: true
      - package: elastic-search-operator
        channels
          - name: stable
            minVersion: 5.6.0
            maxVersion: 6.0.0
----
|Error: Filtering using full:true and min or max version is not allowed.

|===

