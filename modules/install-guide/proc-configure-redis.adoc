[id="configure-redis_{context}"]
= Configuring Redis storage for rate limiting
:prodname: Connectivity Link

To configure persistence for rate limit counters in a multicluster environment, you must configure the connection details for your shared Redis-based datastore. This datastore is used to persist shared rate limit counters for the Limitador component of {prodname}.  

NOTE: You must configure connection details for your shared Redis-based datastore on each OpenShift cluster that you want to use {prodname} for rate limiting. 


.Prerequisites

* See xref:install-prerequisites_{context}[].

.Procedure

. Set the following environment variable to your shared Redis-based instance URL:
+
[source,bash]
----
export REDIS_URL=rediss://user:xxxxxx@some-redis.com:10340
----
+
Ensure that you include the appropriate URI scheme for your environment: 

* Secure Redis: `rediss://` 
* Standard Redis: `redis://` 

. Create a `Secret` resource for your Redis URL as follows:
+
[source,bash]
----
kubectl -n kuadrant-system create secret generic redis-config \
  --from-literal=URL=$REDIS_URL
----

. Update your Limitador custom resource to use the secret that you created as follows:
+
[source,bash]
----
kubectl patch limitador limitador --type=merge -n kuadrant-system -p '
spec:
  storage:
    redis:
      configSecretRef:
        name: redis-config
'      
----

.Additional resources
* For details on how to set up your shared Redis-based datastore, see your Redis-compatible product documentation:

** https://redis.io/docs/latest/[Redis documentation].
** https://docs.aws.amazon.com/AmazonElastiCache/latest/red-ug/WhatIs.html[AWS ElastiCache (Redis OSS) User Guide].
** https://www.dragonflydb.io/docs[Dragonfly documentation].





