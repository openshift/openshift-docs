// Module included in the following assemblies:
//
// * multitenancy/multitenancy-support-in-gitops.adoc

:_mod-docs-content-type: CONCEPT
[id="configuring-namespace-management-argocd-tenants_{context}"]
= Configuring namespace management for Argo CD tenants

[role="_abstract"]
You can enable non-cluster-admin users to configure namespace management for their Argo CD instances by creating a `NamespaceManagement` custom resource (CR).

.Prerequisites

* You have logged in to the {OCP} cluster as an administrator.
* You have installed the {gitops-shortname} Operator on your {OCP} cluster.
* You can access the default Argo CD instance in the `openshift-gitops` namespace.  

.Procedure

. Enable the feature in the `Subscription` Custom Resource (CR).
+
Edit the {gitops-title} Operator `Subscription` CR to allow namespace management.  
+
[source,yaml]
----
apiVersion: operators.coreos.com/v1alpha1
kind: Subscription
metadata:
  name: argocd-operator
  namespace: argocd
spec:
  config:
    env:
    - name: ALLOW_NAMESPACE_MANAGEMENT_IN_NAMESPACE_SCOPED_INSTANCES
      value: "true" # <1>
----
<1> Specify the value to `true` to enable namespace management in the `Subscription` CR

. Configure the Argo CD CR.  
+
Update the Argo CD instance to allow namespace management.  
+
[source,yaml]
----
apiVersion: argoproj.io/v1alpha1
kind: ArgoCD
metadata:
  name: example-argocd
  namespace: <argocd-ns> # <1>
spec:
  namespaceManagement:
    - name: <tenant-ns> # <2>
      allowManagedBy: true
----
+
<1> Replace `<argocd-ns>` with the Argo CD instance namespace.  
<2> Replace `<tenant-ns>` with the namespace that you want Argo CD to manage. You can also use a glob pattern with wildcards such as `/\*` and `?` for pattern matching. For example, specifying `dev-/\*` matches any namespace with the `dev-` prefix.

. Create a `NamespaceManagement` CR.  
+
In the tenant namespace, the tenant user creates a `NamespaceManagement` CR:  
+
[source,yaml]
----
apiVersion: argoproj.io/v1beta1
kind: NamespaceManagement
metadata:
  name: ui-team-namespace
  namespace: <tenant-ns> # <1>
spec:
  managedBy: <argocd-ns> # <2>
----
+
<1> `.metadata.namespace` - Namespace to be managed by the Argo CD instance.
<2> `.spec.managedBy` - Namespace where the Argo CD instance runs. This value must exactly match the Argo CD namespace.

.Verification

After you create the `NamespaceManagement` CR, the {gitops-title} Operator automatically performs the following actions:

* Creates the required `Role` and `RoleBinding` resources in the tenant namespace.
* Updates the Argo CD cluster secret to include the tenant namespace.

You can verify the following resources in the tenant namespace:

* *Roles*: `<argocd-instance-name>-argocd-server`, `<argocd-instance-name>-argocd-application-controller`
* *RoleBindings*: `<argocd-instance-name>-argocd-server`, `<argocd-instance-name>-argocd-application-controller`
* *Cluster secret*: `<argocd-instance-name>-cluster`

where, <argocd-instance-name> is the name of your Argo CD instance.