// Module included in the following assemblies:
//
// * networking/hardware_networks/configuring-sriov-device.adoc

[id="nw-sriov-nic-mlx-secure-boot_{context}"]
= MLX Secure Boot

The Mellanox (MLX) secure boot supports the option to disable vendor plugins in the SR-IOV operator. This allows OCP customers to use the existing virtual functions in the mellanox cards firmware, and is currently the only way to use MLX NICs when secure boot is enabled. Secure boot is required by regulation and desired by customers.

.Procedure

. Configure virtual functions

.. Run the following command when the system is without a secure boot when using the sriov-config daemon:

[source,terminal]
----
mstconfig -d -0001:b1:00.0 set SRIOV_EN=1 NUM_OF_VFS=16
----
.. Reboot the system to enable the virtual functions.

. Configure the sriov operator with the Mellanox plugin disabled

[source,yaml]
----
apiVersion: sriovnetwork.openshift.io/v1
kind: SriovOperatorConfig
metadata:
  name: default
  namespace: openshift-sriov-network-operator
spec:
  configDaemonNodeSelector: {}
  configurationMode: daemon
  disableDrain: false
  disablePlugins:
  - mellanox
  enableInjector: true
  enableOperatorWebhook: true
  logLevel: 2
----

.Verifying that the interface is successfully partitioned
Confirm that the interface partitioned to virtual functions (VFs) for the SR-IOV device by running the following command.

[source,terminal]
----
$ ip link show <interface> <1>
----

<1> Replace `<interface>` with the interface that you specified when partitioning to VFs for the SR-IOV device, for example, `ens3f1`.

.Example output
[source,terminal]
----
5: ens3f1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc mq state UP mode DEFAULT group default qlen 1000
link/ether 3c:fd:fe:d1:bc:01 brd ff:ff:ff:ff:ff:ff

vf 0     link/ether 5a:e7:88:25:ea:a0 brd ff:ff:ff:ff:ff:ff, spoof checking on, link-state auto, trust off
vf 1     link/ether 3e:1d:36:d7:3d:49 brd ff:ff:ff:ff:ff:ff, spoof checking on, link-state auto, trust off
vf 2     link/ether ce:09:56:97:df:f9 brd ff:ff:ff:ff:ff:ff, spoof checking on, link-state auto, trust off
vf 3     link/ether 5e:91:cf:88:d1:38 brd ff:ff:ff:ff:ff:ff, spoof checking on, link-state auto, trust off
vf 4     link/ether e6:06:a1:96:2f:de brd ff:ff:ff:ff:ff:ff, spoof checking on, link-state auto, trust off
----
