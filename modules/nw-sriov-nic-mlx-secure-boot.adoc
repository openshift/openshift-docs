// Module included in the following assemblies:
//
// * networking/hardware_networks/configuring-sriov-device.adoc

[id="nw-sriov-nic-mlx-secure-boot_{context}"]
= Mellanox Secure Boot

Mellanox (MLX) secure boot supports the option to disable vendor plugins in the SR-IOV operator. This allows OCP customers to use the existing virtual functions in the mellanox cards firmware, and is currently the only way to use MLX NICs when secure boot is enabled. Secure boot is required by regulation and desired by customers.

.Procedure

. Configure the virtual functions (VFs)

.. Run the following command when the system is without a secure boot when using the sriov-config daemon:
+
[source,terminal]
----
mstconfig -d -0001:b1:00.0 set SRIOV_EN=1 NUM_OF_VFS=16
----

.. Reboot the system to enable the virtual functions.

. Configure the sriov operator with the Mellanox plugin disabled
+
[source,yaml]
----
apiVersion: sriovnetwork.openshift.io/v1
kind: SriovOperatorConfig
metadata:
  name: default
  namespace: openshift-sriov-network-operator
spec:
  configDaemonNodeSelector: {}
  configurationMode: daemon
  disableDrain: false
  disablePlugins:
  - mellanox
  enableInjector: true
  enableOperatorWebhook: true
  logLevel: 2
----

. Check the virtual functions (VFs) after rebooting
+
[source,terminal]
----
# oc -n openshift-sriov-network-operator get sriovnetworknodestate.sriovnetwork.openshift.io  cnfdr14.telco5g.eng.rdu2.redhat.com -oyaml
----
+
[source,yaml]
----
- deviceID: 101d
    driver: mlx5_core
    eSwitchMode: legacy
    linkSpeed: -1 Mb/s
    linkType: ETH
    mac: 08:c0:eb:96:31:25
    mtu: 1500
    name: ens3f1np1
    pciAddress: 0000:b1:00.1
    totalvfs: 16
    vendor: 15b3
----

. Enable secure boot
Enabling secure boot improves your system's security by preventing unauthorized operating systems and malicious software from loading during the device's boot process. 

.. Enable secure boot using the BIOS.
+
[source,yaml]
----
Secure Boot: Enabled
Secure Boot Policy: Standard
Secure Boot Mode: Mode Deployed
----

.. Reboot the machine.


