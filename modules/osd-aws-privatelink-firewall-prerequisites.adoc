[id="osd-aws-privatelink-firewall-prerequisites"]
= AWS PrivateLink firewall prerequisites

If you are using a firewall and want to create your cluster using AWS PrivateLink, you must configure your firewall to grant access to the sites that {product-title} requires.

See link:https://access.redhat.com/documentation/en-us/openshift_container_platform/4.7/html/installing/installation-configuration#configuring-firewall_configuring-firewall[Configuring your firewall for OpenShift Container Platform] for information about granting access to sites that OCP requires.

.Procedure

. Allowlist the following URLs that are used to install and download packages and tools:
+
[cols="2,4,2",options="header"]
|===
|URL | Function | Requirement
|`registry.redhat.io`
|Provides core components such as dev tools and operator based add-ons, and Red Hat provided container images including middleware and Universal Base Image.
|Required

|`quay.io`
|Used by the cluster to download the platform container images
|Required

|`sso.redhat.com`
|The `https://cloud.redhat.com/openshift` site uses authentication from `sso.redhat.com` to  download the pull secret and use Red Hat SaaS solutions to facilitate monitoring of your subscriptions, cluster inventory, chargeback reporting, and so on.
|Required

|`pull.q1w2.quay.rhcloud.com`
|Provides a fallback registry used by the cluster when quay.io is not available.
|Recommended
|===
+
When you add a site such as `quay.io` to your allowlist, do not add a wildcard entry such as `*.quay.io` to your denylist. In most cases, image registries use a content delivery network (CDN) to serve images. If a firewall blocks access, then image downloads are denied when the initial download request is redirected to a host name such as `cdn01.quay.io`.

. Managed clusters require Telemetry to be enabled to allow Red Hat to react more quickly to problems and better support our customers, as well as better understand how product upgrades impact clusters.
See link:https://access.redhat.com/documentation/en-us/openshift_container_platform/4.6/html/support/remote-health-monitoring-with-connected-clusters#about-remote-health-monitoring[About remote health monitoring] for more information about how remote health monitoring data is used by Red Hat.
+
[cols="2,4,2",options="header"]
|===
|URL | Function | Requirement

|`https://cloud.redhat.com`
|Used by the cluster for the `insights operator` that integrates with the SaaS Red Hat Insights
|Required
|===

. For Amazon Web Services (AWS), you must grant access to the URLs that provide the AWS API and DNS:
+
[cols="2,4,2",options="header"]
|===
|URL | Function | Requirement

|`*.amazonaws.com`
|Required to access AWS services and resources. Review the link:https://docs.aws.amazon.com/general/latest/gr/rande.html[AWS Service Endpoints] in the AWS documentation to determine the exact endpoints to allow for the regions that you use.
|Required
|===

. Allowlist the following URLs:
+
[cols="2,4, 2",options="header"]
|===
|URL | Function | Requirement

|`mirror.openshift.com`
|Required to access mirrored installation content and images. This site is also a source of release image signatures, although the Cluster Version Operator needs only a single functioning source.
|Required

|`storage.googleapis.com/openshift-release`
|Alternative site to download platform release signatures that are used by the cluster to know what images to pull from quay.io.
|Recommended

|`quay-registry.s3.amazonaws.com`
|Used to access Quay image content in AWS.
|Required

|`api.openshift.com`
|Required to check if updates are available for the cluster.
|Required

|`art-rhcos-ci.s3.amazonaws.com`
|Specifies the {op-system-first} images to download.
|Required

|`cloud.redhat.com/openshift`
|Required for your cluster token.
|Required

|`registry.access.redhat.com`
| Access to the `odo` CLI tool that helps developers build on OpenShift and Kubernetes.
|Required
|===

. Allowlist the following OpenShift Dedicated URLs:
+
[cols="2,4, 2",options="header"]
|===
|URL | Function | Requirement

|`api.pagerduty.com` and `events.pagerduty.com`
|This alerting service is used by the in-cluster alertmanager to send alerts notifying SREs of an event to take action on.
|Required

|`api.deadmanssnitch.com` and `nosnch.in`
|Alerting service used by OpenShift Dedicated to send periodic pings that indicate whether the cluster is available and running.
|Required

|`sftp.access.redhat.com`
|FTP server used by must-gather-operator to upload diagnostic logs to help troubleshoot issues with the cluster.
|Recommended

|`*.osdsecuritylogs.splunkcloud.com`
|Used by the splunk-forwarder-operator as a logging forwarding endpoint to be used by the SRE Platform Team for log-based alerting.
|Required

|`observatorium.api.openshift.com`
|Used for Managed OpenShift-specific telemetry.
|Required
|===
+
. Allowlist any site that provides resources for a language or framework that your builds require.
. Allowlist any outbound URLs that depend on the languages and frameworks used in OpenShift. See link:https://access.redhat.com/solutions/2998411[OpenShift Outbound URLs to Allow] for a list of recommended URLs to be allowed on the firewall or proxy.
