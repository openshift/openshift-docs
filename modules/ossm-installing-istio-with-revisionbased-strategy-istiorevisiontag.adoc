// Module included in the following assemblies:

// update/ossm-updating-openshift-service-mesh.adoc

:_mod-docs-content-type: PROCEDURE
[id="installing-istio-with-revisionbased-strategy-istiorevisiontag_{context}"]
= Installing Istio with RevisionBased strategy and IstioRevisionTag

You can install the {istio} control plane, `IstioRevisionTag` resource, {istio} CNI, and the Bookinfo demo application using the `RevisionBased` update strategy.

[NOTE]
====
You can use the following section to understand the update process. You can skip this installation if the cluster already includes an {istio} deployment.
====

.Procedure

. Create the `istio-system` namespace by running the following command:
+
[source,terminal]
----
$ oc create ns istio-system
----

. Deploy the {istio} control plane using the `RevisionBased` update strategy. The following example configuration creates an `{istio}` resource named `default` in the `istio-system` namespace:
+
.Example configuration
[source,yaml]
----
apiVersion: sailoperator.io/v1
kind: Istio
metadata:
  name: default
spec:
  namespace: istio-system
  updateStrategy:
    type: RevisionBased
  version: v1.24.3
----

. Create an `IstioRevisionTag` resource. The following example configuration creates an `IstioRevisionTag` resource named `default`:
+
.Example configuration
[source,yaml]
----
apiVersion: sailoperator.io/v1
kind: IstioRevisionTag
metadata:
  name: default
spec:
  targetRef:
    kind: Istio
    name: default
----
+
Verify that the `targetRef` field points to the desired `{istio}` resource. In the example above, the `IstioRevisionTag` references the `{istio}` resource named `default`.

. Create the `istio-cni` namespace by running the following command:
+
[source,terminal]
----
$ oc create ns istion-cni
----

. Install the {istio} CNI plugin with the desired version. The following example configuration creates an `IstioCNI` resource named `default` in the `istio-cni` namespace:
+
.Example configuration
[source,yaml]
----
apiVersion: sailoperator.io/v1
kind: IstioCNI
metadata:
  name: default
spec:
  version: v1.24.3
  namespace: istio-cni
----

. Configure application workloads to run in the cluster. The following example deploys the `bookinfo` application in the `bookinfo` namespace.

.. Create the `bookinfo` namespace by running the following command:
+
[source,terminal]
----
$ oc create ns bookinfo
----

.. Label the `bookinfo` namespace to enable sidecar injection by running the following command:
+
[source,terminal]
----
$ oc label namespace bookinfo istio-injection=enabled
----

.. Install the `bookinfo` pods in the `bookinfo` namespace by running the following command:
+
[source,terminal]
----
$ oc apply -f https://raw.githubusercontent.com/openshift-service-mesh/istio/release-1.24/samples/bookinfo/platform/kube/bookinfo.yaml -n bookinfo
----

. Review the `IstioRevisionTag` resource by running the following command:
+
[source,terminal]
----
$ oc get istiorevisiontag
----
+
.Example output
+
[source,terminal]
----
NAME      STATUS    IN USE   REVISION          AGE
default   Healthy   True     default-v1-24-3   2m46s
----
+
The `IN USE` field shows `True` because both active workloads and the `bookinfo` namespace now reference the tag.

. Confirm that the proxy version matches the control plane version by running the following command:
+
[source,terminal]
----
$ istioctl proxy-status 
----
+
The `VERSION` column should match the control plane version.
+
.Example output
+
[source,terminal]
----
NAME              TYPE    READY   STATUS    IN USE   VERSION   AGE
default-v1-24-3   Local   True    Healthy   True     v1.24.3   5m31s
----