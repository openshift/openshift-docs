// Module included in the following assemblies:
//
// * installing/disconnected_install/installing-mirroring-disconnected-v2.adoc

:_mod-docs-content-type: PROCEDURE
[id="oc-mirror-delete-v2_{context}"]
= Deleting the images from disconnected environment

The delete functionality consists of two stages:

.Stage 1: Generation

. Creates a delete YAML file using the `--generate` flag. This file is used to validate the images/blobs that will be deleted. 

.. Use the following command to create `delete` yaml file for delete phase:

[source,terminal]
----
$ oc mirror delete --config delete-image-set-config.yaml --workspace file://<previously-mirrored-work-folder> --v2 --generate docker://<remote-registry> 
----

.Verification

. Navigate into the `<previously-mirrored-work-folder>/delete` directory that was generated.
. Verify that the `delete-images.yaml` file has been generated.
. Manually validate that each image within the file is an image that the cluster no longer requires and is safe to remove from the registry.

.Stage 2: Execution

. Use the validated delete yaml file `<previously-mirrored-work-folder>/delete/delete-images.yaml` to delete from the local cache and remote registry.

.. Once the generate stage is completed, use the following command to delete the images from the remote registry. 

[source,terminal]
----
$ oc mirror delete --v2 --delete-yaml-file <previously-mirrored-work-folder>/delete/delete-images.yaml docker://<mirror-registry-url>
----

It is highly recommended to use the mirror-to-disk and disk-to-mirror workflows.

In the image delete workflow, oc-mirror only deletes the manifests of the images, which does not reduce the storage occupied in the registry.
To free up storage space from unnecessary images (those with deleted manifests), you need to enable the garbage collector on your container registry. The procedure for enabling the garbage collector varies depending on the container registry you are using. With the garbage collector enabled, the registry will delete the image blobs that no longer have references to any manifests, thereby reducing the storage previously occupied by the deleted blobs.

[IMPORTANT]
====
Be aware that when using mirror to mirror no images are cached locally, so it is not possible to delete the images from local cache using the delete feature.
====