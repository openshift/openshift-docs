// Module included in the following assemblies:
//
// * configuring/loki-query-performance-troubleshooting.adoc

:_newdoc-version: 2.18.4
:_template-generated: 2025-10-24
:_mod-docs-content-type: PROCEDURE

[id="analyzing-loki-query-performance_{context}"]
= Analyzing Loki query performance

Every query and subquery in Loki generates a `metrics.go` log line with performance statistics. Subqueries emit the log line in the queriers.
Every query has an associated single summary `metrics.go` line emitted by the query-front end.
Use these statistics to calculate the query performance metrics.

.Prerequisites
* You have administrator permissions.
* You have access to the {ocp-product-title} web console.
* You installed and configured {loki-op}.

.Procedure
. In the {ocp-product-title} web console, navigate to the *Metrics* -> *Observe* tab.

. Note the following values:

* *duration*: Denotes the amount of time a query took to run.
* *queue_time*: Denotes the time a query spent in the queue before being processed.
* *chunk_refs_fetch_time*: Denotes the amount of time spent in getting chunk information from the index.
* *store_chunks_download_time*: Denotes the amount of time in getting chunks from cache or storage.

. Calculate the following performance metrics:

** total query time as `total_duration`:
+
[subs=+quotes]
----
total_duration = *duration* + *queue_time*
----

** Percentage of the total duration that a query spent in the queue as `Queue Time`: 
+
[subs=+quotes]
----
Queue Time = *queue_time* / total_duration * 100
----

** Calculate the percentage of the total duration that was spent in getting chunk information from the index as `Chunk Refs Fetch Time`:
+
[subs=+quotes]
----
Chunk Refs Fetch Time = *chunk_refs_fetch_time* / total_duration * 100
----

** Calculate the percentage of the total duration that was spent in getting chunks from cache or storage:
+
[subs=+quotes]
----
Chunks Download Time = *store_chunks_download_time* / total_duration * 100
----

** Calculate the percentage of the total duration that was spent in executing the query:
+
[subs=+quotes]
----
Execution Time = (*duration* - *chunk_refs_fetch_time* - *store_chunks_download_time*) / total_duration * 100
----

. Refer to https://docs.redhat.com/en/documentation/red_hat_openshift_logging/latest/html/about_openshift_logging/index/analyze-query-performance_loki-query-performance-troubleshooting[Query performance analysis] to understand the reason for each metric and how each metric affects query performance.
