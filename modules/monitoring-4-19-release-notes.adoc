// Module included in the following assembly:
//
// * release-notes/monitoring-release-notes.adoc

:_mod-docs-content-type: REFERENCE
[id="monitoring-4-19-release-notes_{context}"]
= {ocp} {product-version} monitoring release notes

[role="_abstract"]
The changes for {ocp} {product-version} monitoring are included in the following errata advisory:

* link:https://access.redhat.com/errata/RHSA-2024:11038[RHSA-2024:11038]

[id="monitoring-4-19-updates-to-monitoring-components-and-dependencies_{context}"]
== Updates to monitoring stack components and dependencies

This release includes the following version updates for monitoring stack components and dependencies:

* Alertmanager to 0.28.1
* Prometheus to 3.2.1
* Prometheus Operator to 0.81.0
* Thanos to 0.37.2
* kube-state-metrics to 2.15.0
* node-exporter to 1.9.1

[id="monitoring-4-19-changes-alerting-rules_{context}"]
== Changes to alerting rules

[NOTE]
====
Red{nbsp}Hat does not guarantee backward compatibility for recording rules or alerting rules.
====

* Added the `PrometheusPossibleNarrowSelectors` alert to warn users when PromQL queries or metric relabel configurations use selectors that could be too restrictive and might not take into account that values on the `le` label of classic histograms or the `quantile` label of summaries are floats in Prometheus v3. For more information, see the "Prometheus v3 upgrade" section.

[id="monitoring-4-19-new-features-and-enhancements_{context}"]
== New features and enhancements

The monitoring stack for this release includes the following new features and enhancements:

Prometheus v3 upgrade::
This release introduces a major update to the Prometheus component, transitioning from v2 to v3. The monitoring stack and other core components include all of the necessary adjustments to ensure a smooth upgrade. However, some user-managed configurations might require modifications. The key changes include the following items:
+
--
* The values of the `le` label for classic histograms and the `quantile` label for summaries are normalized during ingestion. For example, the `example_bucket{le="10"}` metric selector is ingested as `example_bucket{le="10.0"}`. As a result, alerts, recording rules, dashboards, and relabeling configurations that reference label values as whole numbers, for example, `le="10"`, might no longer work as intended.
+
To mitigate the issue, update your selectors:

** If your queries need to cover data from both before and after the Prometheus upgrade, ensure both values are considered, for example, use a regular expression, `example_bucket{le=~"10(.0)?"}`.

** For queries that only cover data after the upgrade, use float values, for example, `le="10.0"`.
+
* Configurations that send alerts to additional Alertmanager instances through `additionalAlertmanagerConfigs` by using the Alertmanager v1 API are no longer supported.
+
To mitigate the issue, upgrade any affected Alertmanager instances to support the v2 API, which is supported since Alertmanager `v0.16.0`, and update your monitoring configuration to use the v2 scheme.
--
+
For more information about the changes between Prometheus v2 and v3, see link:https://prometheus.io/docs/prometheus/latest/migration/[Prometheus 3.0 migration guide].

Metrics collection profiles is generally available::
{product-title} 4.13 introduced the ability to set a metrics collection profile for default platform monitoring to collect either the default amount of metrics data or a minimal amount of metrics data. In {product-title} {product-version}, metrics collection profiles are now generally available.
+
For more information, see link:https://docs.redhat.com/en/documentation/monitoring_stack_for_red_hat_openshift/4.19/html-single/monitoring_key_concepts/index#configuring-metrics-collection-profiles_key-concepts[About metrics collection profiles] and link:https://docs.redhat.com/en/documentation/monitoring_stack_for_red_hat_openshift/4.19/html-single/configuring_core_platform_monitoring/index#choosing-a-metrics-collection-profile_configuring-performance-and-scalability[Choosing a metrics collection profile].

Added cluster proxy support for external Alertmanager instances::
With this release, external Alertmanager instances now use the cluster-wide HTTP proxy settings for communication. The {cmo-first} reads the cluster-wide proxy settings and configures the appropriate proxy URL for the Alertmanager endpoints.

Strict validation for the {cmo-full} is improved::
With this release, the strict validation introduced in {product-title} 4.18 is improved. Error messages now clearly identify the affected field, and validation is case-sensitive to ensure more accurate and consistent configuration.
+
For more information, see (link:https://issues.redhat.com/browse/OCPBUGS-42671[OCPBUGS-42671]) and (link:https://issues.redhat.com/browse/OCPBUGS-54516[OCPBUGS-54516]).

[id="monitoring-4-19-technology-preview-features_{context}"]
== Technology Preview features

[IMPORTANT]
====
[subs="attributes+"]
Technology Preview features are not supported with Red{nbsp}Hat production service level agreements (SLAs) and might not be functionally complete. Red{nbsp}Hat does not recommend using them in production. These features provide early access to upcoming product features, enabling customers to test functionality and provide feedback during the development process.

For more information about the support scope of Red{nbsp}Hat Technology Preview features, see link:https://access.redhat.com/support/offerings/techpreview/[Technology Preview Features Support Scope].
====

The following table tracks features that are in Technology Preview or were Technology Preview in recent releases. Features are marked with the following statuses:

* _Not Available_
* _Technology Preview_
* _General Availability_

.Monitoring Technology Preview tracker
[cols="4,1,1,1",options="header"]
|====
|Feature |4.17 |4.18 |4.19

|Metrics Collection Profiles
|Technology Preview
|Technology Preview
|General Availability

|====

[id="monitoring-4-19-fixed-issues_{context}"]
== Fixed issues

The monitoring stack for this release includes the following fixed issues:

* Previously, if a scrape failed, Prometheus erroneously considered the samples from the very next scrape as duplicates and dropped them. This issue affected only the scrape immediately following a failure, while subsequent scrapes were processed correctly. With this release, the scrape following a failure is now correctly handled, ensuring that no valid samples are mistakenly dropped. (link:https://issues.redhat.com/browse/OCPBUGS-53025[OCPBUGS-53025])