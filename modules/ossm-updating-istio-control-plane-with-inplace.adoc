// Module included in the following assemblies:
// update/ossm-updating-openshift-service-mesh.adoc

:_mod-docs-content-type: PROCEDURE
[id="ossm-updating-istio-control-plane-with-inplace_{context}"]
= Updating Istio control plane with InPlace strategy

When updating {istio} using the `InPlace` strategy, you can increment the version by only one minor release at a time. To update by more than one minor version, you must increment the version and restart the workloads after each update. Restarting workloads ensures compatibility between the sidecar and control plane versions. The update process is complete after restarting all workloads.

.Prerequisites

* You are logged in to {ocp-product-title} as a user with the `cluster-admin` role.
* You have installed the {SMProductName} Operator, and deployed {istio}.
* You have installed `istioctl` on your local machine.
* You have configured the {istio} control plane to use the `InPlace` update strategy. In this example, the `{istio}` resource named `default` is deployed in the `istio-system` namespace.
* You have installed the {istio} CNI plugin with the desired version. In this example, the `IstioCNI` resource named `default` is deployed in the `istio-cni` namespace.
* You have labeled the `bookinfo` namespace to enable sidecar injection.
* You have application workloads running in the cluster. In this example, the `bookinfo` application is deployed in the `bookinfo` namespace.

.Procedure

. Change the version in the `{istio}` resource. For example, to update to {istio} `1.24.4`, set the `spec.version` field to `v1.24.4` by running the following command:
+
[source,terminal]
----
$ oc patch istio default --type='merge' -p '{"spec":{"version":"v1.24.4"}}'
----
+
.Version update in {istio} CR
+
[source,yaml]
----
kind: Istio
spec:
  version: v1.24.4
  updateStrategy:
    type: InPlace
----
+
The {SMProductShortName} Operator deploys a new version of the control plane that replaces the old version of the control plane. The sidecars automatically reconnect to the new control plane.

. Confirm that the new version of the control plane is ready by running the following command:
+
[source,terminal]
----
$ oc get istio
----
+
.Example output
+
[source,terminal]
----
NAME      REVISIONS   READY   IN USE   ACTIVE REVISION   STATUS    VERSION   AGE
default   1           1       1        default           Healthy   v1.24.4   4m50s
----

. Restart the application workloads so that the new version of the sidecar gets injected by running the following command:
+
[source,terminal]
----
$ oc rollout restart deployment -n bookinfo
----

.Verification

. Verify that the new version of the sidecar is running by entering the following command:
+
[source,terminal]
----
$ istioctl proxy-status 
----
+
.Example output
+
[source,terminal]
----
NAME                                                    CLUSTER        CDS                LDS                EDS                RDS                ECDS        ISTIOD                                     VERSION
details-v1-7d775cb4f6-5t9zm.bookinfo                    Kubernetes     SYNCED (2m25s)     SYNCED (2m25s)     SYNCED (2m17s)     SYNCED (2m25s)     IGNORED     istiod-default-v1-24-4-c98fd9675-r7bfw     1.24.4
productpage-v1-7c4b6b857-mxrw6.bookinfo                 Kubernetes     SYNCED (2m35s)     SYNCED (2m35s)     SYNCED (2m17s)     SYNCED (2m35s)     IGNORED     istiod-default-v1-24-4-c98fd9675-r7bfw     1.24.4
ratings-v1-5b896f8544-r552l.bookinfo                    Kubernetes     SYNCED (2m21s)     SYNCED (2m21s)     SYNCED (2m17s)     SYNCED (2m21s)     IGNORED     istiod-default-v1-24-4-c98fd9675-r7bfw     1.24.4
reviews-v1-746f96c9d4-9pw8k.bookinfo                    Kubernetes     SYNCED (2m17s)     SYNCED (2m17s)     SYNCED (2m17s)     SYNCED (2m17s)     IGNORED     istiod-default-v1-24-4-c98fd9675-r7bfw     1.24.4
reviews-v2-97bdf5876-4mzx5.bookinfo                     Kubernetes     SYNCED (2m35s)     SYNCED (2m35s)     SYNCED (2m17s)     SYNCED (2m35s)     IGNORED     istiod-default-v1-24-4-c98fd9675-r7bfw     1.24.4
reviews-v3-77d9db6844-djgjk.bookinfo                    Kubernetes     SYNCED (2m19s)     SYNCED (2m19s)     SYNCED (2m17s)     SYNCED (2m19s)     IGNORED     istiod-default-v1-24-4-c98fd9675-r7bfw     1.24.4
----
+
The column `VERSION` should match with the new control plane version.