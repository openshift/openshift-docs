:_content-type: ASSEMBLY
[id="release-notes-40"]
= Red Hat Advanced Cluster Security for Kubernetes 4.0
include::modules/common-attributes.adoc[]
:context: release-notes-40

toc::[]

{rh-rhacscs-first} is an enterprise-ready, Kubernetes-native container security solution that protects your vital applications across build, deploy, and runtime stages of the application lifecycle. It deploys in your infrastructure and integrates with your DevOps tools and workflows to deliver better security and compliance and to enable DevOps and InfoSec teams to operationalize security.

.Release dates
[options="header"]
|====
|{product-title-short} version |Released on
|`4.0` |3 May 2023
|====

[id="about-this-release-40"]
== About this release

{product-title-short} 4.0 includes the following new features, improvements, and updates:

* xref:../release_notes/40-release-notes.adoc#major-release-version-change[Major release version change to 4.0]
* xref:../release_notes/40-release-notes.adoc#external-postgresql-database-rn40[Installing Central with an external PostgreSQL database (Technology Preview)]
* xref:../release_notes/40-release-notes.adoc#acs-cloud-release-rn40[{product-title-short} Limited Availability]
* xref:../release_notes/40-release-notes.adoc#telemetry-rn40[Telemetry data collection in {product-title-short}]
* xref:../release_notes/40-release-notes.adoc#rhcos-node-scan-rn40[{op-system-first} node host scanning for security vulnerabilities]
* xref:../release_notes/40-release-notes.adoc#process-listening-endpoints-rn40[Processes listening on endpoints API]
* xref:../release_notes/40-release-notes.adoc#network-graph-rn40[Network graph 2.0 (Technology Preview) updates]
* xref:../release_notes/40-release-notes.adoc#fips-compliance-rn40[FIPS compliance]
* xref:../release_notes/40-release-notes.adoc#token-expiry-alert-rn40[Alert messages sent to Central logs for expiring tokens]
* xref:../release_notes/40-release-notes.adoc#sensor-resync-rn40[Improvements for Sensor resync (Technology Preview)]
* xref:../release_notes/40-release-notes.adoc#doc-additions-rn40[Documentation additions]

[IMPORTANT]
====
For xref:../configuration/enable-offline-mode.adoc#enable-offline-mode[offline configured] installations that have set the `collector.slimMode` option to `false`: the `rhacs-collector-rhel8` image now contains a subset of kernel modules and eBPF probes available in the support package download. If the collector status is `unhealthy` after an upgrade, follow the instructions for xref:../configuration/enable-offline-mode.adoc#download-kernel-support-package_enable-offline-mode[downloading kernel support packages] and then upload them to Central.
====

[id="new-features-40"]
== New features

[id="major-release-version-change"]
=== Major release version change to 4.0
With this release, {product-title-short} includes a major architecture change, moving the Central database to PostgreSQL. This change provides important performance and scale 	benefits.

By default, {product-title-short} installation includes the PostgreSQL database. Future plans include the ability to use your own PostgreSQL-compliant software. {product-title-short} 4.0 includes this feature as a Technology Preview with certain limitations. For more information, see "Installing Central with an external PostgreSQL database (Technology Preview)".

{product-title-short} includes features that depend on the new architecture. Specifically, policy criteria and vulnerability reporting with collections were introduced in 3.74 as a Technology Preview, and are now generally available.

//update link to Customer Portal link after CP version is published (lags behind by ~1 day)
For instructions for a new installation of {product-title-short} 4.0, see xref:../installing/acs-installation-platforms.adoc#acs-installation-platforms[Supported platforms and installation methods].

[id="upgrade-to-40"]
=== Upgrading {product-title-short} to version 4.0

To prevent automatic upgrades when using the Operator, {product-title-short} 4.0 uses a new subscription channel. This update allows the {product-title-short} Operator to comply with Red Hat standards and provides consistency with other Red Hat Operators. As documented in the upgrade instructions, you must explicitly change your subscription channel when upgrading. Customers who remain on the `latest` channel in the current {product-title-short} Operator channel will continue to receive 3.74 updates until it is no longer supported. The life cycle of {product-title-short} 3.74 has been extended by 3 months to allow you more time to migrate to {product-title-short} 4.0. The upgrade process includes automatically migrating the database, and requires no intervention.

After Central is upgraded, upgrade the subscription channel on all Secured Clusters.

You are encouraged to evaluate the upgrade in a staging environment before pushing it to production to ensure that your unique environment does not present unforeseen issues.

The documentation provides detailed instructions for rolling back to the previous version if necessary. Before the upgrade, back up the existing Central database following the xref:../backup_and_restore/backing-up-acs.adoc#backing-up-acs[documented backup procedure] so that you can roll back to the previous version if necessary. You are encouraged to practice rolling back to the previous version in the staging environment to ensure that your backup was successful and that rolling back the previous version brings the system back to the expected operational state.

To upgrade {product-title-short} to 4.0, perform the following steps:

. Upgrade to {product-title-short} version 3.74 if you have an earlier version installed.
. Back up the database for Central.
. Upgrade Central to version 4.0.
. Upgrade secured clusters to version 4.0.

For additional instructions on upgrading, see the documentation in the "Upgrade documentation" section. Procedures for upgrading by using Helm and `roxctl` now include a step to back up the Central database before upgrading Central.

[id="upgrade-acscs-rn40"]
=== Upgrading {rh-rhacscs-first} to version 4.0

To upgrade {product-title-short}, you must switch the Operator channel to `stable` for your secured clusters.
[NOTE]
====
Manifest-based upgrades using `roxctl` and Helm upgrade procedures for secured clusters remain unchanged.
====

[id="upgrade-documentation-rn40"]
=== Upgrade documentation

For more information about upgrading to release 4.0, see the following documentation:

- xref:../upgrading/upgrade-operator.adoc#upgrade-operator[Upgrading by using the Operator]
- xref:../upgrading/upgrade-helm.adoc#upgrade-helm[Upgrading using Helm charts]
- xref:../upgrading/upgrade-roxctl.adoc#upgrade-roxctl[Manually upgrading using the roxctl CLI]

[id="external-postgresql-database-rn40"]
=== Installing Central with an external PostgreSQL database (Technology Preview)

With this release, you can test the use of your existing PostgreSQL infrastructure to provision a database for {product-title-short}.

:FeatureName: External PostgreSQL database
include::snippets/technology-preview.adoc[]

{product-title-short} 4.0 includes this feature as a Technology Preview and it is not supported for production systems. It currently has several limitations, including the need for privileged superuser access. Red Hat is seeking customer feedback and testing.

For more information, see xref:../installing/installing_ocp/install-central-ocp.adoc#install-central-operator-tech-preview_install-central-ocp[Installing Central with an external database using the Operator method].

[id="acs-cloud-release-rn40"]
=== {product-title-short} Limited Availability

{rh-rhacscs-first} provides a fully hosted and managed Central instance that allows you to secure your on-premise and cloud-based Kubernetes clusters.

{product-title-short} is available for approved customers. Customers can get {product-title-short} by using the Amazon Web Services (AWS) Marketplace or from their regular Red Hat channels. For more information, contact Red Hat Sales.

During the Limited Availability phase, Red Hat will provide full support with committed service level agreements (SLAs) and response times. Red Hat will also continue to provide an email list for feedback and general questions. The following items apply to {product-title-short} limited availability:

- {product-title-short} provides the capability to access repositories local to the secured clusters. This functionality is supported only for OpenShift secured clusters and Red Hat Quay that will have local scanning capabilities for internal and extended registries in the customer environments.
- The Ireland (`eu-west-1`) region is now available when creating an {product-title-short} instance. Red Hat will ensure all data residency requirements for data are met per the EU standards.
- {product-title-short} is fully integrated into the AWS Marketplace.

[id="telemetry-rn40"]
=== Telemetry data collection in {product-title-short}

With this release, Telemetry, where {product-title-short} collects anonymized aggregated information about product usage and product configuration, is enabled by default. To learn more about telemetry or see instructions for opting out, see xref:../telemetry/about-telemetry.adoc#about-telemetry[About Telemetry].

[id="rhcos-node-scan-rn40"]
=== {op-system-first} node host scanning for security vulnerabilities

{product-title-short} provides {op-system} node host scanning for security vulnerabilities. The scope of this feature is limited to scanning {op-system} RPMs installed on the node host as part of the {op-system} installation for any known vulnerabilities. This feature provides the following functionality:

- Analysis and detection of {op-system} components
- Matching of vulnerabilities on the components by using {op-system-base} and {osp} 4.X OVALv2 security data streams

To view a list of {op-system-base} versions for {ocp} and {op-system}, see link:https://access.redhat.com/articles/6907891[RHEL Versions Utilized by RHEL CoreOS and OCP].

[NOTE]
====
{ocp}/{op-system} 4.10 or later is supported.
====

For more information about vulnerability scanning, see xref:../operating/manage-vulnerabilities/scan-rhcos-node-host.adoc#scan-rhcos-node-host[Scanning RHCOS node hosts].

[id="process-listening-endpoints-rn40"]
=== Processes listening on endpoints API

{product-title-short} now provides a list of all processes that are listening on ports in secured clusters. This information can help you associate which deployments and associated processes have open ports and better assess cluster security.

This functionality is available for deployments by using the `v1/listening_endpoints` API. Changes to the {product-title-short} web portal for this feature are planned for a future release. In this release, the following known limitations exist:

- It is possible that the process ID (PID) information attached to an endpoint reflects a process of the same name and parameters, but earlier execution time. Additionally, only the pod ID, process name, process arguments, port, and protocol are guaranteed to be populated for a given deployment.
- Under rare circumstances, network endpoints reported by the API might have process information reflecting the characteristics of the parent process instead of the process that created the listening endpoint.
- Only TCP endpoints are currently reported.

For more information, navigate to *Help* -> *API reference* in the {product-title-short} portal.

[id="network-graph-rn40"]
=== Network graph 2.0 (Technology Preview) updates

:FeatureName: Network graph 2.0
include::snippets/technology-preview.adoc[leveloffset=+1]

The Network Graph (2.0 preview) has been updated to address user feedback and add improvements. The following changes have been made:

- Differentiated *Filtered* namespaces from *Derived* namespaces
- Changed behavior of the display to dim additional items in the background when an item is selected
- Separated *Anomalous flows* and *Baseline flows* in the *Details* tab for deployments
- Added container configurations
- Renamed *Extraneous flows* to *Inactive flows*

For more information, see xref:../operating/manage-network-policies.adoc#network-graph-20-docs[Network graph (2.0 preview)].

[id="fips-compliance-rn40"]
=== FIPS compliance

{product-title-short} functionality has been validated on {osp} 4.12 running in Federal Information Processing Standards (FIPS) mode.

[id="token-expiry-alert-rn40"]
=== Alert messages sent to Central logs for expiring tokens

API tokens are used in {product-title-short} for some system integrations, authentication processes, and system functions. API tokens expire in 1 year. This release adds an automatic notification process to create warning messages for tokens that will expire in less than 1 week. These messages appear in the Central logs. You can configure your system to alert you when you receive these messages so that you know when you need to generate new tokens. For more information, see xref:../configuration/configure-api-token.adoc#about-api-token-expiration_configure-api-token[About API token expiration].

[id="sensor-resync-rn40"]
=== Improvements for Sensor resync (Technology Preview)

:FeatureName: Sensor resync
include::snippets/technology-preview.adoc[]

{product-title-short} has reduced the amount of CPU usage needed for Sensor to resync with Central. The improvement can be enabled with the environment flag of `ROX_RESYNC_DISABLED="true"` in all sensors running {product-title-short} version 4.0. By default, this variable is disabled, or set to `false`.

Without this improvement, Sensor reprocesses Kubernetes and {osp}-specific events every minute, which increases the CPU consumption considerably, especially for large clusters with many pods or deployments. With this improvement, reprocessing is no longer required, considerably reducing the load on the CPU.

[id="doc-additions-rn40"]
=== Documentation additions

- Instructions for adding integrations with Microsoft Azure have been added. See xref:../operating/manage-user-access/configuring-identity-providers/connecting-azure-ad-to-rhacs-using-sso-configuration.adoc#user-authentication[Connecting Azure AD to {product-title-short} using SSO configuration].

[id="notable-technical-changes-rn40"]
== Notable technical changes

- Active vulnerability management is now controlled by a `ROX_ACTIVE_VULN_MGMT` variable with a default value of `false` to improve performance. If you need active vulnerability management, set this variable to `true` to reactivate it. However, if you reactivate this variable, increase the memory limit of Central.
- Previously, the `Analyst` permission set had `read` access on all permissions except the now-deprecated `DebugLogs` permission. This permission set now has `read` access to all permissions except `Administration`.
- The default resources for Sensor have increased to a request of 2 cores and 4 GB of RAM and a limit of 4 cores and 8 GB of RAM to support a larger number of clusters without modification.
- The {product-title-short} Operator default channel has changed from `latest` to `stable`. If you are running a version earlier than 4.0, you must follow the upgrade procedure to preserve {product-title-short} data in case of issues with the upgrade. For more information, see xref:../upgrading/upgrade-operator.adoc#upgrade-operator[Upgrading by using the Operator].
- The versioning scheme for the {product-title-short} Helm charts has changed. Previously, the product version `(Major).(Minor).(Patch)` was rendered to the Helm chart version `(Minor).(Patch).0`; for example, `3.74.2` -> `74.2.0`. The new versioning scheme maps product version `(Major).(Minor).(Patch)` to the Helm chart version as `(Major*100).(Minor).(Patch)`; for example, `4.0.2` -> `400.0.2`.

[id="deprecation-notices-40"]
== Deprecated and removed features

Some features available in previous releases have been deprecated or removed.

Deprecated functionality is still included in {product-title-short} and continues to be supported; however, it will be removed in a future release of this product and is not recommended for new deployments. For the most recent list of major functionality deprecated and removed, see the following table. Additional information about some removed or deprecated functionality is available after the table.

In the table, features are marked with the following statuses:

- GA: General Availability
- TP: Technology Preview
- DEP: Deprecated
- REM: Removed
- NA: Not applicable


.Deprecated and removed features tracker
[cols="3,1,1,1",options="header"]
|====
| Feature | {product-title-short} 3.73 |{product-title-short} 3.74 | {product-title-short} 4.0

| `AllComments` permission
| DEP
| DEP
| REM


| `BuildDate` attribute
| GA
| DEP
| REM

| Clair scanner version 2
| GA
| DEP
| REM

| `ComplianceRuns` permission
| DEP
| DEP
| REM

| `DebugLogs` permission
| DEP
| DEP
| REM

| Examining images for Application-level dependencies for vulnerability reporting: `dotnet/shared/Microsoft.AspNetCore.App/` and `dotnet/shared/Microsoft.NETCore.App/`
| GA
| GA
| DEP

| `Expiration` field in `Exclusion` proto
| GA
| GA
| DEP

| `ids` field in the `/v1/cves/suppress` and `/v1/cves/unsuppress` API payload
a|
* DEP in {product-title-short} 3.73
* REM in {product-title-short} (Field Trial)
| DEP
| REM

| Kernel module collection method
| GA
| DEP
| DEP

| Network Graph version 1.0
| GA
| GA
| DEP

| `NetworkGraphConfig` permission
| DEP
| DEP
| REM

| `Policy` permission
| GA
| DEP
| REM

| `ProbeUpload` permission
| DEP
| DEP
| REM

| `Role` permission
| GA
| DEP
| REM

| `roxctl scanner generate` flag `offline-mode` (flag only)
| GA
| GA
| DEP

| `ScannerBundle` permission
| DEP
| DEP
| REM

| `ScannerDefinitions` permission
| DEP
| DEP
| REM

| `ScopeManager` default role
| GA
| DEP
| REM

| `SensorUpgradeConfig` permission
| DEP
| DEP
| REM

| `ServiceIdentity` permission
| DEP
| DEP
| REM

| Support for {ocp} versions earlier than 4.10
| GA
| DEP
| REM

| `/v1/cves/suppress` and `/v1/cves/unsuppress`
a|
* DEP in {product-title-short} 3.73
* REM in {product-title-short} (Field Trial)
| DEP
| REM

| `/v1/report` endpoint
| GA
| GA
| DEP

| `/v1/serviceaccounts` endpoint
| GA
| GA
| DEP

| `VulnerabilityReports` permission
| GA
| DEP
| REM

| `vulns` field of `storage.Node` object in response payload of `v/nodes`
a|
* DEP in {product-title-short} 3.73
* REM in {product-title-short} (Field Trial)
| DEP
| REM
|====

[id="deprecated-features-374"]
=== Deprecated features

The following section provides additional information about deprecated features listed in the preceding table.

- The `--offline-mode` flag for the `roxctl scanner generate` command is deprecated, as Scanner's default behavior is to fetch vulnerability updates from Central. The flag is planned for removal in the {product-title-short} 4.2.0 release.
- The Network Graph version 1.0 is deprecated. Use the Network Graph version 2.0 for improved functionality and a better user experience.
- The PDF export feature in the Vulnerability Management section of the {product-title-short} web portal is deprecated and is planned for removal in the {product-title-short} 4.2.0 release. Use the vulnerability reporting feature instead for more comprehensive CSV data.
- Vulnerability scanning support for non-RPM (ASP).NET Core Runtime is deprecated and is planned for removal in the {product-title-short} 4.2.0 release.
- All `/v1/report` APIs for creating and managing vulnerability reports are deprecated and will be replaced with new `/v2/report` APIs in a future release.

[id="remove-kernel-rn40"]
==== Remove kernel module as collection method

Currently, secured clusters can specify three options of collection methods for runtime events: eBPF (selected by default), kernel module, or no collection. Kernel module as a collection method was deprecated in the {product-title-short} version 3.74 release and is planned for removal in the {product-title-short} version 4.1 release.

[discrete]
[id="actions-kernel-module-rn40"]
===== Actions you must take
Verify the collection method of your secured clusters. This value is set in the `collector.collectionMethod` parameter and is one of the following methods:

- `EBPF`
- `KERNEL_MODULE`
- `NO_COLLECTION`

If any of your secured clusters uses `KERNEL_MODULE` as a collection method, change it to `EBPF`.

[id="removed-features-rn40"]
== Removed features

The following section provides additional information about removed features listed in the preceding table.

[id="permissions-rn40"]
=== Permissions and permission sets

As announced in the Release Notes for {product-title-short} 3.73.0, some permissions are now grouped for simplification. The deprecation process in 4.0 will remove and replace the deprecated permissions with the replacing permission. The access level granted to the replacing permission will be the lowest among all access levels of the replaced permissions.

The following list provides more information about permission and permission set changes:

* Permission `Administration` replaces the deprecated following permissions:
** `AllComments`
** `Config`
** `DebugLogs`
** `NetworkGraphConfig`
** `ProbeUpload`
** `ScannerBundle`
** `ScannerDefinitions`
** `SensorUpgradeConfig`
** `ServiceIdentity`
* Permission `Compliance` replaces the deprecated permission `ComplianceRuns`.
* The `Analyst` permission set will change behavior. Instead of allowing `read` access to all resources except `DebugLogs`, it will allow `read` access to all resources except `Administration`. This change affects you if you were using the `Analyst` role or permission set for actions requiring `read` access on the following resources:
+
--
** `AllComments`
** `Config`
** `NetworkGraphConfig`
** `ProbeUpload`
** `ScannerBundle`
** `ScannerDefinitions`
** `SensorUpgradeConfig`
** `ServiceIdentity`
--
+
To address this change, preemptively create a new permission set with `read` access on the `Administration` and other required resources, and reference it instead of `Analyst` in the created roles.

[id="bug-fixes-rn40"]
== Bug fixes

[id="resolved-in-version-40"]
=== Resolved in version 4.0

Release date: 3 May 2023

//bugs are not linked because ACS Jira is not public
- Previously, in the {product-title-short} portal, the *Platform Configuration* -> *Clusters* page did not display information in the *Cloud Provider* field for Azure Red Hat OpenShift and Red Hat OpenShift Service on AWS (ROSA) clusters. This has been fixed. (ROX-14399)
- If the most recent critical alert in an environment was from a custom policy that triggers off of Kubernetes audit logs, it could cause the widgets on the main dashboard to fail. This has been fixed. (ROX-15103)
- Previously, the `image scan_time` value was not updated for some images in the *Image* entity list. This issue occurred because the workflow for updating watched images and the workflow for manually scanning images did not actually re-scan the images when the image SHA remained the same. This has been fixed. (ROX-15808)
- Fixed an issue in consistency with `roxctl` output and API output for the image vulnerability data. Previously, roxctl showed the total number of CVEs. Now the unique number of CVEs is shown instead. (ROX-15277)
- Fixed an issue with the `roxctl generate netpol` command. Previously, the command generated network policies with the `status{}` field, which prevented applying policies to a cluster. The command no longer generates network policies with this field. (ROX-14775)
- Fixed an issue where the *Create Policy* buttons were not visible when the certificate expiration banner was displayed. (ROX-12433)
- Error messages generated during runtime policy validation have been improved. (ROX-15809)
- Previously, {product-title-short} failed to suspend a cron job when enforcing a deploy time policy. This issue has been fixed. (ROX-15113)

[id="known-issues-40"]
=== Known issues

* Currently, {product-title-short} does not support alerts for security policy violations for containers running with default `seccomp profiles-Unconfined`. The alert violations for Unconfined `seccomp` profiles are generated only if the `seccomp` profile is explicitly set to "Unconfined" in the container specification. No workaround exists. (ROX-13490)

[id="image-versions-40"]
== Image versions

[%header,cols="1,1,2"]
|===
| Image | Description | Current version

| Main
| Includes Central, Sensor, Admission controller, and Compliance. Also includes `roxctl` for use in continuous integration (CI) systems.
a| `registry.redhat.io/advanced-cluster-security/rhacs-main-rhel8:4.0`

| Scanner
| Scans images and nodes.
a|`registry.redhat.io/advanced-cluster-security/rhacs-scanner-rhel8:4.0`

| Scanner DB
| Stores image scan results and vulnerability definitions.
a|`registry.redhat.io/advanced-cluster-security/rhacs-scanner-db-rhel8:4.0`

| Collector
| Collects runtime activity in Kubernetes or {ocp} clusters.
a| * `registry.redhat.io/advanced-cluster-security/rhacs-collector-rhel8:4.0`
* `registry.redhat.io/advanced-cluster-security/rhacs-collector-slim-rhel8:4.0`
|===
