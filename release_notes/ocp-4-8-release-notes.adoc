[id="ocp-4-8-release-notes"]
= {product-title} {product-version} release notes
include::modules/common-attributes.adoc[]
:context: release-notes

toc::[]

Red Hat {product-title} provides developers and IT organizations with a hybrid cloud application platform for deploying both new and existing applications on secure, scalable resources with minimal configuration and management overhead. {product-title} supports a wide selection of programming languages and frameworks, such as Java, JavaScript, Python, Ruby, and PHP.

Built on {op-system-base-full} and Kubernetes, {product-title} provides a more secure and scalable multi-tenant operating system for today's enterprise-class applications, while delivering integrated application runtimes and libraries. {product-title} enables organizations to meet security, privacy, compliance, and governance requirements.

[id="ocp-4-8-about-this-release"]
== About this release

// TODO: Update k8s link once there is a version-specific URL for the Kubernetes release
{product-title} (link:https://access.redhat.com/errata/RHBA-2021:1234[RHBA-2021:1234]) is now available. This release uses link:https://kubernetes.io/docs/setup/release/notes/[Kubernetes 1.21] with CRI-O runtime. New features, changes, and known issues that pertain to {product-title} {product-version} are included in this topic.

//Red Hat did not publicly release {product-title} 4.8.0 as the GA version and, instead, is releasing {product-title} 4.8.z as the GA version.

{product-title} {product-version} clusters are available at https://cloud.redhat.com/openshift. The {cloud-redhat-com} application for {product-title} allows you to deploy OpenShift clusters to either on-premise or cloud environments.

{product-title} {product-version} is supported on {op-system-base-full} 7.7 or later, as well as {op-system-first} 4.6.

You must use {op-system} machines for the control plane, which are also known as master machines, and you can use either {op-system} or {op-system-base-full} 7.7 or later for compute machines, which are also known as worker machines.

[IMPORTANT]
====
Because only {op-system-base-full} version 7.7 or later is supported for compute machines, you must not upgrade the {op-system-base} compute machines to version 8.
====

//{product-title} 4.6 is an Extended Update Support (EUS) release. More information on Red Hat OpenShift EUS is available in link:https://access.redhat.com/support/policy/updates/openshift#ocp4_phases[OpenShift Life Cycle] and link:https://access.redhat.com/support/policy/updates/openshift-eus[OpenShift EUS Overview].

With the release of {product-title} 4.8, version 4.5 is now end of life. For more information, see the link:https://access.redhat.com/support/policy/updates/openshift[Red Hat OpenShift Container Platform Life Cycle Policy].

[id="ocp-4-8-inclusive-language"]
== Making open source more inclusive

Red Hat is committed to replacing problematic language in our code, documentation, and web properties. We are beginning with these four terms: master, slave, blacklist, and whitelist. Because of the enormity of this endeavor, these changes will be implemented gradually over several upcoming releases. For more details, see link:https://www.redhat.com/en/blog/making-open-source-more-inclusive-eradicating-problematic-language[Red Hat CTO Chris Wrightâ€™s message].

[id="ocp-4-8-new-features-and-enhancements"]
== New features and enhancements

This release adds improvements related to the following components and concepts.

[id="ocp-4-8-rhcos"]
=== {op-system-first}

[id="ocp-4-8-rhcos-butane"]
==== Butane config transpiler simplifies creation of machine configs

{product-title} now includes the Butane config transpiler to assist with producing and validating machine configs. Documentation now recommends using Butane to create machine configs for LUKS disk encryption, boot disk mirroring, and custom kernel modules.

[id="ocp-4-8-rhcos-chrony-default"]
==== Change to custom `chrony.conf` default on cloud platforms

If a cloud administrator has already set a custom `/etc/chrony.conf` configuration, {op-system} no longer sets the `PEERNTP=no` option by default on cloud platforms. Otherwise, the `PEERNTP=no` option is still set by default. See link:https://bugzilla.redhat.com/show_bug.cgi?id=1924869[BZ#1924869] for more information.

[id="ocp-4-8-installation-and-upgrade"]
=== Installation and upgrade

[id="ocp-4-8-installation-azure-empty-rg"]
==== Installing a cluster to an existing, empty resource group on Azure

You can now define an already existing resource group to install your cluster to on Azure by defining the `platform.azure.resourceGroupName` field in the `install-config.yaml` file. This resource group must be empty and only used for a single cluster; the cluster components assume ownership of all resources in the resource group.

If you limit the service principal scope of the installation program to this resource group, you must ensure all other resources used by the installation program in your environment have the necessary permissions, such as the public DNS zone and virtual network. Destroying the cluster using the installation program deletes the user-defined resource group.

[id="ocp-4-8-installation-existing-iam-roles-aws"]
==== Using existing IAM roles for clusters on AWS

You can now define a pre-existing Amazon Web Services (AWS) IAM role for your machine instance profiles by setting the `compute.platform.aws.iamRole` and `controlPlane.platform.aws.iamRole` fields in the `install-config.yaml` file. This allows you to do the following for your IAM roles:

* Match naming schemes
* Include predefined permissions boundaries

[id="ocp-4-8-installation-pre-existing-hosted-zones-aws"]
==== Using pre-existing Route53 hosted private zones on AWS

You can now define an existing Route 53 private hosted zone for your cluster by setting the `platform.aws.hostedZone` field in the `install-config.yaml` file. You can only use a pre-existing hosted zone when also supplying your own VPC.

[id="ocp-4-8-installation-increase-gcp-subnets-within-machine-cidr"]
==== Increasing the size of GCP subnets within the machine CIDR

The {product-title} installation program for Google Cloud Platform (GCP) now creates subnets as large as possible within the machine CIDR. This allows the cluster to use a machine CIDR appropriately sized to accommodate the number of nodes in the cluster.

[id="ocp-4-8-web-console"]
=== Web console

[id="ocp-4-8-custom-console-routes-use-custom-domains-cluster-api"]
==== Custom console routes now use the new CustomDomains cluster API

For `console` and `downloads` routes, custom routes functionality is now implemented to use the new `ingress` config route configuration API `spec.componentRoutes`. The Console Operator config already contained custom route customization, but for the `console` route only. The route configuration via `console-operator` config is being deprecated. Therefore, if the `console` custom route is set up in both the `ingress` config and `console-operator` config, then the new `ingress` config custom route configuration takes precedent.

[id="ocp-4-8-access-code-snippet-from-quick-start"]
==== Access a code snippet from a Quick Start

You can now execute a CLI snippet when it is included in a Quick Start from the web console. To use this feature, you must first install the Web Terminal Operator. The web terminal and code snippet actions that execute in the web terminal are not present if you do not install the Web Terminal Operator. Alternatively, you can copy a code snippet to the clipboard regardless of whether you have the Web Terminal Operator installed or not.

[id="ocp-4-8-improved-presentation-quick-start-prereqs"]
==== Improved presentation of Quick Start prerequisites

Previously, Quick Start prerequisites were displayed as combined text instead of a list on the Quick Start card. With scalability in mind, the prerequisites are now presented in a popover rather than on the card.

image::quick-start-prerequisites.png[Quick Start prerequisites displayed as popover,338,336]

[id="ocp-4-8-security"]
=== Security and compliance

[id="ocp-4-8-security-log-oauth-tokens"]
==== Audit logging for OAuth access token logout requests

The `Default` audit log policy now logs request bodies for OAuth access token creation (login) and deletion (logout) requests. Previously, deletion request bodies were not logged.

For more information about audit log policies, see xref:../security/audit-log-policy-config.adoc#audit-log-policy-config[Configuring the node audit log policy].

[id="ocp-4-8-security-wildcard-subjects-headless-services"]
==== Wildcard subject for service serving certificates for headless services

Generating a service serving certificate for headless services now includes a wildcard subject in the format of `*.<service.name>.<service.namespace>.svc`. This allows for TLS-protected connections to individual stateful set pods without having to manually generate certificates for these pods.

[IMPORTANT]
====
Because the generated certificates contain wildcard subjects for headless services, do not use the service CA if your client must differentiate between individual pods. In this case:

* Generate individual TLS certificates by using a different CA.
* Do not accept the service CA as a trusted CA for connections that are directed to individual pods and must not be impersonated by other pods. These connections must be configured to trust the CA that was used to generate the individual TLS certificates.
====

For more information, see xref:../security/certificates/service-serving-certificate.adoc#add-service-certificate_service-serving-certificate[Add a service certificate].

[id="ocp-4-8-networking"]
=== Networking

[id="ocp-4-8-migrate-openshift-sdn-ovn-kubernetes-user-provisioned"]
==== Migrate from OpenShift SDN to OVN-Kubernetes on user-provisioned infrastructure

An OpenShift SDN cluster network provider migration to the OVN-Kubernetes cluster network provider is supported for user-provisioned clusters. For more information, see xref:../networking/ovn_kubernetes_network_provider/migrate-from-openshift-sdn.adoc#nw-ovn-kubernetes-migration-about_migrate-from-openshift-sdn[Migrate from the OpenShift SDN cluster network provider].

[id="ocp-4-8-openshift-sdn-egress-ips-balance"]
==== OpenShift SDN cluster network provider egress IP feature balances across nodes

The egress IP feature of OpenShift SDN now balances network traffic roughly equally across nodes for a given namespace, if that namespace is assigned multiple egress IP addresses. Each IP address must reside on a different node.
For more information, refer to xref:../networking/openshift_sdn/assigning-egress-ips.adoc#assigning-egress-ips[Configuring egress IPs for a project] for OpenShift SDN.

[id="ocp-4-8-supported-hardware-sriov"]
==== Supported hardware for SR-IOV

{product-title} {product-version} adds support for additional Intel and Mellanox hardware.

* Intel X710 and XL710 controllers
* Four Intel E810 family controllers: E810-CQDA2, E810-2CQDA2, E810-XXVDA2, E810-XXVDA4
* Mellanox ConnectX-5 Ex

For more information, see the xref:../networking/hardware_networks/about-sriov.adoc#supported-devices_about-sriov[supported devices].

[id="ocp-4-8-enhancements-sriov-network-operator"]
==== Enhancements to the SR-IOV Network Operator

The Network Resources Injector that is deployed with the Operator is enhanced to expose information about huge pages requests and limits with the Downward API. When a pod specification includes a huge pages request or limit, the information is exposed in the `/etc/podnetinfo` path.

For more information, see xref:../networking/hardware_networks/about-sriov.adoc#nw-sriov-hugepages_about-sriov[Huge pages resource injection for Downward API].

[id="ocp-4-8-tracking-network-flows"]
==== Tracking network flows

{product-title} {product-version} adds support for sending the metadata about network flows on the pod network to a network flows collector. The following protocols are supported:

* NetFlow

* sFlow

* IPFIX

Packet data is not sent to the network flows collector. Packet-level metadata such as the protocol, source address, destination address, port numbers, number of bytes, and other packet-level information is sent to the network flows collector.

For more information, see xref:../networking/ovn_kubernetes_network_provider/tracking-network-flows.adoc#tracking-network-flows[Tracking network flows].

[id="ocp-4-8-coredns-mdns"]
==== CoreDNS-mDNS no longer used to resolve node names to IP addresses

{product-title} 4.8 and later releases include functionality that uses cluster membership information to generate A/AAAA records. This resolves the node names to their IP addresses. Once the nodes are registered with the API, the cluster can disperse node information without using CoreDNS-mDNS. This eliminates the network traffic associated with multicast DNS.

[id="ocp-4-8-preparation-haproxy-2.2"]
==== Converting HTTP header names to support upgrading to {product-title} 4.8

{product-title} updated to HAProxy 2.2, which changes HTTP header names to lowercase by default, for example, changing `Host: xyz.com` to `host: xyz.com`. For legacy applications that are sensitive to the capitalization of HTTP header names, use the Ingress Controller `spec.httpHeaders.headerNameCaseAdjustments` API field to accommodate legacy applications until they can be fixed. Make sure to add the necessary configuration by using `spec.httpHeaders.headerNameCaseAdjustments` before upgrading {product-title} now that HAProxy 2.2 is available.

For more information, see xref:../networking/ingress-operator.adoc#nw-ingress-converting-http-header-case_configuring-ingress[Converting HTTP header case].


[id="ocp-4-8-ingress-configuring-global-access-gcp"]
==== Configuring global access for an Ingress Controller on GCP

{product-title} {product-version} adds support for the global access option for Ingress Controllers created on GCP with an internal load balancer. When the global access option is enabled, clients in any region within the same VPC network and compute region as the load balancer can reach the workloads running on your cluster.

For more information, see xref:../networking/ingress-operator.adoc#nw-ingress-controller-configuration-gcp-global-access_configuring-ingress[Configuring global access for an Ingress Controller on GCP].

[id="ocp-4-8-setting-ingress-configuring-thread-count"]
==== Setting Ingress Controller thread count

{product-title} 4.8 adds support for setting the thread count to increase the amount of incoming connections a cluster can handle.

For more information, see xref:../networking/ingress-operator.adoc#nw-ingress-setting-thread-count_configuring-ingress[Setting Ingress Controller thread count].

[id="ocp-4-8-ingress-configuring-proxy-protocol"]
==== Configuring the PROXY protocol for an Ingress Controller

{product-title} 4.8 adds support for configuring the PROXY protocol for the Ingress Controller on non-cloud platforms, specifically for `HostNetwork` or `NodePortService` endpoint publishing strategy types.

For more information, see xref:../networking/ingress-operator.adoc#nw-ingress-controller-configuration-proxy-protocol_configuring-ingress[Configuring PROXY protocol for an Ingress Controller].

[id="ocp-4-8-networking-ntp-on-control-plane"]
==== NTP servers on control plane nodes

In {product-title} {product-version}, installer-provisioned clusters can configure and deploy Network Time Protocol (NTP) servers on the control plane nodes and NTP clients on worker nodes. This enables workers to retrieve the date and time from the NTP servers on the control plane nodes, even when disconnected from a routable network. You can also configure and deploy NTP servers and NTP clients after deployment.

[id="ocp-4-8-enhancements-kuryr-kubernetes"]
==== Changes to default API load balancer management for Kuryr

In {product-title} 4.8 deployments on {rh-openstack-first} with Kuryr-Kubernetes, the API load balancer for the `default/kubernetes` service is no longer managed by the Cluster Network Operator (CNO), but instead by the kuryr-controller itself. This means that:

* When upgrading to {product-title} 4.8, the `default/kubernetes` service will have downtime.
+
[NOTE]
====
In deployments where no Open Virtual Network (OVN) Octavia is available, more downtime should be expected
====

* The `default/kubernetes` load balancer is no longer required to use the Octavia Amphora driver. Instead, OVN Octavia will be used to implement the `default/kubernetes` service if it is available in the OpenStack cloud.

[id="ocp-4-8-storage"]
=== Storage


[id="ocp-4-8-registry"]
=== Registry


[id="ocp-4-8-olm"]
=== Operator lifecycle

[id="ocp-4-8-admin-error-reporting"]
==== Enhanced error reporting for administrators

A cluster administrator using Operator Lifecycle Manager (OLM) to install an Operator can encounter error conditions that are related either to the current API or low-level APIs. Previously, there was little insight into why OLM could not fulfill a request to install or update an Operator. These errors could range from trivial issues like typos in object properties or missing RBAC, to more complex issues where items could not be loaded from the catalog due to metadata parsing.

Because administrators should not require understanding of the interaction process between the various low-level APIs or access to the OLM pod logs to successfully debug such issues, {product-title} 4.8 introduces the following enhancements in OLM to provide administrators with more comprehensible error reporting and messages:

[id="ocp-4-8-installplan-errors"]
Retrying install plans::
Install plans, defined by an `InstallPlan` object, can encounter transient errors, for example, due to API server availability or conflicts with other writers. Previously, these errors would result in the termination of partially-applied install plans that required manual cleanup. With this enhancement, the Catalog Operator now retries errors during install plan execution for up to one minute. The new `.status.message` field provides a human-readable indication when retries are occurring.

[id="ocp-4-8-operatorgroup-errors"]
Indicating invalid Operator groups::
Creating a subscription in a namespace with no Operator groups or multiple Operator groups would previously result in a stalled Operator installation with an install plan that stays in `phase=Installing` forever. With this enhancement, the install plan immediately transitions to `phase=Failed` so that the administrator can correct the invalid Operator group, and then delete and re-create the subscription again.

[id="ocp-4-8-candidate-operator-errors"]
Specific reporting when no candidate Operators found::
`ResolutionFailed` events, which are created when dependency resolution in a namespace fails, now provide more specific text when the namespace contains a subscription that references a package or channel that does not exist in the referenced catalog source. Previously, this message was generic:
+
[source,terminal]
----
no candidate operators found matching the spec of subscription '<name>'
----
+
With this enhancement, the messages are more specific:
+
.Operator does not exist
[source,terminal]
----
no operators found in package <name> in the catalog referenced by subscription <name>
----
+
.Catalog does not exist
[source,terminal]
----
no operators found from catalog <name> in namespace openshift-marketplace referenced by subscription <name>
----
+
.Channel does not exist
[source,terminal]
----
no operators found in channel <name> of package <name> in the catalog referenced by subscription <name>
----
+
.Cluster service version (CSV) does not exist
[source,terminal]
----
no operators found with name <name>.<version> in channel <name> of package <name> in the catalog referenced by subscription <name>
----

[id="ocp-4-8-osdk"]
=== Operator development

[id="ocp-4-8-pkgman-to-bundle"]
==== Migration of Operator projects from package manifest format to bundle format

The bundle format is the preferred Operator packaging format for Operator Lifecycle Manager (OLM) starting in {product-title} 4.6. If you have an Operator project that was initially created in the package manifest format, which has been deprecated, you can now use the Operator SDK `pkgman-to-bundle` command to migrate the project to the bundle format.

For more information, see xref:../operators/operator_sdk/osdk-pkgman-to-bundle.adoc#osdk-pkgman-to-bundle[Migrating package manifest projects to bundle format].

[id="ocp-4-8-images"]
=== Images


[id="ocp-4-8-machine-api"]
=== Machine API

[id="ocp-4-8-vsphere-machine-autoscaler-to-from-zero"]
==== Scaling machines running in vSphere to and from zero with the cluster autoscaler

When running machines in vSphere, you can now set the `minReplicas` value to `0` in the `MachineAutoscaler` resource definition. When this value is set to `0`, the cluster autoscaler scales the machine set to and from zero depending on if the machines are in use. For more information, see the xref:../machine_management/applying-autoscaling.html#machine-autoscaler-cr_applying-autoscaling[MachineAutoscaler resource definition].

[id="ocp-4-8-nodes"]
=== Nodes

[id="ocp-4-8-nodes-descheduler-apigroup"]
==== Descheduler operator.openshift.io/v1 API group is now available

The `operator.openshift.io/v1` API group is now available for the descheduler. Support for the `operator.openshift.io/v1beta1` API group for the descheduler might be removed in a future release.

[id="ocp-4-8-nodes-descheduler-metrics"]
==== Prometheus metrics for the descheduler

You can now enable Prometheus metrics for the descheduler by adding the `openshift.io/cluster-monitoring=true` label to the `openshift-kube-descheduler-operator` namespace where you installed the descheduler.

The following descheduler metrics are available:

* `descheduler_build_info` - Provides build information about the descheduler.
* `descheduler_pods_evicted` - Provides the number of pods that have been evicted for each combination of strategy, namespace, and result. There must be at least one evicted pod for this metric to appear.

[id="ocp-4-8-nodes-huge-pages-downward-api"]
==== Support for huge pages with the Downward API

With this release, when you set requests and limits for huge pages in a pod specification, you can use the Downward API to view the allocation for the pod from within a container. This enhancements relies on the `DownwardAPIHugePages` feature gate. {product-title} {product-version} enables the feature gate.

For more information, see xref:../scalability_and_performance/what-huge-pages-do-and-how-they-are-consumed-by-apps.adoc#consuming-huge-pages-resource-using-the-downward-api_huge-pages[Consuming huge pages resources using the Downward API].

[id='ocp-4-8-nodes-nfd-operator-new-labels_{context}']
==== New labels for the Node Feature Discovery Operator

The Node Feature Discovery (NFD) Operator detects hardware features available on each node in an {product-title} cluster. Then, it modifies node objects with node labels. This enables the NFD Operator to advertise the features of specific nodes. {product-title} {product-version} supports three additional labels for the NFD Operator.

- `pstate intel-pstate`: When the Intel `pstate` driver is enabled and in use, the `pstate intel-pstate` label reflects the status of the Intel `pstate` driver. The status is either `active` or `passive`.

- `pstate scaling_governor`: When the Intel `pstate` driver status is `active`, the `pstate scaling_governor` label reflects the scaling governor algorithm. The algorithm is either `powersave` or `performance`.

- `cstate status`: If the `intel_idle` driver has C-states or idle states, the `cstate status` label is `true`. Otherwise, it is `false`.

[id="ocp-4-8-logging"]
=== Cluster logging


[id="ocp-4-8-monitoring"]
=== Monitoring

[id="ocp-4-8-monitoring-removed-API-alerts"]
==== Alerts and information on APIs in use that will be removed in the next release

{product-title} 4.8 introduces two new alerts that fire when an API that will be removed in the next release is in use:

* `APIRemovedInNextReleaseInUse` - for APIs that will be removed in the next {product-title} release.
* `APIRemovedInNextEUSReleaseInUse` - for APIs that will be removed in the next {product-title} link:https://access.redhat.com/support/policy/updates/openshift#ocp4_phases[Extended Update Support] (EUS) release.

You can use the new `APIRequestCount` API to track what is using the deprecated APIs. This allows you to plan whether any actions are required in order to upgrade to the next release.

[id="ocp-4-8-metering"]
=== Metering
The Metering Operator is deprecated as of {product-title} 4.6, and is scheduled to be removed in {product-title} 4.9.

[id="ocp-4-8-scale"]
=== Scale

[id="ocp-4-8-reducing-nic-queues-using-the-performance-addon-operator"]
==== Reducing NIC using the Performance Addon Operator

The Performance Addon Operator allows you to adjust the Network Interface Card (NIC) queue count for each network device by configuring the performance profile. Device network queues allow packets to be distributed among different physical queues, and each queue gets a separate thread for packet processing.

For Data Plane Development Kit (DPDK) based workloads, it is important to reduce the NIC queues to only the number of reserved or housekeeping CPUs to ensure the desired low latency is achieved.

For more information, see xref:../scalability_and_performance/cnf-performance-addon-operator-for-low-latency-nodes.adoc#reducing-nic-queues-using-the-performance-addon-operator_cnf-master[Reducing NIC queues using the Performance Addon Operator].

[id="ocp-4-8-scale-cluster-maximums"]
==== Cluster maximums

Updated guidance around xref:../scalability_and_performance/planning-your-environment-according-to-object-maximums.adoc#planning-your-environment-according-to-object-maximums[cluster maximums] for {product-title} {product-version} is now available.

[IMPORTANT]
====
No large scale testing for performance against OVN-Kubernetes testing was executed for this release.
====

Use the link:https://access.redhat.com/labs/ocplimitscalculator/[{product-title} Limit Calculator] to estimate cluster limits for your environment.

[id="ocp-4-8-performance-creator-tool"]
==== Creating a performance profile
You can now create a performance profile using the Performance Profile Creator (PPC) tool. The tool consumes `must-gather` data from the cluster and several user-supplied profile arguments, and using this information it generates a performance profile that is appropriate for your hardware and topology.

For more information, see xref:../scalability_and_performance/cnf-create-performance-profiles.adoc#cnf-create-performance-profiles[Creating a Performance Profile].

[id="ocp-4-8-nfd-operator"]
==== Node Feature Discovery Operator

The xref:../scalability_and_performance/psap-node-feature-discovery-operator.adoc#node-feature-discovery-operator[Node Feature Discovery (NFD) Operator] is now available. Use it to expose node-level information by orchestrating Node Feature Discovery, a Kubernetes add-on for detecting hardware features and system configuration.

[id="ocp-4-8-dev-exp"]
=== Developer experience

[id="ocp-4-8-auth"]
=== Authentication and authorization

[id="ocp-4-8-auth-tp-aws-sts"]
==== Running {product-title} using AWS Security Token Service (STS) for credentials is generally available

You can now use the Cloud Credential Operator (CCO) utility (`ccoctl`) to configure the CCO to use the Amazon Web Services Security Token Service (AWS STS). When the CCO is configured to use STS, it assigns IAM roles that provide short-term, limited-privilege security credentials to components.

This feature was previously introduced as a Technology Preview feature in {product-title} 4.7, and is now generally available in {product-title} 4.8.

For more information, see xref:../authentication/managing_cloud_provider_credentials/cco-mode-sts.adoc#cco-mode-sts[Using manual mode with STS].

[id="ocp-4-8-notable-technical-changes"]
== Notable technical changes

{product-title} 4.8 introduces the following notable technical changes.

[discrete]
[id="ocp-4-8-oauth-tokens"]
==== OAuth tokens without a SHA-256 prefix can no longer be used

Prior to {product-title} 4.6, OAuth access and authorize tokens used secret information for the object names.

Starting with {product-title} 4.6, OAuth access token and authorize token object names are stored as non-sensitive object names, with a SHA-256 prefix. OAuth tokens that do not contain a SHA-256 prefix can no longer be used or created in {product-title} 4.8.

[discrete]
[id="ocp-4-8-moderate-profiles"]
==== The Federal Risk and Authorization Management Program (FedRAMP) moderate controls

In {product-title} 4.8, the `rhcos4-moderate` profile is now complete. The `ocp4-moderate` profile will be completed in a future release.

[discrete]
[id="ocp-4-8-haproxy-2.2.13-upgrade"]
==== Ingress Controller upgraded to HAProxy 2.2.13

The {product-title} Ingress Controller is upgraded to HAProxy version 2.2.13.

[discrete]
[id="ocp-4-8-coreDNS-version-update"]
==== CoreDNS update to version 1.8.1

In {product-title} 4.8, CoreDNS uses version 1.8.1, which has several bug fixes, renamed metrics, and dual-stack IPv6 enablement.

[id="ocp-4-8-deprecated-removed-features"]
== Deprecated and removed features

Some features available in previous releases have been deprecated or removed.

Deprecated functionality is still included in {product-title} and continues to be supported; however, it will be removed in a future release of this product and is not recommended for new deployments. For the most recent list of major functionality deprecated and removed within {product-title} {product-version}, refer to the table below. Additional details for more fine-grained functionality that has been deprecated and removed are listed after the table.

In the table, features are marked with the following statuses:

* *GA*: _General Availability_
* *DEP*: _Deprecated_
* *REM*: _Removed_

//TODO: remove anything that has been REM since 4.6

.Deprecated and removed features tracker
[cols="3,1,1,1",options="header"]
|====
|Feature |OCP 4.6 |OCP 4.7 |OCP 4.8

|`OperatorSource` objects
|REM
|REM
|REM

|Package manifest format (Operator Framework)
|DEP
|DEP
|DEP

|`oc adm catalog build`
|DEP
|DEP
|DEP

|`--filter-by-os` flag for `oc adm catalog mirror`
|GA
|DEP
|DEP

|v1beta1 CRDs
|DEP
|DEP
|

|Docker Registry v1 API
|DEP
|DEP
|

|Metering Operator
|DEP
|DEP
|DEP

|Scheduler policy
|GA
|DEP
|DEP

|`ImageChangesInProgress` condition for Cluster Samples Operator
|GA
|DEP
|

|`MigrationInProgress` condition for Cluster Samples Operator
|GA
|DEP
|

|Use of `v1` in `apiVersion` for {product-title} resources
|GA
|DEP
|

|Use of `dhclient` in {op-system-first}
|DEP
|DEP
|DEP

|Cluster Loader
|GA
|GA
|DEP

|====

[id="ocp-4-8-deprecated-features"]
=== Deprecated features

[id="ocp-4-8-descheduler-apigroup-deprecated"]
==== Descheduler operator.openshift.io/v1beta1 API group is deprecated

The `operator.openshift.io/v1beta1` API group for the descheduler is deprecated and might be removed in a future release. Use the `operator.openshift.io/v1` API group instead.

[id="ocp-4-8-dhclient-deprecated"]
==== Use of dhclient in {op-system-first} is deprecated

Starting with {product-title} 4.6, {op-system-first} switched to using `NetworkManager` in the `initramfs` to configure networking during early boot. As part of this change, the use of the `dhclient` binary for DHCP was deprecated. Use the `NetworkManager` internal DHCP client for networking configuration instead. The `dhclient` binary will be removed from {op-system-first} in a future release. See link:https://bugzilla.redhat.com/show_bug.cgi?id=1908462[BZ#1908462] for more information.

[id="ocp-4-8-cluster-loader-deprecated"]
==== Cluster Loader is deprecated

Cluster Loader is now deprecated and will be removed in a future release.

[id="ocp-4-8-pkgman-cmds"]
==== Operator SDK package manifest format commands

As part of the continued deprecation of the Operator package manifest format, the following commands have been removed from the Operator SDK CLI:

* `generate packagemanifest`
* `run packagemanifest`

[id="ocp-4-8-removed-features"]
=== Removed features

[id="ocp-4-8-images-removed-from-samples-imagestreams"]
==== Images removed from samples imagestreams

The following images are no longer included in the samples imagestreams provided with {product-title}:

----
registry.redhat.io/rhscl/nodejs-10-rhel7
registry.redhat.io/ubi7/nodejs-10
registry.redhat.io/rhscl/perl-526-rhel7
registry.redhat.io/rhscl/postgresql-10-rhel7
registry.redhat.io/rhscl/ruby-25-rhel7
registry.redhat.io/ubi7/ruby-25
registry.redhat.io/rhdm-7/rhdm-decisioncentral-rhel8:7.9.0
registry.redhat.io/rhdm-7/rhdm-kieserver-rhel8:7.9.0
registry.redhat.io/rhpam-7/rhpam-businesscentral-monitoring-rhel8:7.9.0
registry.redhat.io/rhpam-7/rhpam-businesscentral-rhel8:7.9.0
registry.redhat.io/rhpam-7/rhpam-smartrouter-rhel8:7.9.0
----

[id="ocp-4-8-bug-fixes"]
== Bug fixes

[id="ocp-4-8-technology-preview"]
== Technology Preview features

Some features in this release are currently in Technology Preview. These experimental features are not intended for production use. Note the following scope of support on the Red Hat Customer Portal for these features:

link:https://access.redhat.com/support/offerings/techpreview[Technology Preview Features Support Scope]

In the table below, features are marked with the following statuses:

* *TP*: _Technology Preview_
* *GA*: _General Availability_
* *-*: _Not Available_

//TODO: remove anything that has been GA since 4.6

.Technology Preview tracker
[cols="4,1,1,1",options="header"]
|====
|Feature |OCP 4.6 |OCP 4.7 |OCP 4.8

|Precision Time Protocol (PTP)
|TP
|TP
|

|`oc` CLI Plug-ins
|TP
|TP
|

|Descheduler
|TP
|GA
|GA

|OVN-Kubernetes Pod network provider
|GA
|GA
|

|HPA custom metrics adapter based on Prometheus
|TP
|TP
|

|HPA for memory utilization
|TP
|GA
|

|Service Binding
|TP
|GA
|

|Log forwarding
|GA
|GA
|

|Monitoring for user-defined projects
|GA
|GA
|

|Raw Block with Cinder
|TP
|TP
|

|External provisioner for AWS EFS
|TP
|TP
|

|CSI volume snapshots
|TP
|GA
|

|CSI volume cloning
|GA
|GA
|

|CSI volume expansion
|TP
|TP
|

|vSphere Problem Detector Operator
|-
|GA
|

|CSI GCP PD Driver Operator
|-
|TP
|

|CSI OpenStack Cinder Driver Operator
|-
|TP
|

|CSI AWS EBS Driver Operator
|TP
|TP
|

|Red Hat Virtualization (oVirt) CSI Driver Operator
|GA
|GA
|

|CSI inline ephemeral volumes
|TP
|TP
|

|Automatic device discovery and provisioning with Local Storage Operator
|TP
|TP
|

|OpenShift Pipelines
|TP
|TP
|

|OpenShift GitOps
|TP
|TP
|

|Vertical Pod Autoscaler
|TP
|TP
|

|Operator API
|GA
|GA
|

|Adding kernel modules to nodes
|TP
|TP
|

|Egress router CNI plug-in
|-
|TP
|

|Scheduler profiles
|-
|TP
|TP

|Non-preempting priority classes
|-
|TP
|TP

|Kubernetes NMState Operator
|-
|TP
|

|Assisted Installer
|-
|TP
|

|AWS Security Token Service (STS)
|-
|TP
|GA

|====

[id="ocp-4-8-known-issues"]
== Known issues

// TODO: This known issue should carry forward to 4.8 and beyond!
* In {product-title} 4.1, anonymous users could access discovery endpoints. Later releases revoked this access to reduce the possible attack surface for security exploits because some discovery endpoints are forwarded to aggregated API servers. However, unauthenticated access is preserved in upgraded clusters so that existing use cases are not broken.
+
If you are a cluster administrator for a cluster that has been upgraded from {product-title} 4.1 to 4.8, you can either revoke or continue to allow unauthenticated access. It is recommended to revoke unauthenticated access unless there is a specific need for it. If you do continue to allow unauthenticated access, be aware of the increased risks.
+
[WARNING]
====
If you have applications that rely on unauthenticated access, they might receive HTTP `403` errors if you revoke unauthenticated access.
====
+
Use the following script to revoke unauthenticated access to discovery endpoints:
+
[source,bash]
----
## Snippet to remove unauthenticated group from all the cluster role bindings
$ for clusterrolebinding in cluster-status-binding discovery system:basic-user system:discovery system:openshift:discovery ;
do
### Find the index of unauthenticated group in list of subjects
index=$(oc get clusterrolebinding ${clusterrolebinding} -o json | jq 'select(.subjects!=null) | .subjects | map(.name=="system:unauthenticated") | index(true)');
### Remove the element at index from subjects array
oc patch clusterrolebinding ${clusterrolebinding} --type=json --patch "[{'op': 'remove','path': '/subjects/$index'}]";
done
----
+
This script removes unauthenticated subjects from the following cluster role bindings:
+
--
** `cluster-status-binding`
** `discovery`
** `system:basic-user`
** `system:discovery`
** `system:openshift:discovery`
--
+
(link:https://bugzilla.redhat.com/show_bug.cgi?id=1821771[*BZ#1821771*])

// TODO: This known issue should carry forward to 4.9 and beyond!
* The `oc annotate` command does not work for LDAP group names that contain an equal sign (`=`), because the command uses the equal sign as a delimiter between the annotation name and value. As a workaround, use `oc patch` or `oc edit` to add the annotation. (link:https://bugzilla.redhat.com/show_bug.cgi?id=1917280[*BZ#1917280*])

* When powering on a virtual machine on vSphere with user-provisioned infrastructure, the process of scaling up a node might not work as expected. A known issue in the hypervisor configuration causes machines to be created within the hypervisor but not powered on. If a node appears to be stuck in the `Provisioning` state after scaling up a machine set, you can investigate the status of the virtual machine in the vSphere instance itself. Use the VMware commands `govc tasks` and `govc events` to determine the status of the virtual machine. Check for a similar error message to the following:
+
[source,terminal]
----
[Invalid memory setting: memory reservation (sched.mem.min) should be equal to memsize(8192). ]
----
+
You can attempt to resolve the issue with the steps in this link:https://kb.vmware.com/s/article/2002779[VMware KBase article]. For more information, see the Red Hat Knowledgebase solution link:https://access.redhat.com/solutions/5785341[[UPI vSphere\] Node scale-up doesn't work as expected]. (link:https://bugzilla.redhat.com/show_bug.cgi?id=1918383[*BZ#1918383*])

* The OVN-Kubernetes network provider does not support the `externalTrafficPolicy` feature for `NodePort`- and `LoadBalancer`-type services.  The `service.spec.externalTrafficPolicy` field determines whether traffic for a service is routed to node-local or cluster-wide endpoints. Currently, such traffic is routed by default to cluster-wide endpoints, and there is no way to limit traffic to node-local endpoints. This will be resolved in a future release. (link:https://bugzilla.redhat.com/show_bug.cgi?id=1903408[*BZ#1903408*])

[id="ocp-4-8-asynchronous-errata-updates"]
== Asynchronous errata updates

Security, bug fix, and enhancement updates for {product-title} 4.8 are released as asynchronous errata through the Red Hat Network. All {product-title} 4.8 errata is https://access.redhat.com/downloads/content/290/[available on the Red Hat Customer Portal]. See the https://access.redhat.com/support/policy/updates/openshift[{product-title} Life Cycle] for more information about asynchronous errata.

Red Hat Customer Portal users can enable errata notifications in the account settings for Red Hat Subscription Management (RHSM). When errata notifications are enabled, users are notified via email whenever new errata relevant to their registered systems are released.

[NOTE]
====
Red Hat Customer Portal user accounts must have systems registered and consuming {product-title} entitlements for {product-title} errata notification emails to generate.
====

This section will continue to be updated over time to provide notes on enhancements and bug fixes for future asynchronous errata releases of {product-title} 4.8. Versioned asynchronous releases, for example with the form {product-title} 4.8.z, will be detailed in subsections. In addition, releases in which the errata text cannot fit in the space provided by the advisory will be detailed in subsections that follow.

[IMPORTANT]
====
For any {product-title} release, always review the instructions on xref:../updating/updating-cluster.adoc#updating-cluster[updating your cluster] properly.
====

[id="ocp-4-8-0-ga"]
=== RHBA-2021:1234 - {product-title} 4.8.0 image release, bug fix, and security update advisory

Issued: 2021-xx-xx

{product-title} release 4.8.0, which includes security updates, is now available. The list of bug fixes that are included in the update is documented in the link:https://access.redhat.com/errata/RHBA-2021:1234[RHBA-2021:1234] advisory. The RPM packages that are included in the update are provided by the link:https://access.redhat.com/errata/RHBA-2021:5678[RHBA-2021:5678] advisory.

Space precluded documenting all of the container images for this release in the advisory. See the following article for notes on the container images in this release:

link:https://access.redhat.com/solutions/<ARTICLE_ID>[{product-title} 4.8.0 container image list]
