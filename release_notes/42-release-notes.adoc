:_content-type: ASSEMBLY
[id="release-notes-42"]
= {product-title} 4.2
include::modules/common-attributes.adoc[]
:context: release-notes-42

toc::[]

{rh-rhacs-first} is an enterprise-ready, Kubernetes-native container security solution that protects your vital applications across the build, deploy, and runtime stages of the application lifecycle.
{product-title} deploys into your infrastructure and integrates with your DevOps tools and workflows. This integration provides better security and compliance, enabling DevOps and InfoSec teams to operationalize security.

.Release dates
[options="header"]
|====

|{product-title-short} version |Released on

|`4.2.0` | 18 September 2023
|`4.2.1` | 3 October 2023

|====

[id="about-this-release_{context}"]
== About this release

{product-title-short} 4.2 includes the following new features, improvements, and updates:

*Platform*

* xref:../release_notes/42-release-notes.adoc#bring-your-own-postgresql-database-for-rhacs-central_release-notes-42[Bring your own PostgreSQL database for {product-title-short} Central (Technology Preview)]
* xref:../release_notes/42-release-notes.adoc#the-core-bpf-collection-method-is-now-ga_release-notes-42[The CORE BPF collection method is now GA]
* xref:../release_notes/42-release-notes.adoc#rhacs-product-usage-report_release-notes-42[{product-title-short} Product usage report]
* xref:../release_notes/42-release-notes.adoc#performance-improvements-for-the-compliance-dashboard_release-notes-42[Performance improvements for the Compliance dashboard]

*Vulnerability management*

* xref:../release_notes/42-release-notes.adoc#vulnerability-scanning-support-for-registry-mirrors-in-ocp_release-notes-42[Vulnerability scanning support for Registry Mirrors in {ocp}]
* xref:../release_notes/42-release-notes.adoc#configure-delegated-image-scanning-in-the-rhacs-portal_release-notes-42[Configure delegated image scanning in the {product-title-short} portal]
* xref:../release_notes/42-release-notes.adoc#define-new-system-policies-using-cve-age-or-fixability_release-notes-42[Define new system policies using CVE age or fixability]
* xref:../release_notes/42-release-notes.adoc#on-demand-and-downloadable-reporting-of-cve-report-in-vm-2.0_release-notes-42[On-demand and downloadable CVE report in Vulnerability Management 2.0]
* xref:../release_notes/42-release-notes.adoc#scanner-supports-additional-operating-systems_release-notes-42[Scanner supports additional operating systems]

*Network Security*

* xref:../release_notes/42-release-notes.adoc#improvements-to-runtime-network-policy-generation_release-notes-42[Improvements to runtime network policy generation]
* xref:../release_notes/42-release-notes.adoc#build-time-network-policy-tools_release-notes-42[Build time Network Policy tools (Technology Preview)]
* xref:../release_notes/42-release-notes.adoc#new-listening-endpoints-menu-in-the-rhacs-portal_release-notes-42[New Listening Endpoints menu in the {product-title-short} portal]
* xref:../release_notes/42-release-notes.adoc#viewing-network-policy-yaml-files-from-a-violation_release-notes-42[Viewing network policy YAML files from a violation]

[id="new-features_{context}"]
== New features

This release adds improvements related to the following components and concepts:

[id="bring-your-own-postgresql-database-for-rhacs-central_{context}"]
=== Bring your own PostgreSQL database for {product-title-short} Central (Technology Preview)

When installing {product-title-short}, instead of creating an exclusive {product-title-short} PostgreSQL database instance, you can use your existing one.

:FeatureName: Bring your own PostgreSQL database
include::snippets/technology-preview.adoc[]

For more information, see xref:../installing/installing_ocp/install-central-ocp.adoc#install-central-operator-tech-preview_install-central-ocp[Installing Central with an external database using the Operator method].

[id="the-core-bpf-collection-method-is-now-ga_{context}"]
=== The CORE BPF collection method is now generally available

The runtime collection method based on BPF CO-RE (Compile Once-Run Everywhere) introduced in {product-title-short} 4.1 is now generally available on `x86_64` and `s390x` architectures. To enable it, set the value of your backed-up cluster's `collector.collectionMethod` parameter to `CORE_BPF`.

[role="_additional-resources"]
.Additional resources
* xref:../cloud_service/installing_cloud_other/install-secured-cluster-cloud-other.adoc#configure-secured-cluster-services-helm-chart-customizations-cloud-other[Configuring the secured-cluster-services Helm chart with customizations]

[id="rhacs-product-usage-report_{context}"]
=== {product-title-short} product usage report

{product-title-short} now provides a product usage report to help estimate {product-title-short} consumption for licensing. It lists the number of secured {ocp} or Kubernetes nodes and the number of CPU units used for secured clusters. To download this report in CSV format, go to the *System Health* dashboard and click *Show product usage*. You can also get the product usage data using the API.

For more information, see xref:../operating/use-system-health-dashboard.adoc#viewing-product-usage_use-system-health-dashboard[Viewing product usage data].


[id="performance-improvements-for-the-compliance-dashboard_{context}"]
=== Performance improvements for the Compliance dashboard

{product-title-short} 4.2 includes significant performance improvements for the Compliance dashboard.

Based on testing with a 50-cluster and 4900-node-environment, these improvement includes:

* *2x* speed improvement in cold start.
* From *7x* to *500x* speed boost in *Request after caching*, with a minor improvement in requests involving large data transfers (`600` KiB).
* Memory utilization on Central has decreased from `10` GiB to just `500` MiB.
* CPU utilization has dropped from `4.5` vCPUs to `0.8` vCPUs.

[id="vulnerability-scanning-support-for-registry-mirrors-in-ocp_{context}"]
=== Vulnerability scanning support for Registry Mirrors in {ocp}

If you have a disconnected environment or use registry mirrors to satisfy your organizational controls on external content, {product-title-short} can now scan images from your registry mirrors in {ocp} environments.

This feature leverages the *delegated image scanning* functionality introduced in {product-title-short} 4.1. The delegated image scanning functionality allows {product-title-short} Secured cluster services to use Sensor to pull images for scanning from registry mirrors you have set up by using the `ImageContentSourcePolicy`, `ImageDigestMirrorSet`, or `ImageTagMirrorSet` custom resources.

For more details, see xref:../operating/examine-images-for-vulnerabilities.adoc#accessing-delegated-image-scanning_examine-images-for-vulnerabilities[Accessing delegated image scanning].

[id="configure-delegated-image-scanning-in-the-rhacs-portal_{context}"]
=== Configure delegated image scanning in the {product-title-short} portal

{product-title-short} 4.1 introduced *Scanning support for images pulled from on-premise registries* to support {product-title-managed-short} environments, allowing you to delegate vulnerability scanning to the {product-title-short} secured cluster services using APIs. With {product-title-short} 4.2, the delegated image scanning feature is now available in {product-title-short}, and you can configure it using the {product-title-short} portal.

For more information, see xref:../operating/examine-images-for-vulnerabilities.adoc#accessing-delegated-image-scanning_examine-images-for-vulnerabilities[Accessing delegated image scanning].

[id="define-new-system-policies-using-cve-age-or-fixability_{context}"]
=== Define new system policies using CVE age or fixability

To support your organization's vulnerability management policies, you can now use the following new vulnerability management policy criteria:

* *CVE Is Fixable*: This criterion results in a violation only if the image in the deployment you are evaluating has a fixable CVE.
* *Days Since CVE Was First Discovered In Image*: This criterion results in a violation only if it has been more than a specified number of days since {product-title-short} discovered the CVE in a specific image.
* *Days Since CVE Was First Discovered In System*: This criterion results in a violation only if it has been more than a specified number of days since {product-title-short} discovered the CVE across all deployed images in all clusters that {product-title-short} monitors.

[id="on-demand-and-downloadable-reporting-of-cve-report-in-vm-2.0_{context}"]
=== On-demand and downloadable CVE report in Vulnerability Management 2.0 (Technology Preview)

{product-title-short} 4.2 introduces workload vulnerability reporting in Vulnerability Management 2.0 (Technology Preview). You can now create on-demand reports and download them in CSV format. Like VM 1.0, you can continue generating scheduled or on-demand reports and sending them by an email notifier. The report includes rich detail for detected CVEs, including Deployment info, Image info, and detailed CVE data such as Fixable Status, Component Upgrade Version, Severity, CVSS score, and more.

:FeatureName: Vulnerability Management 2.0
include::snippets/technology-preview.adoc[]

For more information, see xref:../operating/manage-vulnerabilities/vulnerability-management.adoc#vulnerability-reporting-vuln-mgt2[Vulnerability reporting in Vulnerability Management 2.0].

[id="scanner-supports-additional-operating-systems_{context}"]
=== Scanner supports additional operating systems

{product-title-short} 4.2 can now identify vulnerabilities in images with the following Linux distributions:

* `alpine:v3.18`
* `debian:12`
* `ubuntu:23.04`
* `ubuntu:23.10`

For more information, see xref:../operating/examine-images-for-vulnerabilities.adoc#scanning-images_examine-images-for-vulnerabilities[Scanning Images].

[id="improvements-to-runtime-network-policy-generation_{context}"]
=== Improvements to runtime network policy generation

With this release, you can now generate policies from within the *Network Graph* and narrow down policies that apply to specific deployments and namespaces in a cluster. You can also use the *Filter deployments* section criteria to narrow the generated policies' scope further. After generating network policies, you can compare the generated policies with the existing network policies and view them side-by-side to understand the differences in the YAML files for the policies. You can download the generated policies or share them with system notifiers, such as Slack, that you have previously set up using integrations in {product-title-short}.

[id="build-time-network-policy-tools_{context}"]
=== Build time Network Policy tools (Technology Preview)

:FeatureName: Build time Network Policy tools
include::snippets/technology-preview.adoc[]

Based on user feedback, Red Hat has restructured the command-line syntax and expanded the toolset.
The following three `netpol` tools operate on a given file directory, which includes all of the project's workload manifests, including network policy manifests if available.

These command line tools help teams to shift network security left. With the automated generation of Kubernetes network policies and the supplementary validation tools, Dev and DevOps teams can include network policy development into their Build pipeline, using the {product-title-short} command-line interface, `roxctl`.

[options="header",cols="1m,3"]
|====

|Command | Description

|roxctl netpol generate
|Generates Kubernetes network policies by analyzing your project's YAML manifests in a specified directory.
In older versions, the command was `roxctl generate netpol`. For more information, see Using the build-time network policy generator.For more information, see xref:../cli/generating-build-time-network-policies.adoc#using-the-build-time-network-policy-generator_generating-build-time-network-policies[Using the build-time network policy generator].

|roxctl netpol connectivity map
|Lists the allowed connections between workloads based on the workload and Kubernetes network policy manifest in the specified directory. Results also include a graphical representation in `.dot` format. For more details, see xref:../operating/manage-network-policies.adoc#connectivity-mapping-using-the-roxctl-connectivity-map-command_manage-network-policies[Connectivity mapping using the roxctl connectivity-map command].

|roxctl netpol connectivity diff
|Lists the differences in allowed connections between two project versions based on the workload and Kubernetes network policy manifest in each version directory. This feature shows the semantic differences which are not noticeable when performing a source code syntactic `diff`.
For more details, see xref:../operating/manage-network-policies.adoc#identifying-the-differences-in-allowed-connections-between-project-versions_manage-network-policies[Identifying the differences in allowed connections between project versions].

|====

Currently, you can use these tools without authenticating with {product-title-short}. Red Hat plans to include more advanced features when you authenticate with {product-title-short} in a future release.

[id="new-listening-endpoints-menu-in-the-rhacs-portal_{context}"]
=== New Listening Endpoints menu in the {product-title-short} portal

{product-title-short} provides information about processes listening on ports for all deployments in a secured cluster. Until now, this information was only accessible through the API. In {product-title-short} 4.2, you can see detailed information about which processes are listening on what ports using the {product-title-short} portal. It includes details about the process, port, pod, and container, and you can sort and filter the list using *Deployment*, *Namespace*, or *Cluster* criteria.

For more information, see xref:../operating/audit-listening-endpoints.adoc[Auditing listening endpoints].


[id="viewing-network-policy-yaml-files-from-a-violation_{context}"]
=== Viewing network policy YAML files from a violation

In the {product-title-short} portal, the *Deployment* tab shows a new *Network policies* section when viewing violations for a specific policy. If the namespace to which the deployment belongs has network policies listed, you can click on a listed policy to view or download the entire YAML file for that network policy.

[id="notable-technical-changes_{context}"]
== Notable technical changes

* {product-title-short} now includes `ALL` as a valid value for drop capabilities. The policy implementation has been changed so that if the policy criteria specifies that a deployment must drop a capability, for example, `A or B`, and a deployment manifest contains `DROP ALL`, it does not violate the policy.
* In {product-title-short} 4.2, the `SecuredCluster` custom resource definition (CRD) includes a new parameter called `spec.admissionControl.replicas` to configure the number of replicas for the admission controller. The default value for this parameter is `3`.
* You do not need to set `ForceRollbackVersion` for rolling back from future {product-title-short} 4.x releases to version 4.2 or later.
* Authentication is now mandatory for certain endpoints that were previously public. Specifically, `/v1/metadata`, `/v1/database/status`, and `/v1/mitreattackvectors` now require authentication. This change decreases the potential exposure to denial of service (DoS) attacks and blocks attackers from exploiting the information accessible through these endpoints.
* Non-autogenerated image integrations no longer use the `/v2/_catalog` registry repository list during matching. Additionally, to turn off repository list matching for autogenerated integrations, set the new environment variable `ROX_DISABLE_REGISTRY_REPO_LIST` to `true` on Central.
* The *Component Upgrade* column in vulnerability reports is renamed to *CVE Fixed In*.
* Previously, access to the `/api/docs/swagger` API required read permission for the *Integration* resource. Now, it only requires users to be authenticated to access it.
* Scanner now selects the image for scanning based on its architecture alignment with the Scanner's architecture, rather than consistently choosing `amd64` for multi-arch image scanning.
** For example, if Scanner runs on `s390x` and an `s390x` version of the multi-arch image exists, it scans that `s390x` image.
** If no image matches Scanner's architecture, then it attempts to scan the `amd64` version, as it did previously.
* Telemetry data collection is enabled by default, except for installations with the offline mode enabled. To disable telemetry, see xref:../telemetry/opting-out-of-telemetry.adoc#opting-out-of-telemetry[Opting out of Telemetry].
* Integration with {ocp} monitoring is configured and enabled by default for {product-title-short} installations on OpenShift 4. To deactivate this integration, set the flag `monitoring.openshift.enabled` to `false`.
* Go executable in the following images available at `registry.redhat.io/advanced-cluster-security` are dynamically linked and compiled with the `CGO_ENABLED=1` option:
** `rhacs-main-rhel8`
** `rhacs-rhel8-operator`
** `rhacs-scanner-rhel8`
** `rhacs-scanner-slim-rhel8`
** `rhacs-roxctl-rhel8`
+
However, the `roxctl` binary which you download from the {product-title-short} portal is still statically linked.


[id="deprecated-and-removed-features_{context}"]
== Deprecated and removed features

Some features available in previous releases have been deprecated or removed.

Deprecated functionality is still included in {product-title-short} and continues to be supported; however, it will be removed in a future release of this product and is not recommended for new deployments.
For the most recent list of major functionality deprecated and removed, see the following table.
Additional information about some removed or deprecated functionality is available after the table.

In the table, features are marked with the following statuses:

* GA: General Availability
* TP: Technology Preview
* DEP: Deprecated
* REM: Removed
* NA: Not applicable

.Deprecated and removed features tracker
[cols="3,1,1,1",options="header"]
|====
| Feature | {product-title-short} 3.74 |{product-title-short} 4.0 | {product-title-short} 4.2

| Examining images for Application-level dependencies for vulnerability reporting: `dotnet/shared/Microsoft.AspNetCore.App/` and `dotnet/shared/Microsoft.NETCore.App/`
| DEP
| DEP
| DEP

| `Expiration` field in `Exclusion` proto
| DEP
| DEP
| DEP

| Kernel module collection method
| DEP
| REM
| NA

| Network Graph version 1.0
| DEP
| REM
| NA

| `roxctl scanner generate` flag `offline-mode` (flag only)
| DEP
| DEP
| REM

| `roxctl generate netpol`
| NA
| NA
| DEP

| `roxctl connectivity-map`
| NA
| NA
| DEP

| `/v1/report` endpoint
| DEP
| DEP
| DEP

| `/v1/serviceaccounts` endpoint
| DEP
| DEP
| DEP

| Vulnerability Management 1.0: Image CVEs, Image Components, Images, Deployments, and Namespaces.
| GA
| DEP
| DEP

| Custom Security Context Constraints (SCCs): `stackrox-collector`,`stackrox-admission-control`, and `stackrox-sensor`
| GA
| DEP
| DEP

| `Vulnerability Management Approver` permission
| GA
| DEP
| DEP

| `Vulnerability Management Requester` permission
| GA
| DEP
| DEP

| `Vulnerability Report Creator` permission
| GA
| GA
| DEP

| `Vulnerability Reports` and `Policy` permission
| DEP
| REM
| NA

| `Role` resource
| DEP
| REM
| NA

| `Scope Manager` system role and permission set
| DEP
| REM
| NA

| `ROX_FORCE_LOCAL_IMAGE_SCANNING` environment variable
| DEP
| REM
| NA

| CIS Docker v1.2.0 Compliance Standard
| NA
| NA
| DEP

|====


[id="deprecated-features_{context}"]
=== Deprecated features

The following section provides additional information about deprecated features listed in the preceding table.

* Red Hat has deprecated the following commands for build-time network policy generation (Technology Preview) feature:
** `roxctl generate netpol`, use the `roxctl netpol generate` command instead.
** `roxctl connectivity-map`, use the `roxctl netpol connectivity map` command instead.
* Red Hat is scheduled to remove the CIS Docker v1.2.0 standard from {product-title-short} Compliance checks starting in {product-title-short} 4.4.
* Starting with version 4.0, {product-title-short} does not evaluate the risk associated with service account permissions for deployments.

[id="removed-features_{context}"]
=== Removed features

The following section provides additional information about the removed features listed in the preceding table.

[id="dark-mode_{context}"]
==== Dark mode
Dark mode in {product-title-managed-short} had rendering issues with buttons and images, leading to an inconsistent experience. Therefore, the dark mode and its toggle button are now removed from the navigation. (ROX-16515)

[id="pdf-export_{context}"]
==== PDF export
Red Hat removed the PDF export feature from the Vulnerability Management dashboard. Instead, you can use the updated vulnerability reporting feature in Vulnerability Management 2.0 (Technology Preview). (ROX-16394)

:FeatureName: Vulnerability Management 2.0
include::snippets/technology-preview.adoc[]

[id="report-configuration-without-an-associated-collection"]
==== Report configuration without an associated collection

In version 4.0, {product-title-short} released the collections feature that replaced access scopes used in report configurations.
{product-title-short} automatically created equivalent collections for access scopes used in existing report configurations and migrated report configurations to use newly-created collections.
If the migration failed, the report configurations became non-functional, and {product-title-short} logged the error messages in Central logs and in the {product-title-short} web portal.

{product-title-short} 4.2 deletes the report configurations that could not be migrated.
To avoid losing any existing report configurations, create valid collections for reports that failed the migration and attach the collection to the report configuration before you upgrade to {product-title-short} 4.2.

For more information on collections, see xref:../operating/create-use-collections.adoc#create-use-collections[Creating and using deployment collections].

[id="offline-mode-flag"]
==== Offline-mode flag
Red Hat has removed the `--offline-mode` flag for the `roxctl scanner generate` command.

[id="use-container-iam-role-option-in-ecr-integration-for-rhacs-cloud-service"]
==== Use Container IAM role option in ECR integration for {product-title-managed-short}
Red Hat has removed the *Use Container IAM role* option from {product-title-managed-short} from the ECR integration configuration page.

[id="notice-for-upcoming-changes"]
== Notice for upcoming changes

* Previously, the Syslog notifier sent an incorrect message header; {product-title-short} flipped the severity and name fields. When configuring the notifier, you can now select the following options:
** `CEF`: The corrected message header. Default option when you are configuring using the {product-title-short} portal.
** `CEF (legacy field order)`: This is the previous incorrect message header. Default option if you use API and do not specify a value for the message header. Red Hat plans to remove the wrong message header option `CEF (legacy field order)` in version 4.4. Additionally, all legacy field order notifiers will be migrated to `CEF`.
* In a future version, Red Hat plans to enable authentication for the following API endpoints:
** `/v1/featureflags`
** `/v1/resources`
* If you are using these API endpoints, you must prepare to use them with authentication.
* Starting from {product-title-short} 4.3, Red Hat will not support rolling back to {product-title-short} 3.x or {product-title-short} 4.0.
* Red Hat has delayed the removal of the `/v1/report` API endpoint in {product-title-short} 4.2; it will now be removed in {product-title-short} 4.3.
* Red Hat will remove the following widgets from the Compliance dashboard in {product-title-short} 4.4:
** CIS Docker v1.2.0 Compliance
** PCI DSS 3.2.1 Compliance
** CIS Kubernetes v1.5 Compliance
** NIST SP 800-53 Compliance
** NIST SP 800-190 Compliance
** HIPAA 164 Compliance
//removed ocp4-cis and ocp4-cis-node per dcaspin because only applies to users of compliance operator

[id="bug-fixes_{context}"]
== Bug fixes

[id="resolved-in-version-420_{context}"]
=== Resolved in version 4.2.0

*Release date*: 18 September 2023

* Previously, if a non-blocking socket failed to open a connection, Collector would still report that as a connection. This issue has been fixed. (ROX-17486)
* In {product-title-short} 4.2, Collector correctly handles asynchronous connection establishment.(ROX-17486)
* Previously, Operator installations broke if the OpenShift cluster-wide proxy was enabled and Central or SecuredCluster CR configured an egress proxy environment variable. This issue is fixed. (ROX-18477)
* Previously, when using eBPF on IBM Z, {product-title-short} reported incorrect process UNIX group IDs (GID). This issue is now fixed. (ROX-17459)
* In previous {product-title-short} versions, there was a mismatch in the number of CVEs reported by JSON output and table output. This issue is now fixed. (ROX-15277)
* Previously, integrating {product-title-short} with Jira failed when you used an OAuth token or JWT while configuring the integration. This issue is fixed. (ROX-17992)

[id="resolved-in-version-4201_{context}"]
=== Resolved in version 4.2.1

*Release date*: 3 October 2023

* A sensor panic could occur in version 4.2.0 if a cluster contained deployments with an invalid image reference, for example, `image: " "`, and delegated scanning was enabled for all registries. This issue has been fixed.
* The minimum permissions required to display 6 of the sidebar links in the {product-title-short} web portal were too strict in the 4.2.0 release, and are reduced in this release.

[id="image-versions_{context}"]
== Image versions

[%header,cols="1,1,2"]
|===
| Image | Description | Current version

| Main
| Includes Central, Sensor, Admission controller, and Compliance. Also includes `roxctl` for use in continuous integration (CI) systems.
a| `registry.redhat.io/advanced-cluster-security/rhacs-main-rhel8:4.2.0`

| Scanner
| Scans images and nodes.
a|`registry.redhat.io/advanced-cluster-security/rhacs-scanner-rhel8:4.2.0`

| Scanner DB
| Stores image scan results and vulnerability definitions.
a|`registry.redhat.io/advanced-cluster-security/rhacs-scanner-db-rhel8:4.2.0`

| Collector
| Collects runtime activity in Kubernetes or {ocp} clusters.
a| * `registry.redhat.io/advanced-cluster-security/rhacs-collector-rhel8:4.2.0`
* `registry.redhat.io/advanced-cluster-security/rhacs-collector-slim-rhel8:4.2.0`

| Central DB
| Postgres instance that provides the database storage for Central.
a| `registry.redhat.io/advanced-cluster-security/rhacs-central-db-rhel8:4.2.0`
|===
